
import React, { useMemo, useState, useEffect, useRef } from 'react';
import { evaluate } from 'mathjs';

// Safe formula evaluator that prevents code injection
const createSafeEvaluator = () => {
   // Whitelist of allowed identifiers
   const ALLOWED_FUNCTIONS = new Set([
      'sin', 'cos', 'tan', 'asin', 'acos', 'atan', 'atan2',
      'sqrt', 'pow', 'abs', 'log', 'log10', 'exp',
      'floor', 'ceil', 'round', 'min', 'max',
      'PI', 'E', 'pi', 'e'
   ]);

   // Dangerous patterns to block
   const DANGEROUS_PATTERNS = [
      /\beval\b/i, /\bfunction\b/i, /=>/,
      /\bconstructor\b/i, /\bprototype\b/i, /\b__proto__\b/,
      /\bwindow\b/i, /\bdocument\b/i, /\bfetch\b/i,
      /\bimport\b/i, /\brequire\b/i, /\bprocess\b/i,
      /\bglobal\b/i, /\bthis\b/i, /\bnew\b/i
   ];

   return (formula: string, variables: Record<string, number>, calculations: Record<string, number> = {}): number => {
      if (typeof formula !== 'string') return Number(formula) || 0;

      // Check for dangerous patterns
      for (const pattern of DANGEROUS_PATTERNS) {
         if (pattern.test(formula)) {
            console.warn('Blocked dangerous formula pattern:', formula);
            return 0;
         }
      }

      try {
         // Transform formula to mathjs format
         let safeFormula = formula
            // Replace Math.X with just X (mathjs uses lowercase)
            .replace(/Math\.(sin|cos|tan|asin|acos|atan|atan2|sqrt|pow|abs|log|log10|exp|floor|ceil|round|min|max|PI|E)/gi,
               (_, fn) => fn.toLowerCase())
            // Replace variables.X and calculations.X with actual values
            .replace(/variables\.(\w+)/g, (_, name) => String(variables[name] ?? 0))
            .replace(/calculations\.(\w+)/g, (_, name) => String(calculations[name] ?? 0));

         // Evaluate using mathjs (sandboxed)
         const result = evaluate(safeFormula);
         return typeof result === 'number' ? result : (result === true ? 1 : (result === false ? 0 : Number(result) || 0));
      } catch (error) {
         // Silent fail - return 0 for invalid formulas
         return 0;
      }
   };
};

const safeEvaluate = createSafeEvaluator();

interface DiagramProps {
   type: string;
   data: string | any;
   title: string;
}

// --- DYNAMIC BLUEPRINT ENGINE TYPES ---
interface BlueprintVariable {
   label: string;
   min: number;
   max: number;
   value: number;
   step?: number;
   unit?: string;
}

interface BlueprintElement {
   type: 'rect' | 'circle' | 'line' | 'text' | 'emoji' | 'path';
   id: string;
   attributes: Record<string, string | number>; // Values can be formulas e.g., "variables.x * 2"
   content?: string;
}

interface BlueprintChallenge {
   goal: string; // Formula evaluating to boolean, e.g. "variables.x > 10 && variables.x < 20"
   constraints?: { label: string, condition: string }[]; // Conditions that must be met
   feedback: { success: string, failure: string };
}

interface BlueprintData {
   scenario: string;
   variables: Record<string, BlueprintVariable>;
   calculations?: Record<string, string>;
   elements: BlueprintElement[];
   challenge?: BlueprintChallenge;
   insight: string;
}

const GeneratedDiagram: React.FC<DiagramProps> = ({ type, data, title }) => {
   const parsedData = useMemo(() => {
      console.log("[GeneratedDiagram] Received:", { type, data: typeof data, title });

      if (!data) {
         console.warn("[GeneratedDiagram] No data provided");
         return null;
      }

      try {
         // If data is already an object (not a string), use it directly
         if (typeof data === 'object') {
            console.log("[GeneratedDiagram] Data is already an object:", data);
            return data;
         }

         // Clean up common JSON issues before parsing
         let cleanedData = data
            // Remove trailing commas before } or ]
            .replace(/,\s*([}\]])/g, '$1')
            // Fix unescaped newlines in strings
            .replace(/\n/g, '\\n')
            // Remove any BOM or invisible characters
            .replace(/^\uFEFF/, '')
            .trim();

         // Try to parse JSON string
         const parsed = JSON.parse(cleanedData);
         console.log("[GeneratedDiagram] Parsed data:", parsed);
         return parsed;
      } catch (e) {
         console.error("[GeneratedDiagram] JSON parse error:", e, "Raw data:", data);

         // Try one more time with aggressive cleanup
         try {
            let aggressiveClean = data
               .replace(/,\s*}/g, '}')
               .replace(/,\s*]/g, ']')
               .replace(/[\x00-\x1F\x7F]/g, '') // Remove control characters
               .trim();
            const parsed = JSON.parse(aggressiveClean);
            console.log("[GeneratedDiagram] Parsed with aggressive cleanup:", parsed);
            return parsed;
         } catch (e2) {
            console.error("[GeneratedDiagram] Aggressive parse also failed:", e2);
            return null;
         }
      }
   }, [data]);

   // --- DYNAMIC BLUEPRINT RENDERER ---
   const DynamicBlueprintRenderer = () => {
      const blueprint = parsedData as BlueprintData;

      // Validation: Ensure blueprint has required fields
      if (!blueprint || !blueprint.variables || !blueprint.elements) {
         return (
            <div className="h-full flex flex-col items-center justify-center p-8 bg-amber-50">
               <div className="max-w-md text-center">
                  <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-amber-100 flex items-center justify-center">
                     <i className="fa-solid fa-triangle-exclamation text-2xl text-amber-600"></i>
                  </div>
                  <h3 className="text-lg font-bold text-slate-800 mb-2">Blueprint Data Issue</h3>
                  <p className="text-sm text-slate-600 mb-4">The interactive graphic couldn't be rendered due to missing or invalid data.</p>
                  <div className="text-left bg-white p-4 rounded-lg border border-amber-200 text-xs font-mono overflow-auto max-h-48">
                     <p className="text-amber-700 mb-2">Expected: variables, elements, scenario</p>
                     <p className="text-slate-500">Received: {JSON.stringify(blueprint, null, 2).slice(0, 300)}...</p>
                  </div>
               </div>
            </div>
         );
      }

      // Initialize state from blueprint defaults
      const [variables, setVariables] = useState<Record<string, number>>(() => {
         const init: Record<string, number> = {};
         Object.entries(blueprint.variables || {}).forEach(([key, conf]) => {
            init[key] = conf.value;
         });
         return init;
      });

      const [challengeState, setChallengeState] = useState<'idle' | 'success' | 'failure'>('idle');
      const [feedbackMsg, setFeedbackMsg] = useState<string>("");

      // Helper: Safe evaluation of formulas (uses mathjs instead of new Function to prevent code injection)
      const evaluateFormula = (formula: string | number): any => {
         if (typeof formula === 'number') return formula;
         if (!formula || (!formula.includes('variables') && !formula.includes('Math') && !formula.includes('calculations'))) return formula;

         // Calculate derived values first
         const calculatedValues: Record<string, number> = {};
         if (blueprint.calculations) {
            Object.entries(blueprint.calculations).forEach(([key, calcFormula]) => {
               calculatedValues[key] = safeEvaluate(calcFormula as string, variables, {});
            });
         }

         // Evaluate the main formula using the safe evaluator
         return safeEvaluate(formula, variables, calculatedValues);
      };

      // Check Challenge Status
      useEffect(() => {
         if (!blueprint.challenge) return;

         const isGoalMet = evaluateFormula(blueprint.challenge.goal);
         const constraintsMet = blueprint.challenge.constraints ? blueprint.challenge.constraints.every(c => evaluateFormula(c.condition)) : true;

         if (isGoalMet && constraintsMet) {
            setChallengeState('success');
            setFeedbackMsg(blueprint.challenge.feedback.success);
         } else if (!constraintsMet) {
            // Find which constraint failed
            const failed = blueprint.challenge.constraints?.find(c => !evaluateFormula(c.condition));
            setChallengeState('failure');
            setFeedbackMsg(failed ? `Constraint Violated: ${failed.label}` : blueprint.challenge.feedback.failure);
         } else {
            setChallengeState('idle');
            setFeedbackMsg("");
         }
      }, [variables, blueprint.challenge]);

      // Derived calculations for display
      const currentCalculations = useMemo(() => {
         const calc: Record<string, number> = {};
         if (blueprint.calculations) {
            Object.entries(blueprint.calculations).forEach(([key, formula]) => {
               calc[key] = Number(evaluateFormula(formula)); // Re-use eval logic
            });
         }
         return calc;
      }, [variables, blueprint.calculations]);


      return (
         <div className="w-full h-full bg-slate-50 flex flex-col md:flex-row overflow-hidden relative">
            {/* VISUALIZATION CANVAS */}
            <div className="flex-1 relative flex items-center justify-center p-8 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')]">
               <div className="relative z-10 w-full max-w-2xl aspect-[4/3] bg-white rounded-3xl shadow-2xl overflow-hidden border border-slate-200">
                  <svg viewBox="0 0 800 600" className="w-full h-full">
                     <defs>
                        <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                           <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#f1f5f9" strokeWidth="1" />
                        </pattern>
                     </defs>
                     <rect width="100%" height="100%" fill="url(#grid)" />

                     {/* Render Dynamic Elements */}
                     {blueprint.elements?.map((el, i) => {
                        // Evaluate all dynamic attributes
                        const attrs: any = {};
                        Object.entries(el.attributes || {}).forEach(([attrKey, attrVal]) => {
                           attrs[attrKey] = evaluateFormula(attrVal);
                        });

                        // React key
                        const key = el.id || i;

                        switch (el.type) {
                           case 'rect':
                              return <rect key={key} {...attrs} />;
                           case 'circle':
                              return <circle key={key} {...attrs} />;
                           case 'line':
                              return <line key={key} {...attrs} strokeLinecap="round" />;
                           case 'text':
                              // Support template syntax: "Thrust: {{calculations.thrust}} N"
                              let textContent = el.content || attrs.text || '';
                              if (typeof textContent === 'string' && textContent.includes('{{')) {
                                 textContent = textContent.replace(/\{\{([^}]+)\}\}/g, (_, expr) => {
                                    const val = evaluateFormula(expr.trim());
                                    return typeof val === 'number' ? val.toFixed(1) : val;
                                 });
                              } else if (typeof textContent === 'string' && (textContent.includes('calculations.') || textContent.includes('variables.'))) {
                                 // If it's just a formula without template
                                 const val = evaluateFormula(textContent);
                                 textContent = typeof val === 'number' ? val.toFixed(1) : val;
                              }
                              return <text key={key} {...attrs} textAnchor="middle" alignmentBaseline="middle">{textContent}</text>;
                           case 'emoji':
                              return (
                                 <text key={key} x={attrs.x} y={attrs.y} fontSize={attrs.fontSize || 40} textAnchor="middle" alignmentBaseline="middle">
                                    {el.content}
                                 </text>
                              );
                           default: return null;
                        }
                     })}
                  </svg>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full md:w-80 bg-white border-l border-slate-100 p-6 flex flex-col gap-6 shadow-[-10px_0_40px_rgba(0,0,0,0.02)] z-20 overflow-y-auto">
               <div className="mb-2">
                  <h3 className="text-xs font-black text-indigo-500 uppercase tracking-widest mb-1">Interactive Lab</h3>
                  <p className="text-lg font-serif font-bold text-slate-800 leading-tight">{blueprint.scenario}</p>
               </div>

               {/* Variable Controls */}
               <div className="space-y-6">
                  {Object.entries(blueprint.variables || {}).map(([key, conf]) => (
                     <div key={key}>
                        <div className="flex justify-between mb-2">
                           <label className="text-xs font-bold text-slate-500 uppercase">{conf.label}</label>
                           <span className="text-xs font-mono font-bold text-indigo-600">
                              {variables[key]} <span className="text-slate-400">{conf.unit}</span>
                           </span>
                        </div>
                        <input
                           type="range"
                           min={conf.min} max={conf.max} step={conf.step || 1}
                           value={variables[key]}
                           onChange={(e) => setVariables(prev => ({ ...prev, [key]: Number(e.target.value) }))}
                           className="w-full h-2 bg-slate-100 rounded-full appearance-none cursor-pointer accent-indigo-500"
                        />
                     </div>
                  ))}
               </div>

               {/* Live Calculations */}
               {Object.keys(currentCalculations).length > 0 && (
                  <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100 space-y-2">
                     <div className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Real-time Metrics</div>
                     {Object.entries(currentCalculations).map(([key, val]) => (
                        <div key={key} className="flex justify-between items-center">
                           <span className="text-xs font-medium text-slate-600 capitalize">{key.replace(/_/g, ' ')}</span>
                           <span className="text-sm font-mono font-bold text-slate-900">{typeof val === 'number' ? val.toFixed(1) : val}</span>
                        </div>
                     ))}
                  </div>
               )}

               <div className="mt-auto pt-6 border-t border-slate-100">
                  {/* Challenge Feedback */}
                  {blueprint.challenge && (
                     <div className={`mb-4 p-3 rounded-xl border ${challengeState === 'success' ? 'bg-green-50 border-green-200 text-green-800' : challengeState === 'failure' ? 'bg-red-50 border-red-200 text-red-800' : 'bg-slate-50 border-slate-200 text-slate-600'}`}>
                        <div className="flex items-center gap-2 mb-1">
                           <i className={`fa-solid ${challengeState === 'success' ? 'fa-check-circle' : challengeState === 'failure' ? 'fa-triangle-exclamation' : 'fa-circle-question'}`}></i>
                           <span className="text-xs font-black uppercase tracking-widest">{challengeState === 'success' ? 'Success' : challengeState === 'failure' ? 'Warning' : 'Challenge Active'}</span>
                        </div>
                        <p className="text-xs font-bold leading-tight">{feedbackMsg || "Adjust variables to meet the goal."}</p>
                     </div>
                  )}

                  <div className="flex gap-3">
                     <div className="w-8 h-8 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0">
                        <i className="fa-solid fa-lightbulb"></i>
                     </div>
                     <p className="text-xs text-slate-600 italic leading-relaxed">
                        {blueprint.insight}
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- MULTI-STEP EQUATIONS RENDERER ---
   const MultiStepEquationsRenderer = () => {
      const config = parsedData || {
         initialEquation: { left: "2x + 5", right: "13" },
         steps: [
            { type: 'subtract', value: 5, target: '2x + 5', result: '2x' },
            { type: 'divide', value: 2, target: '2x', result: 'x' }
         ],
         goal: "x"
      };

      const [current, setCurrent] = useState(config.initialEquation);
      const [history, setHistory] = useState([{ ...config.initialEquation, op: "Start" }]);
      const [isSolved, setIsSolved] = useState(false);

      const handleStep = (step: any) => {
         if (isSolved) return;

         const newVal = step.type === 'subtract'
            ? (parseInt(current.right) - step.value).toString()
            : (parseInt(current.right) / step.value).toString();

         const nextState = { left: step.result, right: newVal };
         setHistory([...history, { ...nextState, op: `${step.type === 'subtract' ? '-' : '√∑'} ${step.value}` }]);
         setCurrent(nextState);
         if (step.result === config.goal) setIsSolved(true);
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col items-center justify-center p-8">
            <div className="max-w-2xl w-full bg-white rounded-3xl shadow-xl p-8 border border-slate-200">
               <div className="text-center mb-8">
                  <h3 className="text-2xl font-bold text-slate-800 mb-2">Escape Room: Unlock the Variable</h3>
                  <p className="text-slate-500 italic">Apply operations to both sides to isolate {config.goal}!</p>
               </div>

               <div className="flex items-center justify-center gap-8 mb-12">
                  <div className="p-6 bg-indigo-50 rounded-2xl border-2 border-indigo-200 min-w-[120px] text-center shadow-inner">
                     <span className="text-3xl font-mono font-bold text-indigo-600">{current.left}</span>
                  </div>
                  <div className="text-4xl font-bold text-slate-300">=</div>
                  <div className="p-6 bg-indigo-50 rounded-2xl border-2 border-indigo-200 min-w-[120px] text-center shadow-inner">
                     <span className="text-3xl font-mono font-bold text-indigo-600">{current.right}</span>
                  </div>
               </div>

               <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
                  {config.steps.map((s: any, i: number) => (
                     <button
                        key={i}
                        onClick={() => handleStep(s)}
                        disabled={current.left !== s.target || isSolved}
                        className="p-4 bg-slate-800 text-white rounded-xl font-bold hover:bg-slate-700 disabled:opacity-30 disabled:cursor-not-allowed transition-all shadow-lg active:scale-95"
                     >
                        {s.type === 'subtract' ? 'Subtract' : 'Divide'} {s.value} from both sides
                     </button>
                  ))}
               </div>

               <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100">
                  <h4 className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">Operation History</h4>
                  <div className="space-y-3">
                     {history.map((h, i) => (
                        <div key={i} className="flex justify-between items-center text-sm">
                           <div className="flex items-center gap-3">
                              <span className="w-6 h-6 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-[10px] font-bold">{i}</span>
                              <span className="text-slate-500 font-medium">{h.op}</span>
                           </div>
                           <span className="font-mono font-bold text-slate-700">{h.left} = {h.right}</span>
                        </div>
                     ))}
                  </div>
               </div>

               {isSolved && (
                  <div className="mt-8 p-6 bg-green-50 border-2 border-green-200 rounded-2xl text-green-800 text-center animate-in fade-in zoom-in duration-500">
                     <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                        <i className="fa-solid fa-unlock text-2xl text-green-600"></i>
                     </div>
                     <h4 className="text-xl font-bold mb-1">Variable Unlocked!</h4>
                     <p className="text-sm opacity-80">{config.goal} = {current.right}</p>
                  </div>
               )}
            </div>
         </div>
      );
   };

   // --- VARIABLES ON BOTH SIDES RENDERER ---
   const VariablesBothSidesRenderer = () => {
      const config = parsedData || {
         initial: { left: ["3x", "5"], right: ["x", "13"] },
         goal: "2x = 8"
      };

      const [state, setState] = useState(config.initial);
      const [isSolved, setIsSolved] = useState(false);

      const moveTerm = (term: string, from: 'left' | 'right') => {
         if (isSolved) return;

         const newState = {
            left: [...state.left],
            right: [...state.right]
         };

         if (term === 'x' && from === 'right') {
            newState.right = state.right.filter(t => t !== 'x');
            newState.left = ["2x", "5"];
            setState(newState);
            if (newState.left.join(" ") === "2x 5" && newState.right.join(" ") === "13") {
               setIsSolved(true);
            }
         }
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col items-center justify-center p-8">
            <div className="max-w-4xl w-full bg-white rounded-3xl shadow-xl p-12 border border-slate-200 relative overflow-hidden">
               <div className="absolute top-0 left-0 w-full h-2 bg-indigo-500"></div>

               <div className="text-center mb-12">
                  <h3 className="text-3xl font-serif font-bold text-slate-800 mb-2">Equation Tug-of-War</h3>
                  <p className="text-slate-500 italic">Gather your variables on one side and numbers on the other!</p>
               </div>

               <div className="relative h-48 flex items-center justify-between mb-12 px-12">
                  <div className="absolute top-1/2 left-0 w-full h-1 bg-slate-200 -translate-y-1/2"></div>

                  <div className="relative z-10 flex gap-3">
                     {state.left.map((t: string, i: number) => (
                        <div key={i} className={`px-6 py-4 rounded-xl shadow-lg border-2 font-mono font-bold text-xl transition-all hover:-translate-y-1 cursor-pointer ${t.includes('x') ? 'bg-indigo-600 border-indigo-400 text-white' : 'bg-amber-500 border-amber-300 text-white'}`}>
                           {t}
                        </div>
                     ))}
                  </div>

                  <div className="relative z-20 w-16 h-16 bg-white rounded-full border-4 border-slate-200 flex items-center justify-center shadow-xl">
                     <span className="text-2xl font-black text-slate-300">=</span>
                  </div>

                  <div className="relative z-10 flex gap-3">
                     {state.right.map((t: string, i: number) => (
                        <div key={i} className={`px-6 py-4 rounded-xl shadow-lg border-2 font-mono font-bold text-xl transition-all hover:-translate-y-1 cursor-pointer ${t.includes('x') ? 'bg-indigo-600 border-indigo-400 text-white' : 'bg-amber-500 border-amber-300 text-white'}`}>
                           {t}
                        </div>
                     ))}
                  </div>
               </div>

               <div className="grid grid-cols-2 gap-6">
                  <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Strategy: Variables</h4>
                     <button
                        onClick={() => moveTerm('x', 'right')}
                        disabled={!state.right.includes('x')}
                        className="w-full p-4 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition-all shadow-md active:scale-95 disabled:opacity-30"
                     >
                        Subtract 'x' from both sides
                     </button>
                  </div>
                  <div className="p-6 bg-slate-50 rounded-2xl border border-slate-100">
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Strategy: Constants</h4>
                     <button
                        disabled
                        className="w-full p-4 bg-amber-600 text-white rounded-xl font-bold hover:bg-amber-700 transition-all shadow-md active:scale-95 opacity-30"
                     >
                        Subtract '5' from both sides
                     </button>
                  </div>
               </div>

               {isSolved && (
                  <div className="mt-8 p-4 bg-green-50 border border-green-200 rounded-xl text-green-800 text-center animate-bounce">
                     <span className="font-bold">Great job! You gathered the variables. Now solve for x!</span>
                  </div>
               )}
            </div>
         </div>
      );
   };

   // --- LINEAR INEQUALITIES RENDERER ---
   const LinearInequalitiesRenderer = () => {
      const config = parsedData || {
         inequality: "v ‚â§ 65",
         limit: 65,
         variable: "v",
         unit: "mph",
         label: "Speed"
      };

      const [value, setValue] = useState(45);
      const isLegal = value <= config.limit;

      return (
         <div className="w-full h-full bg-slate-900 flex flex-col items-center justify-center p-8 overflow-hidden">
            <div className="max-w-4xl w-full relative h-[400px] bg-slate-800 rounded-3xl border-4 border-slate-700 shadow-2xl overflow-hidden mb-8">
               <div className="absolute bottom-0 w-full h-32 bg-slate-700">
                  <div className="absolute top-1/2 w-full h-2 border-t-4 border-dashed border-slate-500"></div>
               </div>

               <div className="absolute top-12 right-12 w-24 h-32 bg-white rounded-lg border-4 border-slate-900 flex flex-col items-center p-2 shadow-xl">
                  <span className="text-[10px] font-black text-slate-900 uppercase">Speed Limit</span>
                  <span className="text-4xl font-black text-slate-900 mt-2">{config.limit}</span>
               </div>

               <div
                  className="absolute bottom-12 transition-all duration-500 ease-out"
                  style={{ left: `${(value / 120) * 80}%` }}
               >
                  <div className="relative">
                     <span className="text-6xl">üöó</span>
                     <div className="absolute -top-12 left-1/2 -translate-x-1/2 bg-white px-3 py-1 rounded-full shadow-lg border-2 border-slate-200">
                        <span className="text-sm font-bold text-slate-800">{value} {config.unit}</span>
                     </div>
                  </div>
               </div>

               <div className={`absolute top-12 left-12 px-6 py-3 rounded-2xl border-4 font-black text-2xl uppercase tracking-widest transition-all ${isLegal ? 'bg-green-500/20 border-green-500 text-green-500' : 'bg-red-500/20 border-red-500 text-red-500'}`}>
                  {isLegal ? 'Legal' : 'Illegal'}
               </div>
            </div>

            <div className="max-w-2xl w-full bg-white rounded-2xl p-8 shadow-xl">
               <div className="flex justify-between items-center mb-6">
                  <div>
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-1">Inequality</h4>
                     <span className="text-3xl font-mono font-bold text-indigo-600">{config.inequality}</span>
                  </div>
                  <div className="text-right">
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-1">Current {config.label}</h4>
                     <span className={`text-3xl font-mono font-bold ${isLegal ? 'text-green-600' : 'text-red-600'}`}>{value} {config.unit}</span>
                  </div>
               </div>

               <input
                  type="range"
                  min="0" max="120"
                  value={value}
                  onChange={(e) => setValue(parseInt(e.target.value))}
                  className="w-full h-4 bg-slate-100 rounded-full appearance-none cursor-pointer accent-indigo-500 mb-4"
               />

               <div className="flex justify-between text-[10px] font-bold text-slate-400 uppercase">
                  <span>0 {config.unit}</span>
                  <span>60 {config.unit}</span>
                  <span>120 {config.unit}</span>
               </div>
            </div>
         </div>
      );
   };

   // --- INEQUALITIES NUMBER LINE RENDERER ---
   const InequalitiesNumberLineRenderer = () => {
      const [value, setValue] = useState(0);
      const [isClosed, setIsClosed] = useState(true);
      const [direction, setDirection] = useState<'left' | 'right'>('right');

      const inequality = `x ${direction === 'right' ? (isClosed ? '‚â•' : '>') : (isClosed ? '‚â§' : '<')} ${value}`;

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col items-center justify-center p-8">
            <div className="max-w-4xl w-full bg-white rounded-3xl shadow-xl p-12 border border-slate-200">
               <div className="text-center mb-12">
                  <h3 className="text-2xl font-bold text-slate-800 mb-2">Inequality Grapher</h3>
                  <div className="inline-block px-6 py-3 bg-indigo-600 text-white rounded-2xl text-4xl font-mono font-bold shadow-lg">
                     {inequality}
                  </div>
               </div>

               <div className="relative h-32 mb-12">
                  <svg viewBox="0 0 800 100" className="w-full h-full overflow-visible">
                     <line x1="50" y1="50" x2="750" y2="50" stroke="#cbd5e1" strokeWidth="2" />
                     {[-5, -4, -3, -2, -1, 0, 1, 2, 3, 4, 5].map(num => {
                        const x = 400 + num * 60;
                        return (
                           <g key={num}>
                              <line x1={x} y1="45" x2={x} y2="55" stroke="#94a3b8" strokeWidth="2" />
                              <text x={x} y="75" textAnchor="middle" fontSize="12" fill="#64748b" fontWeight="bold">{num}</text>
                           </g>
                        );
                     })}
                     <line
                        x1={400 + value * 60}
                        y1="50"
                        x2={direction === 'right' ? 750 : 50}
                        y2="50"
                        stroke="#6366f1"
                        strokeWidth="8"
                        strokeOpacity="0.3"
                     />
                     <circle
                        cx={400 + value * 60}
                        cy="50"
                        r="8"
                        fill={isClosed ? "#6366f1" : "white"}
                        stroke="#6366f1"
                        strokeWidth="3"
                     />
                  </svg>
               </div>

               <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                  <div className="space-y-4">
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest">1. Set Value</h4>
                     <input
                        type="range"
                        min="-5" max="5" step="1"
                        value={value}
                        onChange={(e) => setValue(parseInt(e.target.value))}
                        className="w-full h-2 bg-slate-100 rounded-full appearance-none cursor-pointer accent-indigo-500"
                     />
                     <div className="text-center font-bold text-slate-600">{value}</div>
                  </div>
                  <div className="space-y-4">
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest">2. Circle Type</h4>
                     <div className="flex gap-2">
                        <button
                           onClick={() => setIsClosed(false)}
                           className={`flex-1 p-3 rounded-xl border-2 font-bold transition-all ${!isClosed ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'bg-white border-slate-200 text-slate-400'}`}
                        >
                           Open
                        </button>
                        <button
                           onClick={() => setIsClosed(true)}
                           className={`flex-1 p-3 rounded-xl border-2 font-bold transition-all ${isClosed ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'bg-white border-slate-200 text-slate-400'}`}
                        >
                           Closed
                        </button>
                     </div>
                  </div>
                  <div className="space-y-4">
                     <h4 className="text-xs font-black text-slate-400 uppercase tracking-widest">3. Direction</h4>
                     <div className="flex gap-2">
                        <button
                           onClick={() => setDirection('left')}
                           className={`flex-1 p-3 rounded-xl border-2 font-bold transition-all ${direction === 'left' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'bg-white border-slate-200 text-slate-400'}`}
                        >
                           Left
                        </button>
                        <button
                           onClick={() => setDirection('right')}
                           className={`flex-1 p-3 rounded-xl border-2 font-bold transition-all ${direction === 'right' ? 'bg-indigo-50 border-indigo-500 text-indigo-700' : 'bg-white border-slate-200 text-slate-400'}`}
                        >
                           Right
                        </button>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- INDEPENDENT/DEPENDENT VARIABLES RENDERER ---
   const IndependentDependentVariablesRenderer = () => {
      const [input, setInput] = useState(5);
      const [isProcessing, setIsProcessing] = useState(false);
      const [output, setOutput] = useState(10);

      const process = (val: number) => {
         setIsProcessing(true);
         setInput(val);
         setTimeout(() => {
            setOutput(val * 2);
            setIsProcessing(false);
         }, 800);
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col items-center justify-center p-8">
            <div className="max-w-4xl w-full bg-white rounded-3xl shadow-xl p-12 border border-slate-200">
               <div className="text-center mb-12">
                  <h3 className="text-2xl font-bold text-slate-800 mb-2">Cause & Effect Laboratory</h3>
                  <p className="text-slate-500 italic">The Independent variable CAUSES the Dependent variable to change.</p>
               </div>

               <div className="flex items-center justify-between gap-8 mb-12">
                  <div className="flex-1 flex flex-col items-center">
                     <div className="mb-4 px-4 py-2 bg-indigo-100 text-indigo-700 rounded-full text-xs font-black uppercase tracking-widest">Independent Variable</div>
                     <div className="w-32 h-32 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg relative">
                        <span className="text-4xl font-bold text-white">{input}</span>
                        <div className="absolute -bottom-4 w-8 h-8 bg-indigo-600 rotate-45"></div>
                     </div>
                     <div className="mt-8 w-full">
                        <input
                           type="range"
                           min="1" max="10"
                           value={input}
                           onChange={(e) => process(parseInt(e.target.value))}
                           className="w-full h-2 bg-slate-100 rounded-full appearance-none cursor-pointer accent-indigo-500"
                        />
                     </div>
                  </div>

                  <div className="w-48 h-48 bg-slate-800 rounded-3xl flex flex-col items-center justify-center relative shadow-2xl border-4 border-slate-700">
                     <div className="text-xs font-black text-slate-500 uppercase mb-2">The Rule</div>
                     <div className="text-2xl font-mono font-bold text-white">x √ó 2</div>
                     {isProcessing && (
                        <div className="absolute inset-0 bg-indigo-500/20 animate-pulse rounded-2xl flex items-center justify-center">
                           <i className="fa-solid fa-gear text-4xl text-white animate-spin"></i>
                        </div>
                     )}
                  </div>

                  <div className="flex-1 flex flex-col items-center">
                     <div className="mb-4 px-4 py-2 bg-amber-100 text-amber-700 rounded-full text-xs font-black uppercase tracking-widest">Dependent Variable</div>
                     <div className={`w-32 h-32 bg-amber-500 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-500 ${isProcessing ? 'scale-90 opacity-50' : 'scale-100 opacity-100'}`}>
                        <span className="text-4xl font-bold text-white">{output}</span>
                     </div>
                     <div className="mt-8 text-center text-slate-400 font-medium italic">
                        "I depend on the input!"
                     </div>
                  </div>
               </div>

               <div className="bg-slate-50 p-6 rounded-2xl border border-slate-100 flex gap-6 items-center">
                  <div className="w-12 h-12 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0">
                     <i className="fa-solid fa-flask-vial text-xl"></i>
                  </div>
                  <div>
                     <h4 className="text-sm font-bold text-slate-800 mb-1">Laboratory Insight</h4>
                     <p className="text-xs text-slate-600 leading-relaxed">
                        In this experiment, you control the <strong>Input</strong> (Independent). The <strong>Output</strong> (Dependent) changes automatically based on the rule. You can't change the output without changing the input first!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- CONCEPT 101: ANGLE TYPES RENDERER ---
   function AngleTypesRenderer() {
      const [angle, setAngle] = useState(45);
      const [showProtractor, setShowProtractor] = useState(true);
      const [showRealWorld, setShowRealWorld] = useState(false);

      const getAngleType = (deg: number) => {
         if (deg === 0) return { label: "ZERO", color: "text-slate-400", desc: "No opening between rays." };
         if (deg < 90) return { label: "ACUTE", color: "text-emerald-500", desc: "Less than 90¬∞, forms a sharp corner." };
         if (deg === 90) return { label: "RIGHT", color: "text-blue-500", desc: "Exactly 90¬∞, forms a perfect 'L' shape." };
         if (deg < 180) return { label: "OBTUSE", color: "text-orange-500", desc: "Greater than 90¬∞ but less than 180¬∞." };
         if (deg === 180) return { label: "STRAIGHT", color: "text-red-500", desc: "Exactly 180¬∞, forms a straight line." };
         return { label: "REFLEX", color: "text-purple-500", desc: "Greater than 180¬∞." };
      };

      const typeInfo = getAngleType(angle);

      const realWorldExamples: Record<string, { img: string, label: string }> = {
         ACUTE: { img: "üçï", label: "Pizza Slice" },
         RIGHT: { img: "üìÑ", label: "Paper Corner" },
         OBTUSE: { img: "ü™ë", label: "Reclining Chair" },
         STRAIGHT: { img: "üìè", label: "Straight Ruler" }
      };

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Angle Architect Studio</h2>
                  <p className="text-slate-500">Designing with Degrees</p>
               </div>
               <div className={`px-4 py-2 rounded-xl bg-slate-50 border border-slate-100 flex flex-col items-center min-w-[120px]`}>
                  <span className={`text-2xl font-black ${typeInfo.color}`}>{angle}¬∞</span>
                  <span className="text-[10px] font-bold uppercase tracking-wider text-slate-400">{typeInfo.label}</span>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-8 items-center justify-center">
               {/* ANGLE VISUALIZER */}
               <div className="relative w-64 h-64 flex items-center justify-center bg-slate-50 rounded-full border border-slate-100 shadow-inner">
                  {/* Protractor Background */}
                  {showProtractor && (
                     <svg className="absolute inset-0 w-full h-full opacity-20" viewBox="0 0 200 200">
                        <circle cx="100" cy="100" r="90" fill="none" stroke="currentColor" strokeWidth="1" strokeDasharray="2 2" />
                        {[...Array(13)].map((_, i) => {
                           const deg = i * 15;
                           const rad = (deg * Math.PI) / 180;
                           const x1 = 100 + Math.cos(rad) * 85;
                           const y1 = 100 - Math.sin(rad) * 85;
                           const x2 = 100 + Math.cos(rad) * 90;
                           const y2 = 100 - Math.sin(rad) * 90;
                           return <line key={deg} x1={x1} y1={y1} x2={x2} y2={y2} stroke="currentColor" strokeWidth="1" />;
                        })}
                     </svg>
                  )}

                  {/* The Angle */}
                  <svg className="w-full h-full overflow-visible" viewBox="0 0 200 200">
                     {/* Base Ray */}
                     <line x1="100" y1="100" x2="190" y2="100" stroke="#94a3b8" strokeWidth="4" strokeLinecap="round" />

                     {/* Rotating Ray */}
                     <line
                        x1="100" y1="100"
                        x2={100 + Math.cos((-angle * Math.PI) / 180) * 90}
                        y2={100 + Math.sin((-angle * Math.PI) / 180) * 90}
                        stroke="currentColor"
                        className={typeInfo.color}
                        strokeWidth="4"
                        strokeLinecap="round"
                     />

                     {/* Angle Arc */}
                     <path
                        d={`M 130 100 A 30 30 0 ${angle > 180 ? 1 : 0} 0 ${100 + Math.cos((-angle * Math.PI) / 180) * 30} ${100 + Math.sin((-angle * Math.PI) / 180) * 30}`}
                        fill="none"
                        stroke="currentColor"
                        className={typeInfo.color}
                        strokeWidth="2"
                        opacity="0.3"
                     />

                     {/* Right Angle Square */}
                     {angle === 90 && (
                        <rect x="100" y="70" width="30" height="30" fill="none" stroke="currentColor" className={typeInfo.color} strokeWidth="2" />
                     )}

                     {/* Vertex */}
                     <circle cx="100" cy="100" r="6" fill="#1e293b" />
                  </svg>

                  {/* Drag Handle (Invisible but large) */}
                  <div
                     className="absolute inset-0 cursor-pointer"
                     onMouseDown={(e) => {
                        const rect = e.currentTarget.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;

                        const handleMove = (moveEvent: MouseEvent) => {
                           const dx = moveEvent.clientX - centerX;
                           const dy = moveEvent.clientY - centerY;
                           let deg = Math.atan2(-dy, dx) * (180 / Math.PI);
                           if (deg < 0) deg += 360;
                           setAngle(Math.round(deg));
                        };

                        const handleUp = () => {
                           window.removeEventListener('mousemove', handleMove);
                           window.removeEventListener('mouseup', handleUp);
                        };

                        window.addEventListener('mousemove', handleMove);
                        window.addEventListener('mouseup', handleUp);
                     }}
                  ></div>
               </div>

               {/* INFO & CONTROLS */}
               <div className="flex-1 max-w-sm space-y-6">
                  <div className="p-4 rounded-2xl bg-slate-50 border border-slate-100">
                     <h3 className={`text-lg font-bold mb-1 ${typeInfo.color}`}>{typeInfo.label} ANGLE</h3>
                     <p className="text-sm text-slate-600 leading-relaxed">{typeInfo.desc}</p>
                  </div>

                  {showRealWorld && realWorldExamples[typeInfo.label] && (
                     <div className="flex items-center gap-4 p-4 rounded-2xl bg-indigo-50 border border-indigo-100 animate-in fade-in slide-in-from-bottom-2">
                        <div className="text-4xl">{realWorldExamples[typeInfo.label].img}</div>
                        <div>
                           <p className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Real World Example</p>
                           <p className="text-sm font-bold text-indigo-900">{realWorldExamples[typeInfo.label].label}</p>
                        </div>
                     </div>
                  )}

                  <div className="space-y-4">
                     <div>
                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2 block">Quick Snaps</label>
                        <div className="flex flex-wrap gap-2">
                           {[30, 45, 60, 90, 120, 150, 180].map(val => (
                              <button
                                 key={val}
                                 onClick={() => setAngle(val)}
                                 className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${angle === val ? 'bg-slate-800 text-white' : 'bg-white border border-slate-200 text-slate-600 hover:border-slate-300'}`}
                              >
                                 {val}¬∞
                              </button>
                           ))}
                        </div>
                     </div>

                     <div className="flex gap-4">
                        <button
                           onClick={() => setShowProtractor(!showProtractor)}
                           className={`flex-1 py-2 rounded-xl text-xs font-bold border transition-all ${showProtractor ? 'bg-indigo-50 border-indigo-200 text-indigo-600' : 'bg-white border-slate-200 text-slate-600'}`}
                        >
                           <i className={`fa-solid fa-compass mr-2`}></i>
                           Protractor
                        </button>
                        <button
                           onClick={() => setShowRealWorld(!showRealWorld)}
                           className={`flex-1 py-2 rounded-xl text-xs font-bold border transition-all ${showRealWorld ? 'bg-indigo-50 border-indigo-200 text-indigo-600' : 'bg-white border-slate-200 text-slate-600'}`}
                        >
                           <i className={`fa-solid fa-eye mr-2`}></i>
                           Examples
                        </button>
                     </div>
                  </div>
               </div>
            </div>

            <div className="mt-8 grid grid-cols-1 md:grid-cols-3 gap-4">
               <div className="p-4 rounded-xl bg-emerald-50 border border-emerald-100">
                  <h4 className="text-xs font-bold text-emerald-700 mb-1">Acute</h4>
                  <p className="text-[10px] text-emerald-600">Sharp, less than 90¬∞. Think "a-cute" little angle!</p>
               </div>
               <div className="p-4 rounded-xl bg-blue-50 border border-blue-100">
                  <h4 className="text-xs font-bold text-blue-700 mb-1">Right</h4>
                  <p className="text-[10px] text-blue-600">Exactly 90¬∞. The corner of a paper or a room.</p>
               </div>
               <div className="p-4 rounded-xl bg-orange-50 border border-orange-100">
                  <h4 className="text-xs font-bold text-orange-700 mb-1">Obtuse</h4>
                  <p className="text-[10px] text-orange-600">Wide, between 90¬∞ and 180¬∞. Like a reclining chair.</p>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 102: ANGLE PARTNERS RENDERER ---
   function AnglePartnersRenderer() {
      const [mode, setMode] = useState<'complementary' | 'supplementary'>('complementary');
      const [angleA, setAngleA] = useState(mode === 'complementary' ? 50 : 120);

      const target = mode === 'complementary' ? 90 : 180;
      const angleB = target - angleA;

      const handleModeChange = (newMode: 'complementary' | 'supplementary') => {
         setMode(newMode);
         if (newMode === 'complementary' && angleA >= 90) setAngleA(45);
         if (newMode === 'supplementary' && angleA < 90) setAngleA(120);
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Angle Partners</h2>
                  <p className="text-slate-500 italic font-serif">Finding the Perfect Match</p>
               </div>
               <div className="flex bg-white p-1 rounded-xl border border-slate-200 shadow-sm">
                  <button
                     onClick={() => handleModeChange('complementary')}
                     className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${mode === 'complementary' ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}
                  >
                     Complementary (90¬∞)
                  </button>
                  <button
                     onClick={() => handleModeChange('supplementary')}
                     className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${mode === 'supplementary' ? 'bg-indigo-600 text-white shadow-md' : 'text-slate-500 hover:bg-slate-50'}`}
                  >
                     Supplementary (180¬∞)
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* VISUALIZATION */}
               <div className="relative w-80 h-80 bg-white rounded-3xl border border-slate-200 shadow-xl flex items-center justify-center overflow-hidden">
                  <div className="absolute inset-0 opacity-[0.03] pointer-events-none" style={{ backgroundImage: 'radial-gradient(#4f46e5 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>

                  <svg viewBox="0 0 200 200" className="w-64 h-64 overflow-visible">
                     {/* Target Frame */}
                     <path
                        d={mode === 'complementary' ? "M 100 100 L 190 100 A 90 90 0 0 0 100 10" : "M 10 100 L 190 100 A 90 90 0 0 0 10 100"}
                        fill="none"
                        stroke="#e2e8f0"
                        strokeWidth="2"
                        strokeDasharray="4 4"
                     />

                     {/* Angle A */}
                     <path
                        d={`M 100 100 L 190 100 A 90 90 0 0 0 ${100 + Math.cos((-angleA * Math.PI) / 180) * 90} ${100 + Math.sin((-angleA * Math.PI) / 180) * 90} Z`}
                        fill="#4f46e5"
                        fillOpacity="0.1"
                        stroke="#4f46e5"
                        strokeWidth="3"
                        strokeLinejoin="round"
                     />

                     {/* Angle B */}
                     <path
                        d={`M 100 100 L ${100 + Math.cos((-angleA * Math.PI) / 180) * 90} ${100 + Math.sin((-angleA * Math.PI) / 180) * 90} A 90 90 0 0 0 ${100 + Math.cos((-target * Math.PI) / 180) * 90} ${100 + Math.sin((-target * Math.PI) / 180) * 90} Z`}
                        fill="#ec4899"
                        fillOpacity="0.1"
                        stroke="#ec4899"
                        strokeWidth="3"
                        strokeLinejoin="round"
                     />

                     {/* Labels */}
                     <text
                        x={100 + Math.cos((-angleA / 2 * Math.PI) / 180) * 60}
                        y={100 + Math.sin((-angleA / 2 * Math.PI) / 180) * 60}
                        textAnchor="middle"
                        className="fill-indigo-700 font-bold text-[12px]"
                     >
                        {angleA}¬∞
                     </text>
                     <text
                        x={100 + Math.cos((-(angleA + angleB / 2) * Math.PI) / 180) * 60}
                        y={100 + Math.sin((-(angleA + angleB / 2) * Math.PI) / 180) * 60}
                        textAnchor="middle"
                        className="fill-pink-700 font-bold text-[12px]"
                     >
                        {angleB}¬∞
                     </text>

                     {/* Right Angle Symbol for Complementary */}
                     {mode === 'complementary' && (
                        <path d="M 100 80 L 120 80 L 120 100" fill="none" stroke="#94a3b8" strokeWidth="1" />
                     )}
                  </svg>

                  {/* Partnership Meter */}
                  <div className="absolute bottom-6 left-6 right-6 h-2 bg-slate-100 rounded-full overflow-hidden flex">
                     <div style={{ width: `${(angleA / target) * 100}%` }} className="h-full bg-indigo-500 transition-all duration-300"></div>
                     <div style={{ width: `${(angleB / target) * 100}%` }} className="h-full bg-pink-500 transition-all duration-300"></div>
                  </div>
               </div>

               {/* CONTROLS */}
               <div className="w-full max-w-xs space-y-8">
                  <div className="space-y-4">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Adjust Angle A</label>
                        <span className="text-xl font-black text-indigo-600">{angleA}¬∞</span>
                     </div>
                     <input
                        type="range"
                        min="1"
                        max={target - 1}
                        value={angleA}
                        onChange={(e) => setAngleA(parseInt(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                     />
                  </div>

                  <div className="grid grid-cols-2 gap-4">
                     <div className="p-4 rounded-2xl bg-white border border-slate-200 shadow-sm">
                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-1">Angle A</p>
                        <p className="text-2xl font-black text-indigo-600">{angleA}¬∞</p>
                     </div>
                     <div className="p-4 rounded-2xl bg-white border border-slate-200 shadow-sm">
                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-1">Angle B</p>
                        <p className="text-2xl font-black text-pink-600">{angleB}¬∞</p>
                     </div>
                  </div>

                  <div className="p-5 rounded-2xl bg-indigo-600 text-white shadow-lg shadow-indigo-200">
                     <div className="flex justify-between items-center mb-2">
                        <span className="text-xs font-bold uppercase tracking-widest opacity-80">Combined Total</span>
                        <span className="text-2xl font-black">{angleA + angleB}¬∞</span>
                     </div>
                     <p className="text-xs opacity-90 leading-relaxed">
                        {mode === 'complementary'
                           ? "These angles are COMPLEMENTARY because they sum to 90¬∞ (a right angle)."
                           : "These angles are SUPPLEMENTARY because they sum to 180¬∞ (a straight line)."}
                     </p>
                  </div>
               </div>
            </div>

            {/* EDUCATIONAL FOOTER */}
            <div className="mt-12 flex flex-col md:flex-row gap-6">
               <div className="flex-1 flex gap-4 items-start p-4 rounded-2xl bg-white border border-slate-100">
                  <div className="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0 font-bold">C</div>
                  <div>
                     <h4 className="text-sm font-bold text-slate-800">Complementary (90¬∞)</h4>
                     <p className="text-xs text-slate-500">Think "C" for "Corner". Two angles that fit perfectly into a 90¬∞ corner.</p>
                  </div>
               </div>
               <div className="flex-1 flex gap-4 items-start p-4 rounded-2xl bg-white border border-slate-100">
                  <div className="w-10 h-10 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center shrink-0 font-bold">S</div>
                  <div>
                     <h4 className="text-sm font-bold text-slate-800">Supplementary (180¬∞)</h4>
                     <p className="text-xs text-slate-500">Think "S" for "Straight". Two angles that form a straight line together.</p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 103: INTERSECTION INVESTIGATION RENDERER ---
   function IntersectionInvestigationRenderer() {
      const [rotation, setRotation] = useState(70);
      const [highlightType, setHighlightType] = useState<'none' | 'vertical' | 'adjacent'>('none');

      const angle1 = rotation;
      const angle2 = 180 - rotation;
      const angle3 = rotation;
      const angle4 = 180 - rotation;

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Intersection Investigation</h2>
                  <p className="text-slate-500 italic font-serif">Where Lines Cross</p>
               </div>
               <div className="flex gap-2">
                  <button
                     onClick={() => setHighlightType(highlightType === 'vertical' ? 'none' : 'vertical')}
                     className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all ${highlightType === 'vertical' ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'}`}
                  >
                     Vertical Pairs
                  </button>
                  <button
                     onClick={() => setHighlightType(highlightType === 'adjacent' ? 'none' : 'adjacent')}
                     className={`px-4 py-2 rounded-xl text-xs font-bold border transition-all ${highlightType === 'adjacent' ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'}`}
                  >
                     Adjacent Pairs
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* VISUALIZATION */}
               <div className="relative w-80 h-80 bg-slate-50 rounded-full border border-slate-100 shadow-inner flex items-center justify-center">
                  <svg viewBox="0 0 200 200" className="w-full h-full overflow-visible">
                     {/* Line 1 (Static Horizontal) */}
                     <line x1="10" y1="100" x2="190" y2="100" stroke="#94a3b8" strokeWidth="4" strokeLinecap="round" />

                     {/* Line 2 (Rotating) */}
                     <line
                        x1={100 + Math.cos((rotation * Math.PI) / 180) * 90}
                        y1={100 + Math.sin((rotation * Math.PI) / 180) * 90}
                        x2={100 + Math.cos(((rotation + 180) * Math.PI) / 180) * 90}
                        y2={100 + Math.sin(((rotation + 180) * Math.PI) / 180) * 90}
                        stroke="#475569"
                        strokeWidth="4"
                        strokeLinecap="round"
                     />

                     {/* Angle Arcs & Labels */}
                     {/* Angle 1 (Top Right) */}
                     <path
                        d={`M 130 100 A 30 30 0 0 0 ${100 + Math.cos((rotation * Math.PI) / 180) * 30} ${100 + Math.sin((rotation * Math.PI) / 180) * 30}`}
                        fill="none" stroke={highlightType === 'vertical' ? '#4f46e5' : (highlightType === 'adjacent' ? '#ec4899' : '#94a3b8')} strokeWidth="3"
                     />
                     <text x="140" y="85" className="text-[12px] font-bold fill-slate-800">{angle1}¬∞</text>

                     {/* Angle 2 (Top Left) */}
                     <path
                        d={`M ${100 + Math.cos((rotation * Math.PI) / 180) * 30} ${100 + Math.sin((rotation * Math.PI) / 180) * 30} A 30 30 0 0 0 70 100`}
                        fill="none" stroke={highlightType === 'adjacent' ? '#ec4899' : '#94a3b8'} strokeWidth="3"
                     />
                     <text x="50" y="85" className="text-[12px] font-bold fill-slate-800">{angle2}¬∞</text>

                     {/* Angle 3 (Bottom Left) */}
                     <path
                        d={`M 70 100 A 30 30 0 0 0 ${100 + Math.cos(((rotation + 180) * Math.PI) / 180) * 30} ${100 + Math.sin(((rotation + 180) * Math.PI) / 180) * 30}`}
                        fill="none" stroke={highlightType === 'vertical' ? '#4f46e5' : (highlightType === 'adjacent' ? '#ec4899' : '#94a3b8')} strokeWidth="3"
                     />
                     <text x="50" y="125" className="text-[12px] font-bold fill-slate-800">{angle3}¬∞</text>

                     {/* Angle 4 (Bottom Right) */}
                     <path
                        d={`M ${100 + Math.cos(((rotation + 180) * Math.PI) / 180) * 30} ${100 + Math.sin(((rotation + 180) * Math.PI) / 180) * 30} A 30 30 0 0 0 130 100`}
                        fill="none" stroke={highlightType === 'adjacent' ? '#ec4899' : '#94a3b8'} strokeWidth="3"
                     />
                     <text x="140" y="125" className="text-[12px] font-bold fill-slate-800">{angle4}¬∞</text>

                     {/* Vertex */}
                     <circle cx="100" cy="100" r="5" fill="#1e293b" />
                  </svg>

                  {/* Rotation Handle */}
                  <div
                     className="absolute inset-0 cursor-pointer"
                     onMouseDown={(e) => {
                        const rect = e.currentTarget.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;

                        const handleMove = (moveEvent: MouseEvent) => {
                           const dx = moveEvent.clientX - centerX;
                           const dy = moveEvent.clientY - centerY;
                           let deg = Math.atan2(dy, dx) * (180 / Math.PI);
                           if (deg < 0) deg += 360;
                           // Keep it in a reasonable range to avoid flipping labels too much
                           setRotation(Math.round(deg % 180));
                        };

                        const handleUp = () => {
                           window.removeEventListener('mousemove', handleMove);
                           window.removeEventListener('mouseup', handleUp);
                        };

                        window.addEventListener('mousemove', handleMove);
                        window.addEventListener('mouseup', handleUp);
                     }}
                  ></div>
               </div>

               {/* INSIGHTS PANEL */}
               <div className="w-full max-w-sm space-y-6">
                  {highlightType === 'vertical' ? (
                     <div className="p-5 rounded-2xl bg-indigo-50 border border-indigo-100 animate-in fade-in zoom-in-95">
                        <h3 className="text-lg font-bold text-indigo-900 mb-2">Vertical Angles</h3>
                        <p className="text-sm text-indigo-700 leading-relaxed">
                           Angles opposite each other at an intersection are <strong>Vertical</strong>. They are always <strong>equal</strong>!
                        </p>
                        <div className="mt-4 flex gap-4">
                           <div className="flex-1 bg-white p-3 rounded-xl border border-indigo-200 text-center">
                              <span className="text-xs font-bold text-slate-400 block mb-1">Pair 1</span>
                              <span className="text-lg font-black text-indigo-600">{angle1}¬∞ = {angle3}¬∞</span>
                           </div>
                           <div className="flex-1 bg-white p-3 rounded-xl border border-indigo-200 text-center">
                              <span className="text-xs font-bold text-slate-400 block mb-1">Pair 2</span>
                              <span className="text-lg font-black text-indigo-600">{angle2}¬∞ = {angle4}¬∞</span>
                           </div>
                        </div>
                     </div>
                  ) : highlightType === 'adjacent' ? (
                     <div className="p-5 rounded-2xl bg-pink-50 border border-pink-100 animate-in fade-in zoom-in-95">
                        <h3 className="text-lg font-bold text-pink-900 mb-2">Adjacent Angles</h3>
                        <p className="text-sm text-pink-700 leading-relaxed">
                           Angles next to each other are <strong>Adjacent</strong>. At an intersection, they are <strong>supplementary</strong> (sum to 180¬∞).
                        </p>
                        <div className="mt-4 p-3 bg-white rounded-xl border border-pink-200 text-center">
                           <span className="text-lg font-black text-pink-600">{angle1}¬∞ + {angle2}¬∞ = 180¬∞</span>
                        </div>
                     </div>
                  ) : (
                     <div className="p-5 rounded-2xl bg-slate-50 border border-slate-100">
                        <h3 className="text-lg font-bold text-slate-800 mb-2">Intersection Rules</h3>
                        <p className="text-sm text-slate-600 leading-relaxed">
                           Drag the lines to see how all four angles change together. If you know just <strong>one</strong> angle, you can find all the others!
                        </p>
                     </div>
                  )}

                  <div className="grid grid-cols-2 gap-4">
                     {[1, 2, 3, 4].map(num => (
                        <div key={num} className="p-3 rounded-xl bg-white border border-slate-200 flex justify-between items-center">
                           <span className="text-[10px] font-bold text-slate-400">‚à†{num}</span>
                           <span className="text-sm font-black text-slate-700">{num % 2 === 1 ? angle1 : angle2}¬∞</span>
                        </div>
                     ))}
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 104: AREA SURVEYOR RENDERER ---
   function AreaSurveyorRenderer() {
      const [shape, setShape] = useState<'rectangle' | 'parallelogram' | 'triangle' | 'trapezoid'>('rectangle');
      const [base, setBase] = useState(6);
      const [height, setHeight] = useState(4);
      const [base2, setBase2] = useState(4); // For trapezoid
      const [showDecomposition, setShowDecomposition] = useState(false);

      const calculateArea = () => {
         switch (shape) {
            case 'rectangle': return base * height;
            case 'parallelogram': return base * height;
            case 'triangle': return 0.5 * base * height;
            case 'trapezoid': return 0.5 * (base + base2) * height;
         }
      };

      const area = calculateArea();

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Land Surveyor Studio</h2>
                  <p className="text-slate-500 italic font-serif">Measuring Property & Area</p>
               </div>
               <div className="flex flex-wrap gap-2 max-w-[300px] justify-end">
                  {['rectangle', 'parallelogram', 'triangle', 'trapezoid'].map(s => (
                     <button
                        key={s}
                        onClick={() => { setShape(s as any); setShowDecomposition(false); }}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold uppercase tracking-wider border transition-all ${shape === s ? 'bg-indigo-600 border-indigo-600 text-white shadow-md' : 'bg-white border-slate-200 text-slate-500 hover:border-slate-300'}`}
                     >
                        {s}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* GRID VISUALIZER */}
               <div className="relative w-full max-w-md aspect-square bg-slate-50 rounded-2xl border border-slate-100 shadow-inner flex items-center justify-center p-8">
                  {/* Grid Lines */}
                  <div className="absolute inset-0 opacity-[0.05] pointer-events-none" style={{ backgroundImage: 'linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)', backgroundSize: '20px 20px' }}></div>

                  <svg viewBox="0 0 200 200" className="w-full h-full overflow-visible drop-shadow-lg">
                     {/* The Shape */}
                     {shape === 'rectangle' && (
                        <rect x="40" y={160 - height * 20} width={base * 20} height={height * 20} fill="#4f46e5" fillOpacity="0.1" stroke="#4f46e5" strokeWidth="3" />
                     )}
                     {shape === 'parallelogram' && (
                        <path
                           d={`M 40 160 L ${40 + base * 20} 160 L ${60 + base * 20} ${160 - height * 20} L 60 ${160 - height * 20} Z`}
                           fill="#4f46e5" fillOpacity="0.1" stroke="#4f46e5" strokeWidth="3"
                        />
                     )}
                     {shape === 'triangle' && (
                        <path
                           d={`M 40 160 L ${40 + base * 20} 160 L 40 ${160 - height * 20} Z`}
                           fill="#4f46e5" fillOpacity="0.1" stroke="#4f46e5" strokeWidth="3"
                        />
                     )}
                     {shape === 'trapezoid' && (
                        <path
                           d={`M 40 160 L ${40 + base * 20} 160 L ${40 + (base + base2) / 2 * 20 + base2 / 2 * 20} ${160 - height * 20} L ${40 + (base + base2) / 2 * 20 - base2 / 2 * 20} ${160 - height * 20} Z`}
                           fill="#4f46e5" fillOpacity="0.1" stroke="#4f46e5" strokeWidth="3"
                        />
                     )}

                     {/* Dimension Labels */}
                     <text x={40 + base * 10} y="175" textAnchor="middle" className="text-[10px] font-bold fill-slate-500">base: {base}</text>
                     <line x1="30" y1={160} x2="30" y2={160 - height * 20} stroke="#94a3b8" strokeWidth="1" strokeDasharray="2 2" />
                     <text x="25" y={160 - height * 10} textAnchor="middle" transform={`rotate(-90, 25, ${160 - height * 10})`} className="text-[10px] font-bold fill-slate-500">height: {height}</text>

                     {shape === 'trapezoid' && (
                        <text x={40 + base * 10} y={150 - height * 20} textAnchor="middle" className="text-[10px] font-bold fill-slate-500">base2: {base2}</text>
                     )}
                  </svg>

                  {/* Decomposition Overlay */}
                  {showDecomposition && shape === 'parallelogram' && (
                     <div className="absolute inset-0 flex items-center justify-center p-8 pointer-events-none">
                        <div className="w-full h-full relative">
                           <div className="absolute bg-amber-400 opacity-30 animate-pulse" style={{ left: '40px', bottom: '40px', width: '20px', height: `${height * 20}px`, clipPath: 'polygon(0% 100%, 100% 100%, 100% 0%)' }}></div>
                        </div>
                     </div>
                  )}
               </div>

               {/* CONTROLS & FORMULA */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="p-5 rounded-2xl bg-indigo-600 text-white shadow-xl shadow-indigo-100">
                     <p className="text-[10px] font-bold uppercase tracking-widest opacity-70 mb-1">Current Formula</p>
                     <h3 className="text-xl font-black mb-4">
                        {shape === 'rectangle' && "Area = base √ó height"}
                        {shape === 'parallelogram' && "Area = base √ó height"}
                        {shape === 'triangle' && "Area = ¬Ω √ó base √ó height"}
                        {shape === 'trapezoid' && "Area = ¬Ω √ó (b1 + b2) √ó h"}
                     </h3>
                     <div className="flex justify-between items-center pt-4 border-t border-white/20">
                        <span className="text-xs font-bold opacity-80">Total Area</span>
                        <span className="text-3xl font-black">{area} sq units</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Base</label>
                           <span className="text-xs font-bold text-slate-700">{base}</span>
                        </div>
                        <input type="range" min="2" max="8" value={base} onChange={(e) => setBase(parseInt(e.target.value))} className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" />
                     </div>
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Height</label>
                           <span className="text-xs font-bold text-slate-700">{height}</span>
                        </div>
                        <input type="range" min="2" max="6" value={height} onChange={(e) => setHeight(parseInt(e.target.value))} className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" />
                     </div>
                     {shape === 'trapezoid' && (
                        <div>
                           <div className="flex justify-between mb-2">
                              <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Base 2</label>
                              <span className="text-xs font-bold text-slate-700">{base2}</span>
                           </div>
                           <input type="range" min="2" max="8" value={base2} onChange={(e) => setBase2(parseInt(e.target.value))} className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600" />
                        </div>
                     )}
                  </div>

                  <button
                     onClick={() => setShowDecomposition(!showDecomposition)}
                     className={`w-full py-3 rounded-xl text-xs font-bold border transition-all ${showDecomposition ? 'bg-amber-50 border-amber-200 text-amber-600' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'}`}
                  >
                     <i className="fa-solid fa-wand-magic-sparkles mr-2"></i>
                     {showDecomposition ? "Hide Derivation" : "Show How Formula Works"}
                  </button>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 105: CIRCLE LAB RENDERER ---
   function CircleLabRenderer() {
      const [radius, setRadius] = useState(5);
      const [isUnwrapped, setIsUnwrapped] = useState(false);
      const [showArea, setShowArea] = useState(false);

      const diameter = radius * 2;
      const circumference = 2 * Math.PI * radius;
      const area = Math.PI * radius * radius;

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Circle Lab</h2>
                  <p className="text-slate-500 italic font-serif">Discovering the Magic of Pi (œÄ)</p>
               </div>
               <div className="flex gap-2">
                  <div className="px-4 py-2 rounded-xl bg-slate-800 text-white flex flex-col items-center min-w-[100px]">
                     <span className="text-xs font-bold opacity-60 uppercase tracking-widest">Pi (œÄ)</span>
                     <span className="text-xl font-black">‚âà 3.14159</span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* CIRCLE VISUALIZER */}
               <div className="relative w-80 h-80 flex items-center justify-center bg-slate-50 rounded-3xl border border-slate-100 shadow-inner">
                  <svg viewBox="0 0 200 200" className="w-full h-full overflow-visible">
                     {/* The Circle */}
                     <circle
                        cx="100" cy="100" r={radius * 15}
                        fill={showArea ? "#4f46e5" : "none"}
                        fillOpacity="0.1"
                        stroke="#4f46e5"
                        strokeWidth="3"
                        className="transition-all duration-500"
                     />

                     {/* Radius Line */}
                     <line x1="100" y1="100" x2={100 + radius * 15} y2="100" stroke="#1e293b" strokeWidth="2" strokeLinecap="round" />
                     <text x={100 + radius * 7.5} y="90" textAnchor="middle" className="text-[10px] font-bold fill-slate-800">r = {radius}</text>

                     {/* Diameter Line (Dashed) */}
                     <line x1={100 - radius * 15} y1="100" x2="100" y2="100" stroke="#94a3b8" strokeWidth="1" strokeDasharray="2 2" />
                     <text x={100 - radius * 7.5} y="115" textAnchor="middle" className="text-[8px] font-bold fill-slate-400">d = {diameter}</text>

                     {/* Unwrapped Circumference */}
                     {isUnwrapped && (
                        <line
                           x1="10" y1="180"
                           x2={10 + (circumference * 15 / (2 * Math.PI * 5)) * 31.4}
                           y2="180"
                           stroke="#ec4899"
                           strokeWidth="4"
                           strokeLinecap="round"
                           className="animate-in slide-in-from-left duration-1000"
                        />
                     )}
                  </svg>

                  {/* Center Point */}
                  <div className="absolute w-2 h-2 bg-slate-800 rounded-full"></div>
               </div>

               {/* STATS & CONTROLS */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="grid grid-cols-1 gap-4">
                     <div className="p-4 rounded-2xl bg-indigo-50 border border-indigo-100">
                        <div className="flex justify-between items-center mb-1">
                           <span className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Circumference (C = 2œÄr)</span>
                           <span className="text-lg font-black text-indigo-900">{circumference.toFixed(2)}</span>
                        </div>
                        <p className="text-[10px] text-indigo-600">The distance all the way around the circle.</p>
                     </div>
                     <div className="p-4 rounded-2xl bg-pink-50 border border-pink-100">
                        <div className="flex justify-between items-center mb-1">
                           <span className="text-[10px] font-bold text-pink-400 uppercase tracking-widest">Area (A = œÄr¬≤)</span>
                           <span className="text-lg font-black text-pink-900">{area.toFixed(2)}</span>
                        </div>
                        <p className="text-[10px] text-pink-600">The total space inside the circle.</p>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Adjust Radius</label>
                           <span className="text-xs font-bold text-slate-700">{radius} units</span>
                        </div>
                        <input type="range" min="1" max="6" step="0.5" value={radius} onChange={(e) => setRadius(parseFloat(e.target.value))} className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800" />
                     </div>

                     <div className="flex gap-4">
                        <button
                           onClick={() => setIsUnwrapped(!isUnwrapped)}
                           className={`flex-1 py-3 rounded-xl text-xs font-bold border transition-all ${isUnwrapped ? 'bg-pink-50 border-pink-200 text-pink-600' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'}`}
                        >
                           <i className="fa-solid fa-ruler-horizontal mr-2"></i>
                           Unwrap C
                        </button>
                        <button
                           onClick={() => setShowArea(!showArea)}
                           className={`flex-1 py-3 rounded-xl text-xs font-bold border transition-all ${showArea ? 'bg-indigo-50 border-indigo-200 text-indigo-600' : 'bg-white border-slate-200 text-slate-600 hover:border-slate-300'}`}
                        >
                           <i className="fa-solid fa-fill-drip mr-2"></i>
                           Fill Area
                        </button>
                     </div>
                  </div>

                  <div className="p-4 rounded-2xl bg-slate-800 text-white">
                     <h4 className="text-xs font-bold mb-2 flex items-center gap-2">
                        <i className="fa-solid fa-lightbulb text-amber-400"></i>
                        Did you know?
                     </h4>
                     <p className="text-[10px] leading-relaxed opacity-80">
                        If you divide any circle's <strong>Circumference</strong> by its <strong>Diameter</strong>, you ALWAYS get <strong>œÄ (3.14...)</strong>. It's a universal constant!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 151: Z-SCORE RENDERER ---
   function ZScoreRenderer() {
      const [mean, setMean] = useState(100);
      const [sd, setSd] = useState(15);
      const [rawValue, setRawValue] = useState(115);

      const zScore = (rawValue - mean) / sd;

      // Normal distribution probability density function
      const pdf = (x: number, m: number, s: number) => {
         return (1 / (s * Math.sqrt(2 * Math.PI))) * Math.exp(-0.5 * Math.pow((x - m) / s, 2));
      };

      // Cumulative distribution function approximation (Percentile)
      const getPercentile = (z: number) => {
         const t = 1 / (1 + 0.2316419 * Math.abs(z));
         const d = 0.3989423 * Math.exp(-z * z / 2);
         const p = d * t * (0.3193815 + t * (-0.3565638 + t * (1.781478 + t * (-1.821256 + t * 1.330274))));
         return z > 0 ? 1 - p : p;
      };

      const percentile = getPercentile(zScore) * 100;

      // Generate curve points
      const points = [];
      const startX = mean - 4 * sd;
      const endX = mean + 4 * sd;
      const step = (endX - startX) / 100;

      for (let x = startX; x <= endX; x += step) {
         points.push({ x, y: pdf(x, mean, sd) });
      }

      // Scaling for SVG
      const svgWidth = 400;
      const svgHeight = 200;
      const margin = 40;
      const chartWidth = svgWidth - 2 * margin;
      const chartHeight = svgHeight - 2 * margin;

      const scaleX = (val: number) => margin + ((val - startX) / (endX - startX)) * chartWidth;
      const scaleY = (val: number) => (svgHeight - margin) - (val / pdf(mean, mean, sd)) * chartHeight;

      const pathData = `M ${points.map(p => `${scaleX(p.x)},${scaleY(p.y)}`).join(' L ')}`;

      // Shaded area path
      const shadedPoints = points.filter(p => p.x <= rawValue);
      const shadedPath = shadedPoints.length > 0
         ? `M ${scaleX(startX)},${svgHeight - margin} L ${shadedPoints.map(p => `${scaleX(p.x)},${scaleY(p.y)}`).join(' L ')} L ${scaleX(rawValue)},${svgHeight - margin} Z`
         : "";

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Z-Score Explorer</h2>
                  <p className="text-slate-500 italic font-serif">Standard Position Finder</p>
               </div>
               <div className="flex gap-2">
                  <div className="px-4 py-2 rounded-xl bg-indigo-600 text-white flex flex-col items-center min-w-[100px]">
                     <span className="text-xs font-bold opacity-60 uppercase tracking-widest">Z-Score</span>
                     <span className="text-xl font-black">{zScore.toFixed(2)}</span>
                  </div>
                  <div className="px-4 py-2 rounded-xl bg-emerald-600 text-white flex flex-col items-center min-w-[100px]">
                     <span className="text-xs font-bold opacity-60 uppercase tracking-widest">Percentile</span>
                     <span className="text-xl font-black">{percentile.toFixed(1)}%</span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* BELL CURVE VISUALIZER */}
               <div className="relative w-full max-w-lg aspect-video bg-slate-50 rounded-3xl border border-slate-100 shadow-inner p-4">
                  <svg viewBox={`0 0 ${svgWidth} ${svgHeight}`} className="w-full h-full overflow-visible">
                     {/* Shaded Area */}
                     <path d={shadedPath} fill="#4f46e5" fillOpacity="0.2" className="transition-all duration-300" />

                     {/* The Curve */}
                     <path d={pathData} fill="none" stroke="#4f46e5" strokeWidth="3" strokeLinecap="round" />

                     {/* X-Axis */}
                     <line x1={margin} y1={svgHeight - margin} x2={svgWidth - margin} y2={svgHeight - margin} stroke="#94a3b8" strokeWidth="1" />

                     {/* Mean Line */}
                     <line
                        x1={scaleX(mean)} y1={scaleY(0)}
                        x2={scaleX(mean)} y2={scaleY(pdf(mean, mean, sd))}
                        stroke="#94a3b8" strokeWidth="1" strokeDasharray="4 4"
                     />
                     <text x={scaleX(mean)} y={svgHeight - margin + 15} textAnchor="middle" className="text-[10px] fill-slate-400 font-bold">Mean (Œº)</text>

                     {/* Raw Value Marker */}
                     <g className="transition-all duration-300">
                        <line
                           x1={scaleX(rawValue)} y1={svgHeight - margin}
                           x2={scaleX(rawValue)} y2={scaleY(pdf(rawValue, mean, sd))}
                           stroke="#1e293b" strokeWidth="2"
                        />
                        <circle cx={scaleX(rawValue)} cy={scaleY(pdf(rawValue, mean, sd))} r="5" fill="#1e293b" />
                        <text x={scaleX(rawValue)} y={scaleY(pdf(rawValue, mean, sd)) - 10} textAnchor="middle" className="text-[10px] font-bold fill-slate-800">x = {rawValue}</text>
                     </g>

                     {/* SD Markers */}
                     {[1, 2, 3].map(i => (
                        <g key={i}>
                           <line x1={scaleX(mean + i * sd)} y1={svgHeight - margin - 5} x2={scaleX(mean + i * sd)} y2={svgHeight - margin + 5} stroke="#cbd5e1" strokeWidth="1" />
                           <line x1={scaleX(mean - i * sd)} y1={svgHeight - margin - 5} x2={scaleX(mean - i * sd)} y2={svgHeight - margin + 5} stroke="#cbd5e1" strokeWidth="1" />
                        </g>
                     ))}
                  </svg>
               </div>

               {/* CONTROLS */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="p-4 rounded-2xl bg-slate-800 text-white space-y-2">
                     <h4 className="text-xs font-bold uppercase tracking-widest opacity-60">Z-Score Formula</h4>
                     <div className="text-xl font-serif italic text-center py-2">
                        z = (x - Œº) / œÉ
                     </div>
                     <p className="text-[10px] opacity-80 leading-relaxed">
                        The z-score tells you how many standard deviations a value is from the mean.
                     </p>
                  </div>

                  <div className="space-y-4">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Raw Score (x)</label>
                           <span className="text-xs font-bold text-slate-700">{rawValue}</span>
                        </div>
                        <input
                           type="range" min={mean - 4 * sd} max={mean + 4 * sd} step="1"
                           value={rawValue} onChange={(e) => setRawValue(parseInt(e.target.value))}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                        />
                     </div>

                     <div className="grid grid-cols-2 gap-4">
                        <div>
                           <div className="flex justify-between mb-2">
                              <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Mean (Œº)</label>
                              <span className="text-xs font-bold text-slate-700">{mean}</span>
                           </div>
                           <input
                              type="range" min="50" max="150" step="1"
                              value={mean} onChange={(e) => {
                                 const newMean = parseInt(e.target.value);
                                 setMean(newMean);
                                 setRawValue(newMean + (rawValue - mean));
                              }}
                              className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                           />
                        </div>
                        <div>
                           <div className="flex justify-between mb-2">
                              <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Std Dev (œÉ)</label>
                              <span className="text-xs font-bold text-slate-700">{sd}</span>
                           </div>
                           <input
                              type="range" min="5" max="30" step="1"
                              value={sd} onChange={(e) => setSd(parseInt(e.target.value))}
                              className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-600"
                           />
                        </div>
                     </div>
                  </div>

                  <div className="p-4 rounded-2xl bg-indigo-50 border border-indigo-100">
                     <h4 className="text-xs font-bold mb-2 flex items-center gap-2 text-indigo-900">
                        <i className="fa-solid fa-lightbulb text-amber-500"></i>
                        Interpretation
                     </h4>
                     <p className="text-[10px] leading-relaxed text-indigo-800">
                        {zScore === 0 ? (
                           "Your score is exactly at the mean."
                        ) : zScore > 0 ? (
                           `Your score is ${zScore.toFixed(2)} standard deviations ABOVE the mean. You performed better than ${percentile.toFixed(1)}% of the population.`
                        ) : (
                           `Your score is ${Math.abs(zScore).toFixed(2)} standard deviations BELOW the mean. ${percentile.toFixed(1)}% of the population scored lower than you.`
                        )}
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 152: CORRELATION COEFFICIENT RENDERER ---
   function CorrelationCoefficientRenderer() {
      const [points, setPoints] = useState([
         { x: 10, y: 20 }, { x: 20, y: 35 }, { x: 30, y: 45 }, { x: 40, y: 60 },
         { x: 50, y: 70 }, { x: 60, y: 85 }, { x: 70, y: 90 }, { x: 80, y: 110 }
      ]);
      const [showLine, setShowLine] = useState(true);

      // Calculate Pearson Correlation Coefficient (r)
      const calculateR = () => {
         const n = points.length;
         if (n < 2) return 0;

         let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0, sumY2 = 0;
         points.forEach(p => {
            sumX += p.x;
            sumY += p.y;
            sumXY += p.x * p.y;
            sumX2 += p.x * p.x;
            sumY2 += p.y * p.y;
         });

         const numerator = n * sumXY - sumX * sumY;
         const denominator = Math.sqrt((n * sumX2 - sumX * sumX) * (n * sumY2 - sumY * sumY));
         return denominator === 0 ? 0 : numerator / denominator;
      };

      const r = calculateR();

      // Calculate Line of Best Fit (y = mx + b)
      const calculateLine = () => {
         const n = points.length;
         let sumX = 0, sumY = 0, sumXY = 0, sumX2 = 0;
         points.forEach(p => {
            sumX += p.x;
            sumY += p.y;
            sumXY += p.x * p.y;
            sumX2 += p.x * p.x;
         });

         const m = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
         const b = (sumY - m * sumX) / n;
         return { m, b };
      };

      const { m, b } = calculateLine();

      const presets = {
         perfect_positive: [{ x: 10, y: 10 }, { x: 20, y: 20 }, { x: 30, y: 30 }, { x: 40, y: 40 }, { x: 50, y: 50 }, { x: 60, y: 60 }, { x: 70, y: 70 }, { x: 80, y: 80 }],
         perfect_negative: [{ x: 10, y: 90 }, { x: 20, y: 80 }, { x: 30, y: 70 }, { x: 40, y: 60 }, { x: 50, y: 50 }, { x: 60, y: 40 }, { x: 70, y: 30 }, { x: 80, y: 20 }],
         no_correlation: [{ x: 10, y: 50 }, { x: 20, y: 20 }, { x: 30, y: 80 }, { x: 40, y: 40 }, { x: 50, y: 70 }, { x: 60, y: 10 }, { x: 70, y: 90 }, { x: 80, y: 30 }],
         strong_positive: [{ x: 10, y: 15 }, { x: 20, y: 30 }, { x: 30, y: 25 }, { x: 40, y: 55 }, { x: 50, y: 65 }, { x: 60, y: 60 }, { x: 70, y: 85 }, { x: 80, y: 95 }]
      };

      const handlePointDrag = (index: number, newX: number, newY: number) => {
         const newPoints = [...points];
         newPoints[index] = {
            x: Math.max(0, Math.min(100, newX)),
            y: Math.max(0, Math.min(100, newY))
         };
         setPoints(newPoints);
      };

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Correlation Lab</h2>
                  <p className="text-slate-500 italic font-serif">Relationship Strength Analyzer</p>
               </div>
               <div className="flex gap-4 items-center">
                  <div className="flex flex-col items-end">
                     <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Correlation (r)</span>
                     <div className="flex items-center gap-2">
                        <div className="w-32 h-2 bg-slate-100 rounded-full overflow-hidden relative">
                           <div
                              className={`absolute h-full transition-all duration-500 ${r >= 0 ? 'bg-indigo-500' : 'bg-rose-500'}`}
                              style={{
                                 left: '50%',
                                 width: `${Math.abs(r) * 50}%`,
                                 transform: r < 0 ? 'translateX(-100%)' : 'none'
                              }}
                           />
                           <div className="absolute left-1/2 top-0 w-0.5 h-full bg-slate-300" />
                        </div>
                        <span className={`text-xl font-black min-w-[60px] text-right ${Math.abs(r) > 0.7 ? 'text-indigo-600' : 'text-slate-600'}`}>
                           {r.toFixed(2)}
                        </span>
                     </div>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-8 items-center justify-center">
               {/* SCATTER PLOT */}
               <div className="relative w-full max-w-lg aspect-square bg-slate-50 rounded-3xl border border-slate-100 shadow-inner p-8">
                  <svg viewBox="0 0 100 100" className="w-full h-full overflow-visible">
                     {/* Grid Lines */}
                     {[0, 25, 50, 75, 100].map(val => (
                        <g key={val}>
                           <line x1={val} y1="0" x2={val} y2="100" stroke="#e2e8f0" strokeWidth="0.5" strokeDasharray="2 2" />
                           <line x1="0" y1={val} x2="100" y2={val} stroke="#e2e8f0" strokeWidth="0.5" strokeDasharray="2 2" />
                        </g>
                     ))}

                     {/* Best Fit Line */}
                     {showLine && (
                        <line
                           x1="0" y1={100 - b}
                           x2="100" y2={100 - (m * 100 + b)}
                           stroke="#4f46e5" strokeWidth="1" strokeDasharray="4 2"
                           className="transition-all duration-300"
                        />
                     )}

                     {/* Data Points */}
                     {points.map((p, i) => (
                        <g key={i} className="cursor-move group">
                           <circle
                              cx={p.x} cy={100 - p.y} r="2.5"
                              fill={Math.abs(r) > 0.7 ? "#4f46e5" : "#64748b"}
                              className="transition-colors duration-300 group-hover:fill-indigo-400"
                           />
                           {/* Invisible larger hit area for dragging */}
                           <circle
                              cx={p.x} cy={100 - p.y} r="6"
                              fill="transparent"
                              onMouseDown={(e) => {
                                 const svg = e.currentTarget.ownerSVGElement!;
                                 const startX = e.clientX;
                                 const startY = e.clientY;
                                 const initialX = p.x;
                                 const initialY = p.y;

                                 const onMouseMove = (moveEvent: MouseEvent) => {
                                    const rect = svg.getBoundingClientRect();
                                    const scale = 100 / rect.width;
                                    const dx = (moveEvent.clientX - startX) * scale;
                                    const dy = (moveEvent.clientY - startY) * scale;
                                    handlePointDrag(i, initialX + dx, initialY - dy);
                                 };

                                 const onMouseUp = () => {
                                    window.removeEventListener('mousemove', onMouseMove);
                                    window.removeEventListener('mouseup', onMouseUp);
                                 };

                                 window.addEventListener('mousemove', onMouseMove);
                                 window.addEventListener('mouseup', onMouseUp);
                              }}
                           />
                        </g>
                     ))}
                  </svg>
                  <div className="absolute bottom-2 left-1/2 -translate-x-1/2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Variable X</div>
                  <div className="absolute left-2 top-1/2 -translate-y-1/2 -rotate-90 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Variable Y</div>
               </div>

               {/* CONTROLS */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="grid grid-cols-2 gap-3">
                     {Object.entries(presets).map(([key, data]) => (
                        <button
                           key={key}
                           onClick={() => setPoints(data)}
                           className="px-3 py-2 rounded-xl bg-slate-50 border border-slate-200 text-[10px] font-bold text-slate-600 hover:bg-white hover:border-indigo-300 hover:text-indigo-600 transition-all capitalize"
                        >
                           {key.replace('_', ' ')}
                        </button>
                     ))}
                  </div>

                  <div className="p-4 rounded-2xl bg-slate-800 text-white space-y-3">
                     <div className="flex justify-between items-center">
                        <h4 className="text-xs font-bold uppercase tracking-widest opacity-60">Interpretation</h4>
                        <button
                           onClick={() => setShowLine(!showLine)}
                           className={`px-2 py-1 rounded-lg text-[8px] font-bold uppercase tracking-widest transition-all ${showLine ? 'bg-indigo-500 text-white' : 'bg-slate-700 text-slate-400'}`}
                        >
                           Best Fit Line
                        </button>
                     </div>
                     <p className="text-sm font-bold">
                        {Math.abs(r) < 0.3 ? "Weak" : Math.abs(r) < 0.7 ? "Moderate" : "Strong"} {r >= 0 ? "Positive" : "Negative"} Relationship
                     </p>
                     <p className="text-[10px] opacity-80 leading-relaxed">
                        {Math.abs(r) > 0.9 ? "The points follow a near-perfect line." :
                           Math.abs(r) > 0.5 ? "There is a clear trend, but with some scatter." :
                              "The points are widely scattered with little linear pattern."}
                     </p>
                  </div>

                  <div className="p-4 rounded-2xl bg-indigo-50 border border-indigo-100">
                     <h4 className="text-xs font-bold mb-2 flex items-center gap-2 text-indigo-900">
                        <i className="fa-solid fa-triangle-exclamation text-amber-500"></i>
                        Critical Insight
                     </h4>
                     <p className="text-[10px] leading-relaxed text-indigo-800">
                        <strong>Correlation is NOT causation!</strong> Even if r = 1.00, it doesn't mean X <em>causes</em> Y. There could be a third variable at play.
                     </p>
                  </div>

                  <div className="flex flex-col gap-2">
                     <div className="flex justify-between text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                        <span>r¬≤ (Coefficient of Determination)</span>
                        <span className="text-slate-700">{(r * r * 100).toFixed(1)}%</span>
                     </div>
                     <div className="w-full h-1.5 bg-slate-100 rounded-full overflow-hidden">
                        <div
                           className="h-full bg-indigo-400 transition-all duration-500"
                           style={{ width: `${r * r * 100}%` }}
                        />
                     </div>
                     <p className="text-[9px] text-slate-500 italic">
                        {(r * r * 100).toFixed(1)}% of the variation in Y can be explained by X.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 153: COMBINATIONS AND PERMUTATIONS RENDERER ---
   function CombinationsPermutationsRenderer() {
      const [n, setN] = useState(5);
      const [r, setR] = useState(3);
      const [mode, setMode] = useState<'permutation' | 'combination'>('permutation');

      const colors = ["#4f46e5", "#10b981", "#f59e0b", "#ef4444", "#8b5cf6", "#ec4899", "#06b6d4"];
      const items = Array.from({ length: n }, (_, i) => ({ id: i, color: colors[i % colors.length] }));

      const factorial = (num: number): number => {
         if (num <= 1) return 1;
         return num * factorial(num - 1);
      };

      const calculateCount = () => {
         if (r > n) return 0;
         const nFact = factorial(n);
         const nMinusRFact = factorial(n - r);

         if (mode === 'permutation') {
            return nFact / nMinusRFact;
         } else {
            return nFact / (factorial(r) * nMinusRFact);
         }
      };

      const count = calculateCount();

      // Generate a few example arrangements/selections
      const generateExamples = () => {
         const examples: number[][] = [];
         const indices = Array.from({ length: n }, (_, i) => i);

         if (mode === 'permutation') {
            // Simple shuffle-based examples for permutations
            for (let i = 0; i < Math.min(count, 6); i++) {
               const shuffled = [...indices].sort(() => Math.random() - 0.5);
               examples.push(shuffled.slice(0, r));
            }
         } else {
            // Simple selection-based examples for combinations
            for (let i = 0; i < Math.min(count, 6); i++) {
               const selection = [...indices].sort(() => Math.random() - 0.5).slice(0, r).sort((a, b) => a - b);
               // Ensure uniqueness for combinations in examples
               if (!examples.some(ex => ex.every((val, idx) => val === selection[idx]))) {
                  examples.push(selection);
               } else {
                  i--; // Try again
               }
            }
         }
         return examples;
      };

      const examples = generateExamples();

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Arrangement Academy</h2>
                  <p className="text-slate-500 italic font-serif">Order Matters?</p>
               </div>
               <div className="flex gap-2">
                  <button
                     onClick={() => setMode('permutation')}
                     className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${mode === 'permutation' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                  >
                     Permutation
                  </button>
                  <button
                     onClick={() => setMode('combination')}
                     className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${mode === 'combination' ? 'bg-emerald-600 text-white shadow-lg' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                  >
                     Combination
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* VISUALIZER */}
               <div className="w-full max-w-md space-y-8">
                  <div className="p-6 rounded-3xl bg-slate-50 border border-slate-100 shadow-inner">
                     <div className="flex flex-wrap gap-4 justify-center mb-8">
                        {items.map(item => (
                           <div
                              key={item.id}
                              className="w-10 h-10 rounded-full shadow-md flex items-center justify-center text-white font-bold text-xs"
                              style={{ backgroundColor: item.color }}
                           >
                              {String.fromCharCode(65 + item.id)}
                           </div>
                        ))}
                     </div>

                     <div className="text-center space-y-2">
                        <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                           {mode === 'permutation' ? 'Possible Arrangements' : 'Possible Selections'}
                        </p>
                        <p className="text-4xl font-black text-slate-800">{count.toLocaleString()}</p>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest text-center">Example {mode === 'permutation' ? 'Orderings' : 'Sets'}</p>
                     <div className="grid grid-cols-2 gap-4">
                        {examples.map((ex, i) => (
                           <div key={i} className="flex gap-2 justify-center p-2 rounded-xl bg-white border border-slate-100 shadow-sm">
                              {ex.map(idx => (
                                 <div
                                    key={idx}
                                    className="w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold text-white"
                                    style={{ backgroundColor: items[idx].color }}
                                 >
                                    {String.fromCharCode(65 + idx)}
                                 </div>
                              ))}
                           </div>
                        ))}
                     </div>
                  </div>
               </div>

               {/* CONTROLS */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="p-4 rounded-2xl bg-slate-800 text-white space-y-4">
                     <div className="flex justify-between items-center">
                        <h4 className="text-xs font-bold uppercase tracking-widest opacity-60">Formula</h4>
                        <span className="text-[10px] font-mono opacity-40">n = {n}, r = {r}</span>
                     </div>
                     <div className="text-2xl font-serif italic text-center py-2">
                        {mode === 'permutation' ? (
                           <>P(n,r) = n! / (n-r)!</>
                        ) : (
                           <>C(n,r) = n! / (r! ¬∑ (n-r)!)</>
                        )}
                     </div>
                     <p className="text-[10px] opacity-80 leading-relaxed text-center">
                        {mode === 'permutation' ? (
                           "Order matters. ABC is different from CBA."
                        ) : (
                           "Order doesn't matter. {A,B,C} is the same as {C,B,A}."
                        )}
                     </p>
                  </div>

                  <div className="space-y-6">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Total Objects (n)</label>
                           <span className="text-xs font-bold text-slate-700">{n}</span>
                        </div>
                        <input
                           type="range" min="1" max="7" step="1"
                           value={n} onChange={(e) => {
                              const val = parseInt(e.target.value);
                              setN(val);
                              if (r > val) setR(val);
                           }}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                        />
                     </div>

                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Number to Select (r)</label>
                           <span className="text-xs font-bold text-slate-700">{r}</span>
                        </div>
                        <input
                           type="range" min="1" max={n} step="1"
                           value={r} onChange={(e) => setR(parseInt(e.target.value))}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                        />
                     </div>
                  </div>

                  <div className="p-4 rounded-2xl bg-indigo-50 border border-indigo-100">
                     <h4 className="text-xs font-bold mb-2 flex items-center gap-2 text-indigo-900">
                        <i className="fa-solid fa-briefcase text-indigo-500"></i>
                        Real World Context
                     </h4>
                     <p className="text-[10px] leading-relaxed text-indigo-800">
                        {mode === 'permutation' ? (
                           "Use Permutations for PIN codes, race results, or passwords where the sequence is critical."
                        ) : (
                           "Use Combinations for lottery numbers, committee members, or pizza toppings where the group is what matters."
                        )}
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 154: CONDITIONAL PROBABILITY RENDERER ---
   function ConditionalProbabilityRenderer() {
      const [sizeA, setSizeA] = useState(60);
      const [sizeB, setSizeB] = useState(40);
      const [overlap, setOverlap] = useState(25);
      const [view, setView] = useState<'venn' | 'tree'>('venn');

      const total = 100;
      const pA = sizeA / total;
      const pB = sizeB / total;
      const pAandB = overlap / total;

      const pAgivenB = pB === 0 ? 0 : pAandB / pB;
      const pBgivenA = pA === 0 ? 0 : pAandB / pA;

      const isIndependent = Math.abs(pAgivenB - pA) < 0.01;

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Probability Lab</h2>
                  <p className="text-slate-500 italic font-serif">Given That... "The Reduced Sample Space"</p>
               </div>
               <div className="flex gap-2">
                  <button
                     onClick={() => setView('venn')}
                     className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${view === 'venn' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                  >
                     Venn Diagram
                  </button>
                  <button
                     onClick={() => setView('tree')}
                     className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${view === 'tree' ? 'bg-indigo-600 text-white shadow-lg' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                  >
                     Tree Diagram
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* VISUALIZER */}
               <div className="w-full max-w-md aspect-square bg-slate-50 rounded-3xl border border-slate-100 shadow-inner p-8 flex items-center justify-center relative">
                  {view === 'venn' ? (
                     <svg viewBox="0 0 200 200" className="w-full h-full overflow-visible">
                        {/* Sample Space */}
                        <rect x="0" y="0" width="200" height="200" fill="none" stroke="#cbd5e1" strokeWidth="1" strokeDasharray="4 4" />
                        <text x="5" y="15" className="text-[10px] fill-slate-400 font-bold">Sample Space (S)</text>

                        {/* Circle A */}
                        <circle
                           cx={100 - (sizeA / 4)} cy="100" r={sizeA * 0.8}
                           fill="#4f46e5" fillOpacity="0.1" stroke="#4f46e5" strokeWidth="2"
                           className="transition-all duration-500"
                        />

                        {/* Circle B */}
                        <circle
                           cx={100 + (sizeB / 4) - (overlap / 2)} cy="100" r={sizeB * 0.8}
                           fill="#ec4899" fillOpacity="0.1" stroke="#ec4899" strokeWidth="2"
                           className="transition-all duration-500"
                        />

                        {/* Labels */}
                        <text x={100 - (sizeA / 2)} y="100" textAnchor="middle" className="text-xs font-bold fill-indigo-600">A</text>
                        <text x={100 + (sizeB / 2)} y="100" textAnchor="middle" className="text-xs font-bold fill-pink-600">B</text>
                        {overlap > 10 && (
                           <text x={100 - (overlap / 4)} y="100" textAnchor="middle" className="text-[10px] font-bold fill-slate-800">A‚à©B</text>
                        )}
                     </svg>
                  ) : (
                     <div className="w-full h-full flex flex-col justify-center gap-8 py-4">
                        {/* Root */}
                        <div className="flex items-center gap-12">
                           <div className="w-2 h-2 bg-slate-400 rounded-full" />
                           <div className="flex flex-col gap-16">
                              {/* Branch B */}
                              <div className="relative">
                                 <div className="absolute -left-12 top-1/2 w-12 h-0.5 bg-slate-200 -rotate-12 origin-left" />
                                 <div className="flex items-center gap-8">
                                    <div className="px-3 py-1 rounded-lg bg-pink-100 text-pink-700 text-[10px] font-bold">Event B (P={pB.toFixed(2)})</div>
                                    <div className="flex flex-col gap-4">
                                       <div className="flex items-center gap-4">
                                          <div className="w-8 h-0.5 bg-slate-200" />
                                          <div className="px-2 py-1 rounded-md bg-indigo-100 text-indigo-700 text-[8px] font-bold">A | B (P={pAgivenB.toFixed(2)})</div>
                                       </div>
                                       <div className="flex items-center gap-4">
                                          <div className="w-8 h-0.5 bg-slate-200" />
                                          <div className="px-2 py-1 rounded-md bg-slate-100 text-slate-500 text-[8px] font-bold">Not A | B (P={(1 - pAgivenB).toFixed(2)})</div>
                                       </div>
                                    </div>
                                 </div>
                              </div>
                              {/* Branch Not B */}
                              <div className="relative">
                                 <div className="absolute -left-12 top-1/2 w-12 h-0.5 bg-slate-200 rotate-12 origin-left" />
                                 <div className="px-3 py-1 rounded-lg bg-slate-100 text-slate-500 text-[10px] font-bold">Not B (P={(1 - pB).toFixed(2)})</div>
                              </div>
                           </div>
                        </div>
                     </div>
                  )}
               </div>

               {/* CONTROLS */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="grid grid-cols-2 gap-4">
                     <div className="p-4 rounded-2xl bg-indigo-600 text-white text-center">
                        <span className="text-[10px] font-bold opacity-60 uppercase tracking-widest">P(A | B)</span>
                        <p className="text-2xl font-black">{pAgivenB.toFixed(3)}</p>
                        <p className="text-[8px] opacity-80 mt-1">Prob of A, GIVEN B</p>
                     </div>
                     <div className="p-4 rounded-2xl bg-pink-600 text-white text-center">
                        <span className="text-[10px] font-bold opacity-60 uppercase tracking-widest">P(B | A)</span>
                        <p className="text-2xl font-black">{pBgivenA.toFixed(3)}</p>
                        <p className="text-[8px] opacity-80 mt-1">Prob of B, GIVEN A</p>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Size of Event A</label>
                           <span className="text-xs font-bold text-slate-700">{sizeA}%</span>
                        </div>
                        <input
                           type="range" min="10" max="80" step="1"
                           value={sizeA} onChange={(e) => {
                              const val = parseInt(e.target.value);
                              setSizeA(val);
                              if (overlap > Math.min(val, sizeB)) setOverlap(Math.min(val, sizeB));
                           }}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                        />
                     </div>
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Size of Event B</label>
                           <span className="text-xs font-bold text-slate-700">{sizeB}%</span>
                        </div>
                        <input
                           type="range" min="10" max="80" step="1"
                           value={sizeB} onChange={(e) => {
                              const val = parseInt(e.target.value);
                              setSizeB(val);
                              if (overlap > Math.min(sizeA, val)) setOverlap(Math.min(sizeA, val));
                           }}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-600"
                        />
                     </div>
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Overlap (A ‚à© B)</label>
                           <span className="text-xs font-bold text-slate-700">{overlap}%</span>
                        </div>
                        <input
                           type="range" min="0" max={Math.min(sizeA, sizeB)} step="1"
                           value={overlap} onChange={(e) => setOverlap(parseInt(e.target.value))}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                        />
                     </div>
                  </div>

                  <div className={`p-4 rounded-2xl border transition-all ${isIndependent ? 'bg-emerald-50 border-emerald-100 text-emerald-800' : 'bg-amber-50 border-amber-100 text-amber-800'}`}>
                     <h4 className="text-xs font-bold mb-1 flex items-center gap-2">
                        <i className={`fa-solid ${isIndependent ? 'fa-check-circle' : 'fa-circle-nodes'}`}></i>
                        {isIndependent ? 'Independent Events' : 'Dependent Events'}
                     </h4>
                     <p className="text-[10px] leading-relaxed opacity-90">
                        {isIndependent
                           ? "Knowing B occurred does NOT change the probability of A. P(A|B) = P(A)."
                           : `Knowing B occurred changes the probability of A from ${pA.toFixed(2)} to ${pAgivenB.toFixed(2)}.`}
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- CONCEPT 155: MARGIN OF ERROR RENDERER ---
   function MarginOfErrorRenderer() {
      const [n, setN] = useState(1000);
      const [confidence, setConfidence] = useState(0.95);
      const [p, setP] = useState(0.52); // Point estimate (e.g., 52% support)

      const zScores: Record<number, number> = { 0.90: 1.645, 0.95: 1.96, 0.99: 2.576 };
      const z = zScores[confidence];

      const moe = z * Math.sqrt((p * (1 - p)) / n);
      const lowerBound = p - moe;
      const upperBound = p + moe;

      return (
         <div className="w-full h-full bg-white flex flex-col p-6 overflow-auto">
            <div className="flex justify-between items-start mb-8">
               <div>
                  <h2 className="text-2xl font-bold text-slate-800">Poll Predictor</h2>
                  <p className="text-slate-500 italic font-serif">Understanding the "Plus or Minus"</p>
               </div>
               <div className="flex gap-2">
                  <div className="px-4 py-2 rounded-xl bg-slate-800 text-white flex flex-col items-center min-w-[120px]">
                     <span className="text-xs font-bold opacity-60 uppercase tracking-widest">Margin of Error</span>
                     <span className="text-xl font-black">¬±{(moe * 100).toFixed(1)}%</span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row gap-12 items-center justify-center">
               {/* VISUALIZER */}
               <div className="w-full max-w-lg space-y-12">
                  <div className="relative h-40 bg-slate-50 rounded-3xl border border-slate-100 shadow-inner p-8 flex items-center">
                     <svg viewBox="0 0 400 100" className="w-full overflow-visible">
                        {/* Scale */}
                        <line x1="0" y1="80" x2="400" y2="80" stroke="#cbd5e1" strokeWidth="1" />
                        {[0, 0.25, 0.5, 0.75, 1].map(val => (
                           <g key={val}>
                              <line x1={val * 400} y1="75" x2={val * 400} y2="85" stroke="#cbd5e1" strokeWidth="1" />
                              <text x={val * 400} y="95" textAnchor="middle" className="text-[10px] fill-slate-400 font-bold">{val * 100}%</text>
                           </g>
                        ))}

                        {/* Error Bar */}
                        <line
                           x1={lowerBound * 400} y1="40"
                           x2={upperBound * 400} y2="40"
                           stroke="#4f46e5" strokeWidth="4" strokeLinecap="round"
                           className="transition-all duration-500"
                        />
                        <line x1={lowerBound * 400} y1="30" x2={lowerBound * 400} y2="50" stroke="#4f46e5" strokeWidth="2" className="transition-all duration-500" />
                        <line x1={upperBound * 400} y1="30" x2={upperBound * 400} y2="50" stroke="#4f46e5" strokeWidth="2" className="transition-all duration-500" />

                        {/* Point Estimate */}
                        <circle
                           cx={p * 400} cy="40" r="6"
                           fill="#1e293b"
                           className="transition-all duration-500"
                        />
                        <text x={p * 400} y="25" textAnchor="middle" className="text-xs font-bold fill-slate-800">{(p * 100).toFixed(1)}%</text>
                     </svg>
                  </div>

                  <div className="grid grid-cols-3 gap-4">
                     <div className="p-4 rounded-2xl bg-slate-50 border border-slate-100 text-center">
                        <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Lower Bound</span>
                        <p className="text-lg font-black text-slate-700">{(lowerBound * 100).toFixed(1)}%</p>
                     </div>
                     <div className="p-4 rounded-2xl bg-indigo-50 border border-indigo-100 text-center">
                        <span className="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Confidence</span>
                        <p className="text-lg font-black text-indigo-700">{(confidence * 100).toFixed(0)}%</p>
                     </div>
                     <div className="p-4 rounded-2xl bg-slate-50 border border-slate-100 text-center">
                        <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Upper Bound</span>
                        <p className="text-lg font-black text-slate-700">{(upperBound * 100).toFixed(1)}%</p>
                     </div>
                  </div>
               </div>

               {/* CONTROLS */}
               <div className="w-full max-w-sm space-y-6">
                  <div className="p-4 rounded-2xl bg-slate-800 text-white space-y-4">
                     <h4 className="text-xs font-bold uppercase tracking-widest opacity-60">The Math</h4>
                     <div className="text-lg font-serif italic text-center py-2">
                        MoE = z * ‚àö[p(1-p) / n]
                     </div>
                     <p className="text-[10px] opacity-80 leading-relaxed text-center">
                        The Margin of Error tells you how much the poll results might differ from the real world.
                     </p>
                  </div>

                  <div className="space-y-6">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Sample Size (n)</label>
                           <span className="text-xs font-bold text-slate-700">{n.toLocaleString()} people</span>
                        </div>
                        <input
                           type="range" min="100" max="5000" step="100"
                           value={n} onChange={(e) => setN(parseInt(e.target.value))}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                        />
                        <p className="text-[9px] text-slate-400 mt-1 italic">Larger sample = smaller error.</p>
                     </div>

                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Confidence Level</label>
                        </div>
                        <div className="flex gap-2">
                           {[0.90, 0.95, 0.99].map(level => (
                              <button
                                 key={level}
                                 onClick={() => setConfidence(level)}
                                 className={`flex-1 py-2 rounded-xl text-xs font-bold transition-all ${confidence === level ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}
                              >
                                 {level * 100}%
                              </button>
                           ))}
                        </div>
                     </div>

                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Poll Result (p)</label>
                           <span className="text-xs font-bold text-slate-700">{(p * 100).toFixed(0)}%</span>
                        </div>
                        <input
                           type="range" min="0.1" max="0.9" step="0.01"
                           value={p} onChange={(e) => setP(parseFloat(e.target.value))}
                           className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-800"
                        />
                     </div>
                  </div>

                  <div className="p-4 rounded-2xl bg-amber-50 border border-amber-100">
                     <h4 className="text-xs font-bold mb-2 flex items-center gap-2 text-amber-900">
                        <i className="fa-solid fa-circle-info text-amber-500"></i>
                        Statistical Significance
                     </h4>
                     <p className="text-[10px] leading-relaxed text-amber-800">
                        If two candidates are within each other's Margin of Error, the race is considered a <strong>"Statistical Dead Heat"</strong> or "Too Close to Call."
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   }

   // --- ENHANCED ROCKET ENGINE RENDERER ---
   const RocketEngineRenderer = () => {
      const [throttle, setThrottle] = useState(60);
      const [mixtureRatio, setMixtureRatio] = useState(2.5); // O/F Ratio
      const [isFiring, setIsFiring] = useState(false);
      const [burnTime, setBurnTime] = useState(0);
      const [challengeComplete, setChallengeComplete] = useState(false);

      // Physics Calculations
      const idealRatio = 2.56; // Optimal O/F for LOX/RP-1
      const ratioEfficiency = Math.max(0, 1 - Math.abs(mixtureRatio - idealRatio) * 0.4);
      const thrust = Math.floor(throttle * 9.5 * ratioEfficiency);
      const chamberTemp = Math.floor(2800 + (throttle * 6) - (Math.abs(mixtureRatio - idealRatio) * 600));
      const chamberPressure = Math.floor(throttle * 2.8);
      const exhaustVelocity = Math.floor(2800 + ratioEfficiency * 500);
      const specificImpulse = Math.floor(exhaustVelocity / 9.8);
      const fuelFlow = (throttle / 100) * 55;
      const oxidizerFlow = fuelFlow * mixtureRatio;
      const totalMassFlow = fuelFlow + oxidizerFlow;

      // Status indicators
      const isRich = mixtureRatio < idealRatio - 0.4;
      const isLean = mixtureRatio > idealRatio + 0.4;
      const isOverheat = chamberTemp > 3400;
      const isUnderPressure = chamberPressure < 100 && isFiring;
      const efficiencyPercent = Math.round(ratioEfficiency * 100);

      // Challenge: Achieve 800+ kN thrust with stable temp
      const goalMet = thrust >= 800 && !isOverheat && isFiring;

      // Burn timer
      React.useEffect(() => {
         let interval: NodeJS.Timeout;
         if (isFiring) {
            interval = setInterval(() => {
               setBurnTime(prev => prev + 0.1);
               if (goalMet && !challengeComplete) {
                  setChallengeComplete(true);
               }
            }, 100);
         }
         return () => clearInterval(interval);
      }, [isFiring, goalMet, challengeComplete]);

      // Flame animation height
      const flameHeight = isFiring ? Math.min(150, thrust / 5) : 0;
      const flameOpacity = isFiring ? Math.min(1, throttle / 80) : 0;

      return (
         <div className="w-full h-full bg-slate-900 text-slate-100 flex flex-col lg:flex-row overflow-hidden">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 relative flex items-center justify-center p-4 overflow-hidden">
               {/* Grid background */}
               <div className="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:30px_30px]"></div>

               {/* Engine Schematic */}
               <div className="relative z-10 w-full max-w-md">
                  <svg viewBox="0 0 400 650" className="w-full h-auto">
                     <defs>
                        <linearGradient id="loxGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#3b82f6" />
                           <stop offset="100%" stopColor="#1e40af" />
                        </linearGradient>
                        <linearGradient id="rp1Gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#f97316" />
                           <stop offset="100%" stopColor="#c2410c" />
                        </linearGradient>
                        <linearGradient id="chamberGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#334155" />
                           <stop offset="100%" stopColor="#1e293b" />
                        </linearGradient>
                        <linearGradient id="flameGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#fbbf24" />
                           <stop offset="30%" stopColor="#f97316" />
                           <stop offset="100%" stopColor="#ef4444" />
                        </linearGradient>
                        <filter id="glow">
                           <feGaussianBlur stdDeviation="4" result="coloredBlur" />
                           <feMerge>
                              <feMergeNode in="coloredBlur" />
                              <feMergeNode in="SourceGraphic" />
                           </feMerge>
                        </filter>
                     </defs>

                     {/* LOX Tank */}
                     <g>
                        <rect x="80" y="30" width="100" height="120" rx="10" fill="url(#loxGradient)" stroke="#60a5fa" strokeWidth="2" />
                        <text x="130" y="75" textAnchor="middle" fill="white" fontSize="11" fontWeight="bold">LIQUID</text>
                        <text x="130" y="90" textAnchor="middle" fill="white" fontSize="11" fontWeight="bold">OXYGEN</text>
                        <text x="130" y="115" textAnchor="middle" fill="#93c5fd" fontSize="10">-183¬∞C</text>
                        <text x="130" y="135" textAnchor="middle" fill="#93c5fd" fontSize="9">{oxidizerFlow.toFixed(1)} kg/s</text>
                     </g>

                     {/* RP-1 Tank */}
                     <g>
                        <rect x="220" y="30" width="100" height="120" rx="10" fill="url(#rp1Gradient)" stroke="#fb923c" strokeWidth="2" />
                        <text x="270" y="75" textAnchor="middle" fill="white" fontSize="11" fontWeight="bold">RP-1</text>
                        <text x="270" y="90" textAnchor="middle" fill="white" fontSize="11" fontWeight="bold">KEROSENE</text>
                        <text x="270" y="115" textAnchor="middle" fill="#fed7aa" fontSize="10">20¬∞C</text>
                        <text x="270" y="135" textAnchor="middle" fill="#fed7aa" fontSize="9">{fuelFlow.toFixed(1)} kg/s</text>
                     </g>

                     {/* Fuel Lines */}
                     <path d="M130 150 L130 200 L175 230" fill="none" stroke="#60a5fa" strokeWidth="6" strokeLinecap="round" />
                     <path d="M270 150 L270 200 L225 230" fill="none" stroke="#fb923c" strokeWidth="6" strokeLinecap="round" />

                     {/* Flow indicators when firing */}
                     {isFiring && (
                        <>
                           <circle r="4" fill="#93c5fd">
                              <animateMotion dur="0.5s" repeatCount="indefinite" path="M130 150 L130 200 L175 230" />
                           </circle>
                           <circle r="4" fill="#fdba74">
                              <animateMotion dur="0.5s" repeatCount="indefinite" path="M270 150 L270 200 L225 230" />
                           </circle>
                        </>
                     )}

                     {/* Turbopump */}
                     <g>
                        <circle cx="200" cy="250" r="35" fill="#475569" stroke="#94a3b8" strokeWidth="3" />
                        <text x="200" y="245" textAnchor="middle" fill="white" fontSize="8" fontWeight="bold">TURBO</text>
                        <text x="200" y="258" textAnchor="middle" fill="white" fontSize="8" fontWeight="bold">PUMP</text>
                        {isFiring && (
                           <g transform="translate(200, 250)">
                              <path d="M-12,-12 L12,12 M-12,12 L12,-12 M0,-15 L0,15 M-15,0 L15,0" stroke="#94a3b8" strokeWidth="2">
                                 <animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="0.3s" repeatCount="indefinite" />
                              </path>
                           </g>
                        )}
                     </g>

                     {/* Injector Plate */}
                     <rect x="160" y="295" width="80" height="15" rx="3" fill="#64748b" stroke="#94a3b8" strokeWidth="2" />
                     <text x="200" y="290" textAnchor="middle" fill="#94a3b8" fontSize="8">INJECTOR</text>

                     {/* Combustion Chamber */}
                     <g>
                        <path d="M160 310 Q140 370 160 410 L240 410 Q260 370 240 310 Z"
                           fill="url(#chamberGradient)"
                           stroke={isOverheat ? "#ef4444" : "#94a3b8"}
                           strokeWidth="3" />
                        {isFiring && (
                           <ellipse cx="200" cy="360" rx="30" ry="20" fill="#fbbf24" opacity="0.6">
                              <animate attributeName="opacity" values="0.4;0.8;0.4" dur="0.2s" repeatCount="indefinite" />
                           </ellipse>
                        )}
                     </g>

                     {/* Chamber Labels */}
                     <g>
                        <text x="290" y="330" fill="#94a3b8" fontSize="9">Chamber</text>
                        <text x="290" y="345" fill={chamberTemp > 3200 ? "#f87171" : "#22c55e"} fontSize="11" fontWeight="bold">{isFiring ? chamberTemp : 20}¬∞C</text>
                        <text x="290" y="365" fill="#94a3b8" fontSize="9">Pressure</text>
                        <text x="290" y="380" fill="#22c55e" fontSize="11" fontWeight="bold">{isFiring ? chamberPressure : 0} bar</text>
                     </g>

                     {/* Nozzle */}
                     <path d="M160 410 L120 530 L280 530 L240 410" fill="#1e293b" stroke="#94a3b8" strokeWidth="3" />
                     <text x="200" y="480" textAnchor="middle" fill="#64748b" fontSize="10">NOZZLE</text>

                     {/* Exhaust Plume */}
                     {isFiring && (
                        <g filter="url(#glow)">
                           <path
                              d={`M130 530 Q${200 + Math.sin(burnTime * 10) * 20} ${530 + flameHeight / 2} ${200} ${530 + flameHeight} Q${200 - Math.sin(burnTime * 10) * 20} ${530 + flameHeight / 2} 270 530 Z`}
                              fill="url(#flameGradient)"
                              opacity={flameOpacity}
                           >
                              <animate attributeName="d"
                                 values={`M130 530 Q180 ${530 + flameHeight / 2} 200 ${530 + flameHeight} Q220 ${530 + flameHeight / 2} 270 530 Z;M130 530 Q220 ${530 + flameHeight / 2} 200 ${530 + flameHeight} Q180 ${530 + flameHeight / 2} 270 530 Z;M130 530 Q180 ${530 + flameHeight / 2} 200 ${530 + flameHeight} Q220 ${530 + flameHeight / 2} 270 530 Z`}
                                 dur="0.15s"
                                 repeatCount="indefinite" />
                           </path>
                           <ellipse cx="200" cy="535" rx="50" ry="10" fill="#fef3c7" opacity="0.7" />
                        </g>
                     )}

                     {/* Thrust Vector */}
                     {isFiring && (
                        <g>
                           <text x="200" y={545 + flameHeight + 20} textAnchor="middle" fill="#fbbf24" fontSize="14" fontWeight="bold">
                              {thrust} kN
                           </text>
                        </g>
                     )}
                  </svg>

                  {/* Warning Overlays */}
                  {isOverheat && isFiring && (
                     <div className="absolute top-1/3 left-1/2 -translate-x-1/2 bg-red-600/95 text-white px-6 py-3 rounded-xl font-bold animate-pulse shadow-2xl border-2 border-red-400 z-20">
                        <div className="flex items-center gap-2">
                           <span className="text-2xl">üî•</span>
                           <div>
                              <div className="text-sm font-black uppercase">OVERHEAT WARNING</div>
                              <div className="text-xs opacity-80">Reduce throttle or adjust O/F ratio</div>
                           </div>
                        </div>
                     </div>
                  )}

                  {challengeComplete && (
                     <div className="absolute top-4 left-1/2 -translate-x-1/2 bg-green-600/95 text-white px-6 py-3 rounded-xl font-bold shadow-2xl border-2 border-green-400 z-20">
                        <div className="flex items-center gap-2">
                           <span className="text-2xl">üéâ</span>
                           <div>
                              <div className="text-sm font-black uppercase">CHALLENGE COMPLETE!</div>
                              <div className="text-xs opacity-80">Achieved 800+ kN stable thrust</div>
                           </div>
                        </div>
                     </div>
                  )}
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-96 bg-slate-800 p-6 border-l border-slate-700 flex flex-col gap-5 overflow-y-auto">
               {/* Header */}
               <div className="flex items-center justify-between border-b border-slate-700 pb-4">
                  <div className="flex items-center gap-3">
                     <div className={`w-3 h-3 rounded-full ${isFiring ? 'bg-green-500 animate-pulse shadow-lg shadow-green-500/50' : 'bg-slate-500'}`}></div>
                     <h2 className="text-sm font-black uppercase tracking-widest text-slate-300">Engine Control</h2>
                  </div>
                  {isFiring && (
                     <div className="text-xs font-mono text-slate-400">
                        T+{burnTime.toFixed(1)}s
                     </div>
                  )}
               </div>

               {/* Challenge Goal */}
               <div className={`p-3 rounded-xl border ${goalMet ? 'bg-green-900/30 border-green-600' : 'bg-slate-700/30 border-slate-600'}`}>
                  <div className="text-[10px] font-black uppercase text-slate-400 mb-1">üéØ Challenge</div>
                  <div className="text-sm font-bold text-white">Achieve 800+ kN thrust without overheating</div>
                  <div className={`text-xs mt-1 ${goalMet ? 'text-green-400' : 'text-slate-400'}`}>
                     {goalMet ? '‚úì Goal achieved!' : `Current: ${thrust} kN`}
                  </div>
               </div>

               {/* Throttle Control */}
               <div>
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-blue-300 uppercase flex items-center gap-2">
                        <i className="fa-solid fa-gauge-high"></i> Throttle
                     </label>
                     <span className="text-sm font-mono font-bold text-white">{throttle}%</span>
                  </div>
                  <input
                     type="range" min="0" max="110" value={throttle}
                     onChange={(e) => setThrottle(Number(e.target.value))}
                     className="w-full h-3 bg-slate-700 rounded-full appearance-none cursor-pointer accent-blue-500"
                  />
                  <div className="flex justify-between text-[9px] text-slate-500 mt-1">
                     <span>IDLE</span>
                     <span>MAX</span>
                     <span className="text-amber-400">OVERDRIVE</span>
                  </div>
               </div>

               {/* Mixture Ratio Control */}
               <div>
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-orange-300 uppercase flex items-center gap-2">
                        <i className="fa-solid fa-droplet"></i> O/F Ratio
                     </label>
                     <span className={`text-sm font-mono font-bold ${isRich ? 'text-blue-400' : isLean ? 'text-orange-400' : 'text-green-400'}`}>
                        {mixtureRatio.toFixed(2)} {isRich ? '(Rich)' : isLean ? '(Lean)' : '(Optimal)'}
                     </span>
                  </div>
                  <input
                     type="range" min="1.5" max="3.5" step="0.05" value={mixtureRatio}
                     onChange={(e) => setMixtureRatio(Number(e.target.value))}
                     className="w-full h-3 bg-slate-700 rounded-full appearance-none cursor-pointer accent-orange-500"
                  />
                  <div className="flex justify-between text-[9px] mt-1">
                     <span className="text-blue-400">Fuel Rich</span>
                     <span className="text-green-400">‚Üì Optimal: 2.56</span>
                     <span className="text-orange-400">Oxidizer Rich</span>
                  </div>
               </div>

               {/* Metrics Grid */}
               <div className="grid grid-cols-2 gap-3">
                  <div className="bg-slate-700/50 p-3 rounded-xl border border-slate-600">
                     <div className="text-[9px] font-black uppercase text-slate-400 mb-1">Thrust</div>
                     <div className="text-2xl font-mono font-bold text-white">{isFiring ? thrust : 0} <span className="text-sm">kN</span></div>
                  </div>
                  <div className={`p-3 rounded-xl border ${isOverheat ? 'bg-red-900/30 border-red-600' : 'bg-slate-700/50 border-slate-600'}`}>
                     <div className="text-[9px] font-black uppercase text-slate-400 mb-1">Chamber Temp</div>
                     <div className={`text-2xl font-mono font-bold ${isOverheat ? 'text-red-400' : 'text-white'}`}>
                        {isFiring ? chamberTemp : 20} <span className="text-sm">¬∞C</span>
                     </div>
                  </div>
                  <div className="bg-slate-700/50 p-3 rounded-xl border border-slate-600">
                     <div className="text-[9px] font-black uppercase text-slate-400 mb-1">Specific Impulse</div>
                     <div className="text-xl font-mono font-bold text-white">{isFiring ? specificImpulse : 0} <span className="text-sm">s</span></div>
                  </div>
                  <div className="bg-slate-700/50 p-3 rounded-xl border border-slate-600">
                     <div className="text-[9px] font-black uppercase text-slate-400 mb-1">Efficiency</div>
                     <div className={`text-xl font-mono font-bold ${efficiencyPercent > 90 ? 'text-green-400' : efficiencyPercent > 70 ? 'text-amber-400' : 'text-red-400'}`}>
                        {efficiencyPercent}%
                     </div>
                  </div>
               </div>

               {/* Mass Flow Display */}
               <div className="bg-slate-700/30 p-3 rounded-xl border border-slate-600">
                  <div className="text-[9px] font-black uppercase text-slate-400 mb-2">Mass Flow Rate</div>
                  <div className="flex justify-between items-center text-sm">
                     <span className="text-blue-300">LOX: {oxidizerFlow.toFixed(1)} kg/s</span>
                     <span className="text-slate-400">|</span>
                     <span className="text-orange-300">RP-1: {fuelFlow.toFixed(1)} kg/s</span>
                  </div>
                  <div className="mt-1 text-xs text-slate-400">
                     Total: {totalMassFlow.toFixed(1)} kg/s
                  </div>
               </div>

               {/* Ignition Button */}
               <button
                  onClick={() => {
                     setIsFiring(!isFiring);
                     if (!isFiring) setBurnTime(0);
                  }}
                  className={`w-full py-4 rounded-xl font-black uppercase tracking-widest shadow-lg active:scale-95 transition-all ${isFiring
                     ? 'bg-gradient-to-r from-red-600 to-red-700 text-white hover:from-red-700 hover:to-red-800'
                     : 'bg-gradient-to-r from-green-600 to-green-700 text-white hover:from-green-700 hover:to-green-800'
                     }`}
               >
                  {isFiring ? 'üõë ENGINE CUTOFF' : 'üî• IGNITE ENGINE'}
               </button>

               {/* Educational Insight */}
               <div className="flex gap-3 p-3 bg-slate-700/30 rounded-xl border border-slate-600">
                  <div className="w-8 h-8 rounded-full bg-amber-500/20 text-amber-400 flex items-center justify-center shrink-0">
                     <i className="fa-solid fa-lightbulb"></i>
                  </div>
                  <p className="text-xs text-slate-300 leading-relaxed">
                     <strong>Insight:</strong> The O/F ratio controls the balance between efficiency and cooling.
                     Too lean (high O/F) burns hotter but more efficiently. Too rich provides cooling but wastes fuel.
                     Real Merlin engines use O/F ‚âà 2.56 for optimal performance.
                  </p>
               </div>
            </div>
         </div>
      );
   };

   // --- COMPOUND INTEREST RENDERER (7-Stage Masterpiece) ---
   // Stage 1: Core insight = Time > Amount due to exponential growth
   // Stage 2: Primary = starting age, Secondary = contribution, rate
   // Stage 3: Growth curve with contribution band, milestone markers
   // Stage 4: FV = PMT √ó (((1 + r)^t - 1) / r), curve reshapes at 60fps
   // Stage 5: State ‚Üí Derived ‚Üí Visual flow
   // Stage 6: Challenge = "Reach $1M"
   const CompoundInterestRenderer = () => {
      const [startAge, setStartAge] = useState(30);
      const [monthlyContribution, setMonthlyContribution] = useState(500);
      const [annualReturn, setAnnualReturn] = useState(0.07);
      const [showComparison, setShowComparison] = useState(false);
      const [comparisonAge, setComparisonAge] = useState(40);
      const [challengeMode, setChallengeMode] = useState(false);
      const retirementAge = 65;

      // Derived calculations
      const yearsInvesting = retirementAge - startAge;
      const monthsInvesting = yearsInvesting * 12;
      const monthlyRate = annualReturn / 12;

      // Future Value with regular contributions: FV = PMT √ó (((1 + r)^n - 1) / r)
      const calculateFV = (months: number, contribution: number, rate: number) => {
         if (rate === 0) return contribution * months;
         return contribution * ((Math.pow(1 + rate, months) - 1) / rate);
      };

      const finalBalance = calculateFV(monthsInvesting, monthlyContribution, monthlyRate);
      const totalContributed = monthlyContribution * monthsInvesting;
      const interestEarned = finalBalance - totalContributed;
      const interestPercentage = finalBalance > 0 ? (interestEarned / finalBalance) * 100 : 0;

      // Comparison calculations
      const compYears = retirementAge - comparisonAge;
      const compMonths = compYears * 12;
      const compBalance = calculateFV(compMonths, monthlyContribution, monthlyRate);

      // Challenge: $1M goal
      const goalAmount = 1000000;
      const goalReached = finalBalance >= goalAmount;

      // Generate curve points for visualization
      const generateCurvePoints = (startAge: number, contribution: number): { x: number, y: number }[] => {
         const points: { x: number, y: number }[] = [];
         const years = retirementAge - startAge;
         for (let year = 0; year <= years; year++) {
            const months = year * 12;
            const balance = calculateFV(months, contribution, monthlyRate);
            points.push({ x: startAge + year, y: balance });
         }
         return points;
      };

      const curvePoints = generateCurvePoints(startAge, monthlyContribution);
      const comparisonPoints = showComparison ? generateCurvePoints(comparisonAge, monthlyContribution) : [];

      // SVG dimensions and scaling
      const chartWidth = 700;
      const chartHeight = 350;
      const padding = { top: 40, right: 40, bottom: 50, left: 80 };
      const innerWidth = chartWidth - padding.left - padding.right;
      const innerHeight = chartHeight - padding.top - padding.bottom;

      // Find max Y for scaling
      const maxY = Math.max(finalBalance, showComparison ? compBalance : 0, goalAmount) * 1.1;

      // Scale functions
      const scaleX = (age: number) => padding.left + ((age - 20) / (retirementAge - 20)) * innerWidth;
      const scaleY = (value: number) => padding.top + innerHeight - (value / maxY) * innerHeight;

      // Generate path string
      const generatePath = (points: { x: number, y: number }[]) => {
         if (points.length === 0) return '';
         return points.map((p, i) =>
            `${i === 0 ? 'M' : 'L'} ${scaleX(p.x)} ${scaleY(p.y)}`
         ).join(' ');
      };

      // Generate filled area path (for contributions)
      const generateAreaPath = () => {
         const contributionPoints: { x: number, y: number }[] = [];
         const years = yearsInvesting;
         for (let year = 0; year <= years; year++) {
            const months = year * 12;
            const contributed = monthlyContribution * months;
            contributionPoints.push({ x: startAge + year, y: contributed });
         }

         const forward = contributionPoints.map((p, i) =>
            `${i === 0 ? 'M' : 'L'} ${scaleX(p.x)} ${scaleY(p.y)}`
         ).join(' ');

         const backward = [...contributionPoints].reverse().map(p =>
            `L ${scaleX(p.x)} ${scaleY(0)}`
         ).join(' ');

         return forward + ' ' + backward + ' Z';
      };

      // Format currency
      const formatCurrency = (value: number) => {
         if (value >= 1000000) return `$${(value / 1000000).toFixed(2)}M`;
         if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
         return `$${value.toFixed(0)}`;
      };

      return (
         <div className="w-full h-full bg-gradient-to-br from-slate-50 to-blue-50 flex flex-col lg:flex-row overflow-hidden">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-4 flex flex-col">
               {/* Header */}
               <div className="mb-4 flex items-center justify-between">
                  <div>
                     <h2 className="text-xl font-bold text-slate-800">Compound Interest Calculator</h2>
                     <p className="text-sm text-slate-500">Discover why time is your most powerful asset</p>
                  </div>
                  <div className="flex items-center gap-3">
                     <button
                        onClick={() => setShowComparison(!showComparison)}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${showComparison
                           ? 'bg-purple-500 text-white'
                           : 'bg-slate-200 text-slate-600 hover:bg-slate-300'
                           }`}
                     >
                        {showComparison ? 'üìä Comparison ON' : 'üìä Compare'}
                     </button>
                     <button
                        onClick={() => setChallengeMode(!challengeMode)}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${challengeMode
                           ? 'bg-amber-500 text-white'
                           : 'bg-slate-200 text-slate-600 hover:bg-slate-300'
                           }`}
                     >
                        {challengeMode ? 'üéØ Challenge ON' : 'üéØ Challenge'}
                     </button>
                  </div>
               </div>

               {/* Challenge Banner */}
               {challengeMode && (
                  <div className={`mb-4 p-3 rounded-xl border-2 ${goalReached
                     ? 'bg-green-50 border-green-300 text-green-800'
                     : 'bg-amber-50 border-amber-300 text-amber-800'
                     }`}>
                     <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                           <span className="text-2xl">{goalReached ? 'üéâ' : 'üéØ'}</span>
                           <div>
                              <div className="text-sm font-bold">
                                 {goalReached ? 'MILLIONAIRE ACHIEVED!' : 'The Millionaire Race'}
                              </div>
                              <div className="text-xs opacity-80">
                                 {goalReached
                                    ? `You'll have ${formatCurrency(finalBalance)} at retirement!`
                                    : `Adjust controls to reach $1,000,000 by age ${retirementAge}`
                                 }
                              </div>
                           </div>
                        </div>
                        <div className="text-right">
                           <div className="text-lg font-mono font-bold">
                              {formatCurrency(finalBalance)}
                           </div>
                           <div className="text-xs opacity-70">
                              / $1,000,000
                           </div>
                        </div>
                     </div>
                  </div>
               )}

               {/* SVG Chart */}
               <div className="flex-1 bg-white rounded-2xl shadow-lg p-4 border border-slate-200">
                  <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-full">
                     <defs>
                        <linearGradient id="growthGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#22c55e" stopOpacity="0.3" />
                           <stop offset="100%" stopColor="#22c55e" stopOpacity="0.05" />
                        </linearGradient>
                        <linearGradient id="contributionGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#3b82f6" stopOpacity="0.4" />
                           <stop offset="100%" stopColor="#3b82f6" stopOpacity="0.1" />
                        </linearGradient>
                     </defs>

                     {/* Grid lines */}
                     {[0, 0.25, 0.5, 0.75, 1].map(ratio => (
                        <g key={ratio}>
                           <line
                              x1={padding.left}
                              y1={scaleY(maxY * ratio)}
                              x2={chartWidth - padding.right}
                              y2={scaleY(maxY * ratio)}
                              stroke="#e2e8f0"
                              strokeDasharray={ratio === 0 ? "0" : "4 4"}
                           />
                           <text
                              x={padding.left - 10}
                              y={scaleY(maxY * ratio) + 4}
                              textAnchor="end"
                              fill="#94a3b8"
                              fontSize="10"
                           >
                              {formatCurrency(maxY * ratio)}
                           </text>
                        </g>
                     ))}

                     {/* Age axis */}
                     {[20, 30, 40, 50, 60, 65].map(age => (
                        <g key={age}>
                           <line
                              x1={scaleX(age)}
                              y1={padding.top}
                              x2={scaleX(age)}
                              y2={chartHeight - padding.bottom}
                              stroke="#e2e8f0"
                              strokeDasharray="4 4"
                           />
                           <text
                              x={scaleX(age)}
                              y={chartHeight - padding.bottom + 20}
                              textAnchor="middle"
                              fill="#64748b"
                              fontSize="11"
                              fontWeight="bold"
                           >
                              {age}
                           </text>
                        </g>
                     ))}
                     <text
                        x={chartWidth / 2}
                        y={chartHeight - 10}
                        textAnchor="middle"
                        fill="#94a3b8"
                        fontSize="12"
                     >
                        Age
                     </text>

                     {/* $1M Goal line */}
                     {challengeMode && (
                        <g>
                           <line
                              x1={padding.left}
                              y1={scaleY(goalAmount)}
                              x2={chartWidth - padding.right}
                              y2={scaleY(goalAmount)}
                              stroke={goalReached ? "#22c55e" : "#fbbf24"}
                              strokeWidth="2"
                              strokeDasharray="8 4"
                           />
                           <text
                              x={chartWidth - padding.right + 5}
                              y={scaleY(goalAmount) + 4}
                              fill={goalReached ? "#22c55e" : "#fbbf24"}
                              fontSize="10"
                              fontWeight="bold"
                           >
                              $1M GOAL
                           </text>
                        </g>
                     )}

                     {/* Contribution area (what you put in) */}
                     <path
                        d={generateAreaPath()}
                        fill="url(#contributionGradient)"
                     />

                     {/* Comparison curve (ghost) */}
                     {showComparison && comparisonPoints.length > 0 && (
                        <path
                           d={generatePath(comparisonPoints)}
                           fill="none"
                           stroke="#a855f7"
                           strokeWidth="3"
                           strokeDasharray="8 4"
                           opacity="0.7"
                        />
                     )}

                     {/* Main growth curve */}
                     <path
                        d={generatePath(curvePoints)}
                        fill="none"
                        stroke="#22c55e"
                        strokeWidth="4"
                        strokeLinecap="round"
                     />

                     {/* Current position marker */}
                     <g>
                        <circle
                           cx={scaleX(startAge)}
                           cy={scaleY(0)}
                           r="8"
                           fill="#3b82f6"
                           stroke="#fff"
                           strokeWidth="3"
                        />
                        <text
                           x={scaleX(startAge)}
                           y={scaleY(0) + 25}
                           textAnchor="middle"
                           fill="#3b82f6"
                           fontSize="10"
                           fontWeight="bold"
                        >
                           START
                        </text>
                     </g>

                     {/* End point marker */}
                     <g>
                        <circle
                           cx={scaleX(retirementAge)}
                           cy={scaleY(finalBalance)}
                           r="10"
                           fill={goalReached ? "#22c55e" : "#f59e0b"}
                           stroke="#fff"
                           strokeWidth="3"
                        >
                           {goalReached && (
                              <animate attributeName="r" values="10;14;10" dur="1s" repeatCount="3" />
                           )}
                        </circle>
                        <text
                           x={scaleX(retirementAge)}
                           y={scaleY(finalBalance) - 18}
                           textAnchor="middle"
                           fill="#1e293b"
                           fontSize="14"
                           fontWeight="bold"
                        >
                           {formatCurrency(finalBalance)}
                        </text>
                     </g>

                     {/* Comparison end point */}
                     {showComparison && (
                        <g>
                           <circle
                              cx={scaleX(retirementAge)}
                              cy={scaleY(compBalance)}
                              r="8"
                              fill="#a855f7"
                              stroke="#fff"
                              strokeWidth="3"
                           />
                           <text
                              x={scaleX(retirementAge) + 25}
                              y={scaleY(compBalance) + 4}
                              fill="#a855f7"
                              fontSize="11"
                              fontWeight="bold"
                           >
                              {formatCurrency(compBalance)}
                           </text>
                        </g>
                     )}

                     {/* Legend */}
                     <g transform={`translate(${padding.left + 10}, ${padding.top + 10})`}>
                        <rect x="0" y="0" width="12" height="12" fill="#22c55e" rx="2" />
                        <text x="18" y="10" fill="#64748b" fontSize="10">Interest Earned</text>
                        <rect x="0" y="18" width="12" height="12" fill="#3b82f6" opacity="0.5" rx="2" />
                        <text x="18" y="28" fill="#64748b" fontSize="10">Your Contributions</text>
                        {showComparison && (
                           <>
                              <rect x="0" y="36" width="12" height="12" fill="#a855f7" rx="2" />
                              <text x="18" y="46" fill="#64748b" fontSize="10">Late Start (Age {comparisonAge})</text>
                           </>
                        )}
                     </g>
                  </svg>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-96 bg-white p-6 border-l border-slate-200 flex flex-col gap-5 overflow-y-auto shadow-lg">
               {/* Results Summary */}
               <div className="grid grid-cols-2 gap-3">
                  <div className={`p-4 rounded-xl border-2 ${goalReached && challengeMode ? 'bg-green-50 border-green-200' : 'bg-slate-50 border-slate-200'}`}>
                     <div className="text-[10px] font-black uppercase text-slate-400 mb-1">Final Balance</div>
                     <div className={`text-2xl font-mono font-bold ${goalReached && challengeMode ? 'text-green-600' : 'text-slate-800'}`}>
                        {formatCurrency(finalBalance)}
                     </div>
                  </div>
                  <div className="bg-blue-50 p-4 rounded-xl border-2 border-blue-200">
                     <div className="text-[10px] font-black uppercase text-blue-400 mb-1">You Contributed</div>
                     <div className="text-2xl font-mono font-bold text-blue-600">
                        {formatCurrency(totalContributed)}
                     </div>
                  </div>
                  <div className="bg-green-50 p-4 rounded-xl border-2 border-green-200">
                     <div className="text-[10px] font-black uppercase text-green-400 mb-1">Interest Earned</div>
                     <div className="text-xl font-mono font-bold text-green-600">
                        {formatCurrency(interestEarned)}
                     </div>
                  </div>
                  <div className="bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
                     <div className="text-[10px] font-black uppercase text-purple-400 mb-1">Interest %</div>
                     <div className="text-xl font-mono font-bold text-purple-600">
                        {interestPercentage.toFixed(1)}%
                     </div>
                  </div>
               </div>

               {/* Starting Age Control (PRIMARY) */}
               <div className="bg-indigo-50 p-4 rounded-xl border-2 border-indigo-200">
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-indigo-600 uppercase flex items-center gap-2">
                        <span className="text-lg">‚≠ê</span> Starting Age (KEY!)
                     </label>
                     <span className="text-lg font-mono font-bold text-indigo-700">{startAge}</span>
                  </div>
                  <input
                     type="range" min="20" max="50" value={startAge}
                     onChange={(e) => setStartAge(Number(e.target.value))}
                     className="w-full h-3 bg-indigo-200 rounded-full appearance-none cursor-pointer accent-indigo-500"
                  />
                  <div className="flex justify-between text-[10px] text-indigo-400 mt-1">
                     <span>20 (Early)</span>
                     <span>35</span>
                     <span>50 (Late)</span>
                  </div>
               </div>

               {/* Monthly Contribution Control */}
               <div>
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-slate-500 uppercase flex items-center gap-2">
                        <i className="fa-solid fa-piggy-bank text-blue-500"></i> Monthly Contribution
                     </label>
                     <span className="text-sm font-mono font-bold text-slate-700">${monthlyContribution}</span>
                  </div>
                  <input
                     type="range" min="100" max="2000" step="50" value={monthlyContribution}
                     onChange={(e) => setMonthlyContribution(Number(e.target.value))}
                     className="w-full h-2 bg-slate-200 rounded-full appearance-none cursor-pointer accent-blue-500"
                  />
                  <div className="flex justify-between text-[10px] text-slate-400 mt-1">
                     <span>$100</span>
                     <span>$1000</span>
                     <span>$2000</span>
                  </div>
               </div>

               {/* Return Rate Control */}
               <div>
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-slate-500 uppercase flex items-center gap-2">
                        <i className="fa-solid fa-chart-line text-green-500"></i> Annual Return
                     </label>
                     <span className="text-sm font-mono font-bold text-slate-700">{(annualReturn * 100).toFixed(1)}%</span>
                  </div>
                  <input
                     type="range" min="0.04" max="0.10" step="0.005" value={annualReturn}
                     onChange={(e) => setAnnualReturn(Number(e.target.value))}
                     className="w-full h-2 bg-slate-200 rounded-full appearance-none cursor-pointer accent-green-500"
                  />
                  <div className="flex justify-between text-[10px] text-slate-400 mt-1">
                     <span>4% (Conservative)</span>
                     <span>7%</span>
                     <span>10% (Aggressive)</span>
                  </div>
               </div>

               {/* Comparison Age (when enabled) */}
               {showComparison && (
                  <div className="bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
                     <div className="flex justify-between mb-2">
                        <label className="text-xs font-bold text-purple-600 uppercase">
                           üë§ Compare: Start at Age
                        </label>
                        <span className="text-sm font-mono font-bold text-purple-700">{comparisonAge}</span>
                     </div>
                     <input
                        type="range" min="25" max="55" value={comparisonAge}
                        onChange={(e) => setComparisonAge(Number(e.target.value))}
                        className="w-full h-2 bg-purple-200 rounded-full appearance-none cursor-pointer accent-purple-500"
                     />
                     <div className="mt-2 p-2 bg-white rounded-lg">
                        <div className="text-xs text-purple-600">
                           <strong>Difference:</strong> {formatCurrency(Math.abs(finalBalance - compBalance))}
                           {finalBalance > compBalance
                              ? <span className="text-green-600"> more</span>
                              : <span className="text-red-600"> less</span>
                           } by starting {Math.abs(startAge - comparisonAge)} years {startAge < comparisonAge ? 'earlier' : 'later'}
                        </div>
                     </div>
                  </div>
               )}

               {/* Years Investing */}
               <div className="bg-slate-100 p-3 rounded-xl text-center">
                  <div className="text-sm text-slate-600">
                     <span className="font-bold text-slate-800">{yearsInvesting} years</span> of investing
                     = <span className="font-bold text-green-600">{interestPercentage.toFixed(0)}%</span> from interest
                  </div>
               </div>

               {/* Educational Insight */}
               <div className="flex gap-3 p-4 bg-amber-50 rounded-xl border-2 border-amber-200">
                  <div className="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0 text-xl">
                     üí°
                  </div>
                  <div>
                     <p className="text-xs text-amber-800 leading-relaxed">
                        <strong>Key Insight:</strong> Notice how the curve gets steeper over time?
                        That's compound interest working. Starting at 25 instead of 35 with the SAME
                        monthly amount can mean <strong>2-3x more</strong> at retirement.
                        You can't make up for lost time by contributing more later.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- SUPPLY & DEMAND RENDERER (7-Stage Masterpiece) ---
   // Stage 1: Core insight = Price finds equilibrium where supply meets demand
   // Stage 2: Primary = shift demand/supply curves, Secondary = price controls
   // Stage 3: Classic X-diagram with equilibrium point, surplus/shortage areas
   // Stage 4: Demand: P = a - bQ, Supply: P = c + dQ, Equilibrium: where they intersect
   // Stage 5: State (curve positions) ‚Üí Derived (equilibrium, surplus) ‚Üí Visual
   // Stage 6: Challenges = "Find equilibrium", "Create shortage", "Price ceiling"
   const SupplyDemandRenderer = () => {
      const [demandShift, setDemandShift] = useState(0); // -50 to +50
      const [supplyShift, setSupplyShift] = useState(0); // -50 to +50
      const [priceControl, setPriceControl] = useState<number | null>(null);
      const [showSurplus, setShowSurplus] = useState(true);
      const [scenario, setScenario] = useState<'normal' | 'oil_shock' | 'tech_boom' | 'subsidy'>('normal');
      const [challengeMode, setChallengeMode] = useState(false);
      const [challengeTarget, setChallengeTarget] = useState<'equilibrium' | 'shortage' | 'surplus'>('equilibrium');

      // Base curve parameters (linear for simplicity)
      // Demand: P = 100 - Q (slopes down)
      // Supply: P = 10 + 0.8Q (slopes up)
      const demandIntercept = 100 + demandShift;
      const demandSlope = -1;
      const supplyIntercept = 10 + supplyShift;
      const supplySlope = 0.8;

      // Calculate equilibrium
      // 100 + demandShift - Q = 10 + supplyShift + 0.8Q
      // 90 + demandShift - supplyShift = 1.8Q
      // Q = (90 + demandShift - supplyShift) / 1.8
      const equilibriumQ = Math.max(0, (90 + demandShift - supplyShift) / 1.8);
      const equilibriumP = demandIntercept + demandSlope * equilibriumQ;

      // Price-controlled quantities
      const controlledPrice = priceControl ?? equilibriumP;
      const qDemanded = Math.max(0, (demandIntercept - controlledPrice) / Math.abs(demandSlope));
      const qSupplied = Math.max(0, (controlledPrice - supplyIntercept) / supplySlope);

      const hasShortage = priceControl !== null && priceControl < equilibriumP;
      const hasSurplus = priceControl !== null && priceControl > equilibriumP;
      const shortageAmount = hasShortage ? qDemanded - qSupplied : 0;
      const surplusAmount = hasSurplus ? qSupplied - qDemanded : 0;

      // Challenge evaluation
      const challengeMet = challengeMode && (
         (challengeTarget === 'equilibrium' && priceControl === null && Math.abs(demandShift) < 5 && Math.abs(supplyShift) < 5) ||
         (challengeTarget === 'shortage' && shortageAmount > 20) ||
         (challengeTarget === 'surplus' && surplusAmount > 20)
      );

      // Apply scenario presets
      const applyScenario = (s: typeof scenario) => {
         setScenario(s);
         setPriceControl(null);
         switch (s) {
            case 'normal':
               setDemandShift(0);
               setSupplyShift(0);
               break;
            case 'oil_shock':
               setDemandShift(0);
               setSupplyShift(-30); // Supply decreases
               break;
            case 'tech_boom':
               setDemandShift(25); // Demand increases
               setSupplyShift(0);
               break;
            case 'subsidy':
               setDemandShift(0);
               setSupplyShift(20); // Supply increases
               break;
         }
      };

      // SVG dimensions
      const chartWidth = 600;
      const chartHeight = 400;
      const padding = { top: 40, right: 40, bottom: 60, left: 70 };
      const innerWidth = chartWidth - padding.left - padding.right;
      const innerHeight = chartHeight - padding.top - padding.bottom;

      // Scale functions (Q: 0-100, P: 0-120)
      const maxQ = 100;
      const maxP = 120;
      const scaleX = (q: number) => padding.left + (q / maxQ) * innerWidth;
      const scaleY = (p: number) => padding.top + innerHeight - (p / maxP) * innerHeight;

      // Generate line paths
      const demandPath = `M ${scaleX(0)} ${scaleY(demandIntercept)} L ${scaleX(Math.min(maxQ, demandIntercept / Math.abs(demandSlope)))} ${scaleY(0)}`;
      const supplyPath = `M ${scaleX(0)} ${scaleY(supplyIntercept)} L ${scaleX(maxQ)} ${scaleY(supplyIntercept + supplySlope * maxQ)}`;

      return (
         <div className="w-full h-full bg-gradient-to-br from-emerald-50 to-blue-50 flex flex-col lg:flex-row overflow-hidden">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-4 flex flex-col">
               {/* Header */}
               <div className="mb-3 flex items-center justify-between">
                  <div>
                     <h2 className="text-xl font-bold text-slate-800">Supply & Demand</h2>
                     <p className="text-sm text-slate-500">Discover how markets find equilibrium</p>
                  </div>
                  <div className="flex items-center gap-2">
                     <button
                        onClick={() => setChallengeMode(!challengeMode)}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-600'
                           }`}
                     >
                        {challengeMode ? 'üéØ Challenge ON' : 'üéØ Challenge'}
                     </button>
                  </div>
               </div>

               {/* Scenario Buttons */}
               <div className="mb-3 flex gap-2 flex-wrap">
                  {[
                     { id: 'normal', label: '‚öñÔ∏è Normal', desc: 'Base case' },
                     { id: 'oil_shock', label: 'üõ¢Ô∏è Oil Shock', desc: 'Supply drops' },
                     { id: 'tech_boom', label: 'üì± Tech Boom', desc: 'Demand rises' },
                     { id: 'subsidy', label: 'üí∞ Subsidy', desc: 'Supply rises' },
                  ].map(s => (
                     <button
                        key={s.id}
                        onClick={() => applyScenario(s.id as typeof scenario)}
                        className={`px-3 py-2 rounded-lg text-xs font-bold transition-all ${scenario === s.id
                           ? 'bg-indigo-500 text-white shadow-lg'
                           : 'bg-white text-slate-600 border border-slate-200 hover:border-indigo-300'
                           }`}
                     >
                        {s.label}
                     </button>
                  ))}
               </div>

               {/* Challenge Banner */}
               {challengeMode && (
                  <div className={`mb-3 p-3 rounded-xl border-2 ${challengeMet ? 'bg-green-50 border-green-300' : 'bg-amber-50 border-amber-300'
                     }`}>
                     <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                           <span className="text-xl">{challengeMet ? 'üéâ' : 'üéØ'}</span>
                           <div>
                              <div className="text-sm font-bold text-slate-800">
                                 {challengeTarget === 'equilibrium' && 'Find Market Equilibrium'}
                                 {challengeTarget === 'shortage' && 'Create a Shortage (20+ units)'}
                                 {challengeTarget === 'surplus' && 'Create a Surplus (20+ units)'}
                              </div>
                              <div className="text-xs text-slate-600">
                                 {challengeMet ? 'Challenge Complete!' : 'Adjust curves or set price controls'}
                              </div>
                           </div>
                        </div>
                        <select
                           value={challengeTarget}
                           onChange={(e) => setChallengeTarget(e.target.value as typeof challengeTarget)}
                           className="text-xs p-1 rounded border border-slate-300"
                        >
                           <option value="equilibrium">Equilibrium</option>
                           <option value="shortage">Shortage</option>
                           <option value="surplus">Surplus</option>
                        </select>
                     </div>
                  </div>
               )}

               {/* SVG Chart */}
               <div className="flex-1 bg-white rounded-2xl shadow-lg p-4 border border-slate-200">
                  <svg viewBox={`0 0 ${chartWidth} ${chartHeight}`} className="w-full h-full">
                     <defs>
                        <linearGradient id="shortageGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                           <stop offset="0%" stopColor="#ef4444" stopOpacity="0.3" />
                           <stop offset="100%" stopColor="#ef4444" stopOpacity="0.1" />
                        </linearGradient>
                        <linearGradient id="surplusGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                           <stop offset="0%" stopColor="#22c55e" stopOpacity="0.1" />
                           <stop offset="100%" stopColor="#22c55e" stopOpacity="0.3" />
                        </linearGradient>
                     </defs>

                     {/* Grid */}
                     {[0, 25, 50, 75, 100].map(q => (
                        <g key={`q-${q}`}>
                           <line x1={scaleX(q)} y1={padding.top} x2={scaleX(q)} y2={chartHeight - padding.bottom} stroke="#e2e8f0" strokeDasharray="4 4" />
                           <text x={scaleX(q)} y={chartHeight - padding.bottom + 20} textAnchor="middle" fill="#64748b" fontSize="10">{q}</text>
                        </g>
                     ))}
                     {[0, 30, 60, 90, 120].map(p => (
                        <g key={`p-${p}`}>
                           <line x1={padding.left} y1={scaleY(p)} x2={chartWidth - padding.right} y2={scaleY(p)} stroke="#e2e8f0" strokeDasharray="4 4" />
                           <text x={padding.left - 10} y={scaleY(p) + 4} textAnchor="end" fill="#64748b" fontSize="10">${p}</text>
                        </g>
                     ))}

                     {/* Axis labels */}
                     <text x={chartWidth / 2} y={chartHeight - 15} textAnchor="middle" fill="#64748b" fontSize="12" fontWeight="bold">Quantity (Q)</text>
                     <text x={20} y={chartHeight / 2} textAnchor="middle" fill="#64748b" fontSize="12" fontWeight="bold" transform={`rotate(-90, 20, ${chartHeight / 2})`}>Price (P)</text>

                     {/* Shortage/Surplus areas when price control active */}
                     {priceControl !== null && showSurplus && (
                        <g>
                           {hasShortage && (
                              <rect
                                 x={scaleX(qSupplied)}
                                 y={scaleY(controlledPrice) - 15}
                                 width={scaleX(qDemanded) - scaleX(qSupplied)}
                                 height={30}
                                 fill="url(#shortageGradient)"
                                 rx="4"
                              />
                           )}
                           {hasSurplus && (
                              <rect
                                 x={scaleX(qDemanded)}
                                 y={scaleY(controlledPrice) - 15}
                                 width={scaleX(qSupplied) - scaleX(qDemanded)}
                                 height={30}
                                 fill="url(#surplusGradient)"
                                 rx="4"
                              />
                           )}
                        </g>
                     )}

                     {/* Price control line */}
                     {priceControl !== null && (
                        <g>
                           <line
                              x1={padding.left}
                              y1={scaleY(priceControl)}
                              x2={chartWidth - padding.right}
                              y2={scaleY(priceControl)}
                              stroke={hasShortage ? "#ef4444" : hasSurplus ? "#22c55e" : "#6366f1"}
                              strokeWidth="3"
                              strokeDasharray="8 4"
                           />
                           <text
                              x={chartWidth - padding.right + 5}
                              y={scaleY(priceControl) + 4}
                              fill={hasShortage ? "#ef4444" : hasSurplus ? "#22c55e" : "#6366f1"}
                              fontSize="10"
                              fontWeight="bold"
                           >
                              {hasShortage ? 'PRICE CEILING' : hasSurplus ? 'PRICE FLOOR' : 'PRICE CONTROL'}
                           </text>
                        </g>
                     )}

                     {/* Demand curve (blue, slopes down) */}
                     <path d={demandPath} fill="none" stroke="#3b82f6" strokeWidth="4" strokeLinecap="round" />
                     <text x={scaleX(5)} y={scaleY(demandIntercept - 5) - 10} fill="#3b82f6" fontSize="12" fontWeight="bold">Demand (D)</text>

                     {/* Supply curve (orange, slopes up) */}
                     <path d={supplyPath} fill="none" stroke="#f97316" strokeWidth="4" strokeLinecap="round" />
                     <text x={scaleX(85)} y={scaleY(supplyIntercept + supplySlope * 85) - 10} fill="#f97316" fontSize="12" fontWeight="bold">Supply (S)</text>

                     {/* Equilibrium point */}
                     {equilibriumQ > 0 && equilibriumP > 0 && equilibriumP < maxP && (
                        <g>
                           {/* Dashed lines to axes */}
                           <line x1={scaleX(equilibriumQ)} y1={scaleY(equilibriumP)} x2={scaleX(equilibriumQ)} y2={chartHeight - padding.bottom} stroke="#10b981" strokeWidth="2" strokeDasharray="4 4" />
                           <line x1={scaleX(equilibriumQ)} y1={scaleY(equilibriumP)} x2={padding.left} y2={scaleY(equilibriumP)} stroke="#10b981" strokeWidth="2" strokeDasharray="4 4" />

                           {/* Equilibrium marker */}
                           <circle cx={scaleX(equilibriumQ)} cy={scaleY(equilibriumP)} r="12" fill="#10b981" stroke="#fff" strokeWidth="3">
                              <animate attributeName="r" values="12;15;12" dur="2s" repeatCount="indefinite" />
                           </circle>
                           <text x={scaleX(equilibriumQ)} y={scaleY(equilibriumP) - 20} textAnchor="middle" fill="#10b981" fontSize="11" fontWeight="bold">
                              Equilibrium
                           </text>
                           <text x={scaleX(equilibriumQ)} y={scaleY(equilibriumP) + 5} textAnchor="middle" fill="#fff" fontSize="10" fontWeight="bold">E</text>
                        </g>
                     )}

                     {/* Shortage/Surplus labels */}
                     {hasShortage && shortageAmount > 5 && (
                        <text
                           x={(scaleX(qSupplied) + scaleX(qDemanded)) / 2}
                           y={scaleY(controlledPrice) + 5}
                           textAnchor="middle"
                           fill="#ef4444"
                           fontSize="11"
                           fontWeight="bold"
                        >
                           SHORTAGE: {shortageAmount.toFixed(0)} units
                        </text>
                     )}
                     {hasSurplus && surplusAmount > 5 && (
                        <text
                           x={(scaleX(qDemanded) + scaleX(qSupplied)) / 2}
                           y={scaleY(controlledPrice) + 5}
                           textAnchor="middle"
                           fill="#22c55e"
                           fontSize="11"
                           fontWeight="bold"
                        >
                           SURPLUS: {surplusAmount.toFixed(0)} units
                        </text>
                     )}
                  </svg>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-96 bg-white p-5 border-l border-slate-200 flex flex-col gap-4 overflow-y-auto shadow-lg">
               {/* Market Status */}
               <div className={`p-4 rounded-xl border-2 ${hasShortage ? 'bg-red-50 border-red-200' :
                  hasSurplus ? 'bg-green-50 border-green-200' :
                     'bg-emerald-50 border-emerald-200'
                  }`}>
                  <div className="text-[10px] font-black uppercase text-slate-400 mb-1">Market Status</div>
                  <div className={`text-lg font-bold ${hasShortage ? 'text-red-600' : hasSurplus ? 'text-green-600' : 'text-emerald-600'
                     }`}>
                     {hasShortage ? '‚ö†Ô∏è SHORTAGE' : hasSurplus ? 'üì¶ SURPLUS' : '‚úÖ EQUILIBRIUM'}
                  </div>
                  <div className="text-sm text-slate-600 mt-1">
                     P* = ${equilibriumP.toFixed(0)} | Q* = {equilibriumQ.toFixed(0)} units
                  </div>
               </div>

               {/* Demand Shift Control */}
               <div className="bg-blue-50 p-4 rounded-xl border-2 border-blue-200">
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-blue-600 uppercase flex items-center gap-2">
                        üìâ Demand Shift
                     </label>
                     <span className="text-sm font-mono font-bold text-blue-700">
                        {demandShift > 0 ? '+' : ''}{demandShift}
                     </span>
                  </div>
                  <input
                     type="range" min="-50" max="50" value={demandShift}
                     onChange={(e) => setDemandShift(Number(e.target.value))}
                     className="w-full h-3 bg-blue-200 rounded-full appearance-none cursor-pointer accent-blue-500"
                  />
                  <div className="flex justify-between text-[10px] text-blue-400 mt-1">
                     <span>‚Üê Less demand</span>
                     <span>More demand ‚Üí</span>
                  </div>
               </div>

               {/* Supply Shift Control */}
               <div className="bg-orange-50 p-4 rounded-xl border-2 border-orange-200">
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-orange-600 uppercase flex items-center gap-2">
                        üìà Supply Shift
                     </label>
                     <span className="text-sm font-mono font-bold text-orange-700">
                        {supplyShift > 0 ? '+' : ''}{supplyShift}
                     </span>
                  </div>
                  <input
                     type="range" min="-50" max="50" value={supplyShift}
                     onChange={(e) => setSupplyShift(Number(e.target.value))}
                     className="w-full h-3 bg-orange-200 rounded-full appearance-none cursor-pointer accent-orange-500"
                  />
                  <div className="flex justify-between text-[10px] text-orange-400 mt-1">
                     <span>‚Üê Less supply</span>
                     <span>More supply ‚Üí</span>
                  </div>
               </div>

               {/* Price Control */}
               <div className="bg-purple-50 p-4 rounded-xl border-2 border-purple-200">
                  <div className="flex justify-between items-center mb-2">
                     <label className="text-xs font-bold text-purple-600 uppercase">
                        üèõÔ∏è Price Control
                     </label>
                     <button
                        onClick={() => setPriceControl(priceControl === null ? equilibriumP : null)}
                        className={`px-2 py-1 rounded text-xs font-bold ${priceControl !== null
                           ? 'bg-purple-500 text-white'
                           : 'bg-purple-200 text-purple-600'
                           }`}
                     >
                        {priceControl !== null ? 'ON' : 'OFF'}
                     </button>
                  </div>
                  {priceControl !== null && (
                     <>
                        <input
                           type="range" min="20" max="100" value={priceControl}
                           onChange={(e) => setPriceControl(Number(e.target.value))}
                           className="w-full h-3 bg-purple-200 rounded-full appearance-none cursor-pointer accent-purple-500"
                        />
                        <div className="flex justify-between text-[10px] text-purple-400 mt-1">
                           <span>$20 (Ceiling)</span>
                           <span className="font-bold">${priceControl}</span>
                           <span>$100 (Floor)</span>
                        </div>
                     </>
                  )}
               </div>

               {/* Real-World Examples */}
               <div className="bg-slate-50 p-3 rounded-xl border border-slate-200">
                  <div className="text-[10px] font-black uppercase text-slate-400 mb-2">Real Examples</div>
                  <div className="grid grid-cols-2 gap-2 text-xs">
                     <div className="p-2 bg-white rounded border border-slate-100">
                        <span className="font-bold text-red-500">Shortage:</span> Rent control, PS5 launch
                     </div>
                     <div className="p-2 bg-white rounded border border-slate-100">
                        <span className="font-bold text-green-500">Surplus:</span> Min wage, farm subsidies
                     </div>
                  </div>
               </div>

               {/* Educational Insight */}
               <div className="flex gap-3 p-4 bg-amber-50 rounded-xl border-2 border-amber-200">
                  <div className="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0 text-xl">
                     üí°
                  </div>
                  <div>
                     <p className="text-xs text-amber-800 leading-relaxed">
                        <strong>Key Insight:</strong> Markets naturally find equilibrium where supply meets demand.
                        Price controls (ceilings/floors) create shortages or surpluses because they prevent
                        prices from adjusting. The "invisible hand" works through price signals!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- PENDULUM / SIMPLE HARMONIC MOTION RENDERER (7-Stage Masterpiece) ---
   // Stage 1: Core insight = Period depends on LENGTH, not mass or amplitude (for small angles)
   // Stage 2: Primary = pendulum length, Secondary = initial amplitude, gravity
   // Stage 3: Animated pendulum bob swinging, period vs length graph
   // Stage 4: T = 2œÄ‚àö(L/g), Œ∏(t) = Œ∏‚ÇÄcos(œât), œâ = ‚àö(g/L)
   // Stage 5: State (length, amplitude) ‚Üí Derived (period, angular freq) ‚Üí Animation
   // Stage 6: Challenge = "Match the period to 2.0s"
   const PendulumRenderer = () => {
      const [length, setLength] = useState(1.0); // meters
      const [amplitude, setAmplitude] = useState(30); // degrees (initial angle)
      const [gravity, setGravity] = useState(9.8); // m/s¬≤
      const [isSwinging, setIsSwinging] = useState(false);
      const [time, setTime] = useState(0);
      const [showPhaseSpace, setShowPhaseSpace] = useState(false);
      const [challengeMode, setChallengeMode] = useState(false);
      const targetPeriod = 2.0; // Challenge: match this period

      // Physics calculations
      // Period: T = 2œÄ‚àö(L/g) (for small angles)
      const period = 2 * Math.PI * Math.sqrt(length / gravity);
      const angularFrequency = Math.sqrt(gravity / length); // œâ = ‚àö(g/L)

      // Current angle: Œ∏(t) = Œ∏‚ÇÄ * cos(œât) (simple harmonic motion for small angles)
      const amplitudeRad = amplitude * (Math.PI / 180);
      const currentAngleRad = amplitudeRad * Math.cos(angularFrequency * time);
      const currentAngleDeg = currentAngleRad * (180 / Math.PI);

      // Angular velocity: Œ∏'(t) = -Œ∏‚ÇÄœâ * sin(œât)
      const angularVelocity = -amplitudeRad * angularFrequency * Math.sin(angularFrequency * time);

      // Challenge evaluation
      const periodError = Math.abs(period - targetPeriod);
      const challengeMet = challengeMode && periodError < 0.05;

      // Animation loop
      useEffect(() => {
         if (!isSwinging) return;

         const startTime = performance.now();
         const initialTime = time;

         const animate = (now: number) => {
            const elapsed = (now - startTime) / 1000; // seconds
            setTime(initialTime + elapsed);
            if (isSwinging) {
               requestAnimationFrame(animate);
            }
         };

         const animationId = requestAnimationFrame(animate);
         return () => cancelAnimationFrame(animationId);
      }, [isSwinging]);

      // SVG dimensions
      const pivotX = 300;
      const pivotY = 60;
      const pixelsPerMeter = 180; // Scale: 180px = 1m
      const bobRadius = 25;

      // Calculate bob position
      const bobX = pivotX + Math.sin(currentAngleRad) * length * pixelsPerMeter;
      const bobY = pivotY + Math.cos(currentAngleRad) * length * pixelsPerMeter;

      // Generate trail/ghost positions for visualization
      const trailAngles = [];
      for (let i = 0; i <= 10; i++) {
         const trailAngle = amplitudeRad * Math.cos(angularFrequency * (time - i * 0.05));
         trailAngles.push({
            x: pivotX + Math.sin(trailAngle) * length * pixelsPerMeter,
            y: pivotY + Math.cos(trailAngle) * length * pixelsPerMeter,
            opacity: 1 - i * 0.09
         });
      }

      return (
         <div className="w-full h-full bg-gradient-to-br from-violet-50 to-indigo-50 flex flex-col lg:flex-row overflow-hidden">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-4 flex flex-col">
               {/* Header */}
               <div className="mb-3 flex items-center justify-between">
                  <div>
                     <h2 className="text-xl font-bold text-slate-800">Simple Pendulum</h2>
                     <p className="text-sm text-slate-500">Discover what affects the period</p>
                  </div>
                  <div className="flex items-center gap-2">
                     <button
                        onClick={() => setChallengeMode(!challengeMode)}
                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-600'
                           }`}
                     >
                        {challengeMode ? 'üéØ Challenge ON' : 'üéØ Challenge'}
                     </button>
                  </div>
               </div>

               {/* Challenge Banner */}
               {challengeMode && (
                  <div className={`mb-3 p-3 rounded-xl border-2 ${challengeMet ? 'bg-green-50 border-green-300' : 'bg-amber-50 border-amber-300'
                     }`}>
                     <div className="flex items-center justify-between">
                        <div className="flex items-center gap-2">
                           <span className="text-xl">{challengeMet ? 'üéâ' : 'üéØ'}</span>
                           <div>
                              <div className="text-sm font-bold text-slate-800">
                                 Match Period = {targetPeriod.toFixed(1)}s
                              </div>
                              <div className="text-xs text-slate-600">
                                 {challengeMet ? 'Perfect! You found it!' : `Current: ${period.toFixed(2)}s (off by ${periodError.toFixed(2)}s)`}
                              </div>
                           </div>
                        </div>
                        <div className="text-xs text-slate-500">
                           Hint: Adjust the length!
                        </div>
                     </div>
                  </div>
               )}

               {/* SVG Visualization */}
               <div className="flex-1 bg-white rounded-2xl shadow-lg p-4 border border-slate-200 flex items-center justify-center">
                  <svg viewBox="0 0 600 420" className="w-full h-full max-h-[350px]">
                     <defs>
                        <linearGradient id="stringGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                           <stop offset="0%" stopColor="#6366f1" />
                           <stop offset="100%" stopColor="#4f46e5" />
                        </linearGradient>
                        <radialGradient id="bobGradient" cx="30%" cy="30%">
                           <stop offset="0%" stopColor="#818cf8" />
                           <stop offset="100%" stopColor="#4f46e5" />
                        </radialGradient>
                        <filter id="bobShadow" x="-50%" y="-50%" width="200%" height="200%">
                           <feDropShadow dx="3" dy="5" stdDeviation="4" floodOpacity="0.3" />
                        </filter>
                     </defs>

                     {/* Background grid */}
                     <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e2e8f0" strokeWidth="0.5" />
                     </pattern>
                     <rect width="600" height="420" fill="url(#grid)" />

                     {/* Pivot point */}
                     <rect x={pivotX - 60} y={pivotY - 20} width="120" height="25" fill="#374151" rx="4" />
                     <circle cx={pivotX} cy={pivotY} r="8" fill="#1f2937" stroke="#fff" strokeWidth="2" />

                     {/* Amplitude arc (dashed) */}
                     <path
                        d={`M ${pivotX + Math.sin(-amplitudeRad) * length * pixelsPerMeter * 0.3} ${pivotY + Math.cos(-amplitudeRad) * length * pixelsPerMeter * 0.3} 
                            A ${length * pixelsPerMeter * 0.3} ${length * pixelsPerMeter * 0.3} 0 0 1 
                            ${pivotX + Math.sin(amplitudeRad) * length * pixelsPerMeter * 0.3} ${pivotY + Math.cos(amplitudeRad) * length * pixelsPerMeter * 0.3}`}
                        fill="none"
                        stroke="#a78bfa"
                        strokeWidth="2"
                        strokeDasharray="6 4"
                        opacity="0.5"
                     />

                     {/* Trail/ghost positions */}
                     {isSwinging && trailAngles.slice(2).map((pos, i) => (
                        <circle
                           key={i}
                           cx={pos.x}
                           cy={pos.y}
                           r={bobRadius * 0.6}
                           fill="#a78bfa"
                           opacity={pos.opacity * 0.3}
                        />
                     ))}

                     {/* String/rod */}
                     <line
                        x1={pivotX} y1={pivotY}
                        x2={bobX} y2={bobY}
                        stroke="url(#stringGradient)"
                        strokeWidth="4"
                        strokeLinecap="round"
                     />

                     {/* Bob */}
                     <circle
                        cx={bobX}
                        cy={bobY}
                        r={bobRadius}
                        fill="url(#bobGradient)"
                        filter="url(#bobShadow)"
                        stroke="#fff"
                        strokeWidth="3"
                     />

                     {/* Angle indicator */}
                     <text x={pivotX + 35} y={pivotY + 50} fill="#6366f1" fontSize="12" fontWeight="bold">
                        Œ∏ = {currentAngleDeg.toFixed(1)}¬∞
                     </text>

                     {/* Length indicator */}
                     <line x1={pivotX + 40} y1={pivotY + 10} x2={pivotX + 40} y2={pivotY + length * pixelsPerMeter - 10} stroke="#94a3b8" strokeWidth="1" markerEnd="url(#arrow)" />
                     <text x={pivotX + 55} y={pivotY + length * pixelsPerMeter / 2} fill="#64748b" fontSize="11">
                        L = {length.toFixed(2)}m
                     </text>

                     {/* Period display */}
                     <rect x="430" y="20" width="150" height="70" fill="#f8fafc" rx="8" stroke="#e2e8f0" />
                     <text x="505" y="45" textAnchor="middle" fill="#64748b" fontSize="10" fontWeight="bold">PERIOD</text>
                     <text x="505" y="72" textAnchor="middle" fill={challengeMet ? "#22c55e" : "#4f46e5"} fontSize="24" fontWeight="bold">
                        T = {period.toFixed(2)}s
                     </text>

                     {/* Formula */}
                     <text x="505" y="115" textAnchor="middle" fill="#94a3b8" fontSize="11">
                        T = 2œÄ‚àö(L/g)
                     </text>
                  </svg>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-96 bg-white p-5 border-l border-slate-200 flex flex-col gap-4 overflow-y-auto shadow-lg">
               {/* Start/Stop Button */}
               <button
                  onClick={() => {
                     if (!isSwinging) setTime(0);
                     setIsSwinging(!isSwinging);
                  }}
                  className={`w-full py-4 rounded-xl font-bold text-lg transition-all ${isSwinging
                     ? 'bg-red-500 text-white hover:bg-red-600'
                     : 'bg-gradient-to-r from-indigo-500 to-purple-500 text-white hover:from-indigo-600 hover:to-purple-600'
                     }`}
               >
                  {isSwinging ? '‚èπÔ∏è STOP' : '‚ñ∂Ô∏è START SWING'}
               </button>

               {/* Physics Metrics */}
               <div className="grid grid-cols-2 gap-3">
                  <div className="p-3 bg-indigo-50 rounded-xl border-2 border-indigo-200 text-center">
                     <div className="text-[10px] font-black uppercase text-indigo-400">Period</div>
                     <div className="text-xl font-mono font-bold text-indigo-600">{period.toFixed(2)}s</div>
                  </div>
                  <div className="p-3 bg-purple-50 rounded-xl border-2 border-purple-200 text-center">
                     <div className="text-[10px] font-black uppercase text-purple-400">Frequency</div>
                     <div className="text-xl font-mono font-bold text-purple-600">{(1 / period).toFixed(2)} Hz</div>
                  </div>
                  <div className="p-3 bg-slate-50 rounded-xl border border-slate-200 text-center">
                     <div className="text-[10px] font-black uppercase text-slate-400">Angular œâ</div>
                     <div className="text-lg font-mono font-bold text-slate-600">{angularFrequency.toFixed(2)} rad/s</div>
                  </div>
                  <div className="p-3 bg-slate-50 rounded-xl border border-slate-200 text-center">
                     <div className="text-[10px] font-black uppercase text-slate-400">Time</div>
                     <div className="text-lg font-mono font-bold text-slate-600">{time.toFixed(1)}s</div>
                  </div>
               </div>

               {/* Length Control (PRIMARY - affects period) */}
               <div className="bg-indigo-50 p-4 rounded-xl border-2 border-indigo-200">
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-indigo-600 uppercase flex items-center gap-2">
                        ‚≠ê Length (affects period!)
                     </label>
                     <span className="text-sm font-mono font-bold text-indigo-700">{length.toFixed(2)} m</span>
                  </div>
                  <input
                     type="range" min="0.25" max="2.5" step="0.05" value={length}
                     onChange={(e) => setLength(Number(e.target.value))}
                     className="w-full h-3 bg-indigo-200 rounded-full appearance-none cursor-pointer accent-indigo-500"
                  />
                  <div className="flex justify-between text-[10px] text-indigo-400 mt-1">
                     <span>0.25m (fast)</span>
                     <span>1.0m</span>
                     <span>2.5m (slow)</span>
                  </div>
               </div>

               {/* Amplitude Control */}
               <div>
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-slate-500 uppercase">
                        üìê Initial Amplitude
                     </label>
                     <span className="text-sm font-mono font-bold text-slate-700">{amplitude}¬∞</span>
                  </div>
                  <input
                     type="range" min="5" max="45" step="5" value={amplitude}
                     onChange={(e) => setAmplitude(Number(e.target.value))}
                     className="w-full h-2 bg-slate-200 rounded-full appearance-none cursor-pointer accent-violet-500"
                  />
                  <div className="text-[10px] text-slate-400 mt-1 text-center">
                     (Doesn't affect period for small angles!)
                  </div>
               </div>

               {/* Gravity Control */}
               <div>
                  <div className="flex justify-between mb-2">
                     <label className="text-xs font-bold text-slate-500 uppercase">
                        üåç Gravity
                     </label>
                     <span className="text-sm font-mono font-bold text-slate-700">{gravity.toFixed(1)} m/s¬≤</span>
                  </div>
                  <input
                     type="range" min="1.6" max="25" step="0.1" value={gravity}
                     onChange={(e) => setGravity(Number(e.target.value))}
                     className="w-full h-2 bg-slate-200 rounded-full appearance-none cursor-pointer accent-emerald-500"
                  />
                  <div className="flex justify-between text-[10px] text-slate-400 mt-1">
                     <span>üåô Moon (1.6)</span>
                     <span>üåç Earth (9.8)</span>
                     <span>‚ôÉ Jupiter (25)</span>
                  </div>
               </div>

               {/* Key Discovery Box */}
               <div className="bg-emerald-50 p-3 rounded-xl border-2 border-emerald-200">
                  <div className="text-xs text-emerald-800">
                     <strong>üî¨ Key Discovery:</strong> Try changing the amplitude and mass (imagine different bobs).
                     Does the period change? <em>For small angles, only LENGTH and GRAVITY affect the period!</em>
                  </div>
               </div>

               {/* Educational Insight */}
               <div className="flex gap-3 p-4 bg-amber-50 rounded-xl border-2 border-amber-200">
                  <div className="w-10 h-10 rounded-full bg-amber-100 text-amber-600 flex items-center justify-center shrink-0 text-xl">
                     üí°
                  </div>
                  <div>
                     <p className="text-xs text-amber-800 leading-relaxed">
                        <strong>Key Insight:</strong> Galileo discovered that a pendulum's period is
                        independent of its amplitude (for small swings). This led to the invention
                        of accurate clocks! The formula T = 2œÄ‚àö(L/g) shows only length and gravity matter.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ADDITION RENDERER (Concrete ‚Üí Pictorial ‚Üí Abstract) ---
   // Stage 1: Core insight = Combining groups.
   // Stage 2: Primary = num1, num2.
   // Stage 3: Concrete (Apples) + Pictorial (Number Line) + Abstract (Equation).
   // Stage 4: a + b = c.
   // Stage 5: State (num1, num2) ‚Üí Derived (total, paths).
   // Stage 6: Challenge = "Make the total 10".
   const AdditionRenderer = () => {
      const [num1, setNum1] = useState(5);
      const [num2, setNum2] = useState(4);
      const [showNumberLine, setShowNumberLine] = useState(true);
      const [isCombining, setIsCombining] = useState(false);
      const [challengeMode, setChallengeMode] = useState(false);

      const total = num1 + num2;
      const isChallengeMet = challengeMode && total === 10;

      // Helper to render a group of apples
      const renderApples = (count: number, color: string, isResult: boolean = false) => {
         const apples = [];
         const cols = 5;
         for (let i = 0; i < count; i++) {
            const row = Math.floor(i / cols);
            const col = i % cols;
            apples.push(
               <g key={i} transform={`translate(${col * 25 + 15}, ${row * 25 + 15})`} className="animate-in zoom-in duration-300">
                  <circle r="10" fill={color} />
                  <path d="M-2,-8 Q0,-12 2,-8" stroke="#4ade80" strokeWidth="2" fill="none" />
                  <circle r="2" cx="3" cy="-3" fill="white" opacity="0.4" />
               </g>
            );
         }
         return apples;
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Addition</h2>
                     <p className="text-slate-500 text-sm">Combining groups into one total</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Make the total exactly 10</p>
                           <p className="text-xs opacity-80">Adjust the numbers to find different ways to make 10.</p>
                        </div>
                        {isChallengeMet && (
                           <div className="ml-auto animate-bounce text-green-600 font-black">SUCCESS!</div>
                        )}
                     </div>
                  </div>
               )}

               {/* CONCRETE LAYER: Apples */}
               <div className="flex-1 grid grid-cols-3 gap-4 min-h-0">
                  <div className="bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 p-4 flex flex-col items-center">
                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Group A</span>
                     <svg className="w-full h-full max-h-[150px]">
                        {renderApples(num1, "#ef4444")}
                     </svg>
                     <div className="mt-2 text-2xl font-black text-red-500">{num1}</div>
                  </div>

                  <div className="flex items-center justify-center text-4xl font-black text-slate-300">+</div>

                  <div className="bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 p-4 flex flex-col items-center">
                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Group B</span>
                     <svg className="w-full h-full max-h-[150px]">
                        {renderApples(num2, "#3b82f6")}
                     </svg>
                     <div className="mt-2 text-2xl font-black text-blue-500">{num2}</div>
                  </div>
               </div>

               {/* PICTORIAL LAYER: Number Line */}
               {showNumberLine && (
                  <div className="h-24 bg-slate-50 rounded-2xl border border-slate-100 p-4 relative overflow-hidden">
                     <svg viewBox="0 0 600 80" className="w-full h-full">
                        {/* Line */}
                        <line x1="20" y1="50" x2="580" y2="50" stroke="#cbd5e1" strokeWidth="2" />
                        {/* Ticks */}
                        {Array.from({ length: 21 }).map((_, i) => (
                           <g key={i} transform={`translate(${20 + i * 28}, 50)`}>
                              <line y1="-5" y2="5" stroke="#cbd5e1" strokeWidth="2" />
                              <text y="20" textAnchor="middle" fontSize="10" fill="#94a3b8" fontWeight="bold">{i}</text>
                           </g>
                        ))}
                        {/* Jump 1 */}
                        <path
                           d={`M 20,50 Q ${20 + (num1 * 28) / 2},10 ${20 + num1 * 28},50`}
                           fill="none" stroke="#ef4444" strokeWidth="3" strokeDasharray="4 2"
                        />
                        {/* Jump 2 */}
                        <path
                           d={`M ${20 + num1 * 28},50 Q ${20 + num1 * 28 + (num2 * 28) / 2},10 ${20 + (num1 + num2) * 28},50`}
                           fill="none" stroke="#3b82f6" strokeWidth="3"
                        />
                        {/* Marker */}
                        <circle cx={20 + (num1 + num2) * 28} cy="50" r="6" fill="#10b981" className="shadow-lg" />
                     </svg>
                  </div>
               )}

               {/* ABSTRACT LAYER: Equation */}
               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-red-400">{num1}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">First Part</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">+</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-blue-400">{num2}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Second Part</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-5xl font-black text-emerald-400">{total}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Total</div>
                  </div>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8 overflow-y-auto">
               <div className="space-y-6">
                  {/* Num 1 Control */}
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">üçé Group A Size</label>
                        <span className="text-2xl font-black text-red-500">{num1}</span>
                     </div>
                     <input
                        type="range" min="0" max="10" step="1" value={num1}
                        onChange={(e) => setNum1(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-500"
                     />
                  </div>

                  {/* Num 2 Control */}
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">üîµ Group B Size</label>
                        <span className="text-2xl font-black text-blue-500">{num2}</span>
                     </div>
                     <input
                        type="range" min="0" max="10" step="1" value={num2}
                        onChange={(e) => setNum2(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="space-y-4">
                  <button
                     onClick={() => setShowNumberLine(!showNumberLine)}
                     className={`w-full py-3 rounded-xl font-bold text-sm transition-all flex items-center justify-center gap-2 ${showNumberLine ? 'bg-indigo-600 text-white shadow-lg' : 'bg-white text-slate-600 border border-slate-200'
                        }`}
                  >
                     {showNumberLine ? 'üìè HIDE NUMBER LINE' : 'üìè SHOW NUMBER LINE'}
                  </button>

                  <button
                     onClick={() => {
                        const n1 = Math.floor(Math.random() * 10);
                        const n2 = Math.floor(Math.random() * 10);
                        setNum1(n1);
                        setNum2(n2);
                     }}
                     className="w-full py-3 bg-white border border-slate-200 rounded-xl font-bold text-sm text-slate-600 hover:bg-slate-50 transition-all"
                  >
                     üé≤ RANDOM PROBLEM
                  </button>
               </div>

               {/* Educational Insight */}
               <div className="mt-auto p-4 bg-emerald-50 rounded-xl border border-emerald-100">
                  <div className="flex gap-3">
                     <div className="text-emerald-600 text-lg">üí°</div>
                     <p className="text-[10px] text-emerald-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Addition is just putting things together.
                        You can see it as <strong>counting objects</strong> (concrete) or as
                        <strong>jumping forward</strong> on a line (pictorial). The equation
                        is just a short way to write what happened!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- SUBTRACTION RENDERER (Take-Away vs Difference) ---
   // Stage 1: Core insight = Removal or Comparison.
   // Stage 2: Primary = minuend, subtrahend.
   // Stage 3: Mode toggle (Take Away / Difference).
   // Stage 4: a - b = c.
   // Stage 5: State (num1, num2, mode) ‚Üí Derived (result, matched).
   // Stage 6: Challenge = "Find the difference".
   const SubtractionRenderer = () => {
      const [num1, setNum1] = useState(8);
      const [num2, setNum2] = useState(3);
      const [mode, setMode] = useState<'takeaway' | 'difference'>('takeaway');
      const [challengeMode, setChallengeMode] = useState(false);

      const result = num1 - num2;
      const isChallengeMet = challengeMode && result === 5;

      const renderTakeAway = () => {
         const items = [];
         const cols = 5;
         for (let i = 0; i < num1; i++) {
            const row = Math.floor(i / cols);
            const col = i % cols;
            const isRemoved = i >= num1 - num2;
            items.push(
               <g key={i} transform={`translate(${col * 30 + 20}, ${row * 30 + 20})`} className="transition-all duration-500">
                  <circle r="12" fill={isRemoved ? "#cbd5e1" : "#f97316"} opacity={isRemoved ? 0.3 : 1} />
                  {isRemoved && (
                     <path d="M-8,-8 L8,8 M8,-8 L-8,8" stroke="#ef4444" strokeWidth="3" />
                  )}
                  <circle r="3" cx="4" cy="-4" fill="white" opacity="0.4" />
               </g>
            );
         }
         return items;
      };

      const renderDifference = () => {
         const groupA = [];
         const groupB = [];
         const connections = [];

         for (let i = 0; i < num1; i++) {
            groupA.push(
               <circle key={`a-${i}`} cx="20" cy={i * 30 + 20} r="12" fill="#f97316" />
            );
         }
         for (let i = 0; i < num2; i++) {
            groupB.push(
               <circle key={`b-${i}`} cx="180" cy={i * 30 + 20} r="12" fill="#6366f1" />
            );
            connections.push(
               <line key={`c-${i}`} x1="32" y1={i * 30 + 20} x2="168" y2={i * 30 + 20} stroke="#cbd5e1" strokeWidth="2" strokeDasharray="4 2" />
            );
         }

         return (
            <g>
               {connections}
               {groupA}
               {groupB}
               {/* Highlight the difference */}
               {Array.from({ length: num1 - num2 }).map((_, i) => (
                  <rect
                     key={`h-${i}`}
                     x="5" y={(num2 + i) * 30 + 5}
                     width="30" height="30"
                     fill="none" stroke="#ef4444" strokeWidth="2" rx="4"
                     className="animate-pulse"
                  />
               ))}
            </g>
         );
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Subtraction</h2>
                     <p className="text-slate-500 text-sm">Taking away or finding the difference</p>
                  </div>
                  <div className="flex gap-2">
                     <button
                        onClick={() => setMode('takeaway')}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${mode === 'takeaway' ? 'bg-orange-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                           }`}
                     >
                        TAKE AWAY
                     </button>
                     <button
                        onClick={() => setMode('difference')}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${mode === 'difference' ? 'bg-indigo-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                           }`}
                     >
                        DIFFERENCE
                     </button>
                  </div>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Make the difference exactly 5</p>
                           <p className="text-xs opacity-80">Adjust the numbers until the result is 5.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8">
                  <svg className="w-full h-full max-w-[400px] max-h-[400px]" viewBox="0 0 200 300">
                     {mode === 'takeaway' ? renderTakeAway() : renderDifference()}
                  </svg>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-orange-400">{num1}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Start</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">‚àí</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-indigo-400">{num2}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Remove</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-5xl font-black text-emerald-400">{result}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Left</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Start Amount</label>
                        <span className="text-2xl font-black text-orange-500">{num1}</span>
                     </div>
                     <input
                        type="range" min="1" max="10" step="1" value={num1}
                        onChange={(e) => {
                           const val = Number(e.target.value);
                           setNum1(val);
                           if (num2 > val) setNum2(val);
                        }}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500"
                     />
                  </div>

                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Take Away</label>
                        <span className="text-2xl font-black text-indigo-500">{num2}</span>
                     </div>
                     <input
                        type="range" min="0" max={num1} step="1" value={num2}
                        onChange={(e) => setNum2(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="space-y-4">
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`w-full py-3 rounded-xl font-bold text-sm transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-white text-slate-600 border border-slate-200'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>

                  <div className="p-4 bg-blue-50 rounded-xl border border-blue-100">
                     <p className="text-[10px] text-blue-800 leading-relaxed">
                        <strong>Inverse Relationship:</strong> Notice that if
                        <span className="font-bold"> {num1} - {num2} = {result}</span>, then
                        <span className="font-bold"> {num2} + {result} = {num1}</span>.
                        Subtraction is just addition in reverse!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- MULTIPLICATION RENDERER (Area Model & Distributive Property) ---
   // Stage 1: Core insight = Repeated groups / Area.
   // Stage 2: Primary = rows, cols.
   // Stage 3: Resizable Grid + Distributive Split.
   // Stage 4: a √ó b = c.
   // Stage 5: State (rows, cols, splitX) ‚Üí Derived (area, parts).
   // Stage 6: Challenge = "Make Area 24".
   const MultiplicationRenderer = () => {
      const [rows, setRows] = useState(4);
      const [cols, setCols] = useState(6);
      const [splitX, setSplitX] = useState(0); // 0 means no split
      const [challengeMode, setChallengeMode] = useState(false);

      const area = rows * cols;
      const isChallengeMet = challengeMode && area === 24;

      const renderGrid = () => {
         const cells = [];
         const cellSize = 30;
         for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
               const isSplit = splitX > 0 && c >= splitX;
               cells.push(
                  <rect
                     key={`${r}-${c}`}
                     x={c * cellSize + 10}
                     y={r * cellSize + 10}
                     width={cellSize - 2}
                     height={cellSize - 2}
                     fill={isSplit ? "#6366f1" : "#f97316"}
                     className="animate-in zoom-in duration-300"
                     rx="4"
                  />
               );
            }
         }
         return cells;
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Multiplication</h2>
                     <p className="text-slate-500 text-sm">Repeated groups as an area model</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Make the area exactly 24</p>
                           <p className="text-xs opacity-80">Find different dimensions (rows √ó cols) that equal 24.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 overflow-hidden">
                  <div className="relative">
                     <svg width={cols * 30 + 20} height={rows * 30 + 20}>
                        {renderGrid()}
                        {/* Labels */}
                        <text x={-5} y={rows * 15 + 10} textAnchor="middle" transform={`rotate(-90, -5, ${rows * 15 + 10})`} className="text-xs font-black fill-slate-400">{rows}</text>
                        <text x={cols * 15 + 10} y={-5} textAnchor="middle" className="text-xs font-black fill-slate-400">{cols}</text>
                     </svg>
                  </div>
               </div>

               {/* Distributive Property View */}
               {splitX > 0 && (
                  <div className="p-4 bg-slate-50 rounded-2xl border border-slate-200 flex items-center justify-center gap-4 text-sm font-bold">
                     <span className="text-orange-500">({rows} √ó {splitX})</span>
                     <span className="text-slate-400">+</span>
                     <span className="text-indigo-500">({rows} √ó {cols - splitX})</span>
                     <span className="text-slate-400">=</span>
                     <span className="text-emerald-500">{area}</span>
                  </div>
               )}

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-orange-400">{rows}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Rows</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">√ó</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-indigo-400">{cols}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Cols</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-5xl font-black text-emerald-400">{area}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Total Area</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">‚Üï Rows</label>
                        <span className="text-2xl font-black text-orange-500">{rows}</span>
                     </div>
                     <input
                        type="range" min="1" max="10" step="1" value={rows}
                        onChange={(e) => setRows(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500"
                     />
                  </div>

                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">‚Üî Columns</label>
                        <span className="text-2xl font-black text-indigo-500">{cols}</span>
                     </div>
                     <input
                        type="range" min="1" max="12" step="1" value={cols}
                        onChange={(e) => {
                           const val = Number(e.target.value);
                           setCols(val);
                           if (splitX >= val) setSplitX(0);
                        }}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                     />
                  </div>

                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">‚úÇ Split (Distributive)</label>
                        <span className="text-2xl font-black text-slate-400">{splitX || 'Off'}</span>
                     </div>
                     <input
                        type="range" min="0" max={cols - 1} step="1" value={splitX}
                        onChange={(e) => setSplitX(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-400"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-amber-50 rounded-xl border border-amber-100">
                  <div className="flex gap-3">
                     <div className="text-amber-600 text-lg">üí°</div>
                     <p className="text-[10px] text-amber-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Multiplication is just area!
                        The <strong>Distributive Property</strong> lets you break a big
                        problem into two smaller ones.
                        <span className="block mt-1 font-bold">4 √ó 6 is the same as (4 √ó 4) + (4 √ó 2).</span>
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- DIVISION RENDERER (Sharing vs Grouping) ---
   // Stage 1: Core insight = Fair sharing or finding sets.
   // Stage 2: Primary = dividend, divisor.
   // Stage 3: Mode toggle (Sharing / Grouping).
   // Stage 4: a √∑ b = c (r d).
   // Stage 5: State (total, divisor, mode) ‚Üí Derived (quotient, remainder).
   // Stage 6: Challenge = "Fair sharing with remainder".
   const DivisionRenderer = () => {
      const [total, setTotal] = useState(12);
      const [divisor, setDivisor] = useState(3);
      const [mode, setMode] = useState<'sharing' | 'grouping'>('sharing');
      const [challengeMode, setChallengeMode] = useState(false);

      const quotient = Math.floor(total / divisor);
      const remainder = total % divisor;
      const isChallengeMet = challengeMode && remainder === 2;

      const renderSharing = () => {
         const groups = [];
         for (let g = 0; g < divisor; g++) {
            const items = [];
            for (let i = 0; i < quotient; i++) {
               items.push(
                  <circle key={i} cx={i * 15 + 10} cy="10" r="6" fill="#10b981" className="animate-in zoom-in duration-300" />
               );
            }
            groups.push(
               <div key={g} className="flex flex-col items-center gap-2 p-3 bg-white rounded-xl border border-slate-200 shadow-sm">
                  <span className="text-[8px] font-bold text-slate-400 uppercase">Friend {g + 1}</span>
                  <svg width={quotient * 15 + 10} height="20">{items}</svg>
                  <span className="text-xs font-black text-emerald-500">{quotient}</span>
               </div>
            );
         }
         return (
            <div className="flex flex-wrap justify-center gap-4">
               {groups}
               {remainder > 0 && (
                  <div className="flex flex-col items-center gap-2 p-3 bg-amber-50 rounded-xl border border-amber-200 shadow-sm">
                     <span className="text-[8px] font-bold text-amber-500 uppercase">Remainder</span>
                     <svg width={remainder * 15 + 10} height="20">
                        {Array.from({ length: remainder }).map((_, i) => (
                           <circle key={i} cx={i * 15 + 10} cy="10" r="6" fill="#f59e0b" />
                        ))}
                     </svg>
                     <span className="text-xs font-black text-amber-600">{remainder}</span>
                  </div>
               )}
            </div>
         );
      };

      const renderGrouping = () => {
         const groups = [];
         for (let g = 0; g < quotient; g++) {
            groups.push(
               <div key={g} className="p-2 bg-indigo-50 rounded-lg border border-indigo-100 flex gap-1">
                  {Array.from({ length: divisor }).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded-full bg-indigo-500" />
                  ))}
               </div>
            );
         }
         return (
            <div className="flex flex-wrap justify-center gap-3">
               {groups}
               {remainder > 0 && (
                  <div className="p-2 bg-amber-50 rounded-lg border border-amber-100 flex gap-1">
                     {Array.from({ length: remainder }).map((_, i) => (
                        <div key={i} className="w-3 h-3 rounded-full bg-amber-500" />
                     ))}
                  </div>
               )}
            </div>
         );
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Division</h2>
                     <p className="text-slate-500 text-sm">Sharing equally or making groups</p>
                  </div>
                  <div className="flex gap-2">
                     <button
                        onClick={() => setMode('sharing')}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${mode === 'sharing' ? 'bg-emerald-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                           }`}
                     >
                        SHARING
                     </button>
                     <button
                        onClick={() => setMode('grouping')}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${mode === 'grouping' ? 'bg-indigo-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                           }`}
                     >
                        GROUPING
                     </button>
                  </div>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Find a combination with remainder 2</p>
                           <p className="text-xs opacity-80">Adjust the total and divisor until 2 items are left over.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 overflow-y-auto">
                  {mode === 'sharing' ? renderSharing() : renderGrouping()}
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-emerald-400">{total}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Total</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">√∑</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-indigo-400">{divisor}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">{mode === 'sharing' ? 'Friends' : 'Group Size'}</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-5xl font-black text-emerald-400">{quotient}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">{mode === 'sharing' ? 'Each' : 'Groups'}</div>
                  </div>
                  {remainder > 0 && (
                     <>
                        <div className="text-xl font-bold text-slate-600">rem</div>
                        <div className="flex flex-col items-center">
                           <div className="text-4xl font-black text-amber-400">{remainder}</div>
                           <div className="text-[8px] font-bold text-slate-500 uppercase">Left</div>
                        </div>
                     </>
                  )}
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Total Items</label>
                        <span className="text-2xl font-black text-emerald-500">{total}</span>
                     </div>
                     <input
                        type="range" min="1" max="30" step="1" value={total}
                        onChange={(e) => setTotal(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                     />
                  </div>

                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{mode === 'sharing' ? 'Number of Friends' : 'Items per Group'}</label>
                        <span className="text-2xl font-black text-indigo-500">{divisor}</span>
                     </div>
                     <input
                        type="range" min="1" max="10" step="1" value={divisor}
                        onChange={(e) => setDivisor(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-500"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="space-y-4">
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`w-full py-3 rounded-xl font-bold text-sm transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-white text-slate-600 border border-slate-200'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>

                  <div className="p-4 bg-emerald-50 rounded-xl border border-emerald-100">
                     <p className="text-[10px] text-emerald-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Division is "undoing" multiplication.
                        If <span className="font-bold">{divisor} √ó {quotient} = {divisor * quotient}</span>,
                        then <span className="font-bold">{total} √∑ {divisor} = {quotient}</span>
                        (with {remainder} left over).
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- FRACTION RENDERER (Part-Whole, Equivalence, Comparison) ---
   // Stage 1: Core insight = Equal parts of a whole.
   // Stage 2: Primary = numerator, denominator.
   // Stage 3: Bar vs Circle models + Equivalence ghosting.
   // Stage 4: n/d.
   // Stage 5: State (n, d, model) ‚Üí Derived (percentage, angle).
   // Stage 6: Challenge = "Find equivalent to 1/2".
   const FractionRenderer = () => {
      const [num, setNum] = useState(1);
      const [den, setDen] = useState(4);
      const [model, setModel] = useState<'bar' | 'circle'>('bar');
      const [showEquivalent, setShowEquivalent] = useState(false);
      const [challengeMode, setChallengeMode] = useState(false);

      const percentage = (num / den) * 100;
      const isChallengeMet = challengeMode && num / den === 0.5 && den !== 2;

      const renderBar = (n: number, d: number, color: string, isGhost: boolean = false) => {
         const parts = [];
         const width = 300;
         const height = 40;
         const partWidth = width / d;

         for (let i = 0; i < d; i++) {
            parts.push(
               <rect
                  key={i}
                  x={i * partWidth}
                  y={0}
                  width={partWidth}
                  height={height}
                  fill={i < n ? color : "transparent"}
                  stroke={isGhost ? "#cbd5e1" : "#94a3b8"}
                  strokeWidth={isGhost ? "1" : "2"}
                  opacity={isGhost ? 0.3 : 1}
                  className="transition-all duration-500"
               />
            );
         }
         return <g transform="translate(10, 10)">{parts}</g>;
      };

      const renderCircle = (n: number, d: number, color: string) => {
         const parts = [];
         const radius = 80;
         const cx = 100;
         const cy = 100;

         for (let i = 0; i < d; i++) {
            const startAngle = (i * 360) / d;
            const endAngle = ((i + 1) * 360) / d;
            const x1 = cx + radius * Math.cos((startAngle - 90) * Math.PI / 180);
            const y1 = cy + radius * Math.sin((startAngle - 90) * Math.PI / 180);
            const x2 = cx + radius * Math.cos((endAngle - 90) * Math.PI / 180);
            const y2 = cy + radius * Math.sin((endAngle - 90) * Math.PI / 180);

            const largeArcFlag = 360 / d > 180 ? 1 : 0;
            const dPath = `M ${cx} ${cy} L ${x1} ${y1} A ${radius} ${radius} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;

            parts.push(
               <path
                  key={i}
                  d={dPath}
                  fill={i < n ? color : "white"}
                  stroke="#94a3b8"
                  strokeWidth="2"
                  className="transition-all duration-500"
               />
            );
         }
         return <g transform="translate(50, 20)">{parts}</g>;
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Fractions</h2>
                     <p className="text-slate-500 text-sm">Parts of a whole</p>
                  </div>
                  <div className="flex gap-2">
                     <button
                        onClick={() => setModel('bar')}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${model === 'bar' ? 'bg-blue-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                           }`}
                     >
                        BAR MODEL
                     </button>
                     <button
                        onClick={() => setModel('circle')}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all ${model === 'circle' ? 'bg-purple-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                           }`}
                     >
                        CIRCLE MODEL
                     </button>
                  </div>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Find an equivalent to 1/2 (but not 1/2!)</p>
                           <p className="text-xs opacity-80">Adjust the sliders to find another fraction that covers half the shape.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8">
                  <svg className="w-full max-w-[400px] h-[250px]" viewBox="0 0 320 250">
                     {model === 'bar' ? (
                        <>
                           {renderBar(num, den, model === 'bar' ? "#3b82f6" : "#a855f7")}
                           {showEquivalent && (
                              <g transform="translate(0, 60)">
                                 {renderBar(num * 2, den * 2, "#cbd5e1", true)}
                                 <text x="160" y="60" textAnchor="middle" className="text-[10px] fill-slate-400 font-bold italic">Equivalent: {num * 2}/{den * 2}</text>
                              </g>
                           )}
                        </>
                     ) : (
                        renderCircle(num, den, "#a855f7")
                     )}
                  </svg>

                  <div className="mt-8 flex items-center gap-8">
                     <div className="flex flex-col items-center">
                        <div className="text-5xl font-black text-slate-900 border-b-4 border-slate-900 pb-1 mb-1">{num}</div>
                        <div className="text-5xl font-black text-slate-900">{den}</div>
                     </div>
                     <div className="h-20 w-px bg-slate-200" />
                     <div className="text-center">
                        <div className="text-3xl font-black text-slate-400">{percentage.toFixed(0)}%</div>
                        <div className="text-[10px] font-bold text-slate-400 uppercase">of the whole</div>
                     </div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Numerator (Parts)</label>
                        <span className="text-2xl font-black text-blue-500">{num}</span>
                     </div>
                     <input
                        type="range" min="0" max={den} step="1" value={num}
                        onChange={(e) => setNum(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>

                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Denominator (Total)</label>
                        <span className="text-2xl font-black text-slate-900">{den}</span>
                     </div>
                     <input
                        type="range" min="1" max="12" step="1" value={den}
                        onChange={(e) => {
                           const val = Number(e.target.value);
                           setDen(val);
                           if (num > val) setNum(val);
                        }}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-slate-900"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="space-y-4">
                  <button
                     onClick={() => setShowEquivalent(!showEquivalent)}
                     className={`w-full py-3 rounded-xl font-bold text-sm transition-all ${showEquivalent ? 'bg-slate-800 text-white shadow-lg' : 'bg-white text-slate-600 border border-slate-200'
                        }`}
                  >
                     {showEquivalent ? 'üîç HIDE EQUIVALENT' : 'üîç SHOW EQUIVALENT'}
                  </button>

                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`w-full py-3 rounded-xl font-bold text-sm transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-white text-slate-600 border border-slate-200'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>

                  <div className="p-4 bg-blue-50 rounded-xl border border-blue-100">
                     <p className="text-[10px] text-blue-800 leading-relaxed">
                        <strong>The Big Idea:</strong> The <strong>denominator</strong> tells you how many equal parts make a whole.
                        The <strong>numerator</strong> tells you how many of those parts you have.
                        Different fractions can represent the <strong>same amount</strong> (like 1/2 and 2/4)!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- AREA RENDERER (Grid Discovery & Formula Bridge) ---
   // Stage 1: Core insight = Area is the space inside a boundary.
   // Stage 2: Primary = width, height.
   // Stage 3: Resizable Grid + Counting Mode.
   // Stage 4: A = L √ó W.
   // Stage 5: State (w, h, showGrid) ‚Üí Derived (area).
   // Stage 6: Challenge = "Build Area 12".
   const AreaRenderer = () => {
      const [width, setWidth] = useState(4);
      const [height, setHeight] = useState(3);
      const [showGrid, setShowGrid] = useState(true);
      const [challengeMode, setChallengeMode] = useState(false);

      const area = width * height;
      const isChallengeMet = challengeMode && area === 12;

      const renderGrid = () => {
         const cells = [];
         const cellSize = 40;
         for (let r = 0; r < height; r++) {
            for (let c = 0; c < width; c++) {
               cells.push(
                  <rect
                     key={`${r}-${c}`}
                     x={c * cellSize}
                     y={r * cellSize}
                     width={cellSize - 1}
                     height={cellSize - 1}
                     fill={showGrid ? "#f8fafc" : "#3b82f6"}
                     stroke={showGrid ? "#cbd5e1" : "none"}
                     className="transition-all duration-300"
                  />
               );
               if (showGrid) {
                  cells.push(
                     <text
                        key={`t-${r}-${c}`}
                        x={c * cellSize + cellSize / 2}
                        y={r * cellSize + cellSize / 2 + 4}
                        textAnchor="middle"
                        className="text-[8px] fill-slate-300 font-bold"
                     >
                        {r * width + c + 1}
                     </text>
                  );
               }
            }
         }
         return cells;
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Area of Rectangles</h2>
                     <p className="text-slate-500 text-sm">Measuring space with unit squares</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Build a rectangle with Area 12</p>
                           <p className="text-xs opacity-80">Adjust width and height until the total area is exactly 12.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 overflow-hidden">
                  <div className="relative">
                     <svg width={width * 40} height={height * 40} className="shadow-xl rounded-sm overflow-visible">
                        {renderGrid()}
                        {/* Dimension Labels */}
                        <g transform={`translate(${width * 20}, -15)`}>
                           <text textAnchor="middle" className="text-sm font-black fill-blue-600">{width} units</text>
                           <path d={`M ${-width * 20},5 L ${width * 20},5`} stroke="#3b82f6" strokeWidth="2" markerStart="url(#arrow)" markerEnd="url(#arrow)" />
                        </g>
                        <g transform={`translate(${-15}, ${height * 20}) rotate(-90)`}>
                           <text textAnchor="middle" className="text-sm font-black fill-blue-600">{height} units</text>
                           <path d={`M ${-height * 20},5 L ${height * 20},5`} stroke="#3b82f6" strokeWidth="2" />
                        </g>
                     </svg>
                  </div>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-blue-400">{width}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Width</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">√ó</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-blue-400">{height}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Height</div>
                  </div>
                  <div className="text-3xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-5xl font-black text-emerald-400">{area}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Total Area</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">‚Üî Width</label>
                        <span className="text-2xl font-black text-blue-500">{width}</span>
                     </div>
                     <input
                        type="range" min="1" max="10" step="1" value={width}
                        onChange={(e) => setWidth(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>

                  <div className="space-y-3">
                     <div className="flex justify-between items-end">
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">‚Üï Height</label>
                        <span className="text-2xl font-black text-blue-500">{height}</span>
                     </div>
                     <input
                        type="range" min="1" max="8" step="1" value={height}
                        onChange={(e) => setHeight(Number(e.target.value))}
                        className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="space-y-4">
                  <button
                     onClick={() => setShowGrid(!showGrid)}
                     className={`w-full py-3 rounded-xl font-bold text-sm transition-all ${showGrid ? 'bg-slate-800 text-white shadow-lg' : 'bg-white text-slate-600 border border-slate-200'
                        }`}
                  >
                     {showGrid ? 'üî¢ HIDE UNIT SQUARES' : 'üî¢ SHOW UNIT SQUARES'}
                  </button>

                  <div className="p-4 bg-blue-50 rounded-xl border border-blue-100">
                     <p className="text-[10px] text-blue-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Area is the number of <strong>unit squares</strong>
                        that fit inside a shape. Instead of counting them all one by one,
                        you can just multiply the <strong>width</strong> by the <strong>height</strong>!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- POSTURE ANALYZER RENDERER ---
   const PostureAnalyzerRenderer = () => {
      const [view, setView] = useState<'side' | 'front'>('side');
      const [headForward, setHeadForward] = useState(20); // 0-100
      const [shoulderRound, setShoulderRound] = useState(30); // 0-100
      const [showCorrections, setShowCorrections] = useState(false);

      const score = Math.max(0, 100 - (headForward * 0.5) - (shoulderRound * 0.5));

      return (
         <div className="w-full h-full bg-white flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Posture Analyzer</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Alignment & Ergonomics</p>
               </div>
               <div className="flex gap-2">
                  <button
                     onClick={() => setView('side')}
                     className={`px-4 py-2 rounded-xl text-[10px] font-bold transition-all ${view === 'side' ? 'bg-slate-900 text-white' : 'bg-white border border-slate-200 text-slate-500'}`}
                  >
                     SIDE VIEW
                  </button>
                  <button
                     onClick={() => setView('front')}
                     className={`px-4 py-2 rounded-xl text-[10px] font-bold transition-all ${view === 'front' ? 'bg-slate-900 text-white' : 'bg-white border border-slate-200 text-slate-500'}`}
                  >
                     FRONT VIEW
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visual Assessment Area */}
               <div className="flex-1 relative bg-white flex items-center justify-center p-12">
                  <div className="absolute inset-0 opacity-[0.03] pointer-events-none" style={{ backgroundImage: 'linear-gradient(#000 1px, transparent 1px), linear-gradient(90deg, #000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="relative w-64 h-[400px] flex items-center justify-center">
                     {/* Human Skeleton Simplified */}
                     <svg className="w-full h-full overflow-visible" viewBox="0 0 100 200">
                        {view === 'side' ? (
                           <g className="transition-all duration-500">
                              {/* Spine */}
                              <path
                                 d={`M 50 180 Q 45 140 50 100 Q ${50 + shoulderRound / 10} 60 ${50 - headForward / 5} 30`}
                                 fill="none" stroke="#cbd5e1" strokeWidth="4" strokeLinecap="round"
                              />
                              {/* Head */}
                              <circle cx={50 - headForward / 5} cy="20" r="10" fill="#1e293b" />
                              {/* Shoulder */}
                              <circle cx={50 + shoulderRound / 10} cy="60" r="4" fill="#3b82f6" />
                              {/* Hip */}
                              <circle cx="50" cy="100" r="5" fill="#1e293b" />
                              {/* Leg */}
                              <line x1="50" y1="100" x2="50" y2="180" stroke="#1e293b" strokeWidth="4" />

                              {/* Correction Guides */}
                              {showCorrections && (
                                 <g className="animate-pulse">
                                    <line x1="50" y1="10" x2="50" y2="190" stroke="#10b981" strokeWidth="1" strokeDasharray="4 2" />
                                    <path d="M 40 30 L 50 30" stroke="#10b981" strokeWidth="2" markerEnd="url(#arrow)" />
                                    <path d="M 60 60 L 50 60" stroke="#10b981" strokeWidth="2" markerEnd="url(#arrow)" />
                                 </g>
                              )}
                           </g>
                        ) : (
                           <g className="transition-all duration-500">
                              {/* Torso */}
                              <rect x="35" y="60" width="30" height="40" rx="5" fill="#f1f5f9" stroke="#cbd5e1" strokeWidth="2" />
                              {/* Head */}
                              <circle cx="50" cy="30" r="12" fill="#1e293b" />
                              {/* Shoulders */}
                              <line x1="30" y1="60" x2="70" y2="60" stroke="#1e293b" strokeWidth="6" strokeLinecap="round" />
                              {/* Hips */}
                              <line x1="35" y1="100" x2="65" y2="100" stroke="#1e293b" strokeWidth="6" strokeLinecap="round" />
                              {/* Legs */}
                              <line x1="40" y1="100" x2="40" y2="180" stroke="#1e293b" strokeWidth="4" />
                              <line x1="60" y1="100" x2="60" y2="180" stroke="#1e293b" strokeWidth="4" />
                           </g>
                        )}
                        <defs>
                           <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto-start-reverse">
                              <path d="M 0 0 L 10 5 L 0 10 z" fill="#10b981" />
                           </marker>
                        </defs>
                     </svg>
                  </div>
               </div>

               {/* Controls & Analysis */}
               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8 overflow-y-auto">
                  <div className="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 text-center">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Posture Score</p>
                     <div className="text-5xl font-black text-slate-900">{Math.round(score)}<span className="text-lg text-slate-300">/100</span></div>
                     <p className={`text-[10px] font-bold mt-2 uppercase tracking-tight ${score > 80 ? 'text-emerald-500' : score > 60 ? 'text-amber-500' : 'text-red-500'}`}>
                        {score > 80 ? 'Excellent Alignment' : score > 60 ? 'Room for Improvement' : 'Correction Required'}
                     </p>
                  </div>

                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Simulation Controls</p>
                     <div className="space-y-4">
                        <div className="space-y-2">
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-slate-500">HEAD FORWARD</span>
                              <span className="text-slate-900">{headForward}%</span>
                           </div>
                           <input
                              type="range" min="0" max="100" value={headForward}
                              onChange={(e) => setHeadForward(parseInt(e.target.value))}
                              className="w-full accent-slate-900"
                           />
                        </div>
                        <div className="space-y-2">
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-slate-500">SHOULDER ROUNDING</span>
                              <span className="text-slate-900">{shoulderRound}%</span>
                           </div>
                           <input
                              type="range" min="0" max="100" value={shoulderRound}
                              onChange={(e) => setShoulderRound(parseInt(e.target.value))}
                              className="w-full accent-slate-900"
                           />
                        </div>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Alignment Check</p>
                     <ul className="space-y-2">
                        {[
                           { label: 'Ears over shoulders', status: headForward < 20 ? '‚úì' : '‚ö†Ô∏è', color: headForward < 20 ? 'text-emerald-500' : 'text-amber-500' },
                           { label: 'Shoulders back', status: shoulderRound < 30 ? '‚úì' : '‚ö†Ô∏è', color: shoulderRound < 30 ? 'text-emerald-500' : 'text-amber-500' },
                           { label: 'Hips level', status: '‚úì', color: 'text-emerald-500' },
                           { label: 'Neutral spine', status: (headForward + shoulderRound) < 50 ? '‚úì' : '‚ö†Ô∏è', color: (headForward + shoulderRound) < 50 ? 'text-emerald-500' : 'text-amber-500' }
                        ].map(item => (
                           <li key={item.label} className="flex justify-between items-center p-3 bg-white rounded-xl border border-slate-100 text-[10px] font-bold">
                              <span className="text-slate-600">{item.label}</span>
                              <span className={item.color}>{item.status}</span>
                           </li>
                        ))}
                     </ul>
                  </div>

                  <button
                     onClick={() => setShowCorrections(!showCorrections)}
                     className={`mt-auto p-4 rounded-2xl font-black text-xs transition-all uppercase ${showCorrections ? 'bg-emerald-500 text-white' : 'bg-slate-900 text-white hover:bg-slate-800'
                        }`}
                  >
                     {showCorrections ? 'Hide Corrections' : 'Show Corrections'}
                  </button>
               </div>
            </div>
         </div>
      );
   };
   // --- HEART RATE ZONE RENDERER ---
   const HeartRateZoneRenderer = () => {
      const [age, setAge] = useState(25);
      const [restingHR, setRestingHR] = useState(60);
      const [intensity, setIntensity] = useState(50);

      const maxHR = 220 - age;
      const hrr = maxHR - restingHR;
      const targetHR = Math.round(restingHR + (hrr * intensity) / 100);

      const getZone = (hr: number) => {
         const pct = ((hr - restingHR) / hrr) * 100;
         if (intensity < 50) return { name: 'Warm Up', color: 'bg-slate-400', text: 'text-slate-400', desc: 'Light activity, preparing the body.' };
         if (intensity < 60) return { name: 'Zone 1: Recovery', color: 'bg-emerald-400', text: 'text-emerald-400', desc: 'Very light. Improves overall health and helps recovery.' };
         if (intensity < 70) return { name: 'Zone 2: Aerobic', color: 'bg-emerald-500', text: 'text-emerald-500', desc: 'Light. Build endurance and burns fat efficiently.' };
         if (intensity < 80) return { name: 'Zone 3: Tempo', color: 'bg-amber-500', text: 'text-amber-500', desc: 'Moderate. Improves aerobic capacity and circulation.' };
         if (intensity < 90) return { name: 'Zone 4: Threshold', color: 'bg-orange-500', text: 'text-orange-500', desc: 'Hard. Increases maximum performance capacity.' };
         return { name: 'Zone 5: Anaerobic', color: 'bg-red-500', text: 'text-red-500', desc: 'Maximum. Improves speed and neuromuscular system.' };
      };

      const zone = getZone(targetHR);

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Heart Rate Zone Trainer</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Target Heart Rate & Intensity</p>
               </div>
               <div className="flex gap-4">
                  <div className="text-center">
                     <p className="text-[8px] font-bold text-slate-400 uppercase">Max HR</p>
                     <p className="text-lg font-black text-slate-900">{maxHR}</p>
                  </div>
                  <div className="text-center">
                     <p className="text-[8px] font-bold text-slate-400 uppercase">Target</p>
                     <p className={`text-lg font-black ${zone.text}`}>{targetHR} <span className="text-[10px]">BPM</span></p>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '30px 30px' }} />

                  <div className="relative flex flex-col items-center gap-12">
                     {/* Pulsing Heart */}
                     <div className="relative">
                        <div
                           className={`text-8xl transition-all duration-300 transform`}
                           style={{
                              animation: `pulse ${60 / targetHR}s infinite cubic-bezier(0.4, 0, 0.6, 1)`,
                              filter: `drop-shadow(0 0 20px ${zone.color.replace('bg-', '')})`
                           }}
                        >
                           ‚ù§Ô∏è
                        </div>
                        <style>{`
                           @keyframes pulse {
                              0%, 100% { transform: scale(1); }
                              50% { transform: scale(1.15); }
                           }
                        `}</style>
                     </div>

                     {/* Zone Gauge */}
                     <div className="w-64 h-8 bg-slate-100 rounded-full overflow-hidden flex border border-slate-200">
                        <div className="h-full bg-emerald-400" style={{ width: '10%' }} />
                        <div className="h-full bg-emerald-500" style={{ width: '10%' }} />
                        <div className="h-full bg-amber-500" style={{ width: '10%' }} />
                        <div className="h-full bg-orange-500" style={{ width: '10%' }} />
                        <div className="h-full bg-red-500" style={{ width: '10%' }} />
                        <div className="flex-1 bg-slate-200" />
                     </div>

                     <div className="text-center max-w-xs">
                        <h3 className={`text-2xl font-black uppercase tracking-tight ${zone.text}`}>{zone.name}</h3>
                        <p className="text-xs font-bold text-slate-500 mt-2 leading-relaxed">{zone.desc}</p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8 overflow-y-auto">
                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">User Profile</p>
                     <div className="grid grid-cols-2 gap-4">
                        <div className="space-y-2">
                           <label className="text-[10px] font-bold text-slate-400">AGE</label>
                           <input
                              type="number" value={age}
                              onChange={(e) => setAge(Math.max(1, Math.min(100, parseInt(e.target.value) || 1)))}
                              className="w-full p-3 bg-white border border-slate-200 rounded-xl font-black text-sm focus:ring-2 focus:ring-slate-900 outline-none"
                           />
                        </div>
                        <div className="space-y-2">
                           <label className="text-[10px] font-bold text-slate-400">RESTING HR</label>
                           <input
                              type="number" value={restingHR}
                              onChange={(e) => setRestingHR(Math.max(30, Math.min(120, parseInt(e.target.value) || 30)))}
                              className="w-full p-3 bg-white border border-slate-200 rounded-xl font-black text-sm focus:ring-2 focus:ring-slate-900 outline-none"
                           />
                        </div>
                     </div>
                  </div>

                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Exercise Intensity</p>
                     <div className="space-y-4">
                        <div className="flex justify-between items-end">
                           <span className="text-3xl font-black text-slate-900">{intensity}%</span>
                           <span className="text-[10px] font-bold text-slate-400 uppercase mb-1">of HR Reserve</span>
                        </div>
                        <input
                           type="range" min="0" max="100" value={intensity}
                           onChange={(e) => setIntensity(parseInt(e.target.value))}
                           className="w-full accent-slate-900"
                        />
                        <div className="flex justify-between text-[8px] font-black text-slate-400 uppercase tracking-tighter">
                           <span>Rest</span>
                           <span>Light</span>
                           <span>Moderate</span>
                           <span>Hard</span>
                           <span>Max</span>
                        </div>
                     </div>
                  </div>

                  <div className="mt-auto p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Karvonen Formula</p>
                     <p className="text-[10px] leading-relaxed text-slate-300">
                        Target HR = ((Max HR ‚àí Resting HR) √ó %Intensity) + Resting HR
                     </p>
                     <div className="mt-4 pt-4 border-t border-slate-800">
                        <p className="text-[10px] italic text-slate-500">This formula is more accurate than age-only calculations as it accounts for your fitness level (Resting HR).</p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- BREATHING GUIDE RENDERER ---
   const BreathingGuideRenderer = () => {
      const [pattern, setPattern] = useState<'box' | '478' | 'relax'>('box');
      const [isActive, setIsActive] = useState(false);
      const [phase, setPhase] = useState<'In' | 'Hold' | 'Out' | 'Hold_Out'>('In');
      const [timeLeft, setTimeLeft] = useState(4);

      const patterns = {
         box: { in: 4, hold: 4, out: 4, hold_out: 4, label: 'Box Breathing' },
         '478': { in: 4, hold: 7, out: 8, hold_out: 0, label: '4-7-8 Technique' },
         relax: { in: 4, hold: 0, out: 6, hold_out: 0, label: 'Relaxation (4-6)' }
      };

      useEffect(() => {
         let timer: any;
         if (isActive) {
            timer = setInterval(() => {
               setTimeLeft(prev => {
                  if (prev <= 1) {
                     // Switch phase
                     const current = patterns[pattern];
                     if (phase === 'In') {
                        if (current.hold > 0) { setPhase('Hold'); return current.hold; }
                        else { setPhase('Out'); return current.out; }
                     } else if (phase === 'Hold') {
                        setPhase('Out'); return current.out;
                     } else if (phase === 'Out') {
                        if (current.hold_out > 0) { setPhase('Hold_Out'); return current.hold_out; }
                        else { setPhase('In'); return current.in; }
                     } else {
                        setPhase('In'); return current.in;
                     }
                  }
                  return prev - 1;
               });
            }, 1000);
         } else {
            setPhase('In');
            setTimeLeft(patterns[pattern].in);
         }
         return () => clearInterval(timer);
      }, [isActive, phase, pattern]);

      const getScale = () => {
         if (!isActive) return 1;
         if (phase === 'In') return 1 + (1 - timeLeft / patterns[pattern].in) * 0.5;
         if (phase === 'Hold') return 1.5;
         if (phase === 'Out') return 1 + (timeLeft / patterns[pattern].out) * 0.5;
         return 1;
      };

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight">Breathing Guide</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Autonomic Regulation</p>
               </div>
               <div className="flex gap-2">
                  {Object.entries(patterns).map(([key, p]) => (
                     <button
                        key={key} onClick={() => { setPattern(key as any); setIsActive(false); }}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${pattern === key ? 'bg-white text-slate-950' : 'bg-slate-800 text-slate-500 hover:bg-slate-700'}`}
                     >
                        {p.label}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative flex items-center justify-center p-12 overflow-hidden bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black">
                  <div className="absolute inset-0 opacity-20 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '50px 50px' }} />

                  <div className="relative flex flex-col items-center">
                     {/* Breathing Circle */}
                     <div
                        className="w-64 h-64 rounded-full border-4 border-emerald-500/30 flex items-center justify-center transition-all duration-1000 ease-linear"
                        style={{ transform: `scale(${getScale()})`, backgroundColor: phase.includes('Hold') ? 'rgba(16, 185, 129, 0.1)' : 'transparent' }}
                     >
                        <div className="w-48 h-48 rounded-full bg-emerald-500/20 blur-2xl animate-pulse" />
                        <div className="absolute inset-0 flex flex-col items-center justify-center">
                           <span className="text-4xl font-black tracking-tighter text-emerald-400">{phase.replace('_', ' ')}</span>
                           <span className="text-xl font-mono text-emerald-500/50">{timeLeft}s</span>
                        </div>
                     </div>

                     <button
                        onClick={() => setIsActive(!isActive)}
                        className={`mt-16 px-12 py-4 rounded-2xl font-black text-sm transition-all uppercase tracking-widest ${isActive ? 'bg-red-500/20 text-red-400 border border-red-500/50' : 'bg-emerald-500 text-slate-950 shadow-[0_0_30px_rgba(16,185,129,0.3)]'}`}
                     >
                        {isActive ? 'Stop Session' : 'Start Breathing'}
                     </button>
                  </div>
               </div>

               {/* Info Panel */}
               <div className="w-full lg:w-96 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Current Technique</p>
                     <h3 className="text-2xl font-black text-white">{patterns[pattern].label}</h3>
                     <div className="p-4 bg-slate-950 rounded-2xl border border-slate-800 space-y-3">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500">INHALE</span>
                           <span className="text-emerald-400">{patterns[pattern].in}s</span>
                        </div>
                        {patterns[pattern].hold > 0 && (
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-slate-500">HOLD</span>
                              <span className="text-emerald-400">{patterns[pattern].hold}s</span>
                           </div>
                        )}
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500">EXHALE</span>
                           <span className="text-emerald-400">{patterns[pattern].out}s</span>
                        </div>
                        {patterns[pattern].hold_out > 0 && (
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-slate-500">HOLD</span>
                              <span className="text-emerald-400">{patterns[pattern].hold_out}s</span>
                           </div>
                        )}
                     </div>
                  </div>

                  <div className="mt-auto space-y-4">
                     <div className="p-6 bg-slate-800 rounded-3xl border border-slate-700">
                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Science</p>
                        <p className="text-[10px] leading-relaxed text-slate-300">
                           By extending your <strong>exhale</strong> longer than your inhale, you stimulate the <strong>Vagus Nerve</strong>, which signals your brain to switch from "Fight or Flight" to "Rest and Digest" mode.
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- PLATE METHOD RENDERER ---
   const PlateMethodRenderer = () => {
      const [portions, setPortions] = useState({ veggies: 50, protein: 25, carbs: 25 });
      const [mealType, setMealType] = useState<'balanced' | 'low_carb' | 'high_protein'>('balanced');

      const setPreset = (type: 'balanced' | 'low_carb' | 'high_protein') => {
         setMealType(type);
         if (type === 'balanced') setPortions({ veggies: 50, protein: 25, carbs: 25 });
         if (type === 'low_carb') setPortions({ veggies: 60, protein: 30, carbs: 10 });
         if (type === 'high_protein') setPortions({ veggies: 40, protein: 40, carbs: 20 });
      };

      const getScore = () => {
         const { veggies, protein, carbs } = portions;
         let score = 100;
         if (veggies < 40) score -= (40 - veggies) * 2;
         if (protein < 20) score -= (20 - protein) * 2;
         if (carbs > 40) score -= (carbs - 40) * 1.5;
         return Math.max(0, Math.round(score));
      };

      const score = getScore();

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">The Plate Method</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Visual Portion Control</p>
               </div>
               <div className="flex gap-2">
                  {(['balanced', 'low_carb', 'high_protein'] as const).map(t => (
                     <button
                        key={t} onClick={() => setPreset(t)}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${mealType === t ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                     >
                        {t.replace('_', ' ')}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visual Plate */}
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '30px 30px' }} />

                  <div className="relative w-80 h-80 bg-white rounded-full shadow-2xl border-[12px] border-slate-100 flex items-center justify-center overflow-hidden">
                     <svg viewBox="0 0 100 100" className="absolute inset-0 w-full h-full -rotate-90">
                        <circle
                           cx="50" cy="50" r="40" fill="transparent" stroke="#10b981" strokeWidth="80"
                           strokeDasharray={`${portions.veggies} 100`}
                        />
                        <circle
                           cx="50" cy="50" r="40" fill="transparent" stroke="#f59e0b" strokeWidth="80"
                           strokeDasharray={`${portions.protein} 100`}
                           strokeDashoffset={`-${portions.veggies}`}
                        />
                        <circle
                           cx="50" cy="50" r="40" fill="transparent" stroke="#3b82f6" strokeWidth="80"
                           strokeDasharray={`${portions.carbs} 100`}
                           strokeDashoffset={`-${portions.veggies + portions.protein}`}
                        />
                     </svg>

                     <div className="absolute inset-0 pointer-events-none">
                        <div className="absolute top-1/4 left-1/4 -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                           <span className="text-3xl">ü•¶</span>
                           <span className="text-[10px] font-black text-emerald-900 bg-white/80 px-2 py-0.5 rounded-full mt-1">VEGGIES</span>
                        </div>
                        <div className="absolute top-1/4 right-1/4 translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                           <span className="text-3xl">üçó</span>
                           <span className="text-[10px] font-black text-amber-900 bg-white/80 px-2 py-0.5 rounded-full mt-1">PROTEIN</span>
                        </div>
                        <div className="absolute bottom-1/4 right-1/2 translate-x-1/2 translate-y-1/2 flex flex-col items-center">
                           <span className="text-3xl">üçö</span>
                           <span className="text-[10px] font-black text-blue-900 bg-white/80 px-2 py-0.5 rounded-full mt-1">CARBS</span>
                        </div>
                     </div>

                     <div className="absolute w-20 h-20 bg-white rounded-full shadow-lg flex flex-col items-center justify-center border-4 border-slate-50">
                        <span className="text-[8px] font-black text-slate-400 uppercase">Score</span>
                        <span className="text-2xl font-black text-slate-900">{score}</span>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8 overflow-y-auto">
                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Adjust Portions (%)</p>
                     <div className="space-y-6">
                        <div className="space-y-2">
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-emerald-600">VEGETABLES</span>
                              <span className="text-slate-900">{portions.veggies}%</span>
                           </div>
                           <input
                              type="range" min="0" max="100" value={portions.veggies}
                              onChange={(e) => {
                                 const val = parseInt(e.target.value);
                                 const remaining = 100 - val;
                                 const ratio = portions.protein / (portions.protein + portions.carbs || 1);
                                 setPortions({
                                    veggies: val,
                                    protein: Math.round(remaining * ratio),
                                    carbs: Math.round(remaining * (1 - ratio))
                                 });
                              }}
                              className="w-full accent-emerald-500"
                           />
                        </div>
                        <div className="space-y-2">
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-amber-600">PROTEIN</span>
                              <span className="text-slate-900">{portions.protein}%</span>
                           </div>
                           <input
                              type="range" min="0" max="100" value={portions.protein}
                              onChange={(e) => {
                                 const val = parseInt(e.target.value);
                                 const remaining = 100 - val;
                                 const ratio = portions.veggies / (portions.veggies + portions.carbs || 1);
                                 setPortions({
                                    protein: val,
                                    veggies: Math.round(remaining * ratio),
                                    carbs: Math.round(remaining * (1 - ratio))
                                 });
                              }}
                              className="w-full accent-amber-500"
                           />
                        </div>
                        <div className="space-y-2">
                           <div className="flex justify-between text-[10px] font-bold">
                              <span className="text-blue-600">CARBOHYDRATES</span>
                              <span className="text-slate-900">{portions.carbs}%</span>
                           </div>
                           <input
                              type="range" min="0" max="100" value={portions.carbs}
                              onChange={(e) => {
                                 const val = parseInt(e.target.value);
                                 const remaining = 100 - val;
                                 const ratio = portions.veggies / (portions.veggies + portions.protein || 1);
                                 setPortions({
                                    carbs: val,
                                    veggies: Math.round(remaining * ratio),
                                    protein: Math.round(remaining * (1 - ratio))
                                 });
                              }}
                              className="w-full accent-blue-500"
                           />
                        </div>
                     </div>
                  </div>

                  <div className="mt-auto p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">Why this works</p>
                     <ul className="space-y-3">
                        <li className="flex gap-3">
                           <span className="text-emerald-400 text-xs">‚úî</span>
                           <p className="text-[10px] text-slate-300 leading-relaxed"><strong>Veggies (50%):</strong> High fiber and nutrients, low calorie density.</p>
                        </li>
                        <li className="flex gap-3">
                           <span className="text-amber-400 text-xs">‚úî</span>
                           <p className="text-[10px] text-slate-300 leading-relaxed"><strong>Protein (25%):</strong> Essential for muscle repair and satiety.</p>
                        </li>
                        <li className="flex gap-3">
                           <span className="text-blue-400 text-xs">‚úî</span>
                           <p className="text-[10px] text-slate-300 leading-relaxed"><strong>Carbs (25%):</strong> Primary energy source for brain and body.</p>
                        </li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- GRAVITATIONAL PE RENDERER (PE = mgh) ---
   const GravitationalPERenderer = () => {
      const [height, setHeight] = useState(10); // meters
      const [mass, setMass] = useState(5);     // kg
      const [gravity, setGravity] = useState(9.8); // m/s^2
      const [isDropping, setIsDropping] = useState(false);
      const [currentHeight, setCurrentHeight] = useState(10);
      const [velocity, setVelocity] = useState(0);
      const [challengeMode, setChallengeMode] = useState(false);
      const [targetPE, setTargetPE] = useState(500);

      const planets = [
         { name: 'Earth', g: 9.8, color: 'text-blue-400' },
         { name: 'Moon', g: 1.6, color: 'text-slate-400' },
         { name: 'Mars', g: 3.7, color: 'text-orange-400' },
         { name: 'Jupiter', g: 24.8, color: 'text-amber-600' }
      ];

      const pe = mass * gravity * height;
      const currentPE = mass * gravity * currentHeight;
      const ke = 0.5 * mass * velocity * velocity;
      const totalE = pe; // Initial total energy

      useEffect(() => {
         let animationFrame: number;
         if (isDropping && currentHeight > 0) {
            let lastTime = performance.now();
            const animate = (time: number) => {
               const dt = (time - lastTime) / 1000;
               lastTime = time;

               setCurrentHeight(prev => {
                  const newHeight = prev - velocity * dt - 0.5 * gravity * dt * dt;
                  if (newHeight <= 0) {
                     setIsDropping(false);
                     setVelocity(Math.sqrt(2 * gravity * height)); // Final velocity
                     return 0;
                  }
                  return newHeight;
               });
               setVelocity(v => v + gravity * dt);
               animationFrame = requestAnimationFrame(animate);
            };
            animationFrame = requestAnimationFrame(animate);
         }
         return () => cancelAnimationFrame(animationFrame);
      }, [isDropping, gravity, height]);

      const reset = () => {
         setIsDropping(false);
         setCurrentHeight(height);
         setVelocity(0);
      };

      useEffect(() => {
         reset();
      }, [height, mass, gravity]);

      const isChallengeMet = challengeMode && Math.abs(pe - targetPE) < 10;

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Gravitational Potential Energy</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">PE = mgh</p>
               </div>
               <div className="flex items-center gap-4">
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white' : 'bg-slate-200 text-slate-600'}`}
                  >
                     {challengeMode ? 'Exit Challenge' : 'Challenge Mode'}
                  </button>
                  <div className="flex gap-1">
                     {planets.map(p => (
                        <button
                           key={p.name}
                           onClick={() => setGravity(p.g)}
                           className={`px-2 py-1 rounded-md text-[10px] font-bold transition-all ${gravity === p.g ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                        >
                           {p.name}
                        </button>
                     ))}
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Simulation Area */}
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  {/* Ground */}
                  <div className="absolute bottom-20 left-10 right-10 h-2 bg-slate-200 rounded-full" />

                  {/* Object */}
                  <div
                     className="absolute w-12 h-12 bg-indigo-600 rounded-2xl shadow-lg flex items-center justify-center transition-transform duration-75"
                     style={{
                        bottom: `${88 + (currentHeight * 20)}px`,
                        transform: `rotate(${velocity * 2}deg)`
                     }}
                  >
                     <span className="text-white font-black text-xs">{mass}kg</span>
                  </div>

                  {/* Height Indicator */}
                  <div
                     className="absolute left-20 border-l-2 border-dashed border-slate-300 flex flex-col justify-between py-2"
                     style={{ bottom: '88px', height: `${height * 20}px` }}
                  >
                     <div className="w-4 h-0.5 bg-slate-300" />
                     <div className="absolute top-1/2 -translate-y-1/2 -left-8 text-[10px] font-bold text-slate-400 rotate-90 whitespace-nowrap">
                        HEIGHT: {height}m
                     </div>
                     <div className="w-4 h-0.5 bg-slate-300" />
                  </div>

                  {/* Energy Bars */}
                  <div className="absolute right-10 bottom-32 flex gap-4 items-end h-48">
                     <div className="flex flex-col items-center gap-2">
                        <div className="w-8 bg-slate-100 rounded-t-lg relative overflow-hidden h-full">
                           <div
                              className="absolute bottom-0 w-full bg-emerald-500 transition-all duration-75"
                              style={{ height: `${(currentPE / (totalE || 1)) * 100}%` }}
                           />
                        </div>
                        <span className="text-[8px] font-black text-slate-400 uppercase">PE</span>
                     </div>
                     <div className="flex flex-col items-center gap-2">
                        <div className="w-8 bg-slate-100 rounded-t-lg relative overflow-hidden h-full">
                           <div
                              className="absolute bottom-0 w-full bg-blue-500 transition-all duration-75"
                              style={{ height: `${(ke / (totalE || 1)) * 100}%` }}
                           />
                        </div>
                        <span className="text-[8px] font-black text-slate-400 uppercase">KE</span>
                     </div>
                  </div>

                  {/* Controls Overlay */}
                  <div className="absolute bottom-10 left-1/2 -translate-x-1/2 flex gap-4">
                     <button
                        onClick={() => setIsDropping(true)}
                        disabled={isDropping || currentHeight <= 0}
                        className="px-8 py-3 bg-indigo-600 text-white rounded-xl font-black text-sm shadow-xl hover:bg-indigo-700 disabled:opacity-50 transition-all"
                     >
                        DROP OBJECT
                     </button>
                     <button
                        onClick={reset}
                        className="px-8 py-3 bg-slate-100 text-slate-600 rounded-xl font-black text-sm hover:bg-slate-200 transition-all"
                     >
                        RESET
                     </button>
                  </div>
               </div>

               {/* Right Panel */}
               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  {challengeMode && (
                     <div className={`p-6 rounded-3xl border-2 transition-all ${isChallengeMet ? 'bg-emerald-50 border-emerald-200' : 'bg-amber-50 border-amber-200'}`}>
                        <div className="flex items-center gap-3 mb-4">
                           <div className={`w-8 h-8 rounded-full flex items-center justify-center text-lg ${isChallengeMet ? 'bg-emerald-500 text-white' : 'bg-amber-500 text-white'}`}>
                              {isChallengeMet ? '‚úì' : 'üéØ'}
                           </div>
                           <div>
                              <p className="font-bold text-slate-800 text-sm">Goal: Reach {targetPE}J of PE</p>
                              <p className="text-[10px] text-slate-500">Adjust mass and height to hit the target.</p>
                           </div>
                        </div>
                        {isChallengeMet && <div className="text-emerald-600 font-black text-center animate-bounce">CHALLENGE COMPLETE!</div>}
                     </div>
                  )}

                  <div className="space-y-6">
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500 uppercase">MASS (kg)</span>
                           <span className="text-slate-900">{mass} kg</span>
                        </div>
                        <input
                           type="range" min="1" max="20" value={mass}
                           onChange={(e) => setMass(parseInt(e.target.value))}
                           className="w-full accent-indigo-600"
                        />
                     </div>
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500 uppercase">HEIGHT (m)</span>
                           <span className="text-slate-900">{height} m</span>
                        </div>
                        <input
                           type="range" min="1" max="20" value={height}
                           onChange={(e) => setHeight(parseInt(e.target.value))}
                           className="w-full accent-indigo-600"
                        />
                     </div>
                  </div>

                  <div className="mt-auto grid grid-cols-2 gap-4">
                     <div className="p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                        <p className="text-[8px] font-black text-slate-400 uppercase mb-1">Potential Energy</p>
                        <p className="text-xl font-black text-emerald-600">{Math.round(currentPE)}J</p>
                     </div>
                     <div className="p-4 bg-white rounded-2xl border border-slate-200 shadow-sm">
                        <p className="text-[8px] font-black text-slate-400 uppercase mb-1">Kinetic Energy</p>
                        <p className="text-xl font-black text-blue-600">{Math.round(ke)}J</p>
                     </div>
                     <div className="p-4 bg-white rounded-2xl border border-slate-200 shadow-sm col-span-2">
                        <p className="text-[8px] font-black text-slate-400 uppercase mb-1">Velocity</p>
                        <p className="text-xl font-black text-slate-900">{velocity.toFixed(1)} m/s</p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- CHEMICAL PE RENDERER (Bond Energy) ---
   const ChemicalPERenderer = () => {
      const [reaction, setReaction] = useState<'exothermic' | 'endothermic'>('exothermic');
      const [isReacting, setIsReacting] = useState(false);
      const [progress, setProgress] = useState(0);

      const reactions = {
         exothermic: {
            name: 'Combustion (Methane)',
            reactants: 'CH‚ÇÑ + 2O‚ÇÇ',
            products: 'CO‚ÇÇ + 2H‚ÇÇO',
            energyDelta: -890, // kJ/mol
            activationEnergy: 100,
            desc: 'Energy is released as new, stronger bonds form.'
         },
         endothermic: {
            name: 'Photosynthesis (Simplified)',
            reactants: '6CO‚ÇÇ + 6H‚ÇÇO',
            products: 'C‚ÇÜH‚ÇÅ‚ÇÇO‚ÇÜ + 6O‚ÇÇ',
            energyDelta: 2800, // kJ/mol
            activationEnergy: 500,
            desc: 'Energy is absorbed to break strong bonds and form weaker ones.'
         }
      };

      const current = reactions[reaction];

      useEffect(() => {
         let interval: any;
         if (isReacting) {
            interval = setInterval(() => {
               setProgress(p => {
                  if (p >= 100) {
                     setIsReacting(false);
                     return 100;
                  }
                  return p + 2;
               });
            }, 50);
         }
         return () => clearInterval(interval);
      }, [isReacting]);

      const reset = () => {
         setIsReacting(false);
         setProgress(0);
      };

      useEffect(() => {
         reset();
      }, [reaction]);

      const getEnergyY = (x: number) => {
         const startY = 200;
         const peakY = startY - current.activationEnergy * 0.2;
         const endY = startY - current.energyDelta * 0.1;

         if (x < 30) return startY;
         if (x < 50) {
            const t = (x - 30) / 20;
            return startY + (peakY - startY) * (1 - Math.cos(t * Math.PI)) / 2;
         }
         if (x < 70) {
            const t = (x - 50) / 20;
            return peakY + (endY - peakY) * (1 - Math.cos(t * Math.PI)) / 2;
         }
         return endY;
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Chemical Potential Energy</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Bond Energy & Reactions</p>
               </div>
               <div className="flex gap-2">
                  {(['exothermic', 'endothermic'] as const).map(type => (
                     <button
                        key={type}
                        onClick={() => setReaction(type)}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${reaction === type ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                     >
                        {type}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-white flex flex-col p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="flex-1 relative">
                     <svg viewBox="0 0 400 300" className="w-full h-full">
                        <line x1="40" y1="260" x2="380" y2="260" stroke="#cbd5e1" strokeWidth="2" markerEnd="url(#arrow)" />
                        <line x1="40" y1="260" x2="40" y2="20" stroke="#cbd5e1" strokeWidth="2" markerEnd="url(#arrow)" />
                        <text x="380" y="275" textAnchor="end" className="text-[8px] font-bold fill-slate-400">REACTION PROGRESS</text>
                        <text x="35" y="30" textAnchor="end" className="text-[8px] font-bold fill-slate-400 rotate-90 origin-top-right">POTENTIAL ENERGY</text>

                        <path
                           d={`M 40,200 L 120,200 ${Array.from({ length: 41 }).map((_, i) => {
                              const x = 120 + i * 4;
                              const progressX = (i / 40) * 40 + 30;
                              return `L ${x},${getEnergyY(progressX)}`;
                           }).join(' ')} L 360,${getEnergyY(70)}`}
                           fill="none"
                           stroke="#6366f1"
                           strokeWidth="4"
                           strokeLinecap="round"
                        />

                        {isReacting && (
                           <circle
                              cx={120 + (progress / 100) * 160}
                              cy={getEnergyY(30 + (progress / 100) * 40)}
                              r="6"
                              fill="#ef4444"
                              className="animate-pulse"
                           />
                        )}

                        <text x="80" y="190" textAnchor="middle" className="text-[10px] font-black fill-slate-600">REACTANTS</text>
                        <text x="320" y={getEnergyY(70) - 10} textAnchor="middle" className="text-[10px] font-black fill-slate-600">PRODUCTS</text>

                        <line
                           x1="360" y1="200" x2="360" y2={getEnergyY(70)}
                           stroke={reaction === 'exothermic' ? '#10b981' : '#ef4444'}
                           strokeWidth="2"
                           strokeDasharray="4"
                           markerEnd="url(#arrow)"
                        />
                        <text x="365" y={(200 + getEnergyY(70)) / 2} className="text-[8px] font-bold fill-slate-500">
                           ŒîH = {current.energyDelta} kJ/mol
                        </text>
                     </svg>

                     <div className="absolute bottom-0 left-1/2 -translate-x-1/2 flex gap-4">
                        <button
                           onClick={() => setIsReacting(true)}
                           disabled={isReacting}
                           className="px-8 py-3 bg-indigo-600 text-white rounded-xl font-black text-sm shadow-xl hover:bg-indigo-700 disabled:opacity-50 transition-all"
                        >
                           START REACTION
                        </button>
                        <button
                           onClick={reset}
                           className="px-8 py-3 bg-slate-100 text-slate-600 rounded-xl font-black text-sm hover:bg-slate-200 transition-all"
                        >
                           RESET
                        </button>
                     </div>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Reaction Details</p>
                     <h3 className="text-2xl font-black text-slate-900">{current.name}</h3>
                     <div className="p-4 bg-white rounded-2xl border border-slate-200 shadow-sm space-y-4">
                        <div className="flex justify-between items-center">
                           <span className="text-[10px] font-bold text-slate-400 uppercase">Equation</span>
                           <span className="text-sm font-mono font-bold text-indigo-600">{current.reactants} ‚Üí {current.products}</span>
                        </div>
                        <div className="flex justify-between items-center">
                           <span className="text-[10px] font-bold text-slate-400 uppercase">Type</span>
                           <span className={`text-[10px] font-black px-2 py-1 rounded-full ${reaction === 'exothermic' ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}`}>
                              {reaction.toUpperCase()}
                           </span>
                        </div>
                     </div>
                  </div>

                  <div className="p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        {current.desc}
                     </p>
                  </div>

                  <div className="mt-auto space-y-4">
                     <div className="p-4 bg-indigo-50 rounded-2xl border border-indigo-100">
                        <p className="text-[10px] font-black text-indigo-900 uppercase mb-2">Bond Energy Rule</p>
                        <p className="text-[10px] text-indigo-700 leading-relaxed">
                           Breaking bonds <strong>requires</strong> energy (+).<br />
                           Forming bonds <strong>releases</strong> energy (-).
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ENERGY CONSERVATION RENDERER ---
   const EnergyConservationRenderer = () => {
      const [scenario, setScenario] = useState<'pendulum' | 'coaster' | 'ball'>('pendulum');
      const [friction, setFriction] = useState(0); // 0-100
      const [isPlaying, setIsPlaying] = useState(false);
      const [time, setTime] = useState(0);

      const [pe, setPe] = useState(100);
      const [ke, setKe] = useState(0);
      const [thermal, setThermal] = useState(0);

      useEffect(() => {
         let animationId: number;
         if (isPlaying) {
            const animate = () => {
               setTime(t => t + 0.05);
               animationId = requestAnimationFrame(animate);
            };
            animationId = requestAnimationFrame(animate);
         }
         return () => cancelAnimationFrame(animationId);
      }, [isPlaying]);

      useEffect(() => {
         const damping = friction * 0.001;
         let newPe = 0;
         let newKe = 0;

         if (scenario === 'pendulum') {
            const amplitude = 100 * Math.exp(-damping * time);
            const angle = amplitude * Math.cos(2 * time);
            newPe = Math.abs(angle);
            newKe = amplitude - newPe;
         } else if (scenario === 'ball') {
            const gravity = 9.8;
            const h0 = 100;
            const period = Math.sqrt(2 * h0 / gravity) * 2;
            const tInPeriod = time % period;
            const halfPeriod = period / 2;

            let h;
            if (tInPeriod < halfPeriod) {
               h = h0 - 0.5 * gravity * tInPeriod * tInPeriod;
            } else {
               const tUp = tInPeriod - halfPeriod;
               const v0 = gravity * halfPeriod;
               h = v0 * tUp - 0.5 * gravity * tUp * tUp;
            }

            const bounceCount = Math.floor(time / period);
            const energyLoss = Math.pow(1 - friction / 200, bounceCount);
            newPe = Math.max(0, h * energyLoss);
            newKe = Math.max(0, (h0 - h) * energyLoss);
         } else if (scenario === 'coaster') {
            const x = (time * 50) % 400;
            const h = 50 + 40 * Math.sin(x / 50);
            const energyLoss = Math.exp(-damping * time);
            newPe = h * energyLoss;
            newKe = (100 - h) * energyLoss;
         }

         setPe(newPe);
         setKe(newKe);
         setThermal(100 - (newPe + newKe));
      }, [time, scenario, friction]);

      const reset = () => {
         setTime(0);
         setThermal(0);
         setIsPlaying(false);
      };

      useEffect(() => {
         reset();
      }, [scenario]);

      return (
         <div className="w-full h-full bg-slate-900 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-800 border-b border-slate-700 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight">Energy Conservation Lab</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Total Energy is Constant</p>
               </div>
               <div className="flex gap-2">
                  {(['pendulum', 'coaster', 'ball'] as const).map(s => (
                     <button
                        key={s}
                        onClick={() => setScenario(s)}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${scenario === s ? 'bg-white text-slate-900' : 'bg-slate-700 text-slate-400 hover:bg-slate-600'}`}
                     >
                        {s}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-12 overflow-hidden bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-800 via-slate-900 to-black">
                  <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#fff 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="relative w-full h-full flex items-center justify-center">
                     {scenario === 'pendulum' && (
                        <div className="relative h-64 w-64 flex flex-col items-center">
                           <div className="w-32 h-2 bg-slate-700 rounded-full" />
                           <div
                              className="absolute top-0 origin-top transition-transform duration-75"
                              style={{ transform: `rotate(${(pe - 50) * 0.8}deg)`, height: '200px' }}
                           >
                              <div className="w-1 h-full bg-slate-500 mx-auto" />
                              <div className="w-10 h-10 bg-indigo-500 rounded-full shadow-[0_0_20px_rgba(99,102,241,0.5)] -mt-5 mx-auto" />
                           </div>
                        </div>
                     )}

                     {scenario === 'ball' && (
                        <div className="relative h-64 w-64">
                           <div className="absolute bottom-0 w-full h-2 bg-slate-700 rounded-full" />
                           <div
                              className="absolute left-1/2 -translate-x-1/2 w-12 h-12 bg-emerald-500 rounded-full shadow-[0_0_20px_rgba(16,185,129,0.5)] transition-all duration-75"
                              style={{ bottom: `${8 + pe * 2}px` }}
                           />
                        </div>
                     )}

                     {scenario === 'coaster' && (
                        <div className="relative h-64 w-full px-12">
                           <svg viewBox="0 0 400 200" className="w-full h-full">
                              <path
                                 d="M 0,150 Q 100,50 200,150 T 400,150"
                                 fill="none" stroke="#475569" strokeWidth="4" strokeLinecap="round"
                              />
                              <circle
                                 cx={(time * 50) % 400}
                                 cy={150 - (100 - (50 + 40 * Math.sin(((time * 50) % 400) / 50)))}
                                 r="10" fill="#f59e0b"
                              />
                           </svg>
                        </div>
                     )}
                  </div>

                  <div className="absolute top-10 right-10 flex flex-col gap-4 bg-slate-900/80 backdrop-blur-md p-6 rounded-3xl border border-slate-700 shadow-2xl">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Energy Distribution</p>
                     <div className="flex gap-4 h-32 items-end">
                        <div className="flex flex-col items-center gap-2">
                           <div className="w-6 bg-slate-800 rounded-t-lg relative overflow-hidden h-full">
                              <div className="absolute bottom-0 w-full bg-blue-500 transition-all duration-75" style={{ height: `${pe}%` }} />
                           </div>
                           <span className="text-[8px] font-bold text-blue-400">PE</span>
                        </div>
                        <div className="flex flex-col items-center gap-2">
                           <div className="w-6 bg-slate-800 rounded-t-lg relative overflow-hidden h-full">
                              <div className="absolute bottom-0 w-full bg-emerald-500 transition-all duration-75" style={{ height: `${ke}%` }} />
                           </div>
                           <span className="text-[8px] font-bold text-emerald-400">KE</span>
                        </div>
                        <div className="flex flex-col items-center gap-2">
                           <div className="w-6 bg-slate-800 rounded-t-lg relative overflow-hidden h-full">
                              <div className="absolute bottom-0 w-full bg-red-500 transition-all duration-75" style={{ height: `${thermal}%` }} />
                           </div>
                           <span className="text-[8px] font-bold text-red-400">HEAT</span>
                        </div>
                     </div>
                     <div className="mt-4 pt-4 border-t border-slate-800">
                        <div className="flex justify-between text-[10px] font-black">
                           <span className="text-slate-500">TOTAL ENERGY</span>
                           <span className="text-white">100%</span>
                        </div>
                     </div>
                  </div>

                  <div className="absolute bottom-10 left-1/2 -translate-x-1/2 flex gap-4">
                     <button
                        onClick={() => setIsPlaying(!isPlaying)}
                        className={`px-10 py-4 rounded-2xl font-black text-sm transition-all uppercase tracking-widest shadow-xl ${isPlaying ? 'bg-red-500/20 text-red-400 border border-red-500/50' : 'bg-white text-slate-950'}`}
                     >
                        {isPlaying ? 'PAUSE' : 'START SIM'}
                     </button>
                     <button
                        onClick={reset}
                        className="px-10 py-4 bg-slate-800 text-slate-400 rounded-2xl font-black text-sm hover:bg-slate-700 transition-all uppercase tracking-widest"
                     >
                        RESET
                     </button>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-800 border-l border-slate-700 p-8 flex flex-col gap-8">
                  <div className="space-y-6">
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-400 uppercase">Friction / Damping</span>
                           <span className="text-white">{friction}%</span>
                        </div>
                        <input
                           type="range" min="0" max="100" value={friction}
                           onChange={(e) => setFriction(parseInt(e.target.value))}
                           className="w-full accent-white"
                        />
                     </div>
                  </div>

                  <div className="p-6 bg-slate-900 rounded-3xl border border-slate-700">
                     <p className="text-[10px] font-bold text-slate-500 uppercase mb-4 tracking-widest">The Law</p>
                     <p className="text-xs leading-relaxed text-slate-300 italic">
                        "Energy cannot be created or destroyed; it can only be changed from one form to another."
                     </p>
                     <p className="text-[10px] mt-4 text-slate-500 leading-relaxed">
                        Notice how the Total Energy (PE + KE + Heat) always sums to 100%. Friction doesn't "destroy" energy; it transforms it into thermal energy (Heat).
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- MACHINE EFFICIENCY RENDERER (Sankey Diagrams) ---
   const MachineEfficiencyRenderer = () => {
      const [machine, setMachine] = useState<'car' | 'bulb' | 'motor'>('car');

      const machines = {
         car: {
            name: 'Internal Combustion Engine',
            useful: 25,
            waste: 75,
            usefulLabel: 'Kinetic Energy',
            wasteLabel: 'Thermal Energy (Heat)',
            desc: 'Most energy in a car is lost as heat through the exhaust and radiator.'
         },
         bulb: {
            name: 'Incandescent Lightbulb',
            useful: 5,
            waste: 95,
            usefulLabel: 'Light Energy',
            wasteLabel: 'Thermal Energy (Heat)',
            desc: 'Incandescent bulbs are highly inefficient, converting most electricity to heat.'
         },
         motor: {
            name: 'Electric Motor',
            useful: 85,
            waste: 15,
            usefulLabel: 'Kinetic Energy',
            wasteLabel: 'Heat & Sound',
            desc: 'Electric motors are very efficient, with minimal energy lost to friction and heat.'
         }
      };

      const current = machines[machine];
      const usefulWidth = (current.useful / 100) * 200;
      const wasteWidth = (current.waste / 100) * 200;

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Machine Efficiency</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Sankey Diagram Visualization</p>
               </div>
               <div className="flex gap-2">
                  {(['car', 'bulb', 'motor'] as const).map(m => (
                     <button
                        key={m}
                        onClick={() => setMachine(m)}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${machine === m ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                     >
                        {m}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <svg viewBox="0 0 500 400" className="w-full h-full max-w-lg">
                     <path
                        d="M 50,150 L 200,150 L 200,250 L 50,250 Z"
                        fill="#94a3b8" opacity="0.3"
                     />
                     <text x="125" y="205" textAnchor="middle" className="text-[10px] font-black fill-slate-500">INPUT ENERGY (100%)</text>

                     <path
                        d={`M 200,150 L 450,150 L 450,${150 + usefulWidth} L 200,${150 + usefulWidth} Z`}
                        fill="#10b981" className="transition-all duration-700"
                     />
                     <text x="325" y={150 + usefulWidth / 2 + 5} textAnchor="middle" className="text-[10px] font-black fill-white">
                        USEFUL: {current.useful}%
                     </text>
                     <text x="455" y={150 + usefulWidth / 2 + 5} className="text-[8px] font-bold fill-emerald-600">{current.usefulLabel}</text>

                     <path
                        d={`M 200,${150 + usefulWidth} Q 200,350 350,350 L 350,${350 + wasteWidth} Q 200,${350 + wasteWidth} 200,250 Z`}
                        fill="#ef4444" className="transition-all duration-700"
                     />
                     <text x="275" y={350 + wasteWidth / 2 + 5} textAnchor="middle" className="text-[10px] font-black fill-white">
                        WASTE: {current.waste}%
                     </text>
                     <text x="355" y={350 + wasteWidth / 2 + 5} className="text-[8px] font-bold fill-red-600">{current.wasteLabel}</text>

                     <g transform="translate(50, 50)">
                        <rect width="180" height="60" rx="12" fill="#f8fafc" stroke="#e2e8f0" strokeWidth="1" />
                        <text x="90" y="25" textAnchor="middle" className="text-[8px] font-black fill-slate-400 uppercase">Efficiency Formula</text>
                        <text x="90" y="45" textAnchor="middle" className="text-xs font-black fill-slate-900">
                           (Useful / Total) √ó 100 = {current.useful}%
                        </text>
                     </g>
                  </svg>
               </div>

               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Machine Profile</p>
                     <h3 className="text-2xl font-black text-slate-900">{current.name}</h3>
                     <p className="text-sm text-slate-600 leading-relaxed">
                        {current.desc}
                     </p>
                  </div>

                  <div className="p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        In any energy transformation, some energy is always "degraded" into less useful forms, usually <strong>thermal energy</strong> (heat). This is why machines get hot when they run!
                     </p>
                  </div>

                  <div className="mt-auto space-y-4">
                     <div className="p-4 bg-emerald-50 rounded-2xl border border-emerald-100">
                        <p className="text-[10px] font-black text-emerald-900 uppercase mb-2">Efficiency Tip</p>
                        <p className="text-[10px] text-emerald-700 leading-relaxed">
                           Higher efficiency means less energy is wasted, reducing costs and environmental impact.
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- CONVECTION RENDERER (Fluid Circulation) ---
   const ConvectionRenderer = () => {
      const [isHeating, setIsHeating] = useState(false);
      const [heatPos, setHeatPos] = useState(50); // % from left
      const [particles, setParticles] = useState<{ x: number, y: number, vx: number, vy: number, temp: number }[]>([]);

      useEffect(() => {
         const initial = [];
         for (let i = 0; i < 50; i++) {
            initial.push({
               x: Math.random() * 400,
               y: Math.random() * 300,
               vx: (Math.random() - 0.5) * 2,
               vy: (Math.random() - 0.5) * 2,
               temp: 20
            });
         }
         setParticles(initial);
      }, []);

      useEffect(() => {
         let animationId: number;
         const animate = () => {
            setParticles(prev => prev.map(p => {
               let { x, y, vx, vy, temp } = p;
               const distToHeat = Math.abs(x - (heatPos * 4));
               if (isHeating && y > 250 && distToHeat < 50) {
                  temp = Math.min(100, temp + 2);
               } else {
                  temp = Math.max(20, temp - 0.1);
               }
               const buoyancy = (temp - 20) * 0.05;
               vy -= buoyancy;
               vy += 0.1;
               vx *= 0.98;
               vy *= 0.98;
               x += vx;
               y += vy;
               if (x < 0) { x = 0; vx *= -1; }
               if (x > 400) { x = 400; vx *= -1; }
               if (y < 0) { y = 0; vy *= -1; }
               if (y > 300) { y = 300; vy *= -0.5; temp -= 1; }
               const centerX = 200;
               if (temp > 50) vx += (x < centerX ? -0.1 : 0.1);
               return { x, y, vx, vy, temp };
            }));
            animationId = requestAnimationFrame(animate);
         };
         animationId = requestAnimationFrame(animate);
         return () => cancelAnimationFrame(animationId);
      }, [isHeating, heatPos]);

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight">Convection Currents</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Heat Transfer in Fluids</p>
               </div>
               <div className="flex items-center gap-4">
                  <span className="text-[10px] font-bold text-slate-500">HEAT SOURCE POSITION</span>
                  <input
                     type="range" min="10" max="90" value={heatPos}
                     onChange={(e) => setHeatPos(parseInt(e.target.value))}
                     className="w-32 accent-red-500"
                  />
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-black flex items-center justify-center p-12 overflow-hidden">
                  <div className="relative w-[400px] h-[300px] border-2 border-slate-800 rounded-xl overflow-hidden bg-slate-900/50">
                     {particles.map((p, i) => (
                        <div
                           key={i}
                           className="absolute w-3 h-3 rounded-full blur-[2px] transition-colors duration-300"
                           style={{
                              left: `${p.x}px`,
                              top: `${p.y}px`,
                              backgroundColor: `rgb(${Math.min(255, p.temp * 2.5)}, 100, ${Math.max(100, 255 - p.temp * 2)})`,
                              opacity: 0.6
                           }}
                        />
                     ))}
                     <div
                        className={`absolute bottom-0 h-4 w-20 -translate-x-1/2 rounded-t-xl transition-all duration-500 ${isHeating ? 'bg-red-500 shadow-[0_-10px_30px_rgba(239,68,68,0.5)]' : 'bg-slate-800'}`}
                        style={{ left: `${heatPos}%` }}
                     />
                  </div>
                  <div className="absolute bottom-10 left-1/2 -translate-x-1/2">
                     <button
                        onMouseDown={() => setIsHeating(true)}
                        onMouseUp={() => setIsHeating(false)}
                        onMouseLeave={() => setIsHeating(false)}
                        className={`px-12 py-4 rounded-2xl font-black text-sm transition-all uppercase tracking-widest shadow-2xl ${isHeating ? 'bg-red-500 text-white scale-95' : 'bg-white text-slate-950'}`}
                     >
                        HOLD TO HEAT
                     </button>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">The Mechanism</p>
                     <h3 className="text-2xl font-black text-white">How it Works</h3>
                     <div className="space-y-4">
                        <div className="p-4 bg-slate-800 rounded-2xl border border-slate-700 flex gap-4">
                           <div className="w-10 h-10 rounded-full bg-red-500/20 flex items-center justify-center text-red-400 font-black">1</div>
                           <p className="text-[10px] text-slate-300 leading-relaxed">
                              Heat source warms the fluid at the bottom.
                           </p>
                        </div>
                        <div className="p-4 bg-slate-800 rounded-2xl border border-slate-700 flex gap-4">
                           <div className="w-10 h-10 rounded-full bg-orange-500/20 flex items-center justify-center text-orange-400 font-black">2</div>
                           <p className="text-[10px] text-slate-300 leading-relaxed">
                              Warm fluid becomes <strong>less dense</strong> and rises.
                           </p>
                        </div>
                        <div className="p-4 bg-slate-800 rounded-2xl border border-slate-700 flex gap-4">
                           <div className="w-10 h-10 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-400 font-black">3</div>
                           <p className="text-[10px] text-slate-300 leading-relaxed">
                              Cooler, denser fluid sinks to take its place, creating a <strong>circulation loop</strong>.
                           </p>
                        </div>
                     </div>
                  </div>
                  <div className="p-6 bg-slate-800 rounded-3xl border border-slate-700 mt-auto">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">Real World Examples</p>
                     <ul className="text-[10px] text-slate-300 space-y-2">
                        <li>‚Ä¢ Boiling water in a pot</li>
                        <li>‚Ä¢ Atmospheric wind patterns</li>
                        <li>‚Ä¢ Tectonic plate movement (Mantle)</li>
                        <li>‚Ä¢ Ocean currents</li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- SPECIFIC HEAT RENDERER (Q = mcŒîT) ---
   const SpecificHeatRenderer = () => {
      const [material, setMaterial] = useState<'water' | 'iron' | 'aluminum'>('water');
      const [mass, setMass] = useState(1); // kg
      const [isHeating, setIsHeating] = useState(false);
      const [temp, setTemp] = useState(20); // Celsius
      const [energyUsed, setEnergyUsed] = useState(0); // Joules

      const materials = {
         water: { name: 'Water', c: 4184, color: 'bg-blue-400', desc: 'High specific heat; takes a lot of energy to warm up.' },
         iron: { name: 'Iron', c: 450, color: 'bg-slate-500', desc: 'Low specific heat; warms up very quickly.' },
         aluminum: { name: 'Aluminum', c: 900, color: 'bg-slate-300', desc: 'Moderate specific heat.' }
      };

      const current = materials[material];

      useEffect(() => {
         let interval: any;
         if (isHeating) {
            interval = setInterval(() => {
               const power = 1000;
               const dt = 0.1;
               const energy = power * dt;
               setEnergyUsed(prev => prev + energy);
               setTemp(prev => {
                  const deltaT = energy / (mass * current.c);
                  return Math.min(100, prev + deltaT);
               });
            }, 100);
         }
         return () => clearInterval(interval);
      }, [isHeating, mass, current.c]);

      const reset = () => {
         setIsHeating(false);
         setTemp(20);
         setEnergyUsed(0);
      };

      useEffect(() => {
         reset();
      }, [material]);

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Specific Heat Lab</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Q = mcŒîT</p>
               </div>
               <div className="flex gap-2">
                  {(['water', 'iron', 'aluminum'] as const).map(m => (
                     <button
                        key={m}
                        onClick={() => setMaterial(m)}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${material === m ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}`}
                     >
                        {m}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="relative flex flex-col items-center">
                     <div className="absolute -left-16 bottom-20 w-8 h-48 bg-slate-100 rounded-full border-2 border-slate-200 p-1 flex flex-col justify-end">
                        <div
                           className="w-full bg-red-500 rounded-full transition-all duration-300"
                           style={{ height: `${(temp / 100) * 100}%` }}
                        />
                        <div className="absolute -top-6 left-0 w-full text-center text-[10px] font-black text-red-500">{Math.round(temp)}¬∞C</div>
                     </div>

                     <div className={`w-40 h-40 ${current.color} rounded-2xl shadow-lg border-4 border-white flex items-center justify-center relative overflow-hidden`}>
                        <div className="absolute inset-0 bg-black/10 flex items-center justify-center">
                           <span className="text-white font-black text-xl">{current.name}</span>
                        </div>
                        {material === 'water' && temp > 80 && (
                           <div className="absolute inset-0 pointer-events-none">
                              {Array.from({ length: 5 }).map((_, i) => (
                                 <div
                                    key={i}
                                    className="absolute w-2 h-2 bg-white/40 rounded-full animate-bounce"
                                    style={{ left: `${20 + i * 15}%`, bottom: '10%', animationDelay: `${i * 0.2}s` }}
                                 />
                              ))}
                           </div>
                        )}
                     </div>

                     <div className={`mt-4 w-48 h-8 rounded-xl transition-colors duration-500 ${isHeating ? 'bg-orange-500 shadow-[0_0_30px_rgba(249,115,22,0.4)]' : 'bg-slate-200'}`} />
                     <p className="mt-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">1000W Heater</p>
                  </div>

                  <div className="absolute bottom-10 left-1/2 -translate-x-1/2 flex gap-4">
                     <button
                        onMouseDown={() => setIsHeating(true)}
                        onMouseUp={() => setIsHeating(false)}
                        onMouseLeave={() => setIsHeating(false)}
                        className={`px-12 py-4 rounded-2xl font-black text-sm transition-all uppercase tracking-widest shadow-2xl ${isHeating ? 'bg-orange-500 text-white scale-95' : 'bg-white text-slate-950'}`}
                     >
                        HOLD TO HEAT
                     </button>
                     <button
                        onClick={reset}
                        className="px-12 py-4 bg-slate-100 text-slate-400 rounded-2xl font-black text-sm hover:bg-slate-200 transition-all uppercase tracking-widest"
                     >
                        RESET
                     </button>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Material Properties</p>
                     <h3 className="text-2xl font-black text-slate-900">{current.name}</h3>
                     <div className="p-4 bg-white rounded-2xl border border-slate-200 shadow-sm space-y-4">
                        <div className="flex justify-between items-center">
                           <span className="text-[10px] font-bold text-slate-400 uppercase">Specific Heat (c)</span>
                           <span className="text-sm font-black text-indigo-600">{current.c} J/kg¬∑¬∞C</span>
                        </div>
                        <div className="flex justify-between items-center">
                           <span className="text-[10px] font-bold text-slate-400 uppercase">Mass (m)</span>
                           <div className="flex items-center gap-2">
                              <input
                                 type="range" min="0.5" max="5" step="0.5" value={mass}
                                 onChange={(e) => setMass(parseFloat(e.target.value))}
                                 className="w-20 accent-indigo-600"
                              />
                              <span className="text-sm font-black text-slate-900">{mass}kg</span>
                           </div>
                        </div>
                     </div>
                  </div>

                  <div className="mt-auto grid grid-cols-1 gap-4">
                     <div className="p-6 bg-slate-900 rounded-3xl text-white">
                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest">Energy Consumed (Q)</p>
                        <p className="text-3xl font-black text-orange-400">{Math.round(energyUsed).toLocaleString()} J</p>
                        <p className="text-[10px] text-slate-500 mt-4 leading-relaxed">
                           {current.desc}
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- LATENT HEAT RENDERER (Phase Changes) ---
   const LatentHeatRenderer = () => {
      const [isHeating, setIsHeating] = useState(false);
      const [energy, setEnergy] = useState(0); // kJ
      const [mass, setMass] = useState(1); // kg

      const cIce = 2.1;
      const Lf = 334;
      const cWater = 4.18;
      const Lv = 2260;
      const cSteam = 2.0;

      const getTemp = (q: number) => {
         let currentQ = q / mass;
         const qToMelt = (0 - (-20)) * cIce;
         if (currentQ <= qToMelt) return -20 + currentQ / cIce;
         currentQ -= qToMelt;
         if (currentQ <= Lf) return 0;
         currentQ -= Lf;
         const qToBoil = (100 - 0) * cWater;
         if (currentQ <= qToBoil) return 0 + currentQ / cWater;
         currentQ -= qToBoil;
         if (currentQ <= Lv) return 100;
         currentQ -= Lv;
         return 100 + currentQ / cSteam;
      };

      const temp = getTemp(energy);
      const phase = temp < 0 ? 'Ice' : temp === 0 && (energy / mass) < (20 * cIce + Lf) ? 'Melting' : temp < 100 ? 'Water' : temp === 100 && (energy / mass) < (20 * cIce + Lf + 100 * cWater + Lv) ? 'Boiling' : 'Steam';

      useEffect(() => {
         let interval: any;
         if (isHeating) {
            interval = setInterval(() => {
               setEnergy(prev => prev + 10);
            }, 50);
         }
         return () => clearInterval(interval);
      }, [isHeating]);

      const reset = () => {
         setIsHeating(false);
         setEnergy(0);
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Phase Change & Latent Heat</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Heating Curve of Water</p>
               </div>
               <div className="flex items-center gap-4">
                  <span className="text-[10px] font-bold text-slate-500">MASS: {mass}kg</span>
                  <input
                     type="range" min="0.5" max="2" step="0.1" value={mass}
                     onChange={(e) => setMass(parseFloat(e.target.value))}
                     className="w-24 accent-indigo-600"
                  />
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-white flex flex-col p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="flex-1 relative">
                     <svg viewBox="0 0 500 300" className="w-full h-full">
                        <line x1="50" y1="250" x2="450" y2="250" stroke="#cbd5e1" strokeWidth="2" />
                        <line x1="50" y1="250" x2="50" y2="20" stroke="#cbd5e1" strokeWidth="2" />
                        <text x="450" y="265" textAnchor="end" className="text-[8px] font-bold fill-slate-400">ENERGY ADDED (kJ)</text>
                        <text x="45" y="30" textAnchor="end" className="text-[8px] font-bold fill-slate-400 rotate-90 origin-top-right">TEMPERATURE (¬∞C)</text>

                        <line x1="50" y1="150" x2="450" y2="150" stroke="#f1f5f9" strokeWidth="1" strokeDasharray="4" />
                        <text x="45" y="153" textAnchor="end" className="text-[8px] font-bold fill-slate-300">0¬∞C</text>
                        <line x1="50" y1="50" x2="450" y2="50" stroke="#f1f5f9" strokeWidth="1" strokeDasharray="4" />
                        <text x="45" y="53" textAnchor="end" className="text-[8px] font-bold fill-slate-300">100¬∞C</text>

                        <path
                           d={`M 50,${250 - (getTemp(0) + 20)} ${Array.from({ length: 100 }).map((_, i) => {
                              const q = i * 40;
                              const x = 50 + (q / 4000) * 400;
                              const y = 250 - (getTemp(q) + 20);
                              return `L ${x},${y}`;
                           }).join(' ')}`}
                           fill="none" stroke="#e2e8f0" strokeWidth="2"
                        />

                        <path
                           d={`M 50,${250 - (getTemp(0) + 20)} ${Array.from({ length: Math.floor(energy / 40) + 1 }).map((_, i) => {
                              const q = i * 40;
                              const x = 50 + (q / 4000) * 400;
                              const y = 250 - (getTemp(q) + 20);
                              return `L ${x},${y}`;
                           }).join(' ')}`}
                           fill="none" stroke="#6366f1" strokeWidth="4" strokeLinecap="round"
                        />

                        <circle
                           cx={50 + (energy / 4000) * 400}
                           cy={250 - (temp + 20)}
                           r="6" fill="#ef4444" className="animate-pulse"
                        />
                     </svg>

                     <div className="absolute bottom-0 left-1/2 -translate-x-1/2 flex gap-4">
                        <button
                           onMouseDown={() => setIsHeating(true)}
                           onMouseUp={() => setIsHeating(false)}
                           onMouseLeave={() => setIsHeating(false)}
                           className={`px-12 py-4 rounded-2xl font-black text-sm transition-all uppercase tracking-widest shadow-2xl ${isHeating ? 'bg-indigo-600 text-white scale-95' : 'bg-white text-slate-950'}`}
                        >
                           HOLD TO HEAT
                        </button>
                        <button
                           onClick={reset}
                           className="px-12 py-4 bg-slate-100 text-slate-400 rounded-2xl font-black text-sm hover:bg-slate-200 transition-all uppercase tracking-widest"
                        >
                           RESET
                        </button>
                     </div>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Current State</p>
                     <div className="p-6 bg-white rounded-3xl border border-slate-200 shadow-sm flex flex-col items-center gap-2">
                        <span className="text-4xl">{phase === 'Ice' ? 'üßä' : phase === 'Melting' ? 'üíßüßä' : phase === 'Water' ? 'üíß' : phase === 'Boiling' ? 'üí®üíß' : 'üí®'}</span>
                        <h3 className="text-2xl font-black text-slate-900 uppercase">{phase}</h3>
                        <p className="text-4xl font-black text-indigo-600">{Math.round(temp)}¬∞C</p>
                     </div>
                  </div>

                  <div className="p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        Notice the <strong>plateaus</strong> at 0¬∞C and 100¬∞C. During these times, the energy added is used to <strong>break molecular bonds</strong> (Latent Heat) rather than increasing the temperature.
                     </p>
                  </div>

                  <div className="mt-auto space-y-4">
                     <div className="p-4 bg-indigo-50 rounded-2xl border border-indigo-100">
                        <p className="text-[10px] font-black text-indigo-900 uppercase mb-2">Energy Stats</p>
                        <div className="flex justify-between text-[10px]">
                           <span className="text-indigo-700">Total Energy:</span>
                           <span className="font-black text-indigo-900">{energy} kJ</span>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ENTROPY RENDERER (Order vs Disorder) ---
   const EntropyRenderer = () => {
      const [isSimulating, setIsSimulating] = useState(false);
      const [particles, setParticles] = useState<{ x: number, y: number, vx: number, vy: number }[]>([]);
      const [entropy, setEntropy] = useState(0);

      const initParticles = () => {
         const initial = [];
         for (let i = 0; i < 100; i++) {
            initial.push({
               x: 10 + Math.random() * 80,
               y: 10 + Math.random() * 80,
               vx: (Math.random() - 0.5) * 4,
               vy: (Math.random() - 0.5) * 4
            });
         }
         setParticles(initial);
         setEntropy(0);
      };

      useEffect(() => {
         initParticles();
      }, []);

      useEffect(() => {
         let animationId: number;
         if (isSimulating) {
            const animate = () => {
               setParticles(prev => {
                  const next = prev.map(p => {
                     let { x, y, vx, vy } = p;
                     x += vx;
                     y += vy;
                     if (x < 0 || x > 390) vx *= -1;
                     if (y < 0 || y > 290) vy *= -1;
                     return { x, y, vx, vy };
                  });
                  const grid = Array(16).fill(0);
                  next.forEach(p => {
                     const col = Math.floor(p.x / 100);
                     const row = Math.floor(p.y / 75);
                     const idx = Math.min(15, row * 4 + col);
                     grid[idx]++;
                  });
                  let e = 0;
                  grid.forEach(count => {
                     if (count > 0) {
                        const p = count / 100;
                        e -= p * Math.log2(p);
                     }
                  });
                  setEntropy(e / 4);
                  return next;
               });
               animationId = requestAnimationFrame(animate);
            };
            animationId = requestAnimationFrame(animate);
         }
         return () => cancelAnimationFrame(animationId);
      }, [isSimulating]);

      const reset = () => {
         setIsSimulating(false);
         initParticles();
      };

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight">Entropy & Disorder</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">The Second Law of Thermodynamics</p>
               </div>
               <div className="flex items-center gap-4">
                  <div className="flex flex-col items-end">
                     <span className="text-[10px] font-bold text-slate-500 uppercase">Entropy Level</span>
                     <span className="text-xl font-black text-emerald-400">{(entropy * 100).toFixed(1)}%</span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-black flex items-center justify-center p-12 overflow-hidden">
                  <div className="relative w-[400px] h-[300px] border-2 border-slate-800 rounded-xl overflow-hidden bg-slate-900/30">
                     <div className="absolute inset-0 grid grid-cols-4 grid-rows-4 opacity-10 pointer-events-none">
                        {Array.from({ length: 16 }).map((_, i) => (
                           <div key={i} className="border border-slate-500" />
                        ))}
                     </div>
                     {particles.map((p, i) => (
                        <div
                           key={i}
                           className="absolute w-2 h-2 bg-indigo-500 rounded-full shadow-[0_0_8px_rgba(99,102,241,0.5)]"
                           style={{ left: `${p.x}px`, top: `${p.y}px` }}
                        />
                     ))}
                  </div>
                  <div className="absolute bottom-10 left-1/2 -translate-x-1/2 flex gap-4">
                     <button
                        onClick={() => setIsSimulating(!isSimulating)}
                        className={`px-12 py-4 rounded-2xl font-black text-sm transition-all uppercase tracking-widest shadow-2xl ${isSimulating ? 'bg-red-500/20 text-red-400 border border-red-500/50' : 'bg-white text-slate-950'}`}
                     >
                        {isSimulating ? 'PAUSE' : 'RELEASE PARTICLES'}
                     </button>
                     <button
                        onClick={reset}
                        className="px-12 py-4 bg-slate-800 text-slate-400 rounded-2xl font-black text-sm hover:bg-slate-700 transition-all uppercase tracking-widest"
                     >
                        RESET
                     </button>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">The Insight</p>
                     <h3 className="text-2xl font-black text-white">Arrow of Time</h3>
                     <p className="text-sm text-slate-400 leading-relaxed">
                        Entropy is a measure of <strong>disorder</strong> or the number of ways a system can be arranged.
                     </p>
                     <div className="p-6 bg-slate-800 rounded-3xl border border-slate-700">
                        <p className="text-xs leading-relaxed text-slate-300">
                           When particles are clumped in a corner, there are very few ways to arrange them (Low Entropy). As they spread out, the number of possible arrangements increases (High Entropy).
                        </p>
                     </div>
                  </div>
                  <div className="mt-auto p-4 bg-indigo-500/10 rounded-2xl border border-indigo-500/20">
                     <p className="text-[10px] font-black text-indigo-400 uppercase mb-2">Second Law</p>
                     <p className="text-[10px] text-slate-400 leading-relaxed">
                        In an isolated system, entropy never decreases. Systems naturally move from <strong>order</strong> to <strong>disorder</strong>.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- HEAT ENGINE RENDERER (PV Diagrams) ---
   const HeatEngineRenderer = () => {
      const [isPlaying, setIsPlaying] = useState(false);
      const [progress, setProgress] = useState(0);
      const [tempH, setTempH] = useState(500); // Kelvin
      const [tempL, setTempL] = useState(300); // Kelvin

      useEffect(() => {
         let animationId: number;
         if (isPlaying) {
            const animate = () => {
               setProgress(p => (p + 1) % 100);
               animationId = requestAnimationFrame(animate);
            };
            animationId = requestAnimationFrame(animate);
         }
         return () => cancelAnimationFrame(animationId);
      }, [isPlaying]);

      const getPV = (p: number) => {
         const vMin = 100;
         const vMax = 300;
         const gamma = 1.4;
         if (p < 25) {
            const t = p / 25;
            const v = vMin + t * 100;
            return { v, p: (tempH * 10) / v };
         } else if (p < 50) {
            const t = (p - 25) / 25;
            const vStart = 200;
            const v = vStart + t * (vMax - vStart);
            const pStart = (tempH * 10) / vStart;
            return { v, p: pStart * Math.pow(vStart / v, gamma) };
         } else if (p < 75) {
            const t = (p - 50) / 25;
            const vStart = vMax;
            const v = vStart - t * (vStart - 150);
            return { v, p: (tempL * 10) / v };
         } else {
            const t = (p - 75) / 25;
            const vStart = 150;
            const v = vStart - t * (vStart - vMin);
            const pStart = (tempL * 10) / vStart;
            return { v, p: pStart * Math.pow(vStart / v, gamma) };
         }
      };

      const current = getPV(progress);
      const efficiency = (1 - tempL / tempH) * 100;

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Heat Engine Cycle</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">PV Diagram & Efficiency</p>
               </div>
               <div className="flex items-center gap-6">
                  <div className="flex flex-col items-end">
                     <span className="text-[10px] font-bold text-slate-500 uppercase">Carnot Efficiency</span>
                     <span className="text-xl font-black text-emerald-600">{efficiency.toFixed(1)}%</span>
                  </div>
                  <button
                     onClick={() => setIsPlaying(!isPlaying)}
                     className={`px-8 py-3 rounded-xl font-black text-sm transition-all shadow-lg ${isPlaying ? 'bg-red-500 text-white' : 'bg-indigo-600 text-white'}`}
                  >
                     {isPlaying ? 'STOP ENGINE' : 'START ENGINE'}
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <svg viewBox="0 0 400 300" className="w-full h-full max-w-md">
                     <line x1="50" y1="250" x2="380" y2="250" stroke="#cbd5e1" strokeWidth="2" />
                     <line x1="50" y1="250" x2="50" y2="20" stroke="#cbd5e1" strokeWidth="2" />
                     <text x="380" y="265" textAnchor="end" className="text-[8px] font-bold fill-slate-400">VOLUME (V)</text>
                     <text x="45" y="30" textAnchor="end" className="text-[8px] font-bold fill-slate-400 rotate-90 origin-top-right">PRESSURE (P)</text>

                     <path
                        d={`M ${getPV(0).v},${250 - getPV(0).p} ${Array.from({ length: 101 }).map((_, i) => {
                           const pt = getPV(i);
                           return `L ${pt.v},${250 - pt.p}`;
                        }).join(' ')}`}
                        fill="#6366f1" fillOpacity="0.1" stroke="#6366f1" strokeWidth="2"
                     />
                     <circle cx={current.v} cy={250 - current.p} r="6" fill="#ef4444" className="transition-all duration-75" />
                     <text x="200" y="150" textAnchor="middle" className="text-[10px] font-black fill-indigo-600/40 uppercase">Work Done (W)</text>
                  </svg>

                  <div className="absolute left-10 bottom-10 w-32 h-48 border-2 border-slate-200 rounded-xl bg-slate-50 overflow-hidden">
                     <div className="absolute bottom-0 w-full bg-indigo-500/20 transition-all duration-75" style={{ height: `${(current.v / 300) * 100}%` }} />
                     <div className="absolute w-full h-4 bg-slate-800 transition-all duration-75" style={{ bottom: `${(current.v / 300) * 100}%` }} />
                     <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <span className="text-[8px] font-black text-slate-400 uppercase">Cylinder</span>
                     </div>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  <div className="space-y-6">
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-red-500 uppercase">Hot Reservoir (TH)</span>
                           <span className="text-slate-900">{tempH} K</span>
                        </div>
                        <input
                           type="range" min="400" max="800" value={tempH}
                           onChange={(e) => setTempH(parseInt(e.target.value))}
                           className="w-full accent-red-500"
                        />
                     </div>
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-blue-500 uppercase">Cold Reservoir (TL)</span>
                           <span className="text-slate-900">{tempL} K</span>
                        </div>
                        <input
                           type="range" min="200" max="350" value={tempL}
                           onChange={(e) => setTempL(parseInt(e.target.value))}
                           className="w-full accent-blue-500"
                        />
                     </div>
                  </div>

                  <div className="p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        A heat engine works by taking heat from a hot source, converting some of it into <strong>Work</strong>, and exhausting the rest to a cold sink.
                     </p>
                  </div>

                  <div className="mt-auto p-4 bg-emerald-50 rounded-2xl border border-emerald-100">
                     <p className="text-[10px] font-black text-emerald-900 uppercase mb-2">Efficiency Rule</p>
                     <p className="text-[10px] text-emerald-700 leading-relaxed">
                        To increase efficiency, you must either increase the temperature of the hot source or decrease the temperature of the cold sink.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- LIGHT TRANSMISSION RENDERER ---
   const LightTransmissionRenderer = () => {
      const [material, setMaterial] = useState<'glass' | 'tinted' | 'metal'>('glass');
      const [thickness, setThickness] = useState(1); // 1-10
      const [wavelength, setWavelength] = useState(550); // nm (Visible range)

      const materials = {
         glass: { name: 'Clear Glass', transmission: 0.95, absorption: 0.02, reflection: 0.03, color: 'bg-blue-100/30' },
         tinted: { name: 'Tinted Glass', transmission: 0.4, absorption: 0.5, reflection: 0.1, color: 'bg-slate-800/60' },
         metal: { name: 'Polished Metal', transmission: 0, absorption: 0.1, reflection: 0.9, color: 'bg-slate-300' }
      };

      const current = materials[material];

      // Beer-Lambert Law approximation
      const effectiveTransmission = material === 'metal' ? 0 : Math.pow(current.transmission, thickness);
      const effectiveAbsorption = material === 'metal' ? 0.1 : (1 - effectiveTransmission - current.reflection);
      const effectiveReflection = current.reflection;

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight text-white">Light Transmission</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Transmission vs. Absorption vs. Reflection</p>
               </div>
               <div className="flex gap-2">
                  {(['glass', 'tinted', 'metal'] as const).map(m => (
                     <button
                        key={m}
                        onClick={() => setMaterial(m)}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${material === m ? 'bg-white text-slate-950' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                     >
                        {m}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-black flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <svg viewBox="0 0 600 400" className="w-full h-full max-w-2xl">
                     {/* Light Source */}
                     <rect x="20" y="180" width="40" height="40" rx="4" fill="#fbbf24" />
                     <path d="M 60,200 L 250,200" stroke="#fbbf24" strokeWidth="4" strokeDasharray="8 4" className="animate-[dash_2s_linear_infinite]" />

                     {/* Material Sample */}
                     <rect
                        x="250" y={200 - 50}
                        width={thickness * 10} height="100"
                        className={`${current.color} transition-all duration-500`}
                        stroke="rgba(255,255,255,0.2)"
                     />

                     {/* Transmitted Light */}
                     {effectiveTransmission > 0 && (
                        <path
                           d={`M ${250 + thickness * 10},200 L 550,200`}
                           stroke="#fbbf24"
                           strokeWidth={4 * effectiveTransmission}
                           opacity={effectiveTransmission}
                           strokeDasharray="8 4"
                           className="animate-[dash_2s_linear_infinite]"
                        />
                     )}

                     {/* Reflected Light */}
                     {effectiveReflection > 0 && (
                        <path
                           d="M 250,200 L 100,100"
                           stroke="#fbbf24"
                           strokeWidth={4 * effectiveReflection}
                           opacity={effectiveReflection}
                           strokeDasharray="8 4"
                           className="animate-[dash_2s_linear_infinite]"
                        />
                     )}

                     {/* Labels */}
                     <text x="40" y="170" className="text-[10px] font-black fill-amber-400 uppercase">Source</text>
                     <text x="300" y="320" textAnchor="middle" className="text-[10px] font-black fill-slate-500 uppercase">Material Sample</text>
                     <text x="500" y="190" textAnchor="middle" className="text-[10px] font-black fill-amber-400 uppercase">Transmitted</text>
                  </svg>

                  <style>{`
                     @keyframes dash {
                        to { stroke-dashoffset: -12; }
                     }
                  `}</style>
               </div>

               <div className="w-full lg:w-96 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-8">
                  <div className="space-y-6">
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500 uppercase">Thickness</span>
                           <span className="text-white">{thickness} units</span>
                        </div>
                        <input
                           type="range" min="1" max="10" step="1" value={thickness}
                           onChange={(e) => setThickness(parseInt(e.target.value))}
                           className="w-full accent-white"
                        />
                     </div>

                     <div className="p-6 bg-black/40 rounded-3xl border border-slate-800 space-y-4">
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Energy Distribution</p>
                        <div className="space-y-3">
                           <div className="space-y-1">
                              <div className="flex justify-between text-[10px] font-bold">
                                 <span>Transmission</span>
                                 <span className="text-emerald-400">{Math.round(effectiveTransmission * 100)}%</span>
                              </div>
                              <div className="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                 <div className="h-full bg-emerald-500 transition-all duration-500" style={{ width: `${effectiveTransmission * 100}%` }} />
                              </div>
                           </div>
                           <div className="space-y-1">
                              <div className="flex justify-between text-[10px] font-bold">
                                 <span>Absorption</span>
                                 <span className="text-red-400">{Math.round(effectiveAbsorption * 100)}%</span>
                              </div>
                              <div className="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                 <div className="h-full bg-red-500 transition-all duration-500" style={{ width: `${effectiveAbsorption * 100}%` }} />
                              </div>
                           </div>
                           <div className="space-y-1">
                              <div className="flex justify-between text-[10px] font-bold">
                                 <span>Reflection</span>
                                 <span className="text-blue-400">{Math.round(effectiveReflection * 100)}%</span>
                              </div>
                              <div className="h-1.5 bg-slate-800 rounded-full overflow-hidden">
                                 <div className="h-full bg-blue-500 transition-all duration-500" style={{ width: `${effectiveReflection * 100}%` }} />
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>

                  <div className="mt-auto p-6 bg-slate-800 rounded-3xl">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        {material === 'metal'
                           ? "Metals are opaque because their free electrons reflect most light energy."
                           : "As thickness increases, transmission decreases exponentially as more photons are absorbed or scattered."}
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- LIGHT ABSORPTION RENDERER ---
   const LightAbsorptionRenderer = () => {
      const [objectColor, setObjectColor] = useState<'red' | 'green' | 'blue' | 'black' | 'white'>('red');
      const [lightColor, setLightColor] = useState<'white' | 'red' | 'green' | 'blue'>('white');
      const [isShining, setIsShining] = useState(false);
      const [temp, setTemp] = useState(20);

      const colors = {
         red: { hex: '#ef4444', absorbs: ['green', 'blue'] },
         green: { hex: '#10b981', absorbs: ['red', 'blue'] },
         blue: { hex: '#3b82f6', absorbs: ['red', 'green'] },
         black: { hex: '#18181b', absorbs: ['red', 'green', 'blue'] },
         white: { hex: '#ffffff', absorbs: [] }
      };

      const lightHex = {
         white: '#ffffff',
         red: '#ef4444',
         green: '#10b981',
         blue: '#3b82f6'
      };

      useEffect(() => {
         let interval: any;
         if (isShining) {
            interval = setInterval(() => {
               setTemp(prev => {
                  let absorptionRate = 0;
                  if (lightColor === 'white') {
                     absorptionRate = colors[objectColor].absorbs.length * 0.1;
                     if (objectColor === 'black') absorptionRate = 0.5;
                  } else {
                     const isAbsorbed = colors[objectColor].absorbs.includes(lightColor);
                     absorptionRate = isAbsorbed ? 0.3 : 0.05;
                  }
                  return Math.min(100, prev + absorptionRate);
               });
            }, 100);
         }
         return () => clearInterval(interval);
      }, [isShining, objectColor, lightColor]);

      const reflectedColor = () => {
         if (!isShining) return 'transparent';
         if (lightColor === 'white') return colors[objectColor].hex;
         const isAbsorbed = colors[objectColor].absorbs.includes(lightColor);
         return isAbsorbed ? '#111' : lightHex[lightColor];
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Light Absorption & Color</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Energy Conversion & Perception</p>
               </div>
               <div className="flex gap-4">
                  <div className="flex flex-col items-end">
                     <span className="text-[10px] font-bold text-slate-400 uppercase">Surface Temp</span>
                     <span className="text-xl font-black text-red-600">{temp.toFixed(1)}¬∞C</span>
                  </div>
                  <button
                     onMouseDown={() => setIsShining(true)}
                     onMouseUp={() => setIsShining(false)}
                     onMouseLeave={() => setIsShining(false)}
                     className={`px-8 py-3 rounded-xl font-black text-sm transition-all shadow-lg ${isShining ? 'bg-amber-500 text-white scale-95' : 'bg-slate-900 text-white'}`}
                  >
                     SHINE LIGHT
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="relative flex flex-col items-center gap-12">
                     {/* Light Source */}
                     <div className="flex flex-col items-center gap-4">
                        <div className="flex gap-2">
                           {(['white', 'red', 'green', 'blue'] as const).map(c => (
                              <button
                                 key={c}
                                 onClick={() => setLightColor(c)}
                                 className={`w-8 h-8 rounded-full border-2 transition-all ${lightColor === c ? 'border-slate-900 scale-110 shadow-lg' : 'border-transparent opacity-50'}`}
                                 style={{ backgroundColor: lightHex[c] }}
                              />
                           ))}
                        </div>
                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Light Color</p>
                     </div>

                     <div className="relative">
                        {/* Incoming Light Beam */}
                        {isShining && (
                           <div
                              className="absolute -top-32 left-1/2 -translate-x-1/2 w-8 h-32 blur-sm opacity-40 transition-all duration-300"
                              style={{
                                 background: `linear-gradient(to bottom, transparent, ${lightHex[lightColor]})`,
                                 clipPath: 'polygon(20% 0%, 80% 0%, 100% 100%, 0% 100%)'
                              }}
                           />
                        )}

                        {/* Object */}
                        <div className="flex flex-col items-center gap-4">
                           <div
                              className="w-48 h-48 rounded-3xl shadow-2xl transition-all duration-500 border-4 border-white relative overflow-hidden"
                              style={{ backgroundColor: colors[objectColor].hex }}
                           >
                              {/* Heat Glow */}
                              <div
                                 className="absolute inset-0 bg-red-500 transition-opacity duration-1000"
                                 style={{ opacity: (temp - 20) / 160 }}
                              />
                           </div>
                           <div className="flex gap-2">
                              {(['red', 'green', 'blue', 'black', 'white'] as const).map(c => (
                                 <button
                                    key={c}
                                    onClick={() => { setObjectColor(c); setTemp(20); }}
                                    className={`w-6 h-6 rounded-full border-2 transition-all ${objectColor === c ? 'border-slate-900 scale-110' : 'border-transparent opacity-50'}`}
                                    style={{ backgroundColor: colors[c].hex }}
                                 />
                              ))}
                           </div>
                           <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Object Color</p>
                        </div>

                        {/* Reflected Light */}
                        {isShining && (
                           <div
                              className="absolute -top-24 -right-24 w-6 h-24 blur-md opacity-30 transition-all duration-300"
                              style={{
                                 background: `linear-gradient(to top, transparent, ${reflectedColor()})`,
                                 transform: 'rotate(45deg)'
                              }}
                           />
                        )}
                     </div>
                  </div>
               </div>

               <div className="w-full lg:w-96 bg-slate-50 border-l border-slate-200 p-8 flex flex-col gap-8">
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">The Mechanism</p>
                     <h3 className="text-2xl font-black text-slate-900">Why is it {objectColor}?</h3>
                     <p className="text-sm text-slate-600 leading-relaxed">
                        {objectColor === 'black'
                           ? "Black objects absorb almost all visible light, converting the energy into heat. This is why black clothes feel hotter in the sun!"
                           : objectColor === 'white'
                              ? "White objects reflect most visible light, absorbing very little energy and staying cooler."
                              : `A ${objectColor} object reflects ${objectColor} light and absorbs other colors like ${colors[objectColor].absorbs.join(' and ')}.`}
                     </p>
                  </div>

                  <div className="p-6 bg-slate-900 rounded-3xl text-white">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">Energy Transformation</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        When light is <strong>absorbed</strong>, its electromagnetic energy is converted into <strong>thermal energy</strong> (vibrating molecules), which increases the object's temperature.
                     </p>
                  </div>

                  <div className="mt-auto space-y-4">
                     <div className="p-4 bg-amber-50 rounded-2xl border border-amber-100">
                        <p className="text-[10px] font-black text-amber-900 uppercase mb-2">Key Concept</p>
                        <p className="text-[10px] text-amber-700 leading-relaxed">
                           The color we see is the light that was <strong>NOT</strong> absorbed by the object.
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- DIGITAL SIGNAL RENDERER ---
   const DigitalSignalRenderer = () => {
      const [sampleRate, setSampleRate] = useState(10); // 2-40
      const [bitDepth, setBitDepth] = useState(4); // 1-8
      const [freq, setFreq] = useState(1); // Hz
      const [showAnalog, setShowAnalog] = useState(true);
      const [showDigital, setShowDigital] = useState(true);

      const width = 600;
      const height = 300;
      const padding = 40;

      // Generate analog wave points
      const analogPoints = Array.from({ length: 200 }, (_, i) => {
         const x = (i / 199) * (width - 2 * padding) + padding;
         const t = (i / 199) * 2 * Math.PI * freq;
         const y = Math.sin(t) * (height / 2 - padding) + height / 2;
         return { x, y };
      });

      // Generate digital samples
      const numSamples = sampleRate;
      const quantizationLevels = Math.pow(2, bitDepth);
      const digitalPoints = Array.from({ length: numSamples }, (_, i) => {
         const x = (i / (numSamples - 1)) * (width - 2 * padding) + padding;
         const t = (i / (numSamples - 1)) * 2 * Math.PI * freq;
         const rawY = Math.sin(t);

         // Quantize
         const level = Math.round(((rawY + 1) / 2) * (quantizationLevels - 1));
         const quantizedY = (level / (quantizationLevels - 1)) * 2 - 1;
         const y = quantizedY * (height / 2 - padding) + height / 2;

         return { x, y, level };
      });

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight text-white uppercase">Analog to Digital</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Sampling & Quantization</p>
               </div>
               <div className="flex gap-4">
                  <div className="flex items-center gap-2">
                     <input type="checkbox" checked={showAnalog} onChange={() => setShowAnalog(!showAnalog)} className="accent-blue-500" />
                     <span className="text-[10px] font-bold uppercase text-slate-400">Analog</span>
                  </div>
                  <div className="flex items-center gap-2">
                     <input type="checkbox" checked={showDigital} onChange={() => setShowDigital(!showDigital)} className="accent-emerald-500" />
                     <span className="text-[10px] font-bold uppercase text-slate-400">Digital</span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative bg-black flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full max-w-2xl overflow-visible">
                     {/* Grid Lines for Quantization */}
                     {Array.from({ length: quantizationLevels }).map((_, i) => {
                        const y = (i / (quantizationLevels - 1)) * (height - 2 * padding) + padding;
                        return (
                           <line key={i} x1={padding} y1={y} x2={width - padding} y2={y} stroke="rgba(255,255,255,0.05)" strokeWidth="1" />
                        );
                     })}

                     {/* Analog Wave */}
                     {showAnalog && (
                        <path
                           d={`M ${analogPoints.map(p => `${p.x},${p.y}`).join(' L ')}`}
                           fill="none"
                           stroke="#3b82f6"
                           strokeWidth="2"
                           className="opacity-50"
                        />
                     )}

                     {/* Digital Staircase */}
                     {showDigital && (
                        <path
                           d={`M ${digitalPoints.map((p, i) => {
                              const next = digitalPoints[i + 1];
                              if (!next) return `${p.x},${p.y}`;
                              return `${p.x},${p.y} L ${next.x},${p.y}`;
                           }).join(' L ')}`}
                           fill="none"
                           stroke="#10b981"
                           strokeWidth="3"
                           strokeLinecap="round"
                        />
                     )}

                     {/* Sample Points */}
                     {showDigital && digitalPoints.map((p, i) => (
                        <circle key={i} cx={p.x} cy={p.y} r="4" fill="#10b981" />
                     ))}

                     {/* Axes */}
                     <line x1={padding} y1={height / 2} x2={width - padding} y2={height / 2} stroke="white" strokeWidth="1" opacity="0.2" />
                     <line x1={padding} y1={padding} x2={padding} y2={height - padding} stroke="white" strokeWidth="1" opacity="0.2" />
                  </svg>
               </div>

               <div className="w-full lg:w-96 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-8">
                  <div className="space-y-6">
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500 uppercase">Sample Rate</span>
                           <span className="text-emerald-400">{sampleRate} Hz</span>
                        </div>
                        <input
                           type="range" min="2" max="40" step="1" value={sampleRate}
                           onChange={(e) => setSampleRate(parseInt(e.target.value))}
                           className="w-full accent-emerald-500"
                        />
                        <p className="text-[8px] text-slate-500 italic">How often we take a "snapshot" of the wave.</p>
                     </div>

                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold">
                           <span className="text-slate-500 uppercase">Bit Depth</span>
                           <span className="text-blue-400">{bitDepth} bits ({quantizationLevels} levels)</span>
                        </div>
                        <input
                           type="range" min="1" max="8" step="1" value={bitDepth}
                           onChange={(e) => setBitDepth(parseInt(e.target.value))}
                           className="w-full accent-blue-500"
                        />
                        <p className="text-[8px] text-slate-500 italic">Precision of each snapshot (rounding to nearest level).</p>
                     </div>
                  </div>

                  <div className="p-6 bg-black/40 rounded-3xl border border-slate-800 space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Digital Error (Aliasing)</p>
                     <div className="space-y-2">
                        <p className="text-xs text-slate-400 leading-relaxed">
                           {sampleRate < freq * 4
                              ? "‚ö†Ô∏è Warning: Sample rate is too low! The digital signal is losing the true shape of the wave (Aliasing)."
                              : "The digital signal is a good approximation of the analog wave."}
                        </p>
                     </div>
                  </div>

                  <div className="mt-auto p-6 bg-slate-800 rounded-3xl">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300">
                        Digital signals are <strong>discrete</strong> approximations. Higher sample rates and bit depths create more accurate "high-fidelity" representations but require more data storage.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };
   // --- WAVE EQUATION RENDERER ---
   const WaveEquationRenderer = () => {
      const [freq, setFreq] = useState(2);
      const [wavelength, setWavelength] = useState(100);
      const [locked, setLocked] = useState<'v' | 'f' | 'l' | null>(null);
      const [medium, setMedium] = useState('custom');
      const [time, setTime] = useState(0);

      const speed = freq * wavelength;

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.05), 30);
         return () => clearInterval(interval);
      }, []);

      const mediums = [
         { id: 'custom', name: 'Custom', speed: speed },
         { id: 'air', name: 'Air (Sound)', speed: 343 },
         { id: 'water', name: 'Water (Sound)', speed: 1480 },
         { id: 'steel', name: 'Steel (Sound)', speed: 5960 },
         { id: 'vacuum', name: 'Vacuum (Light)', speed: 300000000 },
      ];

      const handleMediumChange = (m: string) => {
         setMedium(m);
         if (m !== 'custom') {
            const targetSpeed = mediums.find(x => x.id === m)?.speed || 343;
            // Adjust wavelength to keep frequency constant
            setWavelength(targetSpeed / freq);
         }
      };

      const updateFreq = (f: number) => {
         setFreq(f);
         if (locked === 'v') {
            setWavelength(speed / f);
         }
      };

      const updateWavelength = (l: number) => {
         setWavelength(l);
         if (locked === 'v') {
            setFreq(speed / l);
         }
      };

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-indigo-400">WAVE EQUATION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">v = f √ó Œª</p>
               </div>
               <div className="flex gap-2">
                  {mediums.map(m => (
                     <button
                        key={m.id}
                        onClick={() => handleMediumChange(m.id)}
                        className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all ${medium === m.id ? 'bg-indigo-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                     >
                        {m.name}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="100%" height="200" className="overflow-visible">
                     <defs>
                        <linearGradient id="waveGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                           <stop offset="0%" stopColor="#6366f1" />
                           <stop offset="100%" stopColor="#a855f7" />
                        </linearGradient>
                     </defs>
                     {/* Axis */}
                     <line x1="0" y1="100" x2="100%" y2="100%" stroke="#1e293b" strokeWidth="2" strokeDasharray="4 4" />

                     {/* Wave Path */}
                     <path
                        d={Array.from({ length: 100 }, (_, i) => {
                           const x = (i / 100) * 800;
                           const y = 100 + Math.sin((x / (wavelength / 10)) - time * freq * 2) * 40;
                           return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                        }).join(' ')}
                        fill="none"
                        stroke="url(#waveGrad)"
                        strokeWidth="4"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                     />

                     {/* Wavelength Marker */}
                     <g transform={`translate(100, 160)`}>
                        <line x1="0" y1="0" x2={wavelength / 2} y2="0" stroke="#fbbf24" strokeWidth="2" />
                        <line x1="0" y1="-5" x2="0" y2="5" stroke="#fbbf24" strokeWidth="2" />
                        <line x1={wavelength / 2} y1="-5" x2={wavelength / 2} y2="5" stroke="#fbbf24" strokeWidth="2" />
                        <text x={wavelength / 4} y="15" textAnchor="middle" fill="#fbbf24" className="text-[10px] font-bold">Œª = {wavelength.toFixed(1)}m</text>
                     </g>
                  </svg>

                  {/* Speed Indicator */}
                  <div className="absolute top-8 right-8 bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Wave Speed (v)</p>
                     <p className="text-2xl font-black text-white tabular-nums">
                        {speed > 1000000 ? (speed / 1000000).toFixed(1) + 'M' : speed.toFixed(1)} <span className="text-xs text-slate-500">m/s</span>
                     </p>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-6 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  {/* Frequency Control */}
                  <div className="space-y-3">
                     <div className="flex justify-between items-center">
                        <label className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Frequency (f)</label>
                        <button
                           onClick={() => setLocked(locked === 'f' ? null : 'f')}
                           className={`p-1 rounded transition-colors ${locked === 'f' ? 'text-indigo-400' : 'text-slate-600 hover:text-slate-400'}`}
                        >
                           <i className={`fa-solid ${locked === 'f' ? 'fa-lock' : 'fa-lock-open'}`}></i>
                        </button>
                     </div>
                     <input
                        type="range"
                        min="0.5"
                        max="10"
                        step="0.1"
                        value={freq}
                        onChange={(e) => updateFreq(parseFloat(e.target.value))}
                        disabled={locked === 'f'}
                        className="w-full accent-indigo-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0.5 Hz</span>
                        <span className="text-white bg-indigo-500/20 px-2 py-0.5 rounded">{freq.toFixed(1)} Hz</span>
                        <span>10 Hz</span>
                     </div>
                  </div>

                  {/* Wavelength Control */}
                  <div className="space-y-3">
                     <div className="flex justify-between items-center">
                        <label className="text-[10px] font-black text-amber-400 uppercase tracking-widest">Wavelength (Œª)</label>
                        <button
                           onClick={() => setLocked(locked === 'l' ? null : 'l')}
                           className={`p-1 rounded transition-colors ${locked === 'l' ? 'text-amber-400' : 'text-slate-600 hover:text-slate-400'}`}
                        >
                           <i className={`fa-solid ${locked === 'l' ? 'fa-lock' : 'fa-lock-open'}`}></i>
                        </button>
                     </div>
                     <input
                        type="range"
                        min="10"
                        max="500"
                        step="1"
                        value={wavelength}
                        onChange={(e) => updateWavelength(parseFloat(e.target.value))}
                        disabled={locked === 'l'}
                        className="w-full accent-amber-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>10 m</span>
                        <span className="text-white bg-amber-500/20 px-2 py-0.5 rounded">{wavelength.toFixed(1)} m</span>
                        <span>500 m</span>
                     </div>
                  </div>

                  {/* Lock Speed Toggle */}
                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <div className="flex items-center justify-between mb-2">
                        <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Lock Speed (v)</span>
                        <button
                           onClick={() => setLocked(locked === 'v' ? null : 'v')}
                           className={`w-10 h-5 rounded-full relative transition-colors ${locked === 'v' ? 'bg-indigo-500' : 'bg-slate-700'}`}
                        >
                           <div className={`absolute top-1 w-3 h-3 bg-white rounded-full transition-all ${locked === 'v' ? 'left-6' : 'left-1'}`} />
                        </button>
                     </div>
                     <p className="text-[10px] text-slate-500 leading-tight">
                        When locked, changing frequency will automatically adjust wavelength to maintain the same wave speed.
                     </p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-indigo-500/10 rounded-3xl border border-indigo-500/20">
                     <p className="text-[10px] font-bold text-indigo-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Wave speed is a property of the <strong>medium</strong>. If the medium doesn't change, increasing frequency must decrease wavelength.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- SUPERPOSITION RENDERER ---
   const SuperpositionRenderer = () => {
      const [wave1, setWave1] = useState({ amp: 40, freq: 2, phase: 0 });
      const [wave2, setWave2] = useState({ amp: 40, freq: 2, phase: Math.PI });
      const [showIndividual, setShowIndividual] = useState(true);
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.05), 30);
         return () => clearInterval(interval);
      }, []);

      const getWaveY = (x: number, w: { amp: number, freq: number, phase: number }) => {
         return Math.sin((x / 20) - time * w.freq + w.phase) * w.amp;
      };

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-cyan-400">WAVE SUPERPOSITION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Principle of Superposition</p>
               </div>
               <div className="flex gap-4">
                  <button
                     onClick={() => setShowIndividual(!showIndividual)}
                     className={`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${showIndividual ? 'bg-cyan-500/20 border-cyan-500 text-cyan-400' : 'bg-slate-800 border-slate-700 text-slate-400'}`}
                  >
                     {showIndividual ? 'Hide Components' : 'Show Components'}
                  </button>
                  <button
                     onClick={() => setWave2({ ...wave2, phase: wave2.phase === 0 ? Math.PI : 0 })}
                     className="px-4 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-indigo-500/20 transition-all active:scale-95"
                  >
                     Toggle Phase (180¬∞)
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="100%" height="300" className="overflow-visible">
                     {/* Grid Lines */}
                     <line x1="0" y1="150" x2="100%" y2="150%" stroke="#1e293b" strokeWidth="1" strokeDasharray="4 4" />

                     {showIndividual && (
                        <>
                           {/* Wave 1 */}
                           <path
                              d={Array.from({ length: 100 }, (_, i) => {
                                 const x = (i / 100) * 800;
                                 const y = 150 + getWaveY(x, wave1);
                                 return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                              }).join(' ')}
                              fill="none"
                              stroke="#6366f1"
                              strokeWidth="2"
                              strokeOpacity="0.4"
                           />
                           {/* Wave 2 */}
                           <path
                              d={Array.from({ length: 100 }, (_, i) => {
                                 const x = (i / 100) * 800;
                                 const y = 150 + getWaveY(x, wave2);
                                 return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                              }).join(' ')}
                              fill="none"
                              stroke="#ec4899"
                              strokeWidth="2"
                              strokeOpacity="0.4"
                           />
                        </>
                     )}

                     {/* Resultant Wave */}
                     <path
                        d={Array.from({ length: 100 }, (_, i) => {
                           const x = (i / 100) * 800;
                           const y = 150 + getWaveY(x, wave1) + getWaveY(x, wave2);
                           return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                        }).join(' ')}
                        fill="none"
                        stroke="#22d3ee"
                        strokeWidth="5"
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        className="drop-shadow-[0_0_8px_rgba(34,211,238,0.5)]"
                     />
                  </svg>

                  {/* Interference Label */}
                  <div className="absolute top-8 left-8">
                     <div className="flex items-center gap-3">
                        <div className={`w-3 h-3 rounded-full ${Math.abs(wave1.phase - wave2.phase) < 0.1 ? 'bg-green-500 animate-pulse' : 'bg-red-500'}`} />
                        <span className="text-sm font-black tracking-widest uppercase">
                           {Math.abs(wave1.phase - wave2.phase) < 0.1 ? 'Constructive' : 'Destructive'} Interference
                        </span>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  {/* Wave 1 Controls */}
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Wave A (Indigo)</p>
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold text-slate-500">
                           <span>Amplitude</span>
                           <span className="text-white">{wave1.amp}</span>
                        </div>
                        <input
                           type="range"
                           min="0"
                           max="80"
                           value={wave1.amp}
                           onChange={(e) => setWave1({ ...wave1, amp: parseInt(e.target.value) })}
                           className="w-full accent-indigo-500"
                        />
                     </div>
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold text-slate-500">
                           <span>Frequency</span>
                           <span className="text-white">{wave1.freq.toFixed(1)}</span>
                        </div>
                        <input
                           type="range"
                           min="0.5"
                           max="5"
                           step="0.1"
                           value={wave1.freq}
                           onChange={(e) => setWave1({ ...wave1, freq: parseFloat(e.target.value) })}
                           className="w-full accent-indigo-500"
                        />
                     </div>
                  </div>

                  {/* Wave 2 Controls */}
                  <div className="space-y-4">
                     <p className="text-[10px] font-black text-pink-400 uppercase tracking-widest">Wave B (Pink)</p>
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold text-slate-500">
                           <span>Amplitude</span>
                           <span className="text-white">{wave2.amp}</span>
                        </div>
                        <input
                           type="range"
                           min="0"
                           max="80"
                           value={wave2.amp}
                           onChange={(e) => setWave2({ ...wave2, amp: parseInt(e.target.value) })}
                           className="w-full accent-pink-500"
                        />
                     </div>
                     <div className="space-y-2">
                        <div className="flex justify-between text-[10px] font-bold text-slate-500">
                           <span>Phase Shift</span>
                           <span className="text-white">{(wave2.phase * 180 / Math.PI).toFixed(0)}¬∞</span>
                        </div>
                        <input
                           type="range"
                           min="0"
                           max={Math.PI * 2}
                           step="0.1"
                           value={wave2.phase}
                           onChange={(e) => setWave2({ ...wave2, phase: parseFloat(e.target.value) })}
                           className="w-full accent-pink-500"
                        />
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-cyan-500/10 rounded-3xl border border-cyan-500/20">
                     <p className="text-[10px] font-bold text-cyan-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Waves don't bounce off each other. They <strong>pass through</strong>, and at every point, the total displacement is simply the sum of the individual waves.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- 2D WAVE INTERFERENCE RENDERER ---
   const WaveInterference2DRenderer = () => {
      const [sourceDist, setSourceDist] = useState(100);
      const [wavelength, setWavelength] = useState(40);
      const [showPathDiff, setShowPathDiff] = useState(false);
      const [probePos, setProbePos] = useState({ x: 400, y: 150 });
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.1), 30);
         return () => clearInterval(interval);
      }, []);

      const s1 = { x: 400 - sourceDist / 2, y: 50 };
      const s2 = { x: 400 + sourceDist / 2, y: 50 };

      const d1 = Math.sqrt(Math.pow(probePos.x - s1.x, 2) + Math.pow(probePos.y - s1.y, 2));
      const d2 = Math.sqrt(Math.pow(probePos.x - s2.x, 2) + Math.pow(probePos.y - s2.y, 2));
      const pathDiff = Math.abs(d1 - d2);
      const phaseDiff = (pathDiff / wavelength) * 2 * Math.PI;

      const interference = Math.cos(phaseDiff / 2); // Amplitude factor

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-400">2D INTERFERENCE</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Two-Source Interference Pattern</p>
               </div>
               <button
                  onClick={() => setShowPathDiff(!showPathDiff)}
                  className={`px-4 py-2 rounded-xl text-xs font-bold transition-all border ${showPathDiff ? 'bg-emerald-500/20 border-emerald-500 text-emerald-400' : 'bg-slate-800 border-slate-700 text-slate-400'}`}
               >
                  {showPathDiff ? 'Hide Analysis' : 'Show Path Difference'}
               </button>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 overflow-hidden border-r border-slate-900 cursor-crosshair"
                  onMouseMove={(e) => {
                     const rect = e.currentTarget.getBoundingClientRect();
                     setProbePos({ x: e.clientX - rect.left, y: e.clientY - rect.top });
                  }}
               >
                  <svg width="100%" height="100%" className="absolute inset-0">
                     <defs>
                        <radialGradient id="ripple1">
                           <stop offset="0%" stopColor="#10b981" stopOpacity="0.6" />
                           <stop offset="100%" stopColor="#10b981" stopOpacity="0" />
                        </radialGradient>
                     </defs>

                     {/* Sources */}
                     <circle cx={s1.x} cy={s1.y} r="6" fill="#10b981" className="animate-pulse" />
                     <circle cx={s2.x} cy={s2.y} r="6" fill="#10b981" className="animate-pulse" />

                     {/* Ripple Visualization (Simplified with concentric circles) */}
                     {[1, 2, 3, 4, 5].map(i => (
                        <React.Fragment key={i}>
                           <circle
                              cx={s1.x}
                              cy={s1.y}
                              r={((time * 20 + i * wavelength) % 400)}
                              fill="none"
                              stroke="#10b981"
                              strokeWidth="2"
                              strokeOpacity={Math.max(0, 1 - ((time * 20 + i * wavelength) % 400) / 400)}
                           />
                           <circle
                              cx={s2.x}
                              cy={s2.y}
                              r={((time * 20 + i * wavelength) % 400)}
                              fill="none"
                              stroke="#10b981"
                              strokeWidth="2"
                              strokeOpacity={Math.max(0, 1 - ((time * 20 + i * wavelength) % 400) / 400)}
                           />
                        </React.Fragment>
                     ))}

                     {/* Probe Lines */}
                     {showPathDiff && (
                        <>
                           <line x1={s1.x} y1={s1.y} x2={probePos.x} y2={probePos.y} stroke="#64748b" strokeWidth="1" strokeDasharray="4 4" />
                           <line x1={s2.x} y1={s2.y} x2={probePos.x} y2={probePos.y} stroke="#64748b" strokeWidth="1" strokeDasharray="4 4" />
                           <circle cx={probePos.x} cy={probePos.y} r="10" fill={Math.abs(interference) > 0.7 ? '#10b981' : '#ef4444'} fillOpacity="0.3" stroke={Math.abs(interference) > 0.7 ? '#10b981' : '#ef4444'} strokeWidth="2" />
                        </>
                     )}
                  </svg>

                  {/* Probe Info Overlay */}
                  <div className="absolute bottom-8 left-8 bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl space-y-2">
                     <div className="flex justify-between gap-8">
                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Path Diff (Œîd)</span>
                        <span className="text-xs font-bold text-white">{pathDiff.toFixed(1)} px</span>
                     </div>
                     <div className="flex justify-between gap-8">
                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">In Wavelengths</span>
                        <span className="text-xs font-bold text-emerald-400">{(pathDiff / wavelength).toFixed(2)} Œª</span>
                     </div>
                     <div className="pt-2 border-t border-slate-800">
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Interference</p>
                        <p className={`text-sm font-black ${(pathDiff / wavelength) % 1 < 0.1 || (pathDiff / wavelength) % 1 > 0.9 ? 'text-emerald-400' : Math.abs((pathDiff / wavelength) % 1 - 0.5) < 0.1 ? 'text-red-400' : 'text-white'}`}>
                           {(pathDiff / wavelength) % 1 < 0.1 || (pathDiff / wavelength) % 1 > 0.9 ? 'CONSTRUCTIVE' : Math.abs((pathDiff / wavelength) % 1 - 0.5) < 0.1 ? 'DESTRUCTIVE' : 'INTERMEDIATE'}
                        </p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Source Separation</label>
                     <input
                        type="range"
                        min="20"
                        max="300"
                        value={sourceDist}
                        onChange={(e) => setSourceDist(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Narrow</span>
                        <span className="text-white bg-emerald-500/20 px-2 py-0.5 rounded">{sourceDist} px</span>
                        <span>Wide</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Wavelength (Œª)</label>
                     <input
                        type="range"
                        min="10"
                        max="100"
                        value={wavelength}
                        onChange={(e) => setWavelength(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Short</span>
                        <span className="text-white bg-emerald-500/20 px-2 py-0.5 rounded">{wavelength} px</span>
                        <span>Long</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-emerald-500/10 rounded-3xl border border-emerald-500/20">
                     <p className="text-[10px] font-bold text-emerald-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Interference depends on the <strong>Path Difference</strong>. If the difference is a whole number of wavelengths (1Œª, 2Œª...), the waves arrive in phase and add up.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- STANDING WAVE RENDERER ---
   const StandingWaveRenderer = () => {
      const [harmonic, setHarmonic] = useState(1);
      const [type, setType] = useState<'string' | 'openPipe' | 'closedPipe'>('string');
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.1), 30);
         return () => clearInterval(interval);
      }, []);

      const getAmplitude = (x: number) => {
         const L = 600;
         if (type === 'string') {
            // Nodes at both ends: sin(nœÄx/L)
            return Math.sin((harmonic * Math.PI * x) / L);
         } else if (type === 'openPipe') {
            // Antinodes at both ends: cos(nœÄx/L)
            return Math.cos((harmonic * Math.PI * x) / L);
         } else {
            // Node at one end, antinode at other: sin((2n-1)œÄx/2L)
            return Math.sin(((2 * harmonic - 1) * Math.PI * x) / (2 * L));
         }
      };

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-400">STANDING WAVES</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Resonance & Harmonics</p>
               </div>
               <div className="flex gap-2">
                  {(['string', 'openPipe', 'closedPipe'] as const).map(t => (
                     <button
                        key={t}
                        onClick={() => { setType(t); setHarmonic(1); }}
                        className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all ${type === t ? 'bg-orange-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                     >
                        {t === 'string' ? 'String' : t === 'openPipe' ? 'Open Pipe' : 'Closed Pipe'}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="600" height="200" className="overflow-visible">
                     {/* Boundary Markers */}
                     <line x1="0" y1="0" x2="0" y2="200" stroke={type === 'string' || type === 'closedPipe' ? '#f97316' : '#1e293b'} strokeWidth="4" />
                     <line x1="600" y1="0" x2="600" y2="200" stroke={type === 'string' ? '#f97316' : '#1e293b'} strokeWidth="4" />

                     {/* Wave Path */}
                     <path
                        d={Array.from({ length: 101 }, (_, i) => {
                           const x = i * 6;
                           const amp = getAmplitude(x);
                           const y = 100 + amp * Math.sin(time * 5) * 60;
                           return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                        }).join(' ')}
                        fill="none"
                        stroke="#f97316"
                        strokeWidth="3"
                        strokeLinecap="round"
                     />

                     {/* Envelope */}
                     <path
                        d={Array.from({ length: 101 }, (_, i) => {
                           const x = i * 6;
                           const amp = getAmplitude(x);
                           const y = 100 + amp * 60;
                           return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                        }).join(' ')}
                        fill="none"
                        stroke="#f97316"
                        strokeWidth="1"
                        strokeDasharray="4 4"
                        strokeOpacity="0.3"
                     />
                     <path
                        d={Array.from({ length: 101 }, (_, i) => {
                           const x = i * 6;
                           const amp = getAmplitude(x);
                           const y = 100 - amp * 60;
                           return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                        }).join(' ')}
                        fill="none"
                        stroke="#f97316"
                        strokeWidth="1"
                        strokeDasharray="4 4"
                        strokeOpacity="0.3"
                     />

                     {/* Node/Antinode Labels */}
                     {Array.from({ length: harmonic + 1 }).map((_, i) => {
                        const x = (i / harmonic) * 600;
                        const amp = getAmplitude(x);
                        const isNode = Math.abs(amp) < 0.1;
                        return (
                           <g key={i} transform={`translate(${x}, 100)`}>
                              <circle r="4" fill={isNode ? '#ef4444' : '#3b82f6'} />
                              <text y={isNode ? 20 : -20} textAnchor="middle" className="text-[10px] font-bold fill-slate-500">
                                 {isNode ? 'NODE' : 'ANTINODE'}
                              </text>
                           </g>
                        );
                     })}
                  </svg>

                  {/* Harmonic Info */}
                  <div className="absolute top-8 right-8 bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Harmonic (n)</p>
                     <p className="text-2xl font-black text-white tabular-nums">
                        {harmonic}
                     </p>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Harmonic Number</label>
                     <div className="grid grid-cols-4 gap-2">
                        {[1, 2, 3, 4, 5, 6, 7, 8].map(h => (
                           <button
                              key={h}
                              onClick={() => setHarmonic(h)}
                              className={`py-2 rounded-lg text-xs font-bold transition-all ${harmonic === h ? 'bg-orange-500 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
                           >
                              {h}
                           </button>
                        ))}
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-orange-500/10 rounded-3xl border border-orange-500/20">
                     <p className="text-[10px] font-bold text-orange-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Standing waves occur when waves reflect and interfere. <strong>Nodes</strong> are points of zero motion, while <strong>Antinodes</strong> are points of maximum motion.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- RESONANCE RENDERER ---
   const ResonanceRenderer = () => {
      const [driveFreq, setDriveFreq] = useState(1.0);
      const [naturalFreq, setNaturalFreq] = useState(2.0);
      const [damping, setDamping] = useState(0.1);
      const [time, setTime] = useState(0);
      const [history, setHistory] = useState<number[]>([]);

      useEffect(() => {
         const interval = setInterval(() => {
            setTime(t => t + 0.1);
         }, 30);
         return () => clearInterval(interval);
      }, []);

      // Simple damped driven oscillator approximation for visualization
      const amplitude = 1 / Math.sqrt(Math.pow(Math.pow(naturalFreq, 2) - Math.pow(driveFreq, 2), 2) + Math.pow(driveFreq * damping, 2));
      const currentPos = Math.sin(time * driveFreq * 2 * Math.PI) * amplitude * 20;

      useEffect(() => {
         setHistory(prev => [...prev.slice(-100), currentPos]);
      }, [time]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-rose-400">RESONANCE</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Driven Oscillations</p>
               </div>
               <div className="flex gap-4">
                  <button
                     onClick={() => setDriveFreq(naturalFreq)}
                     className="px-4 py-2 bg-rose-600 hover:bg-rose-500 text-white rounded-xl text-xs font-bold shadow-lg shadow-rose-500/20 transition-all active:scale-95"
                  >
                     Match Natural Freq
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  {/* Oscillator Visual */}
                  <div className="relative h-64 w-full flex items-center justify-center">
                     {/* Spring/Support */}
                     <div className="absolute top-0 w-32 h-2 bg-slate-800 rounded-full" />
                     <svg width="40" height="200" className="absolute top-2">
                        <path
                           d={`M 20,0 ${Array.from({ length: 20 }, (_, i) => {
                              const y = (i + 1) * (100 + currentPos) / 20;
                              const x = 20 + (i % 2 === 0 ? 10 : -10);
                              return `L ${x},${y}`;
                           }).join(' ')}`}
                           fill="none"
                           stroke="#475569"
                           strokeWidth="2"
                        />
                     </svg>
                     {/* Mass */}
                     <div
                        className="absolute w-16 h-16 bg-gradient-to-br from-rose-500 to-rose-700 rounded-2xl shadow-2xl border-2 border-rose-400/50 flex items-center justify-center"
                        style={{ transform: `translateY(${currentPos}px)` }}
                     >
                        <i className="fa-solid fa-weight-hanging text-white/50 text-2xl"></i>
                     </div>
                  </div>

                  {/* Waveform History */}
                  <div className="w-full h-32 mt-8 bg-black/40 rounded-2xl border border-slate-800 overflow-hidden relative">
                     <svg width="100%" height="100%" preserveAspectRatio="none" viewBox="0 0 100 100">
                        <path
                           d={`M 0,50 ${history.map((h, i) => `L ${i},${50 + h}`).join(' ')}`}
                           fill="none"
                           stroke="#fb7185"
                           strokeWidth="2"
                        />
                     </svg>
                     <div className="absolute top-2 left-4 text-[8px] font-black text-slate-600 uppercase tracking-widest">Amplitude Response</div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-rose-400 uppercase tracking-widest">Driving Frequency (Hz)</label>
                     <input
                        type="range"
                        min="0.1"
                        max="5.0"
                        step="0.1"
                        value={driveFreq}
                        onChange={(e) => setDriveFreq(parseFloat(e.target.value))}
                        className="w-full accent-rose-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0.1 Hz</span>
                        <span className="text-white bg-rose-500/20 px-2 py-0.5 rounded">{driveFreq.toFixed(1)} Hz</span>
                        <span>5.0 Hz</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Natural Frequency (Hz)</label>
                     <input
                        type="range"
                        min="0.5"
                        max="4.0"
                        step="0.1"
                        value={naturalFreq}
                        onChange={(e) => setNaturalFreq(parseFloat(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0.5 Hz</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{naturalFreq.toFixed(1)} Hz</span>
                        <span>4.0 Hz</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Damping (Friction)</label>
                     <input
                        type="range"
                        min="0.01"
                        max="0.5"
                        step="0.01"
                        value={damping}
                        onChange={(e) => setDamping(parseFloat(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Low</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{damping.toFixed(2)}</span>
                        <span>High</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-rose-500/10 rounded-3xl border border-rose-500/20">
                     <p className="text-[10px] font-bold text-rose-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Resonance happens when the <strong>Driving Frequency</strong> matches the <strong>Natural Frequency</strong>. Energy builds up, leading to massive oscillations.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- DOPPLER EFFECT RENDERER ---
   const DopplerEffectRenderer = () => {
      const [sourceVel, setSourceVel] = useState(0);
      const [observerVel, setObserverVel] = useState(0);
      const [freq, setFreq] = useState(2);
      const [time, setTime] = useState(0);
      const [ripples, setRipples] = useState<{ x: number, t: number }[]>([]);

      const speedOfSound = 340;

      useEffect(() => {
         const interval = setInterval(() => {
            setTime(t => t + 0.1);
            setRipples(prev => [...prev.slice(-20), { x: (time * sourceVel) % 800, t: time }]);
         }, 50);
         return () => clearInterval(interval);
      }, [time, sourceVel]);

      const sourcePos = (time * sourceVel) % 800;
      const observerPos = 600;

      // Frequency at observer: f' = f * (v + vo) / (v - vs)
      const observedFreq = freq * (speedOfSound + observerVel) / (speedOfSound - sourceVel);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">DOPPLER EFFECT</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Frequency Shift due to Motion</p>
               </div>
               <div className="flex gap-4">
                  <button
                     onClick={() => { setSourceVel(0); setObserverVel(0); }}
                     className="px-4 py-2 bg-slate-800 hover:bg-slate-700 text-slate-400 rounded-xl text-xs font-bold transition-all"
                  >
                     Reset Motion
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Road/Path */}
                     <line x1="0" y1="200" x2="800" y2="200" stroke="#1e293b" strokeWidth="2" strokeDasharray="8 8" />

                     {/* Ripples */}
                     {ripples.map((r, i) => (
                        <circle
                           key={i}
                           cx={r.x}
                           cy="200"
                           r={(time - r.t) * speedOfSound * 0.5}
                           fill="none"
                           stroke="#3b82f6"
                           strokeWidth="2"
                           strokeOpacity={Math.max(0, 1 - (time - r.t) * 0.5)}
                        />
                     ))}

                     {/* Source (Ambulance/Car) */}
                     <g transform={`translate(${sourcePos}, 200)`}>
                        <rect x="-20" y="-10" width="40" height="20" fill="#ef4444" rx="4" />
                        <circle cx="-10" cy="10" r="4" fill="#000" />
                        <circle cx="10" cy="10" r="4" fill="#000" />
                        <text y="-20" textAnchor="middle" className="text-[10px] font-black fill-red-400">SOURCE</text>
                     </g>

                     {/* Observer */}
                     <g transform={`translate(${observerPos}, 200)`}>
                        <circle r="10" fill="#10b981" />
                        <text y="-20" textAnchor="middle" className="text-[10px] font-black fill-emerald-400">OBSERVER</text>
                     </g>
                  </svg>

                  {/* Frequency Comparison */}
                  <div className="absolute top-8 left-8 flex gap-4">
                     <div className="bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl">
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Source Freq</p>
                        <p className="text-xl font-black text-white tabular-nums">{freq.toFixed(1)} <span className="text-xs text-slate-500">Hz</span></p>
                     </div>
                     <div className="bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl">
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Observed Freq</p>
                        <p className={`text-xl font-black tabular-nums ${observedFreq > freq ? 'text-blue-400' : observedFreq < freq ? 'text-red-400' : 'text-white'}`}>
                           {observedFreq.toFixed(1)} <span className="text-xs text-slate-500">Hz</span>
                        </p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-blue-400 uppercase tracking-widest">Source Velocity (vs)</label>
                     <input
                        type="range"
                        min="-200"
                        max="200"
                        value={sourceVel}
                        onChange={(e) => setSourceVel(parseInt(e.target.value))}
                        className="w-full accent-blue-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Away</span>
                        <span className="text-white bg-blue-500/20 px-2 py-0.5 rounded">{sourceVel} m/s</span>
                        <span>Towards</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Observer Velocity (vo)</label>
                     <input
                        type="range"
                        min="-100"
                        max="100"
                        value={observerVel}
                        onChange={(e) => setObserverVel(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Away</span>
                        <span className="text-white bg-emerald-500/20 px-2 py-0.5 rounded">{observerVel} m/s</span>
                        <span>Towards</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-blue-500/10 rounded-3xl border border-blue-500/20">
                     <p className="text-[10px] font-bold text-blue-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        When the source moves <strong>towards</strong> you, wave crests are bunched together, resulting in a <strong>higher pitch</strong>. As it moves away, they spread out.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- SNELL'S LAW RENDERER ---
   const SnellsLawRenderer = () => {
      const [n1, setN1] = useState(1.0); // Air
      const [n2, setN2] = useState(1.5); // Glass
      const [angle1, setAngle1] = useState(45); // Degrees

      const angle1Rad = (angle1 * Math.PI) / 180;
      // n1 sin Œ∏1 = n2 sin Œ∏2 => sin Œ∏2 = (n1/n2) * sin Œ∏1
      const sinTheta2 = (n1 / n2) * Math.sin(angle1Rad);
      const isTIR = sinTheta2 > 1;
      const angle2Rad = isTIR ? 0 : Math.asin(sinTheta2);
      const angle2 = (angle2Rad * 180) / Math.PI;

      const centerX = 400;
      const centerY = 200;
      const rayLength = 150;

      const x1 = centerX - Math.sin(angle1Rad) * rayLength;
      const y1 = centerY - Math.cos(angle1Rad) * rayLength;

      const x2 = centerX + Math.sin(angle2Rad) * rayLength;
      const y2 = centerY + Math.cos(angle2Rad) * rayLength;

      // Reflection ray for TIR or partial reflection
      const xr = centerX + Math.sin(angle1Rad) * rayLength;
      const yr = centerY - Math.cos(angle1Rad) * rayLength;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-cyan-400">SNELL'S LAW</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Refraction & Index of Refraction</p>
               </div>
               <div className="flex gap-2">
                  <button onClick={() => { setN1(1.0); setN2(1.5); }} className="px-3 py-1 bg-slate-800 rounded-full text-[10px] font-bold">Air ‚Üí Glass</button>
                  <button onClick={() => { setN1(1.5); setN2(1.0); }} className="px-3 py-1 bg-slate-800 rounded-full text-[10px] font-bold">Glass ‚Üí Air</button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Mediums */}
                     <rect x="0" y="200" width="800" height="200" fill="#0ea5e9" fillOpacity="0.1" />
                     <line x1="0" y1="200" x2="800" y2="200" stroke="#38bdf8" strokeWidth="2" />

                     {/* Normal Line */}
                     <line x1="400" y1="50" x2="400" y2="350" stroke="#475569" strokeWidth="1" strokeDasharray="4 4" />

                     {/* Incident Ray */}
                     <line x1={x1} y1={y1} x2={centerX} y2={centerY} stroke="#fbbf24" strokeWidth="3" />
                     <circle cx={x1} cy={y1} r="4" fill="#fbbf24" />

                     {/* Refracted Ray */}
                     {!isTIR && (
                        <line x1={centerX} y1={centerY} x2={x2} y2={y2} stroke="#fbbf24" strokeWidth="3" />
                     )}

                     {/* TIR Ray */}
                     {isTIR && (
                        <line x1={centerX} y1={centerY} x2={xr} y2={yr} stroke="#f87171" strokeWidth="3" strokeDasharray="4 4" />
                     )}

                     {/* Angle Labels */}
                     <text x={centerX - 30} y={centerY - 50} textAnchor="end" className="text-[10px] font-bold fill-amber-400">Œ∏‚ÇÅ = {angle1.toFixed(1)}¬∞</text>
                     {!isTIR && (
                        <text x={centerX + 30} y={centerY + 50} textAnchor="start" className="text-[10px] font-bold fill-amber-400">Œ∏‚ÇÇ = {angle2.toFixed(1)}¬∞</text>
                     )}
                     {isTIR && (
                        <text x={centerX + 40} y={centerY - 40} textAnchor="start" className="text-[10px] font-black fill-red-500">TIR ACTIVE</text>
                     )}

                     {/* Medium Labels */}
                     <text x="20" y="180" className="text-[10px] font-black fill-slate-500 uppercase tracking-widest">Medium 1 (n={n1.toFixed(2)})</text>
                     <text x="20" y="230" className="text-[10px] font-black fill-sky-500 uppercase tracking-widest">Medium 2 (n={n2.toFixed(2)})</text>
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-amber-400 uppercase tracking-widest">Incident Angle (Œ∏‚ÇÅ)</label>
                     <input
                        type="range"
                        min="0"
                        max="90"
                        value={angle1}
                        onChange={(e) => setAngle1(parseInt(e.target.value))}
                        className="w-full accent-amber-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0¬∞</span>
                        <span className="text-white bg-amber-500/20 px-2 py-0.5 rounded">{angle1}¬∞</span>
                        <span>90¬∞</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Index n‚ÇÅ</label>
                     <input
                        type="range"
                        min="1.0"
                        max="2.5"
                        step="0.01"
                        value={n1}
                        onChange={(e) => setN1(parseFloat(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>1.0</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{n1.toFixed(2)}</span>
                        <span>2.5</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-sky-400 uppercase tracking-widest">Index n‚ÇÇ</label>
                     <input
                        type="range"
                        min="1.0"
                        max="2.5"
                        step="0.01"
                        value={n2}
                        onChange={(e) => setN2(parseFloat(e.target.value))}
                        className="w-full accent-sky-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>1.0</span>
                        <span className="text-white bg-sky-500/20 px-2 py-0.5 rounded">{n2.toFixed(2)}</span>
                        <span>2.5</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-cyan-500/10 rounded-3xl border border-cyan-500/20">
                     <p className="text-[10px] font-bold text-cyan-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Light bends <strong>towards</strong> the normal when entering a denser medium (higher n). If it enters a less dense medium at a steep enough angle, it reflects completely (TIR).
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- TIR RENDERER ---
   const TIRRenderer = () => {
      const [n1, setN1] = useState(1.5); // Glass
      const [n2, setN2] = useState(1.0); // Air
      const [angle, setAngle] = useState(30);

      const criticalAngle = (Math.asin(n2 / n1) * 180) / Math.PI;
      const isTIR = angle > criticalAngle;

      const angleRad = (angle * Math.PI) / 180;
      const centerX = 400;
      const centerY = 200;

      // Incident ray
      const x1 = centerX - Math.sin(angleRad) * 150;
      const y1 = centerY + Math.cos(angleRad) * 150;

      // Refracted/Reflected ray
      let x2, y2;
      if (isTIR) {
         x2 = centerX + Math.sin(angleRad) * 150;
         y2 = centerY + Math.cos(angleRad) * 150;
      } else {
         const angle2Rad = Math.asin((n1 / n2) * Math.sin(angleRad));
         x2 = centerX + Math.sin(angle2Rad) * 150;
         y2 = centerY - Math.cos(angle2Rad) * 150;
      }

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-indigo-400">TOTAL INTERNAL REFLECTION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">The Critical Angle</p>
               </div>
               <div className="bg-indigo-500/20 px-4 py-2 rounded-xl border border-indigo-500/30">
                  <p className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Critical Angle (Œ∏c)</p>
                  <p className="text-sm font-black text-white">{criticalAngle.toFixed(1)}¬∞</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Mediums */}
                     <rect x="0" y="200" width="800" height="200" fill="#6366f1" fillOpacity="0.1" />
                     <line x1="0" y1="200" x2="800" y2="200" stroke="#818cf8" strokeWidth="2" />

                     {/* Normal */}
                     <line x1="400" y1="50" x2="400" y2="350" stroke="#1e293b" strokeWidth="1" strokeDasharray="4 4" />

                     {/* Incident Ray */}
                     <line x1={x1} y1={y1} x2={centerX} y2={centerY} stroke="#fcd34d" strokeWidth="4" />

                     {/* Output Ray */}
                     <line x1={centerX} y1={centerY} x2={x2} y2={y2} stroke={isTIR ? '#f87171' : '#fcd34d'} strokeWidth={isTIR ? 4 : 2} strokeDasharray={isTIR ? 'none' : '4 4'} />

                     {/* Labels */}
                     <text x="20" y="230" className="text-[10px] font-black fill-indigo-400 uppercase tracking-widest">Dense Medium (n={n1.toFixed(2)})</text>
                     <text x="20" y="180" className="text-[10px] font-black fill-slate-500 uppercase tracking-widest">Less Dense (n={n2.toFixed(2)})</text>

                     {isTIR && (
                        <g transform={`translate(${centerX + 50}, ${centerY + 50})`}>
                           <text className="text-sm font-black fill-red-500">TRAPPED!</text>
                        </g>
                     )}
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Incident Angle</label>
                     <input
                        type="range"
                        min="0"
                        max="90"
                        value={angle}
                        onChange={(e) => setAngle(parseInt(e.target.value))}
                        className="w-full accent-indigo-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0¬∞</span>
                        <span className="text-white bg-indigo-500/20 px-2 py-0.5 rounded">{angle}¬∞</span>
                        <span>90¬∞</span>
                     </div>
                  </div>

                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Condition for TIR</p>
                     <ul className="text-[10px] text-slate-500 space-y-1">
                        <li className="flex items-center gap-2">
                           <div className={`w-1.5 h-1.5 rounded-full ${n1 > n2 ? 'bg-green-500' : 'bg-red-500'}`} />
                           Dense ‚Üí Less Dense
                        </li>
                        <li className="flex items-center gap-2">
                           <div className={`w-1.5 h-1.5 rounded-full ${angle > criticalAngle ? 'bg-green-500' : 'bg-red-500'}`} />
                           Angle &gt; Critical Angle
                        </li>
                     </ul>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-indigo-500/10 rounded-3xl border border-indigo-500/20">
                     <p className="text-[10px] font-bold text-indigo-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        This is how <strong>Fiber Optics</strong> work! Light is reflected back into the glass over and over, allowing it to travel long distances without escaping.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- LENS RENDERER ---
   const LensRenderer = () => {
      const [focalLength, setFocalLength] = useState(100); // Positive for converging, negative for diverging
      const [objDist, setObjDist] = useState(200);
      const [objHeight, setObjHeight] = useState(50);

      // 1/f = 1/do + 1/di => 1/di = 1/f - 1/do = (do - f) / (f * do) => di = (f * do) / (do - f)
      const imgDist = (focalLength * objDist) / (objDist - focalLength);
      const magnification = -imgDist / objDist;
      const imgHeight = objHeight * magnification;

      const centerX = 400;
      const centerY = 200;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-400">LENS LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Ray Tracing & Image Formation</p>
               </div>
               <div className="flex gap-2">
                  <button onClick={() => setFocalLength(100)} className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all ${focalLength > 0 ? 'bg-emerald-500 text-white' : 'bg-slate-800 text-slate-400'}`}>Converging</button>
                  <button onClick={() => setFocalLength(-100)} className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all ${focalLength < 0 ? 'bg-emerald-500 text-white' : 'bg-slate-800 text-slate-400'}`}>Diverging</button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Optical Axis */}
                     <line x1="0" y1="200" x2="800" y2="200" stroke="#1e293b" strokeWidth="2" strokeDasharray="4 4" />

                     {/* Lens */}
                     <path
                        d={focalLength > 0
                           ? "M 400,100 Q 430,200 400,300 Q 370,200 400,100"
                           : "M 390,100 Q 410,200 390,300 L 410,300 Q 390,200 410,100 Z"}
                        fill="#0ea5e9"
                        fillOpacity="0.2"
                        stroke="#0ea5e9"
                        strokeWidth="2"
                     />

                     {/* Focal Points */}
                     <circle cx={centerX - focalLength} cy="200" r="3" fill="#ef4444" />
                     <circle cx={centerX + focalLength} cy="200" r="3" fill="#ef4444" />
                     <text x={centerX - focalLength} y="220" textAnchor="middle" className="text-[8px] fill-red-500 font-bold">F</text>
                     <text x={centerX + focalLength} y="220" textAnchor="middle" className="text-[8px] fill-red-500 font-bold">F</text>

                     {/* Object */}
                     <line x1={centerX - objDist} y1="200" x2={centerX - objDist} y2={200 - objHeight} stroke="#fbbf24" strokeWidth="4" />
                     <path d={`M ${centerX - objDist - 5},${200 - objHeight + 10} L ${centerX - objDist},${200 - objHeight} L ${centerX - objDist + 5},${200 - objHeight + 10}`} fill="none" stroke="#fbbf24" strokeWidth="2" />

                     {/* Image */}
                     {Math.abs(objDist - focalLength) > 1 && (
                        <>
                           <line
                              x1={centerX + imgDist}
                              y1="200"
                              x2={centerX + imgDist}
                              y2={200 - imgHeight}
                              stroke="#3b82f6"
                              strokeWidth="4"
                              strokeOpacity="0.6"
                              strokeDasharray={imgDist < 0 ? "4 4" : "none"}
                           />
                           <path
                              d={`M ${centerX + imgDist - 5},${200 - imgHeight + (imgHeight > 0 ? 10 : -10)} L ${centerX + imgDist},${200 - imgHeight} L ${centerX + imgDist + 5},${200 - imgHeight + (imgHeight > 0 ? 10 : -10)}`}
                              fill="none"
                              stroke="#3b82f6"
                              strokeWidth="2"
                              strokeOpacity="0.6"
                           />
                        </>
                     )}

                     {/* Rays */}
                     {/* Ray 1: Parallel to axis, then through focal point */}
                     <line x1={centerX - objDist} y1={200 - objHeight} x2={centerX} y2={200 - objHeight} stroke="#475569" strokeWidth="1" />
                     <line x1={centerX} y1={200 - objHeight} x2={centerX + 400} y2={200 - objHeight + (400 * (objHeight / focalLength))} stroke="#475569" strokeWidth="1" />

                     {/* Ray 2: Through center of lens */}
                     <line x1={centerX - objDist} y1={200 - objHeight} x2={centerX + 400} y2={200 - objHeight + (400 + objDist) * (objHeight / objDist)} stroke="#475569" strokeWidth="1" />
                  </svg>

                  {/* Stats Overlay */}
                  <div className="absolute top-8 right-8 bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl space-y-3">
                     <div>
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Image Type</p>
                        <p className="text-sm font-black text-white">
                           {imgDist > 0 ? 'REAL' : 'VIRTUAL'} & {Math.abs(magnification) > 1 ? 'MAGNIFIED' : 'REDUCED'}
                        </p>
                     </div>
                     <div>
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Magnification</p>
                        <p className="text-sm font-black text-emerald-400">{magnification.toFixed(2)}x</p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Object Distance (do)</label>
                     <input
                        type="range"
                        min="10"
                        max="400"
                        value={objDist}
                        onChange={(e) => setObjDist(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Close</span>
                        <span className="text-white bg-emerald-500/20 px-2 py-0.5 rounded">{objDist} px</span>
                        <span>Far</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Focal Length (f)</label>
                     <input
                        type="range"
                        min={focalLength > 0 ? 20 : -200}
                        max={focalLength > 0 ? 200 : -20}
                        value={focalLength}
                        onChange={(e) => setFocalLength(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Short</span>
                        <span className="text-white bg-emerald-500/20 px-2 py-0.5 rounded">{focalLength} px</span>
                        <span>Long</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-emerald-500/10 rounded-3xl border border-emerald-500/20">
                     <p className="text-[10px] font-bold text-emerald-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        <strong>Real images</strong> are formed where rays actually meet (can be projected). <strong>Virtual images</strong> are where rays only <em>appear</em> to come from.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- MIRROR RENDERER ---
   const MirrorRenderer = () => {
      const [focalLength, setFocalLength] = useState(100); // Positive for concave, negative for convex
      const [objDist, setObjDist] = useState(200);
      const [objHeight, setObjHeight] = useState(50);

      // 1/f = 1/do + 1/di => 1/di = 1/f - 1/do => di = (f * do) / (do - f)
      const imgDist = (focalLength * objDist) / (objDist - focalLength);
      const magnification = -imgDist / objDist;
      const imgHeight = objHeight * magnification;

      const centerX = 400;
      const centerY = 200;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-amber-400">MIRROR LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Reflection & Image Formation</p>
               </div>
               <div className="flex gap-2">
                  <button onClick={() => setFocalLength(100)} className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all ${focalLength > 0 ? 'bg-amber-500 text-white' : 'bg-slate-800 text-slate-400'}`}>Concave</button>
                  <button onClick={() => setFocalLength(-100)} className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all ${focalLength < 0 ? 'bg-amber-500 text-white' : 'bg-slate-800 text-slate-400'}`}>Convex</button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Optical Axis */}
                     <line x1="0" y1="200" x2="800" y2="200" stroke="#1e293b" strokeWidth="2" strokeDasharray="4 4" />

                     {/* Mirror */}
                     <path
                        d={focalLength > 0
                           ? "M 400,100 Q 370,200 400,300"
                           : "M 400,100 Q 430,200 400,300"}
                        fill="none"
                        stroke="#94a3b8"
                        strokeWidth="8"
                        strokeLinecap="round"
                     />

                     {/* Focal Points */}
                     <circle cx={centerX - focalLength} cy="200" r="3" fill="#ef4444" />
                     <text x={centerX - focalLength} y="220" textAnchor="middle" className="text-[8px] fill-red-500 font-bold">F</text>

                     {/* Object */}
                     <line x1={centerX - objDist} y1="200" x2={centerX - objDist} y2={200 - objHeight} stroke="#fbbf24" strokeWidth="4" />
                     <path d={`M ${centerX - objDist - 5},${200 - objHeight + 10} L ${centerX - objDist},${200 - objHeight} L ${centerX - objDist + 5},${200 - objHeight + 10}`} fill="none" stroke="#fbbf24" strokeWidth="2" />

                     {/* Image */}
                     {Math.abs(objDist - focalLength) > 1 && (
                        <>
                           <line
                              x1={centerX - imgDist}
                              y1="200"
                              x2={centerX - imgDist}
                              y2={200 - imgHeight}
                              stroke="#f59e0b"
                              strokeWidth="4"
                              strokeOpacity="0.6"
                              strokeDasharray={imgDist < 0 ? "4 4" : "none"}
                           />
                           <path
                              d={`M ${centerX - imgDist - 5},${200 - imgHeight + (imgHeight > 0 ? 10 : -10)} L ${centerX - imgDist},${200 - imgHeight} L ${centerX - imgDist + 5},${200 - imgHeight + (imgHeight > 0 ? 10 : -10)}`}
                              fill="none"
                              stroke="#f59e0b"
                              strokeWidth="2"
                              strokeOpacity="0.6"
                           />
                        </>
                     )}

                     {/* Rays */}
                     {/* Ray 1: Parallel to axis, then through focal point */}
                     <line x1={centerX - objDist} y1={200 - objHeight} x2={centerX} y2={200 - objHeight} stroke="#475569" strokeWidth="1" />
                     <line x1={centerX} y1={200 - objHeight} x2={centerX - 400} y2={200 - objHeight + (400 * (objHeight / focalLength))} stroke="#475569" strokeWidth="1" />
                  </svg>

                  {/* Stats Overlay */}
                  <div className="absolute top-8 right-8 bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl space-y-3">
                     <div>
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Image Type</p>
                        <p className="text-sm font-black text-white">
                           {imgDist > 0 ? 'REAL' : 'VIRTUAL'} & {Math.abs(magnification) > 1 ? 'MAGNIFIED' : 'REDUCED'}
                        </p>
                     </div>
                     <div>
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-1">Magnification</p>
                        <p className="text-sm font-black text-amber-400">{magnification.toFixed(2)}x</p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-amber-400 uppercase tracking-widest">Object Distance (do)</label>
                     <input
                        type="range"
                        min="10"
                        max="400"
                        value={objDist}
                        onChange={(e) => setObjDist(parseInt(e.target.value))}
                        className="w-full accent-amber-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Close</span>
                        <span className="text-white bg-amber-500/20 px-2 py-0.5 rounded">{objDist} px</span>
                        <span>Far</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-amber-400 uppercase tracking-widest">Focal Length (f)</label>
                     <input
                        type="range"
                        min={focalLength > 0 ? 20 : -200}
                        max={focalLength > 0 ? 200 : -20}
                        value={focalLength}
                        onChange={(e) => setFocalLength(parseInt(e.target.value))}
                        className="w-full accent-amber-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Short</span>
                        <span className="text-white bg-amber-500/20 px-2 py-0.5 rounded">{focalLength} px</span>
                        <span>Long</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-amber-500/10 rounded-3xl border border-amber-500/20">
                     <p className="text-[10px] font-bold text-amber-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        <strong>Concave mirrors</strong> can form real or virtual images depending on object position. <strong>Convex mirrors</strong> always form virtual, reduced, upright images.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- POLARIZATION RENDERER ---
   const PolarizationRenderer = () => {
      const [angle1, setAngle1] = useState(0);
      const [angle2, setAngle2] = useState(90);
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.1), 30);
         return () => clearInterval(interval);
      }, []);

      // Malus's Law: I = I0 * cos^2(theta)
      const relativeAngle = Math.abs(angle1 - angle2);
      const intensity = Math.pow(Math.cos((relativeAngle * Math.PI) / 180), 2);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-purple-400">POLARIZATION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Malus's Law & Wave Filtering</p>
               </div>
               <div className="bg-purple-500/20 px-4 py-2 rounded-xl border border-purple-500/30">
                  <p className="text-[10px] font-black text-purple-400 uppercase tracking-widest">Light Intensity</p>
                  <p className="text-sm font-black text-white">{(intensity * 100).toFixed(0)}%</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="600" height="300" className="overflow-visible">
                     {/* Unpolarized Light */}
                     <g transform="translate(50, 150)">
                        {[0, 45, 90, 135].map(a => (
                           <line key={a} x1="-30" y1="0" x2="30" y2="0" stroke="#fff" strokeWidth="1" strokeOpacity="0.3" transform={`rotate(${a})`} />
                        ))}
                        <text y="50" textAnchor="middle" className="text-[8px] fill-slate-500 font-bold">UNPOLARIZED</text>
                     </g>

                     {/* Polarizer 1 */}
                     <g transform={`translate(200, 150)`}>
                        <rect x="-40" y="-60" width="80" height="120" fill="#1e293b" rx="8" stroke="#475569" />
                        {/* Slits */}
                        {Array.from({ length: 7 }).map((_, i) => (
                           <line key={i} x1="-30" y1={-45 + i * 15} x2="30" y2={-45 + i * 15} stroke="#334155" strokeWidth="2" transform={`rotate(${angle1})`} />
                        ))}
                        <text y="80" textAnchor="middle" className="text-[8px] fill-purple-400 font-bold">POLARIZER A ({angle1}¬∞)</text>
                     </g>

                     {/* Polarized Light (Between) */}
                     <g transform="translate(325, 150)">
                        <line x1="-30" y1="0" x2="30" y2="0" stroke="#a855f7" strokeWidth="3" transform={`rotate(${angle1})`} />
                        <text y="50" textAnchor="middle" className="text-[8px] fill-slate-500 font-bold">POLARIZED</text>
                     </g>

                     {/* Polarizer 2 (Analyzer) */}
                     <g transform={`translate(450, 150)`}>
                        <rect x="-40" y="-60" width="80" height="120" fill="#1e293b" rx="8" stroke="#475569" />
                        {/* Slits */}
                        {Array.from({ length: 7 }).map((_, i) => (
                           <line key={i} x1="-30" y1={-45 + i * 15} x2="30" y2={-45 + i * 15} stroke="#334155" strokeWidth="2" transform={`rotate(${angle2})`} />
                        ))}
                        <text y="80" textAnchor="middle" className="text-[8px] fill-purple-400 font-bold">ANALYZER B ({angle2}¬∞)</text>
                     </g>

                     {/* Final Light */}
                     <g transform="translate(550, 150)">
                        <circle r={20 * intensity} fill="#fff" fillOpacity={0.8} className="blur-sm" />
                        <line x1="-20" y1="0" x2="20" y2="0" stroke="#fff" strokeWidth={3 * intensity} transform={`rotate(${angle2})`} />
                     </g>
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-purple-400 uppercase tracking-widest">Polarizer A Angle</label>
                     <input
                        type="range"
                        min="0"
                        max="180"
                        value={angle1}
                        onChange={(e) => setAngle1(parseInt(e.target.value))}
                        className="w-full accent-purple-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0¬∞</span>
                        <span className="text-white bg-purple-500/20 px-2 py-0.5 rounded">{angle1}¬∞</span>
                        <span>180¬∞</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-purple-400 uppercase tracking-widest">Analyzer B Angle</label>
                     <input
                        type="range"
                        min="0"
                        max="180"
                        value={angle2}
                        onChange={(e) => setAngle2(parseInt(e.target.value))}
                        className="w-full accent-purple-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0¬∞</span>
                        <span className="text-white bg-purple-500/20 px-2 py-0.5 rounded">{angle2}¬∞</span>
                        <span>180¬∞</span>
                     </div>
                  </div>

                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Malus's Law</p>
                     <p className="text-[10px] font-mono text-purple-400 mb-2">I = I‚ÇÄ cos¬≤(Œ∏)</p>
                     <p className="text-[10px] text-slate-500 leading-tight">
                        When polarizers are <strong>crossed</strong> (90¬∞ apart), no light passes through.
                     </p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-purple-500/10 rounded-3xl border border-purple-500/20">
                     <p className="text-[10px] font-bold text-purple-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Light is a <strong>transverse wave</strong>. Polarizers act like fences that only let waves vibrating in a specific direction pass through.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- DIFFRACTION RENDERER ---
   const DiffractionRenderer = () => {
      const [slitWidth, setSlitWidth] = useState(10); // micrometers
      const [wavelength, setWavelength] = useState(500); // nanometers
      const [distance, setDistance] = useState(1.0); // meters

      // Single Slit Diffraction: I(theta) = I0 * [sin(beta)/beta]^2 where beta = (pi * a * sin(theta)) / lambda
      // We'll approximate for a small range of angles
      const points = Array.from({ length: 200 }, (_, i) => {
         const x = (i - 100) / 10; // angle approximation
         const beta = (Math.PI * (slitWidth * 1e-6) * (x * 1e-3)) / (wavelength * 1e-9);
         const intensity = beta === 0 ? 1 : Math.pow(Math.sin(beta) / beta, 2);
         return { x: i, y: 100 - intensity * 80 };
      });

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-400">SINGLE SLIT DIFFRACTION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Wave Bending & Interference</p>
               </div>
               <div className="flex gap-4">
                  <div className="flex items-center gap-2">
                     <div className="w-3 h-3 rounded-full" style={{ backgroundColor: `hsl(${(700 - wavelength) * 0.8}, 100%, 50%)` }} />
                     <span className="text-xs font-bold text-slate-400">{wavelength} nm</span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  {/* Intensity Graph */}
                  <div className="w-full h-48 bg-black/40 rounded-2xl border border-slate-800 relative overflow-hidden mb-8">
                     <svg width="100%" height="100%" viewBox="0 0 200 100" preserveAspectRatio="none">
                        <path
                           d={`M ${points.map(p => `${p.x},${p.y}`).join(' L ')}`}
                           fill="none"
                           stroke={`hsl(${(700 - wavelength) * 0.8}, 100%, 50%)`}
                           strokeWidth="2"
                        />
                     </svg>
                     <div className="absolute top-2 left-4 text-[8px] font-black text-slate-600 uppercase tracking-widest">Intensity Pattern</div>
                  </div>

                  {/* Visual Pattern */}
                  <div className="w-full h-12 rounded-lg relative overflow-hidden shadow-2xl shadow-orange-500/10">
                     <div
                        className="absolute inset-0"
                        style={{
                           background: `radial-gradient(circle at center, hsl(${(700 - wavelength) * 0.8}, 100%, 50%) 0%, transparent 70%)`,
                           backgroundSize: `${200 / (slitWidth / 5)}px 100%`,
                           opacity: 0.8
                        }}
                     />
                  </div>
                  <p className="mt-4 text-[8px] font-black text-slate-500 uppercase tracking-widest">Projected Fringe Pattern</p>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Slit Width (a)</label>
                     <input
                        type="range"
                        min="2"
                        max="50"
                        value={slitWidth}
                        onChange={(e) => setSlitWidth(parseInt(e.target.value))}
                        className="w-full accent-orange-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Narrow</span>
                        <span className="text-white bg-orange-500/20 px-2 py-0.5 rounded">{slitWidth} Œºm</span>
                        <span>Wide</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Wavelength (Œª)</label>
                     <input
                        type="range"
                        min="380"
                        max="750"
                        value={wavelength}
                        onChange={(e) => setWavelength(parseInt(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Violet</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{wavelength} nm</span>
                        <span>Red</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-orange-500/10 rounded-3xl border border-orange-500/20">
                     <p className="text-[10px] font-bold text-orange-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        The <strong>narrower</strong> the slit, the <strong>wider</strong> the diffraction pattern. This proves light behaves as a wave, spreading out when it passes through small openings.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- DISPERSION RENDERER ---
   const DispersionRenderer = () => {
      const [prismAngle, setPrismAngle] = useState(60);
      const [incidentAngle, setIncidentAngle] = useState(45);

      const colors = [
         { name: 'Red', wavelength: 700, n: 1.51 },
         { name: 'Orange', wavelength: 600, n: 1.52 },
         { name: 'Yellow', wavelength: 580, n: 1.53 },
         { name: 'Green', wavelength: 530, n: 1.54 },
         { name: 'Blue', wavelength: 470, n: 1.55 },
         { name: 'Violet', wavelength: 400, n: 1.56 },
      ];

      const centerX = 400;
      const centerY = 200;
      const prismSize = 150;

      // Prism vertices
      const p1 = { x: centerX, y: centerY - prismSize * 0.6 };
      const p2 = { x: centerX - prismSize * 0.5, y: centerY + prismSize * 0.4 };
      const p3 = { x: centerX + prismSize * 0.5, y: centerY + prismSize * 0.4 };

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-pink-400">PRISM DISPERSION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Refractive Index & Wavelength</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Prism */}
                     <path d={`M ${p1.x},${p1.y} L ${p2.x},${p2.y} L ${p3.x},${p3.y} Z`} fill="#0ea5e9" fillOpacity="0.1" stroke="#0ea5e9" strokeWidth="2" />

                     {/* Incident White Light */}
                     <line x1="100" y1={centerY} x2={centerX - prismSize * 0.3} y2={centerY} stroke="#fff" strokeWidth="4" strokeOpacity="0.8" />
                     <text x="100" y={centerY - 10} className="text-[8px] font-black fill-slate-500 uppercase tracking-widest">White Light</text>

                     {/* Dispersed Rays (Simplified Visualization) */}
                     {colors.map((c, i) => {
                        const offset = i * 4;
                        const angle = (i - 2.5) * 2;
                        return (
                           <g key={c.name}>
                              {/* Ray inside prism */}
                              <line
                                 x1={centerX - prismSize * 0.3}
                                 y1={centerY}
                                 x2={centerX + prismSize * 0.2}
                                 y2={centerY + offset}
                                 stroke={`hsl(${(700 - c.wavelength) * 0.8}, 100%, 50%)`}
                                 strokeWidth="1"
                                 strokeOpacity="0.5"
                              />
                              {/* Ray exiting prism */}
                              <line
                                 x1={centerX + prismSize * 0.2}
                                 y1={centerY + offset}
                                 x2={centerX + 300}
                                 y2={centerY + offset + 50 + i * 10}
                                 stroke={`hsl(${(700 - c.wavelength) * 0.8}, 100%, 50%)`}
                                 strokeWidth="2"
                              />
                           </g>
                        );
                     })}
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-pink-400 uppercase tracking-widest">Prism Material</label>
                     <div className="grid grid-cols-2 gap-2">
                        <button className="px-3 py-2 bg-pink-500 text-white rounded-xl text-[10px] font-bold">Crown Glass</button>
                        <button className="px-3 py-2 bg-slate-800 text-slate-400 rounded-xl text-[10px] font-bold">Flint Glass</button>
                     </div>
                  </div>

                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Refractive Index (n)</p>
                     <div className="space-y-2">
                        {colors.filter((_, i) => i % 2 === 0).map(c => (
                           <div key={c.name} className="flex justify-between items-center">
                              <span className="text-[10px] font-bold text-slate-500">{c.name}</span>
                              <span className="text-[10px] font-mono text-white">{c.n}</span>
                           </div>
                        ))}
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-pink-500/10 rounded-3xl border border-pink-500/20">
                     <p className="text-[10px] font-bold text-pink-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Different colors of light have different <strong>wavelengths</strong>. Shorter wavelengths (Violet) slow down more and bend more than longer wavelengths (Red).
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- THIN FILM RENDERER ---
   const ThinFilmRenderer = () => {
      const [thickness, setThickness] = useState(200); // nanometers
      const [nFilm, setNFilm] = useState(1.33); // Water/Oil
      const [wavelength, setWavelength] = useState(500);

      // Constructive interference: 2nt = (m + 1/2)lambda (if one phase shift)
      // or 2nt = m*lambda (if zero or two phase shifts)
      // For oil on water (n1=1 < n2=1.5 > n3=1.33), one phase shift at top.
      const phaseShift = 0.5;
      const m = Math.floor((2 * nFilm * thickness) / wavelength - phaseShift);
      const isConstructive = Math.abs((2 * nFilm * thickness) / wavelength - (m + phaseShift)) < 0.1;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-teal-400">THIN FILM INTERFERENCE</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Oil Slicks & Soap Bubbles</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  {/* Film Visual */}
                  <div className="relative w-64 h-64 flex items-center justify-center">
                     {/* Top Layer (Air) */}
                     <div className="absolute top-0 w-full h-20 bg-slate-900/20 border-b border-slate-700 flex items-center justify-center">
                        <span className="text-[8px] font-black text-slate-600 uppercase tracking-widest">Air (n=1.0)</span>
                     </div>
                     {/* Film Layer */}
                     <div
                        className="absolute w-full border-y border-teal-500/30 transition-all duration-300"
                        style={{
                           height: `${thickness / 2}px`,
                           backgroundColor: `hsl(${(700 - wavelength) * 0.8}, 100%, 50%)`,
                           opacity: isConstructive ? 0.6 : 0.1,
                           boxShadow: isConstructive ? `0 0 40px hsl(${(700 - wavelength) * 0.8}, 100%, 50%, 0.3)` : 'none'
                        }}
                     >
                        <div className="absolute inset-0 bg-gradient-to-b from-white/20 to-transparent" />
                     </div>
                     {/* Bottom Layer (Substrate) */}
                     <div className="absolute bottom-0 w-full h-20 bg-slate-800/40 border-t border-slate-700 flex items-center justify-center">
                        <span className="text-[8px] font-black text-slate-600 uppercase tracking-widest">Substrate (n=1.5)</span>
                     </div>

                     {/* Rays */}
                     <svg className="absolute inset-0 w-full h-full overflow-visible">
                        <path d="M 50,50 L 128,120 L 200,50" fill="none" stroke="#fff" strokeWidth="2" strokeOpacity="0.5" />
                        <path d="M 128,120 L 128,160 L 200,90" fill="none" stroke="#fff" strokeWidth="2" strokeOpacity="0.3" strokeDasharray="4 4" />
                     </svg>
                  </div>

                  <div className="mt-8 text-center">
                     <p className={`text-sm font-black ${isConstructive ? 'text-teal-400' : 'text-slate-600'}`}>
                        {isConstructive ? 'CONSTRUCTIVE INTERFERENCE' : 'DESTRUCTIVE INTERFERENCE'}
                     </p>
                     <p className="text-[10px] text-slate-500 mt-1">at {wavelength} nm</p>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-teal-400 uppercase tracking-widest">Film Thickness (t)</label>
                     <input
                        type="range"
                        min="50"
                        max="500"
                        value={thickness}
                        onChange={(e) => setThickness(parseInt(e.target.value))}
                        className="w-full accent-teal-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>50 nm</span>
                        <span className="text-white bg-teal-500/20 px-2 py-0.5 rounded">{thickness} nm</span>
                        <span>500 nm</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Wavelength (Œª)</label>
                     <input
                        type="range"
                        min="380"
                        max="750"
                        value={wavelength}
                        onChange={(e) => setWavelength(parseInt(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Violet</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{wavelength} nm</span>
                        <span>Red</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-teal-500/10 rounded-3xl border border-teal-500/20">
                     <p className="text-[10px] font-bold text-teal-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Light reflects off both the <strong>top</strong> and <strong>bottom</strong> of the film. If these two reflections line up (constructive), that color becomes vivid.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- RAY TRACING LAB RENDERER ---
   const RayTracingLabRenderer = () => {
      const [sourcePos, setSourcePos] = useState({ x: 100, y: 200 });
      const [focalLength, setFocalLength] = useState(100);
      const [numRays, setNumRays] = useState(5);

      const centerX = 400;
      const centerY = 200;

      const rays = Array.from({ length: numRays }, (_, i) => {
         const angle = (i - (numRays - 1) / 2) * 10; // degrees
         const angleRad = (angle * Math.PI) / 180;

         // Ray from source to lens plane (x = centerX)
         const dx = centerX - sourcePos.x;
         const dy = dx * Math.tan(angleRad);
         const hitY = sourcePos.y + dy;

         // Ray after lens
         // Using lens maker/ray transfer matrix logic simplified
         // For a thin lens: y2 = y1, theta2 = theta1 - y1/f
         const theta1 = angleRad;
         const y1 = hitY - centerY;
         const theta2 = theta1 - y1 / focalLength;

         const xEnd = centerX + 400;
         const yEnd = centerY + y1 + (400 * Math.tan(theta2));

         return { hitY, xEnd, yEnd };
      });

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">RAY TRACING LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Multi-Ray Optics Sandbox</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="800" height="400" className="overflow-visible">
                     {/* Optical Axis */}
                     <line x1="0" y1="200" x2="800" y2="200" stroke="#1e293b" strokeWidth="1" strokeDasharray="4 4" />

                     {/* Lens */}
                     <line x1={centerX} y1="50" x2={centerX} y2="350" stroke="#0ea5e9" strokeWidth="4" strokeOpacity="0.3" />
                     <text x={centerX} y="40" textAnchor="middle" className="text-[8px] font-black fill-sky-500 uppercase tracking-widest">Lens Plane</text>

                     {/* Rays */}
                     {rays.map((r, i) => (
                        <g key={i}>
                           <line x1={sourcePos.x} y1={sourcePos.y} x2={centerX} y2={r.hitY} stroke="#fbbf24" strokeWidth="1" strokeOpacity="0.4" />
                           <line x1={centerX} y1={r.hitY} x2={r.xEnd} y2={r.yEnd} stroke="#fbbf24" strokeWidth="1.5" strokeOpacity="0.8" />
                        </g>
                     ))}

                     {/* Light Source */}
                     <g
                        transform={`translate(${sourcePos.x}, ${sourcePos.y})`}
                        className="cursor-move"
                        onMouseDown={(e) => {
                           const svg = e.currentTarget.ownerSVGElement;
                           const move = (moveEvent: MouseEvent) => {
                              const pt = svg!.createSVGPoint();
                              pt.x = moveEvent.clientX;
                              pt.y = moveEvent.clientY;
                              const transformed = pt.matrixTransform(svg!.getScreenCTM()!.inverse());
                              setSourcePos({ x: Math.max(50, Math.min(centerX - 20, transformed.x)), y: transformed.y });
                           };
                           const up = () => {
                              window.removeEventListener('mousemove', move);
                              window.removeEventListener('mouseup', up);
                           };
                           window.addEventListener('mousemove', move);
                           window.addEventListener('mouseup', up);
                        }}
                     >
                        <circle r="12" fill="#fbbf24" className="animate-pulse" />
                        <circle r="6" fill="#fff" />
                        <text y="-20" textAnchor="middle" className="text-[8px] font-black fill-amber-400 uppercase tracking-widest">Source (Drag Me)</text>
                     </g>
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-sky-400 uppercase tracking-widest">Focal Length</label>
                     <input
                        type="range"
                        min="50"
                        max="300"
                        value={focalLength}
                        onChange={(e) => setFocalLength(parseInt(e.target.value))}
                        className="w-full accent-sky-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Short</span>
                        <span className="text-white bg-sky-500/20 px-2 py-0.5 rounded">{focalLength} px</span>
                        <span>Long</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Number of Rays</label>
                     <input
                        type="range"
                        min="1"
                        max="21"
                        step="2"
                        value={numRays}
                        onChange={(e) => setNumRays(parseInt(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>1</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{numRays}</span>
                        <span>21</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-blue-500/10 rounded-3xl border border-blue-500/20">
                     <p className="text-[10px] font-bold text-blue-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Notice how all rays from a single point on the source <strong>converge</strong> to a single point on the other side. This is how a clear image is formed!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- WAVE-PARTICLE DUALITY RENDERER ---
   const WaveParticleDualityRenderer = () => {
      const [mode, setMode] = useState<'wave' | 'particle'>('wave');
      const [intensity, setIntensity] = useState(50);
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.1), 30);
         return () => clearInterval(interval);
      }, []);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-cyan-400">WAVE-PARTICLE DUALITY</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Quantum Mechanics & The Double Slit</p>
               </div>
               <div className="flex bg-slate-800 p-1 rounded-xl border border-slate-700">
                  <button
                     onClick={() => setMode('wave')}
                     className={`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all ${mode === 'wave' ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20' : 'text-slate-500 hover:text-slate-300'}`}
                  >
                     WAVE
                  </button>
                  <button
                     onClick={() => setMode('particle')}
                     className={`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all ${mode === 'particle' ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20' : 'text-slate-500 hover:text-slate-300'}`}
                  >
                     PARTICLE
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="600" height="300" className="overflow-visible">
                     {/* Slit Wall */}
                     <rect x="200" y="0" width="10" height="120" fill="#1e293b" />
                     <rect x="200" y="140" width="10" height="20" fill="#1e293b" />
                     <rect x="200" y="180" width="10" height="120" fill="#1e293b" />

                     {/* Source */}
                     <g transform="translate(50, 150)">
                        <circle r="10" fill="#06b6d4" className="animate-pulse" />
                        <text y="30" textAnchor="middle" className="text-[8px] font-black fill-slate-500 uppercase tracking-widest">Electron Gun</text>
                     </g>

                     {/* Visualization */}
                     {mode === 'wave' ? (
                        <g>
                           {/* Interference Pattern */}
                           {Array.from({ length: 10 }).map((_, i) => (
                              <circle
                                 key={i}
                                 cx="205"
                                 cy="130"
                                 r={(time * 50 + i * 40) % 400}
                                 fill="none"
                                 stroke="#06b6d4"
                                 strokeWidth="1"
                                 strokeOpacity={Math.max(0, 1 - ((time * 50 + i * 40) % 400) / 400)}
                              />
                           ))}
                           {Array.from({ length: 10 }).map((_, i) => (
                              <circle
                                 key={i + 10}
                                 cx="205"
                                 cy="170"
                                 r={(time * 50 + i * 40) % 400}
                                 fill="none"
                                 stroke="#06b6d4"
                                 strokeWidth="1"
                                 strokeOpacity={Math.max(0, 1 - ((time * 50 + i * 40) % 400) / 400)}
                              />
                           ))}
                           {/* Screen Pattern */}
                           <rect x="550" y="0" width="20" height="300" fill="url(#interference-gradient)" />
                        </g>
                     ) : (
                        <g>
                           {/* Particles */}
                           {Array.from({ length: 20 }).map((_, i) => {
                              const t = (time + i * 0.5) % 4;
                              const x = 50 + t * 125;
                              const isTop = (i % 2 === 0);
                              const y = isTop ? 130 : 170;
                              return (
                                 <circle key={i} cx={x} cy={y} r="3" fill="#06b6d4" fillOpacity={x > 200 ? 1 : 0.2} />
                              );
                           })}
                           {/* Screen Pattern */}
                           <rect x="550" y="110" width="20" height="40" fill="#06b6d4" fillOpacity="0.8" />
                           <rect x="550" y="150" width="20" height="40" fill="#06b6d4" fillOpacity="0.8" />
                        </g>
                     )}

                     <defs>
                        <linearGradient id="interference-gradient" x1="0" y1="0" x2="0" y2="1">
                           <stop offset="0%" stopColor="transparent" />
                           <stop offset="20%" stopColor="#06b6d4" />
                           <stop offset="30%" stopColor="transparent" />
                           <stop offset="50%" stopColor="#06b6d4" />
                           <stop offset="70%" stopColor="transparent" />
                           <stop offset="80%" stopColor="#06b6d4" />
                           <stop offset="100%" stopColor="transparent" />
                        </linearGradient>
                     </defs>
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-cyan-400 uppercase tracking-widest">Observation Mode</label>
                     <p className="text-[10px] text-slate-500 leading-relaxed">
                        {mode === 'wave'
                           ? "When unobserved, electrons travel as probability waves, interfering with themselves."
                           : "When we 'watch' which slit the electron goes through, the wave function collapses into a particle."}
                     </p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-cyan-500/10 rounded-3xl border border-cyan-500/20">
                     <p className="text-[10px] font-bold text-cyan-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        This is the heart of <strong>Quantum Mechanics</strong>. Matter is neither just a wave nor just a particle‚Äîit's both, until we measure it!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- PHOTOELECTRIC EFFECT RENDERER ---
   const PhotoelectricEffectRenderer = () => {
      const [wavelength, setWavelength] = useState(400); // nm
      const [intensity, setIntensity] = useState(50);
      const [workFunction, setWorkFunction] = useState(2.3); // eV (Sodium)
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.1), 30);
         return () => clearInterval(interval);
      }, []);

      // E = hf = hc/lambda
      const h = 4.1357e-15; // eV*s
      const c = 3e8; // m/s
      const photonEnergy = (h * c) / (wavelength * 1e-9);
      const maxKE = Math.max(0, photonEnergy - workFunction);
      const electronSpeed = Math.sqrt(maxKE) * 20; // scaled for visualization

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-amber-400">PHOTOELECTRIC EFFECT</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Photons & Electron Emission</p>
               </div>
               <div className="bg-amber-500/20 px-4 py-2 rounded-xl border border-amber-500/30">
                  <p className="text-[10px] font-black text-amber-400 uppercase tracking-widest">Max Electron KE</p>
                  <p className="text-sm font-black text-white">{maxKE.toFixed(2)} eV</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="600" height="300" className="overflow-visible">
                     {/* Metal Plate */}
                     <rect x="400" y="50" width="20" height="200" fill="#475569" rx="4" />
                     <text x="410" y="270" textAnchor="middle" className="text-[8px] font-black fill-slate-500 uppercase tracking-widest">Metal Plate</text>

                     {/* Photons */}
                     {Array.from({ length: Math.floor(intensity / 10) }).map((_, i) => {
                        const t = (time + i * 0.8) % 3;
                        const x = 50 + t * 115;
                        const y = 100 + i * 20;
                        return (
                           <g key={i} transform={`translate(${x}, ${y})`}>
                              <path
                                 d="M 0,0 Q 5,-5 10,0 Q 15,5 20,0"
                                 fill="none"
                                 stroke={`hsl(${(700 - wavelength) * 0.8}, 100%, 50%)`}
                                 strokeWidth="2"
                              />
                              <circle r="2" fill="#fff" />
                           </g>
                        );
                     })}

                     {/* Electrons */}
                     {maxKE > 0 && Array.from({ length: Math.floor(intensity / 10) }).map((_, i) => {
                        const t = (time + i * 0.8) % 3;
                        if (t < 1.5) return null;
                        const x = 420 + (t - 1.5) * electronSpeed * 10;
                        const y = 100 + i * 20;
                        return (
                           <circle key={`e-${i}`} cx={x} cy={y} r="3" fill="#38bdf8" className="animate-pulse" />
                        );
                     })}
                  </svg>

                  {/* Energy Chart Overlay */}
                  <div className="absolute bottom-8 left-8 bg-slate-900/80 backdrop-blur-md p-4 rounded-2xl border border-slate-800 shadow-2xl">
                     <div className="flex items-end gap-2 h-24">
                        <div className="w-8 bg-amber-500/40 rounded-t-lg" style={{ height: `${photonEnergy * 20}px` }}>
                           <p className="text-[8px] -rotate-90 origin-left translate-x-4 -translate-y-2 font-black text-amber-400">PHOTON</p>
                        </div>
                        <div className="w-8 bg-slate-700 rounded-t-lg" style={{ height: `${workFunction * 20}px` }}>
                           <p className="text-[8px] -rotate-90 origin-left translate-x-4 -translate-y-2 font-black text-slate-400">WORK FN</p>
                        </div>
                        <div className="w-8 bg-sky-500/40 rounded-t-lg" style={{ height: `${maxKE * 20}px` }}>
                           <p className="text-[8px] -rotate-90 origin-left translate-x-4 -translate-y-2 font-black text-sky-400">KE MAX</p>
                        </div>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-amber-400 uppercase tracking-widest">Light Wavelength (Œª)</label>
                     <input
                        type="range"
                        min="200"
                        max="800"
                        value={wavelength}
                        onChange={(e) => setWavelength(parseInt(e.target.value))}
                        className="w-full accent-amber-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>UV</span>
                        <span className="text-white bg-amber-500/20 px-2 py-0.5 rounded">{wavelength} nm</span>
                        <span>IR</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Metal Work Function (Œ¶)</label>
                     <select
                        value={workFunction}
                        onChange={(e) => setWorkFunction(parseFloat(e.target.value))}
                        className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-2 text-xs font-bold text-white outline-none focus:ring-2 focus:ring-amber-500/50"
                     >
                        <option value="2.3">Sodium (2.3 eV)</option>
                        <option value="4.3">Zinc (4.3 eV)</option>
                        <option value="4.7">Copper (4.7 eV)</option>
                        <option value="5.1">Platinum (5.1 eV)</option>
                     </select>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-amber-500/10 rounded-3xl border border-amber-500/20">
                     <p className="text-[10px] font-bold text-amber-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Increasing <strong>intensity</strong> (brightness) only ejects <em>more</em> electrons, but increasing <strong>frequency</strong> (shorter Œª) makes them fly <em>faster</em>.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- LASER RENDERER ---
   const LaserRenderer = () => {
      const [isPumping, setIsPumping] = useState(false);
      const [atoms, setAtoms] = useState<{ id: number, state: 'ground' | 'excited', x: number, y: number }[]>(
         Array.from({ length: 20 }, (_, i) => ({
            id: i,
            state: 'ground',
            x: 50 + Math.random() * 300,
            y: 50 + Math.random() * 200
         }))
      );
      const [photons, setPhotons] = useState<{ id: number, x: number, y: number, direction: 1 | -1 }[]>([]);

      useEffect(() => {
         const interval = setInterval(() => {
            if (isPumping) {
               setAtoms(prev => prev.map(a => Math.random() > 0.9 ? { ...a, state: 'excited' } : a));
            } else {
               setAtoms(prev => prev.map(a => Math.random() > 0.98 ? { ...a, state: 'ground' } : a));
            }

            // Move photons
            setPhotons(prev => prev.map(p => ({ ...p, x: p.x + p.direction * 10 })).filter(p => p.x > 0 && p.x < 400));

            // Stimulated emission logic
            setAtoms(prev => {
               const nextAtoms = [...prev];
               setPhotons(prevPhotons => {
                  const nextPhotons = [...prevPhotons];
                  prevPhotons.forEach(p => {
                     nextAtoms.forEach((a, idx) => {
                        if (a.state === 'excited' && Math.abs(a.x - p.x) < 20 && Math.abs(a.y - p.y) < 20) {
                           nextAtoms[idx] = { ...a, state: 'ground' };
                           nextPhotons.push({ id: Math.random(), x: a.x, y: a.y, direction: p.direction });
                        }
                     });
                  });
                  return nextPhotons;
               });
               return nextAtoms;
            });
         }, 50);
         return () => clearInterval(interval);
      }, [isPumping]);

      const excitedCount = atoms.filter(a => a.state === 'excited').length;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-rose-400">LASER PHYSICS</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Stimulated Emission & Pumping</p>
               </div>
               <div className="flex gap-4">
                  <button
                     onMouseDown={() => setIsPumping(true)}
                     onMouseUp={() => setIsPumping(false)}
                     onMouseLeave={() => setIsPumping(false)}
                     className={`px-6 py-2 rounded-xl text-xs font-black transition-all ${isPumping ? 'bg-rose-500 text-white shadow-lg shadow-rose-500/40 scale-95' : 'bg-slate-800 text-slate-400 hover:text-white'}`}
                  >
                     HOLD TO PUMP ENERGY
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <div className="relative w-[400px] h-[300px] border-x-4 border-slate-700 bg-slate-900/20 rounded-lg">
                     {/* Mirrors */}
                     <div className="absolute -left-1 top-0 bottom-0 w-1 bg-slate-400 opacity-80 shadow-[0_0_15px_rgba(255,255,255,0.3)]" />
                     <div className="absolute -right-1 top-0 bottom-0 w-1 bg-slate-400 opacity-40" />

                     {/* Atoms */}
                     {atoms.map(a => (
                        <div
                           key={a.id}
                           className={`absolute w-4 h-4 rounded-full transition-colors duration-300 ${a.state === 'excited' ? 'bg-rose-500 shadow-[0_0_10px_#f43f5e]' : 'bg-slate-700'}`}
                           style={{ left: a.x, top: a.y }}
                        />
                     ))}

                     {/* Photons */}
                     {photons.map(p => (
                        <div
                           key={p.id}
                           className="absolute w-2 h-0.5 bg-rose-400 shadow-[0_0_8px_#fb7185]"
                           style={{ left: p.x, top: p.y }}
                        />
                     ))}

                     {/* Laser Beam (if many photons) */}
                     {photons.length > 15 && (
                        <div className="absolute right-[-200px] top-0 bottom-0 flex items-center">
                           <div className="h-2 w-[200px] bg-rose-500 shadow-[0_0_20px_#f43f5e] opacity-80" />
                        </div>
                     )}
                  </div>

                  <div className="mt-8 flex gap-8">
                     <div className="text-center">
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Excited Atoms</p>
                        <p className="text-xl font-black text-rose-400">{excitedCount} / 20</p>
                     </div>
                     <div className="text-center">
                        <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Photon Count</p>
                        <p className="text-xl font-black text-white">{photons.length}</p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-rose-400 uppercase tracking-widest">Population Inversion</label>
                     <p className="text-[10px] text-slate-500 leading-relaxed">
                        To create a laser, we need more atoms in the <strong>excited state</strong> than the ground state. This is called population inversion.
                     </p>
                  </div>

                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">Laser Acronym</p>
                     <p className="text-[10px] text-slate-300 leading-tight">
                        <strong>L</strong>ight <strong>A</strong>mplification by <strong>S</strong>timulated <strong>E</strong>mission of <strong>R</strong>adiation.
                     </p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-rose-500/10 rounded-3xl border border-rose-500/20">
                     <p className="text-[10px] font-bold text-rose-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        One photon hits an excited atom, causing it to drop to ground state and release a <strong>second identical photon</strong>. This chain reaction creates the beam!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- ACOUSTIC LEVITATION RENDERER ---
   const AcousticLevitationRenderer = () => {
      const [freq, setFreq] = useState(40); // kHz
      const [amplitude, setAmplitude] = useState(80);
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.1), 30);
         return () => clearInterval(interval);
      }, []);

      // Nodes are at intervals of lambda/2
      // lambda = v/f. v = 343 m/s. f = 40kHz => lambda = 8.5mm
      const nodes = [60, 120, 180, 240];

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-400">ACOUSTIC LEVITATION</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Standing Waves & Radiation Pressure</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <div className="relative w-48 h-[300px] flex flex-col items-center">
                     {/* Transducers */}
                     <div className="w-full h-8 bg-slate-800 rounded-t-2xl border-b-4 border-emerald-500/50 flex items-center justify-center">
                        <span className="text-[8px] font-black text-slate-500">TRANSDUCER TOP</span>
                     </div>

                     <div className="flex-1 w-full relative bg-emerald-500/5 flex items-center justify-center overflow-hidden">
                        {/* Standing Wave Visualization */}
                        <svg className="absolute inset-0 w-full h-full">
                           {Array.from({ length: 40 }).map((_, i) => {
                              const y = i * 7.5;
                              const wave = Math.sin(y * 0.1 + time) * (amplitude / 4);
                              return (
                                 <line
                                    key={i}
                                    x1={24 - wave}
                                    y1={y}
                                    x2={168 + wave}
                                    y2={y}
                                    stroke="#10b981"
                                    strokeWidth="1"
                                    strokeOpacity="0.1"
                                 />
                              );
                           })}
                        </svg>

                        {/* Levitating Particles */}
                        {nodes.map((nodeY, i) => (
                           <div
                              key={i}
                              className="absolute w-4 h-4 bg-white rounded-full shadow-[0_0_15px_rgba(255,255,255,0.8)] blur-[1px]"
                              style={{
                                 top: nodeY + Math.sin(time * 2) * 2,
                                 left: '50%',
                                 transform: 'translateX(-50%)',
                                 opacity: amplitude > 50 ? 1 : 0.2
                              }}
                           />
                        ))}
                     </div>

                     <div className="w-full h-8 bg-slate-800 rounded-b-2xl border-t-4 border-emerald-500/50 flex items-center justify-center">
                        <span className="text-[8px] font-black text-slate-500">TRANSDUCER BOTTOM</span>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Acoustic Amplitude</label>
                     <input
                        type="range"
                        min="0"
                        max="100"
                        value={amplitude}
                        onChange={(e) => setAmplitude(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Off</span>
                        <span className="text-white bg-emerald-500/20 px-2 py-0.5 rounded">{amplitude}%</span>
                        <span>Max</span>
                     </div>
                  </div>

                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">The Physics</p>
                     <p className="text-[10px] text-slate-300 leading-tight">
                        Sound waves create <strong>pressure</strong>. In a standing wave, particles are pushed toward the <strong>nodes</strong> (points of zero movement) where they stay suspended.
                     </p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-emerald-500/10 rounded-3xl border border-emerald-500/20">
                     <p className="text-[10px] font-bold text-emerald-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        This isn't magic‚Äîit's <strong>Radiation Pressure</strong>! We can use sound to manipulate matter without ever touching it.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- FIBER OPTICS RENDERER ---
   const FiberOpticsRenderer = () => {
      const [incidentAngle, setIncidentAngle] = useState(20);
      const [fiberCurvature, setFiberCurvature] = useState(0);
      const [time, setTime] = useState(0);

      useEffect(() => {
         const interval = setInterval(() => setTime(t => t + 0.05), 30);
         return () => clearInterval(interval);
      }, []);

      // Total Internal Reflection: n1 sin(theta1) = n2 sin(theta2)
      // For glass (n=1.5) to air (n=1.0), critical angle is ~41.8 deg.
      const criticalAngle = 41.8;
      const isLeaking = (90 - incidentAngle) < criticalAngle;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-indigo-400">FIBER OPTICS</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Total Internal Reflection & Data</p>
               </div>
               <div className={`px-4 py-2 rounded-xl border transition-all ${isLeaking ? 'bg-red-500/20 border-red-500/30' : 'bg-indigo-500/20 border-indigo-500/30'}`}>
                  <p className="text-[10px] font-black uppercase tracking-widest text-slate-400">Signal Status</p>
                  <p className={`text-sm font-black ${isLeaking ? 'text-red-400' : 'text-indigo-400'}`}>
                     {isLeaking ? 'SIGNAL LEAKING' : 'TOTAL INTERNAL REFLECTION'}
                  </p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="600" height="300" className="overflow-visible">
                     {/* Fiber Core */}
                     <path
                        d={`M 50,150 Q ${300},${150 + fiberCurvature} 550,150`}
                        fill="none"
                        stroke="#312e81"
                        strokeWidth="40"
                        strokeLinecap="round"
                        strokeOpacity="0.3"
                     />
                     <path
                        d={`M 50,150 Q ${300},${150 + fiberCurvature} 550,150`}
                        fill="none"
                        stroke="#4338ca"
                        strokeWidth="2"
                        strokeDasharray="4 4"
                        strokeOpacity="0.5"
                     />

                     {/* Light Signal */}
                     <path
                        d={`M 50,150 L 100,${150 - incidentAngle} L 200,${150 + incidentAngle} L 300,${150 - incidentAngle} L 400,${150 + incidentAngle} L 500,${150 - incidentAngle} L 550,150`}
                        fill="none"
                        stroke={isLeaking ? '#ef4444' : '#818cf8'}
                        strokeWidth="3"
                        strokeOpacity={isLeaking ? 0.4 : 1}
                        className={isLeaking ? '' : 'animate-pulse'}
                     />

                     {/* Leaking Rays */}
                     {isLeaking && (
                        <g>
                           <line x1="100" y1={150 - incidentAngle} x2="120" y2={150 - incidentAngle - 40} stroke="#ef4444" strokeWidth="1" strokeOpacity="0.6" />
                           <line x1="200" y1={150 + incidentAngle} x2="220" y2={150 + incidentAngle + 40} stroke="#ef4444" strokeWidth="1" strokeOpacity="0.6" />
                        </g>
                     )}

                     <text x="50" y="120" className="text-[8px] font-black fill-slate-500 uppercase tracking-widest">Input Signal</text>
                     <text x="500" y="120" className="text-[8px] font-black fill-slate-500 uppercase tracking-widest text-right">Output</text>
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Incident Angle</label>
                     <input
                        type="range"
                        min="5"
                        max="60"
                        value={incidentAngle}
                        onChange={(e) => setIncidentAngle(parseInt(e.target.value))}
                        className="w-full accent-indigo-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Shallow</span>
                        <span className="text-white bg-indigo-500/20 px-2 py-0.5 rounded">{incidentAngle}¬∞</span>
                        <span>Steep</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Fiber Curvature</label>
                     <input
                        type="range"
                        min="-100"
                        max="100"
                        value={fiberCurvature}
                        onChange={(e) => setFiberCurvature(parseInt(e.target.value))}
                        className="w-full accent-slate-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Straight</span>
                        <span className="text-white bg-slate-800 px-2 py-0.5 rounded">{fiberCurvature}</span>
                        <span>Bent</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-indigo-500/10 rounded-3xl border border-indigo-500/20">
                     <p className="text-[10px] font-bold text-indigo-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Fiber optics work because light is <strong>trapped</strong> inside the glass. As long as the angle is shallow enough, the light reflects 100% and never escapes.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- STATIC BALLOON RENDERER ---
   const StaticBalloonRenderer = () => {
      const [balloonPos, setBalloonPos] = useState({ x: 100, y: 150 });
      const [balloonCharges, setBalloonCharges] = useState(0);
      const [isRubbing, setIsRubbing] = useState(false);

      const sweaterX = 50;
      const wallX = 500;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-yellow-400">STATIC ELECTRICITY</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Charge Transfer & Attraction</p>
               </div>
               <div className="bg-yellow-500/20 px-4 py-2 rounded-xl border border-yellow-500/30">
                  <p className="text-[10px] font-black text-yellow-400 uppercase tracking-widest">Balloon Charge</p>
                  <p className="text-sm font-black text-white">{balloonCharges} Electrons</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 overflow-hidden">
               {/* Sweater */}
               <div className="absolute left-10 top-20 bottom-20 w-32 bg-red-600/20 border-2 border-red-500/30 rounded-3xl flex items-center justify-center">
                  <div className="grid grid-cols-3 gap-4 opacity-40">
                     {Array.from({ length: 12 }).map((_, i) => (
                        <span key={i} className="text-red-400 font-bold text-xs">+</span>
                     ))}
                  </div>
                  <p className="absolute -bottom-8 text-[8px] font-black text-slate-500 uppercase tracking-widest">Wool Sweater</p>
               </div>

               {/* Wall */}
               <div className="absolute right-10 top-20 bottom-20 w-20 bg-slate-800/40 border-l-4 border-slate-700 rounded-r-3xl flex flex-col justify-around p-4">
                  {Array.from({ length: 8 }).map((_, i) => (
                     <div key={i} className="flex justify-between items-center opacity-40">
                        <span className="text-blue-400 text-[8px]">+</span>
                        <span className="text-red-400 text-[8px]">-</span>
                     </div>
                  ))}
                  <p className="absolute -bottom-8 right-0 text-[8px] font-black text-slate-500 uppercase tracking-widest">Neutral Wall</p>
               </div>

               {/* Balloon */}
               <div
                  className="absolute cursor-move select-none"
                  style={{ left: balloonPos.x, top: balloonPos.y }}
                  onMouseDown={(e) => {
                     const startX = e.clientX - balloonPos.x;
                     const startY = e.clientY - balloonPos.y;
                     const move = (moveEvent: MouseEvent) => {
                        const newX = moveEvent.clientX - startX;
                        const newY = moveEvent.clientY - startY;
                        setBalloonPos({ x: newX, y: newY });

                        // Rubbing logic
                        if (newX < 150) {
                           setIsRubbing(true);
                           setBalloonCharges(prev => Math.min(20, prev + 1));
                        } else {
                           setIsRubbing(false);
                        }

                        // Wall sticking logic
                        if (newX > 400 && balloonCharges > 5) {
                           setBalloonPos(prev => ({ ...prev, x: 440 }));
                        }
                     };
                     const up = () => {
                        window.removeEventListener('mousemove', move);
                        window.removeEventListener('mouseup', up);
                        setIsRubbing(false);
                     };
                     window.addEventListener('mousemove', move);
                     window.addEventListener('mouseup', up);
                  }}
               >
                  <div className={`w-24 h-32 bg-yellow-500 rounded-full relative shadow-2xl transition-transform ${isRubbing ? 'scale-105' : ''}`}>
                     <div className="absolute inset-0 flex flex-wrap content-center justify-center p-4">
                        {Array.from({ length: Math.floor(balloonCharges) }).map((_, i) => (
                           <span key={i} className="text-slate-900 font-black text-[10px] m-0.5">-</span>
                        ))}
                     </div>
                     <div className="absolute -bottom-2 left-1/2 -translate-x-1/2 w-2 h-4 bg-yellow-600 rounded-b-full" />
                  </div>
                  <p className="text-center mt-4 text-[8px] font-black text-slate-500 uppercase tracking-widest">Drag Me!</p>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-yellow-500/10 flex items-center justify-center border border-yellow-500/20 shrink-0">
                     <span className="text-2xl">üí°</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Rubbing the balloon on the sweater transfers <strong>electrons</strong>. The negatively charged balloon then repels electrons in the wall, leaving a positive surface that it sticks to!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- CIRCUIT BUILDER BASIC RENDERER ---
   const CircuitBuilderBasicRenderer = () => {
      const [isBatteryConnected, setIsBatteryConnected] = useState(false);
      const [isBulbConnected, setIsBulbConnected] = useState(false);
      const [isSwitchClosed, setIsSwitchClosed] = useState(false);

      const isLit = isBatteryConnected && isBulbConnected && isSwitchClosed;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">MY FIRST CIRCUIT</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Battery, Bulb & Switch</p>
               </div>
               <div className={`px-4 py-2 rounded-xl border transition-all ${isLit ? 'bg-yellow-500/20 border-yellow-500/30' : 'bg-slate-800 border-slate-700'}`}>
                  <p className="text-[10px] font-black uppercase tracking-widest text-slate-500">Circuit Status</p>
                  <p className={`text-sm font-black ${isLit ? 'text-yellow-400' : 'text-slate-400'}`}>
                     {isLit ? 'LIGHT IS ON!' : 'INCOMPLETE'}
                  </p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <svg width="600" height="400" className="overflow-visible">
                  {/* Wires */}
                  <path d="M 100,200 L 100,100 L 500,100 L 500,200" fill="none" stroke="#475569" strokeWidth="8" strokeLinecap="round" />
                  <path d="M 100,250 L 100,350 L 500,350 L 500,250" fill="none" stroke="#475569" strokeWidth="8" strokeLinecap="round" />

                  {/* Battery Slot */}
                  <g transform="translate(50, 200)" className="cursor-pointer" onClick={() => setIsBatteryConnected(!isBatteryConnected)}>
                     <rect x="0" y="0" width="100" height="50" fill={isBatteryConnected ? '#f59e0b' : '#1e293b'} rx="8" stroke={isBatteryConnected ? '#fbbf24' : '#334155'} strokeWidth="2" />
                     <rect x="100" y="15" width="10" height="20" fill="#94a3b8" rx="2" />
                     <text x="50" y="30" textAnchor="middle" className="text-[10px] font-black fill-slate-900 uppercase">BATTERY</text>
                     {!isBatteryConnected && <text x="50" y="-10" textAnchor="middle" className="text-[8px] font-bold fill-blue-400 animate-bounce">CLICK TO ADD</text>}
                  </g>

                  {/* Bulb Slot */}
                  <g transform="translate(450, 200)" className="cursor-pointer" onClick={() => setIsBulbConnected(!isBulbConnected)}>
                     <circle cx="50" cy="25" r="30" fill={isLit ? '#fef08a' : isBulbConnected ? '#334155' : '#1e293b'} stroke={isBulbConnected ? '#94a3b8' : '#334155'} strokeWidth="2" className={isLit ? 'shadow-[0_0_50px_#facc15]' : ''} />
                     <path d="M 35,45 L 65,45 L 60,60 L 40,60 Z" fill="#94a3b8" />
                     <text x="50" y="30" textAnchor="middle" className={`text-[10px] font-black uppercase ${isLit ? 'fill-yellow-700' : 'fill-slate-500'}`}>BULB</text>
                     {!isBulbConnected && <text x="50" y="-15" textAnchor="middle" className="text-[8px] font-bold fill-blue-400 animate-bounce">CLICK TO ADD</text>}
                  </g>

                  {/* Switch */}
                  <g transform="translate(250, 80)" className="cursor-pointer" onClick={() => setIsSwitchClosed(!isSwitchClosed)}>
                     <circle cx="0" cy="20" r="6" fill="#475569" />
                     <circle cx="100" cy="20" r="6" fill="#475569" />
                     <line
                        x1="0" y1="20"
                        x2={isSwitchClosed ? 100 : 80} y2={isSwitchClosed ? 20 : -20}
                        stroke="#94a3b8" strokeWidth="6" strokeLinecap="round"
                        className="transition-all duration-300"
                     />
                     <text x="50" y="50" textAnchor="middle" className="text-[10px] font-black fill-slate-500 uppercase">SWITCH</text>
                  </g>

                  {/* Electrons (Flowing) */}
                  {isLit && Array.from({ length: 12 }).map((_, i) => (
                     <circle key={i} r="3" fill="#38bdf8">
                        <animateMotion
                           dur="2s"
                           repeatCount="indefinite"
                           path="M 100,225 L 100,350 L 500,350 L 500,225 M 500,225 L 500,100 L 100,100 L 100,225"
                           begin={`${i * 0.2}s`}
                        />
                     </circle>
                  ))}
               </svg>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto grid grid-cols-3 gap-8">
                  <div className="text-center">
                     <p className="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1">Energy Source</p>
                     <p className="text-xs font-bold text-blue-400">Battery</p>
                  </div>
                  <div className="text-center">
                     <p className="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1">The Load</p>
                     <p className="text-xs font-bold text-yellow-400">Light Bulb</p>
                  </div>
                  <div className="text-center">
                     <p className="text-[8px] font-black text-slate-500 uppercase tracking-widest mb-1">The Control</p>
                     <p className="text-xs font-bold text-slate-400">Switch</p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- MAGNET MAZE RENDERER ---
   const MagnetMazeRenderer = () => {
      const [ballPos, setBallPos] = useState({ x: 100, y: 100 });
      const [magnetPos, setMagnetPos] = useState({ x: 300, y: 300 });

      useEffect(() => {
         const dx = magnetPos.x - ballPos.x;
         const dy = magnetPos.y - ballPos.y;
         const dist = Math.sqrt(dx * dx + dy * dy);

         if (dist < 150 && dist > 10) {
            const force = (150 - dist) / 50;
            setBallPos(prev => ({
               x: prev.x + (dx / dist) * force,
               y: prev.y + (dy / dist) * force
            }));
         }
      }, [magnetPos]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-red-400">MAGNET MAZE</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Magnetic Fields & Forces</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 overflow-hidden">
               {/* Maze Walls (Simplified) */}
               <svg className="absolute inset-0 w-full h-full">
                  <rect x="200" y="0" width="20" height="250" fill="#1e293b" />
                  <rect x="400" y="150" width="20" height="250" fill="#1e293b" />
                  <text x="500" y="350" className="text-[10px] font-black fill-emerald-500 uppercase tracking-widest">Goal</text>
                  <circle cx="520" cy="345" r="30" fill="none" stroke="#10b981" strokeWidth="2" strokeDasharray="4 4" />
               </svg>

               {/* Iron Ball */}
               <div
                  className="absolute w-8 h-8 bg-slate-400 rounded-full shadow-lg border-2 border-slate-300 transition-all duration-100"
                  style={{ left: ballPos.x - 16, top: ballPos.y - 16 }}
               >
                  <div className="absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-full" />
               </div>

               {/* Magnet (Draggable) */}
               <div
                  className="absolute cursor-move select-none z-10"
                  style={{ left: magnetPos.x - 20, top: magnetPos.y - 40 }}
                  onMouseDown={(e) => {
                     const startX = e.clientX - magnetPos.x;
                     const startY = e.clientY - magnetPos.y;
                     const move = (moveEvent: MouseEvent) => {
                        setMagnetPos({
                           x: moveEvent.clientX - startX,
                           y: moveEvent.clientY - startY
                        });
                     };
                     const up = () => {
                        window.removeEventListener('mousemove', move);
                        window.removeEventListener('mouseup', up);
                     };
                     window.addEventListener('mousemove', move);
                     window.addEventListener('mouseup', up);
                  }}
               >
                  <div className="w-10 h-20 flex flex-col rounded-md overflow-hidden shadow-2xl border border-slate-800">
                     <div className="flex-1 bg-red-600 flex items-center justify-center font-black text-xs">N</div>
                     <div className="flex-1 bg-blue-600 flex items-center justify-center font-black text-xs">S</div>
                  </div>
                  <p className="text-center mt-2 text-[8px] font-black text-slate-500 uppercase tracking-widest">Magnet</p>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-red-500/10 flex items-center justify-center border border-red-500/20 shrink-0">
                     <span className="text-2xl">üß≤</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Magnets exert a <strong>force</strong> on certain metals like iron. This force gets stronger as the magnet gets closer!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- ELECTROMAGNET BASIC RENDERER ---
   const ElectromagnetBasicRenderer = () => {
      const [numCoils, setNumCoils] = useState(5);
      const [isPowerOn, setIsPowerOn] = useState(false);
      const [paperclips, setPaperclips] = useState<{ id: number, x: number, y: number, isPickedUp: boolean }[]>(
         Array.from({ length: 8 }, (_, i) => ({
            id: i,
            x: 400 + Math.random() * 150,
            y: 300 + Math.random() * 50,
            isPickedUp: false
         }))
      );

      const magneticStrength = isPowerOn ? numCoils * 10 : 0;

      useEffect(() => {
         if (isPowerOn) {
            setPaperclips(prev => prev.map(p => {
               if (p.x < 350 && Math.abs(p.y - 200) < 100) {
                  return { ...p, x: 250, y: 200 + (p.id - 4) * 10, isPickedUp: true };
               }
               return p;
            }));
         } else {
            setPaperclips(prev => prev.map(p => p.isPickedUp ? { ...p, y: 320, isPickedUp: false } : p));
         }
      }, [isPowerOn, numCoils]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-400">ELECTROMAGNET LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Electricity + Magnetism</p>
               </div>
               <div className="flex gap-4">
                  <button
                     onClick={() => setIsPowerOn(!isPowerOn)}
                     className={`px-6 py-2 rounded-xl text-xs font-black transition-all ${isPowerOn ? 'bg-orange-500 text-white shadow-lg shadow-orange-500/40' : 'bg-slate-800 text-slate-400'}`}
                  >
                     {isPowerOn ? 'POWER ON' : 'POWER OFF'}
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="600" height="400" className="overflow-visible">
                     {/* Battery */}
                     <rect x="50" y="300" width="80" height="40" fill="#1e293b" rx="4" stroke="#334155" />
                     <rect x="130" y="310" width="8" height="20" fill="#94a3b8" />

                     {/* Wires */}
                     <path d="M 130,320 L 200,320 L 200,200" fill="none" stroke={isPowerOn ? '#fb923c' : '#475569'} strokeWidth="4" />
                     <path d="M 50,320 L 20,320 L 20,100 L 200,100 L 200,200" fill="none" stroke={isPowerOn ? '#fb923c' : '#475569'} strokeWidth="4" />

                     {/* Iron Nail */}
                     <rect x="180" y="150" width="150" height="20" fill="#64748b" rx="2" transform="rotate(90, 255, 200)" />
                     <path d="M 245,100 L 265,100 L 255,80 Z" fill="#475569" />

                     {/* Coils */}
                     {Array.from({ length: numCoils }).map((_, i) => (
                        <path
                           key={i}
                           d={`M 245,${120 + i * 20} Q 280,${130 + i * 20} 245,${140 + i * 20}`}
                           fill="none"
                           stroke={isPowerOn ? '#fb923c' : '#475569'}
                           strokeWidth="3"
                        />
                     ))}

                     {/* Magnetic Field (Visual) */}
                     {isPowerOn && (
                        <g className="animate-pulse">
                           <ellipse cx="255" cy="200" rx="60" ry="120" fill="none" stroke="#fb923c" strokeWidth="1" strokeOpacity="0.2" />
                           <ellipse cx="255" cy="200" rx="40" ry="100" fill="none" stroke="#fb923c" strokeWidth="1" strokeOpacity="0.3" />
                        </g>
                     )}

                     {/* Paperclips */}
                     {paperclips.map(p => (
                        <g key={p.id} transform={`translate(${p.x}, ${p.y}) rotate(${p.isPickedUp ? 90 : 0})`}>
                           <rect width="15" height="4" fill="none" stroke="#94a3b8" strokeWidth="1.5" rx="2" />
                        </g>
                     ))}
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Number of Coils</label>
                     <input
                        type="range"
                        min="1"
                        max="10"
                        value={numCoils}
                        onChange={(e) => setNumCoils(parseInt(e.target.value))}
                        className="w-full accent-orange-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Weak</span>
                        <span className="text-white bg-orange-500/20 px-2 py-0.5 rounded">{numCoils} Turns</span>
                        <span>Strong</span>
                     </div>
                  </div>

                  <div className="p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">The Secret</p>
                     <p className="text-[10px] text-slate-300 leading-tight">
                        Electricity flowing through a wire creates a <strong>magnetic field</strong>. Wrapping the wire into coils concentrates that field, making it strong enough to pick up metal!
                     </p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-orange-500/10 rounded-3xl border border-orange-500/20">
                     <p className="text-[10px] font-bold text-orange-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Unlike permanent magnets, electromagnets can be <strong>turned on and off</strong>. This makes them incredibly useful in everything from scrap yards to MRI machines.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- CONDUCTIVITY TESTER RENDERER ---
   const ConductivityTesterRenderer = () => {
      const [selectedObject, setSelectedObject] = useState<'none' | 'copper' | 'wood' | 'plastic' | 'water'>('none');

      const objects = {
         none: { name: 'Empty', isConductor: false, color: 'transparent' },
         copper: { name: 'Copper Coin', isConductor: true, color: '#b45309' },
         wood: { name: 'Wooden Stick', isConductor: false, color: '#78350f' },
         plastic: { name: 'Plastic Ruler', isConductor: false, color: '#3b82f6' },
         water: { name: 'Salt Water', isConductor: true, color: '#0ea5e9' }
      };

      const isLit = selectedObject !== 'none' && objects[selectedObject].isConductor;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-400">CONDUCTIVITY TESTER</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Conductors vs. Insulators</p>
               </div>
               <div className={`px-4 py-2 rounded-xl border transition-all ${isLit ? 'bg-emerald-500/20 border-emerald-500/30' : 'bg-slate-800 border-slate-700'}`}>
                  <p className="text-[10px] font-black uppercase tracking-widest text-slate-500">Result</p>
                  <p className={`text-sm font-black ${isLit ? 'text-emerald-400' : 'text-slate-400'}`}>
                     {isLit ? 'CONDUCTOR' : 'INSULATOR'}
                  </p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="400" height="300" className="overflow-visible">
                     {/* Circuit */}
                     <path d="M 100,150 L 50,150 L 50,50 L 350,50 L 350,150 L 300,150" fill="none" stroke="#475569" strokeWidth="6" strokeLinecap="round" />
                     <path d="M 100,200 L 50,200 L 50,250 L 350,250 L 350,200 L 300,200" fill="none" stroke="#475569" strokeWidth="6" strokeLinecap="round" />

                     {/* Battery */}
                     <rect x="170" y="30" width="60" height="40" fill="#1e293b" rx="4" stroke="#334155" />
                     <text x="200" y="55" textAnchor="middle" className="text-[8px] font-black fill-slate-500">BATTERY</text>

                     {/* Bulb */}
                     <circle cx="200" cy="250" r="25" fill={isLit ? '#fef08a' : '#1e293b'} stroke="#334155" strokeWidth="2" className={isLit ? 'shadow-[0_0_40px_#facc15]' : ''} />
                     <text x="200" y="255" textAnchor="middle" className={`text-[8px] font-black ${isLit ? 'fill-yellow-700' : 'fill-slate-500'}`}>BULB</text>

                     {/* Test Probes */}
                     <rect x="100" y="140" width="10" height="70" fill="#94a3b8" rx="2" />
                     <rect x="290" y="140" width="10" height="70" fill="#94a3b8" rx="2" />

                     {/* Test Object */}
                     {selectedObject !== 'none' && (
                        <rect
                           x="110" y="165" width="180" height="20"
                           fill={objects[selectedObject].color}
                           rx="4"
                           className="animate-in fade-in zoom-in duration-300"
                        />
                     )}

                     {/* Electrons */}
                     {isLit && Array.from({ length: 10 }).map((_, i) => (
                        <circle key={i} r="2" fill="#10b981">
                           <animateMotion
                              dur="1.5s"
                              repeatCount="indefinite"
                              path="M 110,175 L 290,175 M 290,175 L 350,175 L 350,250 L 200,250 L 50,250 L 50,175 L 110,175"
                              begin={`${i * 0.15}s`}
                           />
                        </circle>
                     ))}
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-4 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <p className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Select Object to Test</p>
                  <div className="grid grid-cols-1 gap-2">
                     {Object.entries(objects).filter(([k]) => k !== 'none').map(([key, obj]) => (
                        <button
                           key={key}
                           onClick={() => setSelectedObject(key as any)}
                           className={`p-4 rounded-2xl border text-left transition-all ${selectedObject === key ? 'bg-emerald-500/20 border-emerald-500/40' : 'bg-slate-800/50 border-slate-700 hover:border-slate-500'}`}
                        >
                           <div className="flex items-center justify-between">
                              <span className="text-xs font-bold">{obj.name}</span>
                              <div className="w-4 h-4 rounded-full" style={{ backgroundColor: obj.color }} />
                           </div>
                        </button>
                     ))}
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-emerald-500/10 rounded-3xl border border-emerald-500/20">
                     <p className="text-[10px] font-bold text-emerald-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        <strong>Conductors</strong> (like copper) have loose electrons that can flow easily. <strong>Insulators</strong> (like wood) hold onto their electrons tightly, blocking the flow.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- SIMPLE SWITCH RENDERER ---
   const SimpleSwitchRenderer = () => {
      const [isClosed, setIsClosed] = useState(false);
      const [circuitType, setCircuitType] = useState<'series' | 'parallel'>('series');

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-cyan-400">SWITCH LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Controlling the Flow</p>
               </div>
               <div className="flex bg-slate-800 p-1 rounded-xl border border-slate-700">
                  <button
                     onClick={() => setCircuitType('series')}
                     className={`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all ${circuitType === 'series' ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20' : 'text-slate-500 hover:text-slate-300'}`}
                  >
                     SERIES
                  </button>
                  <button
                     onClick={() => setCircuitType('parallel')}
                     className={`px-4 py-1.5 rounded-lg text-[10px] font-black transition-all ${circuitType === 'parallel' ? 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20' : 'text-slate-500 hover:text-slate-300'}`}
                  >
                     PARALLEL
                  </button>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <svg width="600" height="400" className="overflow-visible">
                  {/* Battery */}
                  <rect x="50" y="180" width="60" height="40" fill="#1e293b" rx="4" stroke="#334155" />
                  <text x="80" y="205" textAnchor="middle" className="text-[8px] font-black fill-slate-500">BATTERY</text>

                  {/* Series Circuit */}
                  {circuitType === 'series' ? (
                     <g>
                        <path d="M 110,200 L 200,200 M 300,200 L 400,200 L 400,100 L 500,100 M 500,300 L 400,300 L 400,200 M 50,200 L 20,200 L 20,350 L 500,350 L 500,300" fill="none" stroke="#475569" strokeWidth="4" />
                        {/* Switch */}
                        <g transform="translate(200, 180)" className="cursor-pointer" onClick={() => setIsClosed(!isClosed)}>
                           <circle cx="0" cy="20" r="4" fill="#94a3b8" />
                           <circle cx="100" cy="20" r="4" fill="#94a3b8" />
                           <line x1="0" y1="20" x2={isClosed ? 100 : 80} y2={isClosed ? 20 : -10} stroke="#94a3b8" strokeWidth="4" strokeLinecap="round" />
                        </g>
                        {/* Bulbs */}
                        <circle cx="500" cy="100" r="20" fill={isClosed ? '#fef08a' : '#1e293b'} stroke="#334155" className={isClosed ? 'shadow-[0_0_30px_#facc15]' : ''} />
                        <circle cx="500" cy="300" r="20" fill={isClosed ? '#fef08a' : '#1e293b'} stroke="#334155" className={isClosed ? 'shadow-[0_0_30px_#facc15]' : ''} />
                     </g>
                  ) : (
                     <g>
                        <path d="M 110,200 L 200,200 M 300,200 L 350,200 L 350,100 L 500,100 M 350,200 L 350,300 L 500,300 M 50,200 L 20,200 L 20,350 L 550,350 L 550,100 L 500,100 M 550,300 L 500,300" fill="none" stroke="#475569" strokeWidth="4" />
                        {/* Switch */}
                        <g transform="translate(200, 180)" className="cursor-pointer" onClick={() => setIsClosed(!isClosed)}>
                           <circle cx="0" cy="20" r="4" fill="#94a3b8" />
                           <circle cx="100" cy="20" r="4" fill="#94a3b8" />
                           <line x1="0" y1="20" x2={isClosed ? 100 : 80} y2={isClosed ? 20 : -10} stroke="#94a3b8" strokeWidth="4" strokeLinecap="round" />
                        </g>
                        {/* Bulbs */}
                        <circle cx="500" cy="100" r="20" fill={isClosed ? '#fef08a' : '#1e293b'} stroke="#334155" className={isClosed ? 'shadow-[0_0_30px_#facc15]' : ''} />
                        <circle cx="500" cy="300" r="20" fill={isClosed ? '#fef08a' : '#1e293b'} stroke="#334155" className={isClosed ? 'shadow-[0_0_30px_#facc15]' : ''} />
                     </g>
                  )}

                  {/* Electrons */}
                  {isClosed && Array.from({ length: 15 }).map((_, i) => (
                     <circle key={i} r="2" fill="#22d3ee">
                        <animateMotion
                           dur="2s"
                           repeatCount="indefinite"
                           path={circuitType === 'series'
                              ? "M 110,200 L 200,200 L 300,200 L 400,200 L 400,100 L 500,100 L 500,300 L 500,350 L 20,350 L 20,200 L 50,200"
                              : "M 110,200 L 200,200 L 300,200 L 350,200 L 350,100 L 500,100 L 550,100 L 550,350 L 20,350 L 20,200 L 50,200"
                           }
                           begin={`${i * 0.15}s`}
                        />
                     </circle>
                  ))}
               </svg>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20 shrink-0">
                     <span className="text-2xl">üîå</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     A switch works by <strong>breaking the path</strong>. When it's open, electrons can't jump the gap, so the circuit stops. Close it, and the loop is complete!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- MAGNETIC POLE RENDERER ---
   const MagneticPoleRenderer = () => {
      const [isBroken, setIsBroken] = useState(false);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-red-400">MAGNETIC POLES</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">North, South & Monopoles</p>
               </div>
               <button
                  onClick={() => setIsBroken(!isBroken)}
                  className={`px-6 py-2 rounded-xl text-xs font-black transition-all ${isBroken ? 'bg-slate-800 text-slate-400' : 'bg-red-500 text-white shadow-lg shadow-red-500/40'}`}
               >
                  {isBroken ? 'RESET MAGNET' : 'BREAK THE MAGNET'}
               </button>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <div className="relative flex items-center gap-4">
                  {!isBroken ? (
                     <div className="w-64 h-24 flex rounded-xl overflow-hidden shadow-2xl border border-slate-800 animate-in zoom-in duration-500">
                        <div className="flex-1 bg-red-600 flex flex-col items-center justify-center">
                           <span className="text-4xl font-black">N</span>
                           <span className="text-[10px] font-bold opacity-50">NORTH</span>
                        </div>
                        <div className="flex-1 bg-blue-600 flex flex-col items-center justify-center">
                           <span className="text-4xl font-black">S</span>
                           <span className="text-[10px] font-bold opacity-50">SOUTH</span>
                        </div>
                     </div>
                  ) : (
                     <div className="flex gap-16 animate-in slide-in-from-left duration-500">
                        <div className="w-32 h-24 flex rounded-xl overflow-hidden shadow-2xl border border-slate-800">
                           <div className="flex-1 bg-red-600 flex items-center justify-center font-black text-2xl">N</div>
                           <div className="flex-1 bg-blue-600 flex items-center justify-center font-black text-2xl">S</div>
                        </div>
                        <div className="w-32 h-24 flex rounded-xl overflow-hidden shadow-2xl border border-slate-800">
                           <div className="flex-1 bg-red-600 flex items-center justify-center font-black text-2xl">N</div>
                           <div className="flex-1 bg-blue-600 flex items-center justify-center font-black text-2xl">S</div>
                        </div>
                     </div>
                  )}

                  {/* Field Lines (Visual) */}
                  <svg className="absolute inset-0 -z-10 w-[800px] h-[400px] -translate-x-1/4 -translate-y-1/4 pointer-events-none">
                     <defs>
                        <linearGradient id="field-grad" x1="0%" y1="0%" x2="100%" y2="0%">
                           <stop offset="0%" stopColor="#ef4444" stopOpacity="0.2" />
                           <stop offset="100%" stopColor="#3b82f6" stopOpacity="0.2" />
                        </linearGradient>
                     </defs>
                     {!isBroken && (
                        <g>
                           <path d="M 300,200 Q 400,100 500,200" fill="none" stroke="url(#field-grad)" strokeWidth="2" strokeDasharray="4 4" />
                           <path d="M 300,200 Q 400,300 500,200" fill="none" stroke="url(#field-grad)" strokeWidth="2" strokeDasharray="4 4" />
                           <path d="M 300,200 Q 400,50 500,200" fill="none" stroke="url(#field-grad)" strokeWidth="1" strokeDasharray="4 4" />
                           <path d="M 300,200 Q 400,350 500,200" fill="none" stroke="url(#field-grad)" strokeWidth="1" strokeDasharray="4 4" />
                        </g>
                     )}
                  </svg>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-red-500/10 flex items-center justify-center border border-red-500/20 shrink-0">
                     <span className="text-2xl">‚úÇÔ∏è</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Every magnet has two poles. If you break a magnet in half, you don't get a "North" and a "South"‚Äîyou get <strong>two smaller magnets</strong>, each with its own North and South!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- ATTRACT & REPEL RENDERER ---
   const AttractRepelRenderer = () => {
      const [leftMagnetType, setLeftMagnetType] = useState<'N' | 'S'>('N');
      const [rightMagnetType, setRightMagnetType] = useState<'N' | 'S'>('S');
      const [distance, setDistance] = useState(200);

      const isAttracting = leftMagnetType !== rightMagnetType;
      const forceStrength = Math.max(0, (300 - distance) / 20);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">ATTRACT OR REPEL?</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Magnetic Interaction Rules</p>
               </div>
               <div className={`px-4 py-2 rounded-xl border transition-all ${isAttracting ? 'bg-emerald-500/20 border-emerald-500/30' : 'bg-red-500/20 border-red-500/30'}`}>
                  <p className="text-[10px] font-black uppercase tracking-widest text-slate-500">Interaction</p>
                  <p className={`text-sm font-black ${isAttracting ? 'text-emerald-400' : 'text-red-400'}`}>
                     {isAttracting ? 'ATTRACTING' : 'REPELLING'}
                  </p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden">
               <div className="flex items-center gap-8" style={{ gap: `${distance}px` }}>
                  {/* Left Magnet */}
                  <div
                     className="w-32 h-16 flex rounded-lg overflow-hidden shadow-2xl border border-slate-800 cursor-pointer"
                     onClick={() => setLeftMagnetType(leftMagnetType === 'N' ? 'S' : 'N')}
                  >
                     <div className={`flex-1 flex items-center justify-center font-black ${leftMagnetType === 'N' ? 'bg-red-600' : 'bg-blue-600'}`}>
                        {leftMagnetType}
                     </div>
                     <div className={`flex-1 flex items-center justify-center font-black ${leftMagnetType === 'N' ? 'bg-blue-600' : 'bg-red-600'}`}>
                        {leftMagnetType === 'N' ? 'S' : 'N'}
                     </div>
                  </div>

                  {/* Right Magnet */}
                  <div
                     className="w-32 h-16 flex rounded-lg overflow-hidden shadow-2xl border border-slate-800 cursor-pointer"
                     onClick={() => setRightMagnetType(rightMagnetType === 'N' ? 'S' : 'N')}
                  >
                     <div className={`flex-1 flex items-center justify-center font-black ${rightMagnetType === 'N' ? 'bg-red-600' : 'bg-blue-600'}`}>
                        {rightMagnetType}
                     </div>
                     <div className={`flex-1 flex items-center justify-center font-black ${rightMagnetType === 'N' ? 'bg-blue-600' : 'bg-red-600'}`}>
                        {rightMagnetType === 'N' ? 'S' : 'N'}
                     </div>
                  </div>
               </div>

               {/* Force Arrows */}
               <div className="mt-12 flex items-center gap-4">
                  {isAttracting ? (
                     <div className="flex items-center gap-2 text-emerald-400">
                        <span className="text-2xl animate-bounce">‚Üí</span>
                        <span className="text-[10px] font-black uppercase tracking-widest">Pulling Together</span>
                        <span className="text-2xl animate-bounce">‚Üê</span>
                     </div>
                  ) : (
                     <div className="flex items-center gap-2 text-red-400">
                        <span className="text-2xl animate-bounce">‚Üê</span>
                        <span className="text-[10px] font-black uppercase tracking-widest">Pushing Away</span>
                        <span className="text-2xl animate-bounce">‚Üí</span>
                     </div>
                  )}
               </div>

               {/* Distance Slider */}
               <div className="absolute bottom-12 w-64">
                  <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block text-center mb-4">Distance</label>
                  <input
                     type="range"
                     min="50"
                     max="400"
                     value={distance}
                     onChange={(e) => setDistance(parseInt(e.target.value))}
                     className="w-full accent-blue-500"
                  />
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20 shrink-0">
                     <span className="text-2xl">ü§ù</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     The golden rule of magnetism: <strong>Opposites attract</strong> (N and S), and <strong>likes repel</strong> (N and N, or S and S). The closer they are, the stronger the force!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- COMPASS RENDERER ---
   const CompassRenderer = () => {
      const [magnetPos, setMagnetPos] = useState({ x: 450, y: 150 });
      const [isDragging, setIsDragging] = useState(false);

      const compasses = Array.from({ length: 25 }).map((_, i) => ({
         x: 50 + (i % 5) * 80,
         y: 50 + Math.floor(i / 5) * 60
      }));

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-400">COMPASS LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Earth's Field & Local Magnets</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 overflow-hidden">
               {/* Compass Grid */}
               {compasses.map((c, i) => {
                  const dx = magnetPos.x - c.x;
                  const dy = magnetPos.y - c.y;
                  const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                  return (
                     <div
                        key={i}
                        className="absolute w-12 h-12 rounded-full border border-slate-800 bg-slate-900/30 flex items-center justify-center"
                        style={{ left: c.x - 24, top: c.y - 24 }}
                     >
                        <div
                           className="w-8 h-1 bg-gradient-to-r from-red-500 to-blue-500 rounded-full transition-transform duration-200"
                           style={{ transform: `rotate(${angle}deg)` }}
                        />
                        <div className="absolute w-1 h-1 bg-white rounded-full" />
                     </div>
                  );
               })}

               {/* Draggable Magnet */}
               <div
                  className="absolute cursor-move select-none z-10"
                  style={{ left: magnetPos.x - 40, top: magnetPos.y - 20 }}
                  onMouseDown={(e) => {
                     const startX = e.clientX - magnetPos.x;
                     const startY = e.clientY - magnetPos.y;
                     const move = (moveEvent: MouseEvent) => {
                        setMagnetPos({
                           x: moveEvent.clientX - startX,
                           y: moveEvent.clientY - startY
                        });
                     };
                     const up = () => {
                        window.removeEventListener('mousemove', move);
                        window.removeEventListener('mouseup', up);
                     };
                     window.addEventListener('mousemove', move);
                     window.addEventListener('mouseup', up);
                  }}
               >
                  <div className="w-20 h-10 flex rounded-lg overflow-hidden shadow-2xl border border-slate-800">
                     <div className="flex-1 bg-red-600 flex items-center justify-center font-black text-xs">N</div>
                     <div className="flex-1 bg-blue-600 flex items-center justify-center font-black text-xs">S</div>
                  </div>
                  <p className="text-center mt-2 text-[8px] font-black text-slate-500 uppercase tracking-widest">Drag Me!</p>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20 shrink-0">
                     <span className="text-2xl">üß≠</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     A compass needle is just a <strong>tiny magnet</strong> that's free to spin. It always points toward the strongest magnetic field nearby‚Äîusually the Earth, unless there's a closer magnet!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- MAGNETIC MATERIAL RENDERER ---
   const MagneticMaterialRenderer = () => {
      const [selectedMaterial, setSelectedMaterial] = useState<'none' | 'iron' | 'aluminum' | 'wood'>('none');
      const [magnetPos, setMagnetPos] = useState({ x: 100, y: 150 });

      const materials = {
         none: { name: 'Empty', isMagnetic: false, color: 'transparent' },
         iron: { name: 'Iron Bolt', isMagnetic: true, color: '#64748b' },
         aluminum: { name: 'Aluminum Foil', isMagnetic: false, color: '#cbd5e1' },
         wood: { name: 'Wooden Block', isMagnetic: false, color: '#78350f' }
      };

      const isAttracted = selectedMaterial !== 'none' && materials[selectedMaterial].isMagnetic && magnetPos.x > 350;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-slate-400">MAGNETIC MATERIALS</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">What sticks to a magnet?</p>
               </div>
               <div className={`px-4 py-2 rounded-xl border transition-all ${isAttracted ? 'bg-red-500/20 border-red-500/30' : 'bg-slate-800 border-slate-700'}`}>
                  <p className="text-[10px] font-black uppercase tracking-widest text-slate-500">Interaction</p>
                  <p className={`text-sm font-black ${isAttracted ? 'text-red-400' : 'text-slate-400'}`}>
                     {isAttracted ? 'ATTRACTED!' : 'NO INTERACTION'}
                  </p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden">
               {/* Test Tray */}
               <div className="absolute right-20 top-1/2 -translate-y-1/2 w-48 h-48 bg-slate-900/50 border-2 border-dashed border-slate-800 rounded-3xl flex items-center justify-center">
                  {selectedMaterial !== 'none' ? (
                     <div
                        className={`w-24 h-24 rounded-2xl shadow-2xl transition-all duration-300 ${isAttracted ? 'translate-x-[-20px]' : ''}`}
                        style={{ backgroundColor: materials[selectedMaterial].color }}
                     >
                        <div className="absolute inset-0 flex items-center justify-center">
                           <span className="text-[10px] font-black uppercase tracking-widest opacity-50">{materials[selectedMaterial].name}</span>
                        </div>
                     </div>
                  ) : (
                     <span className="text-[10px] font-black text-slate-700 uppercase tracking-widest">Place Object Here</span>
                  )}
               </div>

               {/* Draggable Magnet */}
               <div
                  className="absolute cursor-move select-none z-10"
                  style={{ left: magnetPos.x - 40, top: magnetPos.y - 20 }}
                  onMouseDown={(e) => {
                     const startX = e.clientX - magnetPos.x;
                     const startY = e.clientY - magnetPos.y;
                     const move = (moveEvent: MouseEvent) => {
                        setMagnetPos({
                           x: moveEvent.clientX - startX,
                           y: moveEvent.clientY - startY
                        });
                     };
                     const up = () => {
                        window.removeEventListener('mousemove', move);
                        window.removeEventListener('mouseup', up);
                     };
                     window.addEventListener('mousemove', move);
                     window.addEventListener('mouseup', up);
                  }}
               >
                  <div className="w-20 h-10 flex rounded-lg overflow-hidden shadow-2xl border border-slate-800">
                     <div className="flex-1 bg-red-600 flex items-center justify-center font-black text-xs">N</div>
                     <div className="flex-1 bg-blue-600 flex items-center justify-center font-black text-xs">S</div>
                  </div>
               </div>

               {/* Material Selector */}
               <div className="absolute left-8 top-1/2 -translate-y-1/2 flex flex-col gap-2">
                  {Object.entries(materials).filter(([k]) => k !== 'none').map(([key, obj]) => (
                     <button
                        key={key}
                        onClick={() => setSelectedMaterial(key as any)}
                        className={`p-4 rounded-2xl border text-left transition-all ${selectedMaterial === key ? 'bg-slate-800 border-slate-600' : 'bg-slate-900/30 border-slate-800 hover:border-slate-700'}`}
                     >
                        <span className="text-xs font-bold">{obj.name}</span>
                     </button>
                  ))}
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-slate-500/10 flex items-center justify-center border border-slate-500/20 shrink-0">
                     <span className="text-2xl">üß±</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Not all metals are magnetic! <strong>Iron, Nickel, and Cobalt</strong> are the big three. Metals like Aluminum and Copper don't stick to magnets at all.
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- SERIES CIRCUIT RENDERER ---
   const SeriesCircuitRenderer = () => {
      const [voltage, setVoltage] = useState(9);
      const [resistors, setResistors] = useState([10, 10, 10]); // Ohms

      const totalResistance = resistors.reduce((a, b) => a + b, 0);
      const current = voltage / totalResistance;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-yellow-400">SERIES CIRCUIT</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Single Path & Voltage Division</p>
               </div>
               <div className="flex gap-4">
                  <div className="bg-yellow-500/10 px-4 py-2 rounded-xl border border-yellow-500/20">
                     <p className="text-[8px] font-black text-yellow-400 uppercase tracking-widest">Total Current</p>
                     <p className="text-sm font-black text-white">{current.toFixed(2)} A</p>
                  </div>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <svg width="600" height="400" className="overflow-visible">
                  {/* Circuit Path */}
                  <rect x="100" y="100" width="400" height="200" fill="none" stroke="#334155" strokeWidth="4" rx="8" />

                  {/* Battery */}
                  <g transform="translate(80, 175)">
                     <rect x="0" y="0" width="40" height="50" fill="#1e293b" rx="4" stroke="#fbbf24" strokeWidth="2" />
                     <text x="20" y="30" textAnchor="middle" className="text-[8px] font-black fill-yellow-500">9V</text>
                  </g>

                  {/* Resistors */}
                  {resistors.map((r, i) => {
                     const x = 200 + i * 100;
                     return (
                        <g key={i} transform={`translate(${x}, 100)`}>
                           <path d="M -20,0 L -10,0 L -5,-10 L 5,10 L 15,-10 L 25,10 L 30,0 L 40,0" fill="none" stroke="#94a3b8" strokeWidth="2" />
                           <text x="10" y="-20" textAnchor="middle" className="text-[8px] font-black fill-slate-500">{r} Œ©</text>
                           <text x="10" y="20" textAnchor="middle" className="text-[8px] font-bold fill-yellow-400">{(current * r).toFixed(1)}V</text>
                        </g>
                     );
                  })}

                  {/* Electrons */}
                  {Array.from({ length: 12 }).map((_, i) => (
                     <circle key={i} r="3" fill="#fbbf24">
                        <animateMotion
                           dur={`${2 / current}s`}
                           repeatCount="indefinite"
                           path="M 100,200 L 100,100 L 500,100 L 500,300 L 100,300 L 100,200"
                           begin={`${i * 0.2}s`}
                        />
                     </circle>
                  ))}
               </svg>
            </div>

            {/* Controls */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto grid grid-cols-2 gap-8">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-yellow-400 uppercase tracking-widest">Battery Voltage</label>
                     <input
                        type="range"
                        min="1"
                        max="24"
                        value={voltage}
                        onChange={(e) => setVoltage(parseInt(e.target.value))}
                        className="w-full accent-yellow-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>1V</span>
                        <span className="text-white">{voltage}V</span>
                        <span>24V</span>
                     </div>
                  </div>
                  <div className="p-4 bg-yellow-500/5 rounded-2xl border border-yellow-500/10">
                     <p className="text-[10px] font-black text-yellow-400 uppercase tracking-widest mb-2">The Rule</p>
                     <p className="text-[10px] text-slate-400 leading-tight">
                        In a series circuit, the <strong>current is the same</strong> everywhere, but the <strong>voltage splits</strong> between the components.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- PARALLEL CIRCUIT RENDERER ---
   const ParallelCircuitRenderer = () => {
      const [voltage, setVoltage] = useState(12);
      const [resistors, setResistors] = useState([20, 30, 60]); // Ohms

      const currents = resistors.map(r => voltage / r);
      const totalCurrent = currents.reduce((a, b) => a + b, 0);
      const totalResistance = voltage / totalCurrent;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">PARALLEL CIRCUIT</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Multiple Paths & Constant Voltage</p>
               </div>
               <div className="bg-blue-500/10 px-4 py-2 rounded-xl border border-blue-500/20">
                  <p className="text-[8px] font-black text-blue-400 uppercase tracking-widest">Total Current</p>
                  <p className="text-sm font-black text-white">{totalCurrent.toFixed(2)} A</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <svg width="600" height="400" className="overflow-visible">
                  {/* Main Bus */}
                  <path d="M 100,200 L 150,200 M 150,100 L 150,300 M 450,100 L 450,300 M 450,200 L 500,200" fill="none" stroke="#334155" strokeWidth="4" />

                  {/* Battery */}
                  <g transform="translate(50, 175)">
                     <rect x="0" y="0" width="40" height="50" fill="#1e293b" rx="4" stroke="#3b82f6" strokeWidth="2" />
                     <text x="20" y="30" textAnchor="middle" className="text-[8px] font-black fill-blue-500">{voltage}V</text>
                  </g>

                  {/* Parallel Branches */}
                  {resistors.map((r, i) => {
                     const y = 100 + i * 100;
                     return (
                        <g key={i}>
                           <path d={`M 150,${y} L 250,${y} M 350,${y} L 450,${y}`} fill="none" stroke="#334155" strokeWidth="4" />
                           <g transform={`translate(250, ${y})`}>
                              <path d="M 0,0 L 10,0 L 15,-10 L 25,10 L 35,-10 L 45,10 L 50,0 L 100,0" fill="none" stroke="#94a3b8" strokeWidth="2" />
                              <text x="50" y="-20" textAnchor="middle" className="text-[8px] font-black fill-slate-500">{r} Œ©</text>
                              <text x="50" y="20" textAnchor="middle" className="text-[8px] font-bold fill-blue-400">{currents[i].toFixed(2)}A</text>
                           </g>
                           {/* Branch Electrons */}
                           {Array.from({ length: 6 }).map((_, j) => (
                              <circle key={j} r="2" fill="#3b82f6">
                                 <animateMotion
                                    dur={`${1.5 / currents[i]}s`}
                                    repeatCount="indefinite"
                                    path={`M 150,${y} L 450,${y}`}
                                    begin={`${j * 0.25}s`}
                                 />
                              </circle>
                           ))}
                        </g>
                     );
                  })}
               </svg>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto grid grid-cols-2 gap-8">
                  <div className="p-4 bg-blue-500/5 rounded-2xl border border-blue-500/10">
                     <p className="text-[10px] font-black text-blue-400 uppercase tracking-widest mb-2">The Rule</p>
                     <p className="text-[10px] text-slate-400 leading-tight">
                        In a parallel circuit, the <strong>voltage is the same</strong> across all branches, but the <strong>current splits</strong>. Adding more branches <strong>decreases</strong> total resistance!
                     </p>
                  </div>
                  <div className="flex items-center gap-4">
                     <div className="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20 shrink-0">
                        <span className="text-2xl">üè†</span>
                     </div>
                     <p className="text-xs text-slate-500 leading-relaxed">
                        This is how your house is wired. If one light goes out, the others stay on because they each have their own path to the battery!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- VOLTAGE POTENTIAL RENDERER ---
   const VoltagePotentialRenderer = () => {
      const [height, setHeight] = useState(100);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-400">ELECTRIC POTENTIAL</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">The Water Analogy</p>
               </div>
               <div className="bg-orange-500/10 px-4 py-2 rounded-xl border border-orange-500/20">
                  <p className="text-[8px] font-black text-orange-400 uppercase tracking-widest">Potential (Voltage)</p>
                  <p className="text-sm font-black text-white">{(height / 10).toFixed(1)} Volts</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <div className="relative w-full max-w-md h-64 border-b-4 border-slate-800">
                  {/* Water Tank */}
                  <div
                     className="absolute bottom-0 left-1/2 -translate-x-1/2 w-32 bg-blue-500/30 border-2 border-blue-400/50 rounded-t-xl transition-all duration-500"
                     style={{ height: `${height}px` }}
                  >
                     <div className="absolute top-0 left-0 right-0 h-1 bg-blue-300 animate-pulse" />
                     <div className="absolute inset-0 flex items-center justify-center">
                        <span className="text-[10px] font-black text-blue-400 uppercase tracking-widest rotate-90">High Pressure</span>
                     </div>
                  </div>

                  {/* Ground */}
                  <div className="absolute bottom-[-20px] left-0 right-0 text-center">
                     <span className="text-[10px] font-black text-slate-600 uppercase tracking-widest">Ground (0V)</span>
                  </div>

                  {/* Electrons (Falling) */}
                  {Array.from({ length: 8 }).map((_, i) => (
                     <div
                        key={i}
                        className="absolute w-2 h-2 bg-blue-400 rounded-full animate-bounce"
                        style={{
                           left: `${30 + i * 10}%`,
                           bottom: `${height + 20}px`,
                           animationDelay: `${i * 0.2}s`,
                           animationDuration: `${1.5 - height / 200}s`
                        }}
                     />
                  ))}
               </div>

               {/* Height Slider */}
               <div className="absolute right-12 top-1/2 -translate-y-1/2 h-48 flex flex-col items-center gap-4">
                  <span className="text-[8px] font-black text-slate-500 uppercase tracking-widest">Increase Potential</span>
                  <input
                     type="range"
                     min="20"
                     max="200"
                     value={height}
                     onChange={(e) => setHeight(parseInt(e.target.value))}
                     className="h-full appearance-none bg-slate-800 w-2 rounded-full outline-none"
                     style={{ writingMode: 'bt-lr' } as any}
                  />
                  <span className="text-[8px] font-black text-slate-500 uppercase tracking-widest">Decrease Potential</span>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-orange-500/10 flex items-center justify-center border border-orange-500/20 shrink-0">
                     <span className="text-2xl">üåä</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Think of <strong>Voltage</strong> like water pressure. The higher the tank, the more "push" the water has. In a circuit, voltage is the "push" that makes electrons flow!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- CURRENT FLOW RENDERER ---
   const CurrentFlowRenderer = () => {
      const [speed, setSpeed] = useState(1);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-cyan-400">ELECTRIC CURRENT</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Flow Rate & Amperes</p>
               </div>
               <div className="bg-cyan-500/10 px-4 py-2 rounded-xl border border-cyan-500/20">
                  <p className="text-[8px] font-black text-cyan-400 uppercase tracking-widest">Current (Amps)</p>
                  <p className="text-sm font-black text-white">{speed.toFixed(1)} A</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden">
               {/* Wire Section */}
               <div className="relative w-full max-w-2xl h-32 bg-slate-900/50 border-y-4 border-slate-800 flex items-center overflow-hidden">
                  {/* Electrons */}
                  {Array.from({ length: 20 }).map((_, i) => (
                     <div
                        key={i}
                        className="absolute w-6 h-6 bg-cyan-400 rounded-full flex items-center justify-center shadow-[0_0_15px_rgba(34,211,238,0.5)]"
                        style={{
                           left: `${(i * 10) % 110}%`,
                           animation: `flow ${2 / speed}s linear infinite`,
                           animationDelay: `${(i * 0.1)}s`
                        }}
                     >
                        <span className="text-[10px] font-black text-slate-900">-</span>
                     </div>
                  ))}
               </div>

               <style>{`
                  @keyframes flow {
                     from { transform: translateX(-100px); }
                     to { transform: translateX(800px); }
                  }
               `}</style>

               {/* Speed Slider */}
               <div className="mt-12 w-64">
                  <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest block text-center mb-4">Flow Rate</label>
                  <input
                     type="range"
                     min="0.1"
                     max="5"
                     step="0.1"
                     value={speed}
                     onChange={(e) => setSpeed(parseFloat(e.target.value))}
                     className="w-full accent-cyan-500"
                  />
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20 shrink-0">
                     <span className="text-2xl">‚ö°</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     <strong>Current</strong> is the rate at which charge flows. 1 Ampere means 6.24 quintillion electrons are passing through a point every single second!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- OHM'S LAW RENDERER ---
   const OhmsLawRenderer = () => {
      const [voltage, setVoltage] = useState(10);
      const [resistance, setResistance] = useState(5);

      const current = voltage / resistance;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-white">OHM'S LAW LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">V = I √ó R</p>
               </div>
               <div className="flex gap-4">
                  <div className="bg-slate-800 px-4 py-2 rounded-xl border border-slate-700">
                     <p className="text-[8px] font-black text-slate-500 uppercase tracking-widest">Current (I)</p>
                     <p className="text-sm font-black text-white">{current.toFixed(2)} A</p>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  {/* The "Ohm's Law" Triangle/Cartoon */}
                  <div className="relative w-64 h-64 flex items-center justify-center">
                     {/* Voltage (The Pusher) */}
                     <div
                        className="absolute top-0 w-24 h-24 bg-yellow-500 rounded-full flex items-center justify-center shadow-lg transition-all duration-300"
                        style={{ transform: `scale(${0.5 + voltage / 20})` }}
                     >
                        <span className="text-slate-900 font-black text-xl">V</span>
                     </div>

                     {/* Resistance (The Squeezer) */}
                     <div
                        className="absolute right-0 w-24 h-24 bg-red-500 rounded-full flex items-center justify-center shadow-lg transition-all duration-300"
                        style={{ transform: `scale(${0.5 + resistance / 20})` }}
                     >
                        <span className="text-white font-black text-xl">R</span>
                     </div>

                     {/* Current (The Flow) */}
                     <div
                        className="absolute bottom-0 w-24 h-24 bg-blue-500 rounded-full flex items-center justify-center shadow-lg transition-all duration-300"
                        style={{ transform: `scale(${0.5 + current / 5})` }}
                     >
                        <span className="text-white font-black text-xl">I</span>
                     </div>
                  </div>

                  <div className="mt-12 text-center">
                     <p className="text-2xl font-black tracking-tighter">
                        <span className="text-yellow-500">{voltage}V</span> =
                        <span className="text-blue-500"> {current.toFixed(2)}A</span> √ó
                        <span className="text-red-500"> {resistance}Œ©</span>
                     </p>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-8 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-yellow-500 uppercase tracking-widest">Voltage (V)</label>
                     <input
                        type="range"
                        min="1"
                        max="20"
                        value={voltage}
                        onChange={(e) => setVoltage(parseInt(e.target.value))}
                        className="w-full accent-yellow-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Low Push</span>
                        <span>{voltage}V</span>
                        <span>High Push</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-red-500 uppercase tracking-widest">Resistance (R)</label>
                     <input
                        type="range"
                        min="1"
                        max="20"
                        value={resistance}
                        onChange={(e) => setResistance(parseInt(e.target.value))}
                        className="w-full accent-red-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>Easy Path</span>
                        <span>{resistance}Œ©</span>
                        <span>Hard Path</span>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-6 bg-slate-800/50 rounded-3xl border border-slate-700">
                     <p className="text-[10px] font-bold text-slate-400 uppercase mb-2 tracking-widest text-center">The Insight</p>
                     <p className="text-xs leading-relaxed text-slate-300 text-center">
                        Voltage <strong>pushes</strong> current, while Resistance <strong>opposes</strong> it. If you double the resistance, you cut the current in half!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- ELECTROMAGNET RENDERER (ADVANCED) ---
   const ElectromagnetRenderer = () => {
      const [numCoils, setNumCoils] = useState(50);
      const [current, setCurrent] = useState(2);
      const [coreMaterial, setCoreMaterial] = useState<'air' | 'iron'>('air');

      const magneticField = (coreMaterial === 'iron' ? 100 : 1) * numCoils * current;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-400">ELECTROMAGNET LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Solenoids & Permeability</p>
               </div>
               <div className="bg-orange-500/10 px-4 py-2 rounded-xl border border-orange-500/20">
                  <p className="text-[8px] font-black text-orange-400 uppercase tracking-widest">Field Strength (B)</p>
                  <p className="text-sm font-black text-white">{(magneticField / 1000).toFixed(2)} Tesla (est.)</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="400" height="300" className="overflow-visible">
                     {/* Magnetic Field Lines */}
                     {Array.from({ length: 12 }).map((_, i) => (
                        <ellipse
                           key={i}
                           cx="200" cy="150"
                           rx={60 + i * 20}
                           ry={40 + i * 15}
                           fill="none"
                           stroke="#fb923c"
                           strokeWidth="1"
                           strokeOpacity={Math.min(0.5, (magneticField / 5000) * (1 - i / 12))}
                           className="animate-pulse"
                        />
                     ))}

                     {/* Core */}
                     <rect
                        x="100" y="130" width="200" height="40"
                        fill={coreMaterial === 'iron' ? '#475569' : 'transparent'}
                        stroke={coreMaterial === 'iron' ? '#64748b' : '#334155'}
                        strokeWidth="2"
                        rx="4"
                     />
                     {coreMaterial === 'air' && (
                        <text x="200" y="155" textAnchor="middle" className="text-[8px] font-black fill-slate-700">AIR CORE</text>
                     )}

                     {/* Coils */}
                     {Array.from({ length: Math.floor(numCoils / 5) }).map((_, i) => (
                        <path
                           key={i}
                           d={`M ${110 + i * 10},120 Q ${115 + i * 10},110 ${120 + i * 10},120 L ${120 + i * 10},180 Q ${115 + i * 10},190 ${110 + i * 10},180 Z`}
                           fill="none"
                           stroke="#b45309"
                           strokeWidth="2"
                        />
                     ))}
                  </svg>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-6 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Number of Turns (N)</label>
                     <input
                        type="range"
                        min="10"
                        max="100"
                        value={numCoils}
                        onChange={(e) => setNumCoils(parseInt(e.target.value))}
                        className="w-full accent-orange-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>10</span>
                        <span>{numCoils} Turns</span>
                        <span>100</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Current (I)</label>
                     <input
                        type="range"
                        min="0"
                        max="5"
                        step="0.1"
                        value={current}
                        onChange={(e) => setCurrent(parseFloat(e.target.value))}
                        className="w-full accent-orange-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>0A</span>
                        <span>{current} Amps</span>
                        <span>5A</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Core Material</label>
                     <div className="grid grid-cols-2 gap-2">
                        <button
                           onClick={() => setCoreMaterial('air')}
                           className={`p-2 rounded-xl border text-[10px] font-black transition-all ${coreMaterial === 'air' ? 'bg-orange-500 text-white' : 'bg-slate-800 text-slate-500 border-slate-700'}`}
                        >
                           AIR
                        </button>
                        <button
                           onClick={() => setCoreMaterial('iron')}
                           className={`p-2 rounded-xl border text-[10px] font-black transition-all ${coreMaterial === 'iron' ? 'bg-orange-500 text-white' : 'bg-slate-800 text-slate-500 border-slate-700'}`}
                        >
                           IRON
                        </button>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-4 bg-orange-500/5 rounded-2xl border border-orange-500/10">
                     <p className="text-[10px] font-bold text-orange-400 uppercase mb-2 tracking-widest">The Secret</p>
                     <p className="text-[10px] text-slate-400 leading-tight">
                        An iron core concentrates the magnetic field lines because it has high <strong>permeability</strong>. This can make the magnet 100x stronger!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- BASIC MOTOR RENDERER ---
   const BasicMotorRenderer = () => {
      const [speed, setSpeed] = useState(0);
      const [rotation, setRotation] = useState(0);

      useEffect(() => {
         if (speed === 0) return;
         const interval = setInterval(() => {
            setRotation(prev => (prev + speed) % 360);
         }, 16);
         return () => clearInterval(interval);
      }, [speed]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">DC MOTOR LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Lorentz Force & Commutation</p>
               </div>
               <div className="bg-blue-500/10 px-4 py-2 rounded-xl border border-blue-500/20">
                  <p className="text-[8px] font-black text-blue-400 uppercase tracking-widest">RPM (est.)</p>
                  <p className="text-sm font-black text-white">{speed * 60}</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <svg width="400" height="300" className="overflow-visible">
                  {/* Stator Magnets */}
                  <rect x="50" y="100" width="40" height="100" fill="#ef4444" rx="4" />
                  <text x="70" y="155" textAnchor="middle" className="text-xl font-black fill-white">N</text>
                  <rect x="310" y="100" width="40" height="100" fill="#3b82f6" rx="4" />
                  <text x="330" y="155" textAnchor="middle" className="text-xl font-black fill-white">S</text>

                  {/* Rotor (Armature) */}
                  <g transform={`rotate(${rotation}, 200, 150)`}>
                     <rect x="150" y="140" width="100" height="20" fill="#b45309" rx="2" stroke="#78350f" />
                     <rect x="195" y="100" width="10" height="100" fill="#b45309" rx="2" stroke="#78350f" />
                     {/* Force Arrows */}
                     {speed > 0 && (
                        <g>
                           <path d="M 150,140 L 150,100" stroke="#10b981" strokeWidth="4" markerEnd="url(#arrowhead)" />
                           <path d="M 250,160 L 250,200" stroke="#10b981" strokeWidth="4" markerEnd="url(#arrowhead)" />
                        </g>
                     )}
                  </g>

                  {/* Commutator & Brushes */}
                  <circle cx="200" cy="150" r="15" fill="#94a3b8" stroke="#475569" />
                  <path d="M 180,150 L 170,150 M 220,150 L 230,150" stroke="#475569" strokeWidth="4" />

                  <defs>
                     <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
                     </marker>
                  </defs>
               </svg>
            </div>

            {/* Controls */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex flex-col gap-4">
                  <label className="text-[10px] font-black text-blue-400 uppercase tracking-widest text-center">Throttle (Current)</label>
                  <input
                     type="range"
                     min="0"
                     max="10"
                     step="1"
                     value={speed}
                     onChange={(e) => setSpeed(parseInt(e.target.value))}
                     className="w-full accent-blue-500"
                  />
                  <div className="flex justify-between text-[10px] font-bold text-slate-500">
                     <span>OFF</span>
                     <span>{speed === 0 ? 'STOPPED' : 'RUNNING'}</span>
                     <span>MAX POWER</span>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- BASIC GENERATOR RENDERER ---
   const BasicGeneratorRenderer = () => {
      const [rotation, setRotation] = useState(0);
      const [isSpinning, setIsSpinning] = useState(false);

      useEffect(() => {
         if (!isSpinning) return;
         const interval = setInterval(() => {
            setRotation(prev => (prev + 5) % 360);
         }, 16);
         return () => clearInterval(interval);
      }, [isSpinning]);

      const voltage = Math.sin(rotation * (Math.PI / 180)) * 10;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-yellow-400">AC GENERATOR</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Faraday's Law & Induction</p>
               </div>
               <div className="bg-yellow-500/10 px-4 py-2 rounded-xl border border-yellow-500/20">
                  <p className="text-[8px] font-black text-yellow-400 uppercase tracking-widest">Output Voltage</p>
                  <p className="text-sm font-black text-white">{voltage.toFixed(2)} V</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <svg width="400" height="300" className="overflow-visible">
                     {/* Magnets */}
                     <rect x="50" y="100" width="40" height="100" fill="#ef4444" rx="4" />
                     <rect x="310" y="100" width="40" height="100" fill="#3b82f6" rx="4" />

                     {/* Rotating Coil */}
                     <g transform={`rotate(${rotation}, 200, 150)`}>
                        <rect x="150" y="100" width="100" height="100" fill="none" stroke="#fbbf24" strokeWidth="4" rx="4" />
                        {/* Flux Lines (Visual) */}
                        <line x1="150" y1="150" x2="250" y2="150" stroke="#fbbf24" strokeWidth="1" strokeDasharray="4 4" />
                     </g>

                     {/* Slip Rings */}
                     <circle cx="200" cy="250" r="10" fill="none" stroke="#94a3b8" strokeWidth="2" />
                     <circle cx="200" cy="270" r="10" fill="none" stroke="#94a3b8" strokeWidth="2" />
                  </svg>
               </div>

               {/* Oscilloscope */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-6 overflow-hidden border-t lg:border-t-0 border-slate-800">
                  <div className="flex-1 bg-slate-950 rounded-2xl border border-slate-800 relative overflow-hidden">
                     <div className="absolute inset-0 grid grid-cols-4 grid-rows-4 pointer-events-none">
                        {Array.from({ length: 16 }).map((_, i) => (
                           <div key={i} className="border border-slate-900/50" />
                        ))}
                     </div>
                     {/* Sine Wave */}
                     <svg className="absolute inset-0 w-full h-full">
                        <path
                           d={Array.from({ length: 100 }).map((_, i) => {
                              const x = (i / 100) * 320;
                              const y = 80 + Math.sin((i / 10 + rotation / 10) * Math.PI) * 50;
                              return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                           }).join(' ')}
                           fill="none"
                           stroke="#fbbf24"
                           strokeWidth="2"
                        />
                     </svg>
                     <div className="absolute top-2 left-2 text-[8px] font-black text-slate-500 uppercase tracking-widest">Oscilloscope</div>
                  </div>

                  <button
                     onClick={() => setIsSpinning(!isSpinning)}
                     className={`w-full py-4 rounded-2xl text-xs font-black transition-all ${isSpinning ? 'bg-red-500/20 text-red-400 border border-red-500/30' : 'bg-yellow-500 text-slate-900 shadow-lg shadow-yellow-500/40'}`}
                  >
                     {isSpinning ? 'STOP TURBINE' : 'START TURBINE'}
                  </button>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-yellow-500/10 flex items-center justify-center border border-yellow-500/20 shrink-0">
                     <span className="text-2xl">üåÄ</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     A generator is just a motor in reverse! Instead of using electricity to make motion, we use <strong>motion to make electricity</strong> by spinning a coil through a magnetic field.
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- EARTH FIELD RENDERER ---
   const EarthFieldRenderer = () => {
      const [showField, setShowField] = useState(true);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">GEOMAGNETISM</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Earth's Protective Shield</p>
               </div>
               <button
                  onClick={() => setShowField(!showField)}
                  className={`px-6 py-2 rounded-xl text-xs font-black transition-all ${showField ? 'bg-blue-500 text-white shadow-lg shadow-blue-500/40' : 'bg-slate-800 text-slate-500 border-slate-700'}`}
               >
                  {showField ? 'HIDE FIELD' : 'SHOW FIELD'}
               </button>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <div className="relative">
                  {/* Earth */}
                  <div className="w-48 h-48 rounded-full bg-gradient-to-br from-blue-600 to-emerald-600 shadow-[0_0_50px_rgba(59,130,246,0.3)] relative overflow-hidden border-2 border-blue-400/20">
                     {/* Continents (Simplified) */}
                     <div className="absolute top-4 left-8 w-12 h-8 bg-emerald-500/40 rounded-full blur-sm" />
                     <div className="absolute top-20 left-20 w-16 h-12 bg-emerald-500/40 rounded-full blur-sm" />
                     <div className="absolute bottom-8 left-12 w-10 h-14 bg-emerald-500/40 rounded-full blur-sm" />

                     {/* Internal Magnet */}
                     <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-32 flex flex-col rounded-full overflow-hidden opacity-80 rotate-[11deg]">
                        <div className="flex-1 bg-blue-600 flex items-center justify-center text-[8px] font-black">S</div>
                        <div className="flex-1 bg-red-600 flex items-center justify-center text-[8px] font-black">N</div>
                     </div>
                  </div>

                  {/* Magnetic Field Lines */}
                  {showField && (
                     <svg className="absolute inset-0 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] pointer-events-none overflow-visible" style={{ left: '50%', top: '50%' }}>
                        <defs>
                           <linearGradient id="earth-grad" x1="0%" y1="0%" x2="0%" y2="100%">
                              <stop offset="0%" stopColor="#3b82f6" stopOpacity="0.2" />
                              <stop offset="50%" stopColor="#3b82f6" stopOpacity="0.05" />
                              <stop offset="100%" stopColor="#3b82f6" stopOpacity="0.2" />
                           </linearGradient>
                        </defs>
                        <g transform="rotate(11, 300, 300)">
                           {Array.from({ length: 8 }).map((_, i) => (
                              <ellipse
                                 key={i}
                                 cx="300" cy="300"
                                 rx={100 + i * 40}
                                 ry={150 + i * 60}
                                 fill="none"
                                 stroke="url(#earth-grad)"
                                 strokeWidth="1.5"
                                 strokeDasharray="5 5"
                                 className="animate-[pulse_4s_infinite]"
                                 style={{ animationDelay: `${i * 0.5}s` }}
                              />
                           ))}
                        </g>
                     </svg>
                  )}

                  {/* Solar Wind (Visual) */}
                  <div className="absolute left-[-300px] top-1/2 -translate-y-1/2 flex flex-col gap-8 opacity-40">
                     {Array.from({ length: 5 }).map((_, i) => (
                        <div
                           key={i}
                           className="w-32 h-1 bg-gradient-to-r from-yellow-400 to-transparent rounded-full animate-[slide_2s_linear_infinite]"
                           style={{ animationDelay: `${i * 0.4}s` }}
                        />
                     ))}
                  </div>
               </div>

               <style>{`
                  @keyframes slide {
                     from { transform: translateX(0); }
                     to { transform: translateX(100px); }
                  }
               `}</style>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20 shrink-0">
                     <span className="text-2xl">üåç</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Earth is like a giant bar magnet! Its magnetic field (the <strong>magnetosphere</strong>) acts as a shield, deflecting harmful solar radiation and making life possible.
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- HOUSEHOLD SAFETY RENDERER ---
   const HouseholdSafetyRenderer = () => {
      const [isOverloaded, setIsOverloaded] = useState(false);
      const [breakerTripped, setBreakerTripped] = useState(false);
      const [appliances, setAppliances] = useState({
         toaster: false,
         microwave: false,
         kettle: false
      });

      const totalCurrent = (appliances.toaster ? 8 : 0) + (appliances.microwave ? 10 : 0) + (appliances.kettle ? 9 : 0);
      const limit = 20;

      useEffect(() => {
         if (totalCurrent > limit && !breakerTripped) {
            setIsOverloaded(true);
            const timer = setTimeout(() => {
               setBreakerTripped(true);
               setIsOverloaded(false);
            }, 1000);
            return () => clearTimeout(timer);
         }
      }, [totalCurrent, breakerTripped]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-red-400">ELECTRICAL SAFETY</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Breakers & Overloads</p>
               </div>
               <div className="flex gap-4">
                  <div className={`px-4 py-2 rounded-xl border transition-all ${breakerTripped ? 'bg-red-500/20 border-red-500/30' : 'bg-emerald-500/20 border-emerald-500/30'}`}>
                     <p className="text-[8px] font-black text-slate-500 uppercase tracking-widest">Breaker Status</p>
                     <p className={`text-sm font-black ${breakerTripped ? 'text-red-400' : 'text-emerald-400'}`}>
                        {breakerTripped ? 'TRIPPED' : 'ACTIVE'}
                     </p>
                  </div>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden">
               {/* Circuit Board */}
               <div className="w-full max-w-2xl bg-slate-900/50 rounded-3xl border border-slate-800 p-8">
                  <div className="flex justify-between items-end gap-8">
                     {/* Appliances */}
                     {Object.entries(appliances).map(([name, active]) => (
                        <button
                           key={name}
                           onClick={() => !breakerTripped && setAppliances(prev => ({ ...prev, [name]: !active }))}
                           className={`flex-1 p-6 rounded-2xl border transition-all flex flex-col items-center gap-4 ${active ? 'bg-slate-800 border-slate-600' : 'bg-slate-950 border-slate-800'}`}
                        >
                           <span className="text-3xl">{name === 'toaster' ? 'üçû' : name === 'microwave' ? 'üç±' : 'ü´ñ'}</span>
                           <span className="text-[10px] font-black uppercase tracking-widest text-slate-500">{name}</span>
                           <span className={`text-[10px] font-bold ${active ? 'text-emerald-400' : 'text-slate-700'}`}>{active ? 'ON' : 'OFF'}</span>
                        </button>
                     ))}
                  </div>

                  {/* Meter */}
                  <div className="mt-12 p-6 bg-slate-950 rounded-2xl border border-slate-800">
                     <div className="flex justify-between items-center mb-4">
                        <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Total Load</span>
                        <span className={`text-xl font-black ${totalCurrent > limit ? 'text-red-500' : 'text-white'}`}>{breakerTripped ? 0 : totalCurrent} / {limit} Amps</span>
                     </div>
                     <div className="h-4 bg-slate-900 rounded-full overflow-hidden border border-slate-800">
                        <div
                           className={`h-full transition-all duration-500 ${totalCurrent > limit ? 'bg-red-500' : 'bg-emerald-500'}`}
                           style={{ width: `${breakerTripped ? 0 : (totalCurrent / limit) * 100}%` }}
                        />
                     </div>
                  </div>
               </div>

               {breakerTripped && (
                  <button
                     onClick={() => {
                        setBreakerTripped(false);
                        setAppliances({ toaster: false, microwave: false, kettle: false });
                     }}
                     className="mt-8 px-8 py-3 bg-red-500 text-white rounded-xl font-black text-xs shadow-lg shadow-red-500/40 animate-bounce"
                  >
                     RESET CIRCUIT BREAKER
                  </button>
               )}
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-red-500/10 flex items-center justify-center border border-red-500/20 shrink-0">
                     <span className="text-2xl">üõ°Ô∏è</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     A <strong>circuit breaker</strong> is a safety switch. If too many appliances are on at once, the wire gets hot and could start a fire. The breaker "trips" to cut the power before that happens!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- COULOMB'S LAW RENDERER ---
   const CoulombsLawRenderer = () => {
      const [q1, setQ1] = useState(5); // microCoulombs
      const [q2, setQ2] = useState(-5);
      const [distance, setDistance] = useState(10); // cm

      const k = 8.987e9;
      const force = (k * Math.abs(q1 * 1e-6 * q2 * 1e-6)) / Math.pow(distance * 1e-2, 2);
      const isAttractive = (q1 > 0 && q2 < 0) || (q1 < 0 && q2 > 0);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-purple-400">COULOMB'S LAW</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Electrostatic Force</p>
               </div>
               <div className="bg-purple-500/10 px-4 py-2 rounded-xl border border-purple-500/20">
                  <p className="text-[8px] font-black text-purple-400 uppercase tracking-widest">Force (F)</p>
                  <p className="text-sm font-black text-white">{force.toFixed(2)} Newtons</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <div className="relative w-full max-w-2xl h-64 flex items-center justify-between px-20">
                  {/* Charge 1 */}
                  <div
                     className={`w-16 h-16 rounded-full flex items-center justify-center shadow-2xl transition-all duration-300 ${q1 > 0 ? 'bg-red-500 shadow-red-500/50' : 'bg-blue-500 shadow-blue-500/50'}`}
                     style={{ transform: `scale(${0.8 + Math.abs(q1) / 20})` }}
                  >
                     <span className="text-xl font-black">{q1 > 0 ? '+' : '-'}{Math.abs(q1)}</span>
                  </div>

                  {/* Force Arrows */}
                  <div className="flex-1 flex items-center justify-center relative">
                     <div className="w-full h-1 bg-slate-800 absolute top-1/2 -translate-y-1/2" />
                     <div
                        className={`absolute top-1/2 -translate-y-1/2 flex items-center gap-2 transition-all duration-500 ${isAttractive ? 'flex-row' : 'flex-row-reverse'}`}
                        style={{ width: `${100 - distance * 2}%` }}
                     >
                        <div className={`w-8 h-8 border-t-4 border-r-4 border-purple-500 ${isAttractive ? 'rotate-45' : '-rotate-[135deg]'}`} />
                        <div className="flex-1 h-1 bg-purple-500 animate-pulse" />
                        <div className={`w-8 h-8 border-t-4 border-r-4 border-purple-500 ${isAttractive ? '-rotate-[135deg]' : 'rotate-45'}`} />
                     </div>
                  </div>

                  {/* Charge 2 */}
                  <div
                     className={`w-16 h-16 rounded-full flex items-center justify-center shadow-2xl transition-all duration-300 ${q2 > 0 ? 'bg-red-500 shadow-red-500/50' : 'bg-blue-500 shadow-blue-500/50'}`}
                     style={{ transform: `scale(${0.8 + Math.abs(q2) / 20})` }}
                  >
                     <span className="text-xl font-black">{q2 > 0 ? '+' : '-'}{Math.abs(q2)}</span>
                  </div>
               </div>

               {/* Distance Label */}
               <div className="absolute bottom-20 left-1/2 -translate-x-1/2 text-[10px] font-black text-slate-500 uppercase tracking-widest">
                  Distance: {distance} cm
               </div>
            </div>

            {/* Controls */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-4xl mx-auto grid grid-cols-3 gap-8">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-red-400 uppercase tracking-widest">Charge 1 (ŒºC)</label>
                     <input
                        type="range"
                        min="-10"
                        max="10"
                        value={q1}
                        onChange={(e) => setQ1(parseInt(e.target.value))}
                        className="w-full accent-red-500"
                     />
                  </div>
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-blue-400 uppercase tracking-widest">Charge 2 (ŒºC)</label>
                     <input
                        type="range"
                        min="-10"
                        max="10"
                        value={q2}
                        onChange={(e) => setQ2(parseInt(e.target.value))}
                        className="w-full accent-blue-500"
                     />
                  </div>
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-purple-400 uppercase tracking-widest">Distance (cm)</label>
                     <input
                        type="range"
                        min="5"
                        max="50"
                        value={distance}
                        onChange={(e) => setDistance(parseInt(e.target.value))}
                        className="w-full accent-purple-500"
                     />
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- ELECTRIC FIELD RENDERER ---
   const ElectricFieldRenderer = () => {
      const [charges, setCharges] = useState([
         { x: 150, y: 150, q: 1 },
         { x: 350, y: 150, q: -1 }
      ]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-cyan-400">ELECTRIC FIELD MAP</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Vector Fields & Flux</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden">
               <svg width="500" height="300" className="overflow-visible">
                  {/* Field Vectors (Simplified Grid) */}
                  {Array.from({ length: 10 }).map((_, i) => (
                     Array.from({ length: 6 }).map((_, j) => {
                        const px = 50 + i * 45;
                        const py = 40 + j * 45;

                        // Calculate net field at this point
                        let ex = 0;
                        let ey = 0;
                        charges.forEach(c => {
                           const dx = px - c.x;
                           const dy = py - c.y;
                           const r2 = dx * dx + dy * dy;
                           const r = Math.sqrt(r2);
                           const f = c.q / (r2 * r);
                           ex += f * dx;
                           ey += f * dy;
                        });

                        const angle = Math.atan2(ey, ex) * (180 / Math.PI);
                        const mag = Math.sqrt(ex * ex + ey * ey);
                        const opacity = Math.min(0.6, mag * 100000);

                        return (
                           <g key={`${i}-${j}`} transform={`translate(${px}, ${py}) rotate(${angle})`} opacity={opacity}>
                              <path d="M -5,0 L 5,0 M 2,-3 L 5,0 L 2,3" fill="none" stroke="#22d3ee" strokeWidth="1" />
                           </g>
                        );
                     })
                  ))}

                  {/* Charges */}
                  {charges.map((c, i) => (
                     <circle
                        key={i}
                        cx={c.x} cy={c.y} r="12"
                        fill={c.q > 0 ? '#ef4444' : '#3b82f6'}
                        className="cursor-pointer"
                        onClick={() => {
                           const newCharges = [...charges];
                           newCharges[i].q *= -1;
                           setCharges(newCharges);
                        }}
                     />
                  ))}
               </svg>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-cyan-500/10 flex items-center justify-center border border-cyan-500/20 shrink-0">
                     <span className="text-2xl">üìç</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     Electric field lines always point <strong>away from positive</strong> charges and <strong>towards negative</strong> charges. The closer the lines, the stronger the field!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- CAPACITOR LAB RENDERER ---
   const CapacitorLabRenderer = () => {
      const [area, setArea] = useState(200); // mm^2
      const [separation, setSeparation] = useState(5); // mm
      const [voltage, setVoltage] = useState(5);

      const epsilon0 = 8.854e-12;
      const capacitance = (epsilon0 * area * 1e-6) / (separation * 1e-3);
      const charge = capacitance * voltage;
      const energy = 0.5 * capacitance * voltage * voltage;

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-400">CAPACITOR LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Dielectrics & Energy Storage</p>
               </div>
               <div className="flex gap-4">
                  <div className="bg-emerald-500/10 px-4 py-2 rounded-xl border border-emerald-500/20 text-right">
                     <p className="text-[8px] font-black text-emerald-400 uppercase tracking-widest">Capacitance</p>
                     <p className="text-sm font-black text-white">{(capacitance * 1e12).toFixed(2)} pF</p>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  <div className="relative flex flex-col items-center gap-4">
                     {/* Top Plate */}
                     <div
                        className="h-4 bg-slate-800 border-2 border-slate-600 rounded-full flex items-center justify-center relative shadow-[0_0_20px_rgba(16,185,129,0.2)]"
                        style={{ width: `${area / 2}px`, transform: `translateY(${-separation * 5}px)` }}
                     >
                        {Array.from({ length: Math.floor(charge * 1e11) }).map((_, i) => (
                           <div key={i} className="w-1 h-1 bg-red-500 rounded-full mx-0.5" />
                        ))}
                        <div className="absolute -top-6 text-[8px] font-black text-red-400">+ CHARGE</div>
                     </div>

                     {/* Bottom Plate */}
                     <div
                        className="h-4 bg-slate-800 border-2 border-slate-600 rounded-full flex items-center justify-center relative shadow-[0_0_20px_rgba(16,185,129,0.2)]"
                        style={{ width: `${area / 2}px`, transform: `translateY(${separation * 5}px)` }}
                     >
                        {Array.from({ length: Math.floor(charge * 1e11) }).map((_, i) => (
                           <div key={i} className="w-1 h-1 bg-blue-500 rounded-full mx-0.5" />
                        ))}
                        <div className="absolute -bottom-6 text-[8px] font-black text-blue-400">- CHARGE</div>
                     </div>

                     {/* Field Lines */}
                     <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                        {Array.from({ length: 10 }).map((_, i) => (
                           <div
                              key={i}
                              className="w-0.5 bg-emerald-500/20 absolute"
                              style={{
                                 height: `${separation * 10}px`,
                                 left: `${(i * 10) + (50 - (10 * 5))}%`
                              }}
                           />
                        ))}
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-6 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Plate Area (A)</label>
                     <input
                        type="range"
                        min="100"
                        max="400"
                        value={area}
                        onChange={(e) => setArea(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>100 mm¬≤</span>
                        <span>{area} mm¬≤</span>
                        <span>400 mm¬≤</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-emerald-400 uppercase tracking-widest">Separation (d)</label>
                     <input
                        type="range"
                        min="2"
                        max="20"
                        value={separation}
                        onChange={(e) => setSeparation(parseInt(e.target.value))}
                        className="w-full accent-emerald-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>2 mm</span>
                        <span>{separation} mm</span>
                        <span>20 mm</span>
                     </div>
                  </div>

                  <div className="p-4 bg-emerald-500/5 rounded-2xl border border-emerald-500/10">
                     <p className="text-[10px] font-bold text-emerald-400 uppercase mb-2 tracking-widest">Stored Energy</p>
                     <p className="text-xl font-black text-white">{(energy * 1e9).toFixed(2)} nJ</p>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-4 bg-slate-800/50 rounded-2xl border border-slate-700">
                     <p className="text-[10px] text-slate-400 leading-tight">
                        Capacitance increases with <strong>Area</strong> and decreases with <strong>Separation</strong>. It's like a bucket for electric charge!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- RLC CIRCUIT RENDERER ---
   const RLCCircuitRenderer = () => {
      const [frequency, setFrequency] = useState(60); // Hz
      const [resistance, setResistance] = useState(10); // Ohms
      const [inductance, setInductance] = useState(0.1); // Henrys
      const [capacitance, setCapacitance] = useState(100); // microFarads

      const omega = 2 * Math.PI * frequency;
      const xl = omega * inductance;
      const xc = 1 / (omega * capacitance * 1e-6);
      const impedance = Math.sqrt(Math.pow(resistance, 2) + Math.pow(xl - xc, 2));
      const phase = Math.atan((xl - xc) / resistance) * (180 / Math.PI);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-400">RLC CIRCUIT LAB</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Impedance & Resonance</p>
               </div>
               <div className="bg-blue-500/10 px-4 py-2 rounded-xl border border-blue-500/20">
                  <p className="text-[8px] font-black text-blue-400 uppercase tracking-widest">Impedance (Z)</p>
                  <p className="text-sm font-black text-white">{impedance.toFixed(2)} Œ©</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Visualizer */}
               <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden border-r border-slate-900">
                  {/* Phasor Diagram */}
                  <div className="relative w-64 h-64 border-2 border-slate-800 rounded-full">
                     <div className="absolute inset-0 flex items-center justify-center">
                        {/* R Vector */}
                        <div
                           className="h-1 bg-emerald-500 absolute origin-left"
                           style={{ width: `${resistance * 5}px`, transform: 'rotate(0deg)' }}
                        />
                        {/* XL Vector */}
                        <div
                           className="h-1 bg-red-500 absolute origin-left"
                           style={{ width: `${xl * 2}px`, transform: 'rotate(-90deg)' }}
                        />
                        {/* XC Vector */}
                        <div
                           className="h-1 bg-blue-500 absolute origin-left"
                           style={{ width: `${xc * 2}px`, transform: 'rotate(90deg)' }}
                        />
                        {/* Z Vector */}
                        <div
                           className="h-1.5 bg-white absolute origin-left shadow-[0_0_10px_rgba(255,255,255,0.5)]"
                           style={{ width: `${impedance * 5}px`, transform: `rotate(${-phase}deg)` }}
                        />
                     </div>
                     <div className="absolute top-2 left-2 text-[8px] font-black text-slate-500 uppercase">Phasor Diagram</div>
                  </div>

                  <div className="mt-12 grid grid-cols-3 gap-8 text-center">
                     <div>
                        <p className="text-[8px] font-black text-red-400 uppercase tracking-widest">X_L</p>
                        <p className="text-lg font-black">{xl.toFixed(1)}Œ©</p>
                     </div>
                     <div>
                        <p className="text-[8px] font-black text-blue-400 uppercase tracking-widest">X_C</p>
                        <p className="text-lg font-black">{xc.toFixed(1)}Œ©</p>
                     </div>
                     <div>
                        <p className="text-[8px] font-black text-white uppercase tracking-widest">Phase</p>
                        <p className="text-lg font-black">{phase.toFixed(1)}¬∞</p>
                     </div>
                  </div>
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-slate-900/30 p-6 flex flex-col gap-6 overflow-y-auto border-t lg:border-t-0 border-slate-800">
                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Frequency (f)</label>
                     <input
                        type="range"
                        min="10"
                        max="200"
                        value={frequency}
                        onChange={(e) => setFrequency(parseInt(e.target.value))}
                        className="w-full accent-blue-500"
                     />
                     <div className="flex justify-between text-[10px] font-bold text-slate-500">
                        <span>10 Hz</span>
                        <span>{frequency} Hz</span>
                        <span>200 Hz</span>
                     </div>
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Inductance (L)</label>
                     <input
                        type="range"
                        min="0.01"
                        max="0.5"
                        step="0.01"
                        value={inductance}
                        onChange={(e) => setInductance(parseFloat(e.target.value))}
                        className="w-full accent-red-500"
                     />
                  </div>

                  <div className="space-y-4">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Capacitance (C)</label>
                     <input
                        type="range"
                        min="10"
                        max="500"
                        value={capacitance}
                        onChange={(e) => setCapacitance(parseInt(e.target.value))}
                        className="w-full accent-blue-500"
                     />
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-4 bg-blue-500/5 rounded-2xl border border-blue-500/10">
                     <p className="text-[10px] text-slate-400 leading-tight">
                        Resonance occurs when <strong>X_L = X_C</strong>. At this point, the impedance is at its minimum and equal to the resistance!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- FARADAY'S LAW RENDERER ---
   const FaradaysLawRenderer = () => {
      const [magnetPos, setMagnetPos] = useState(0);
      const [isMoving, setIsMoving] = useState(false);
      const [inducedVoltage, setInducedVoltage] = useState(0);

      useEffect(() => {
         if (!isMoving) {
            setInducedVoltage(0);
            return;
         }
         const interval = setInterval(() => {
            setMagnetPos(prev => {
               const next = prev + 5;
               if (next > 400) {
                  setIsMoving(false);
                  return 0;
               }
               // Voltage is proportional to velocity (rate of change of flux)
               setInducedVoltage(Math.sin(next / 20) * 10);
               return next;
            });
         }, 16);
         return () => clearInterval(interval);
      }, [isMoving]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-400">FARADAY'S LAW</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Magnetic Induction</p>
               </div>
               <div className="bg-orange-500/10 px-4 py-2 rounded-xl border border-orange-500/20">
                  <p className="text-[8px] font-black text-orange-400 uppercase tracking-widest">Induced EMF (Œµ)</p>
                  <p className="text-sm font-black text-white">{inducedVoltage.toFixed(2)} V</p>
               </div>
            </div>

            <div className="flex-1 relative bg-slate-950 flex flex-col items-center justify-center p-8 overflow-hidden">
               <svg width="500" height="300" className="overflow-visible">
                  {/* Coil */}
                  <g transform="translate(250, 150)">
                     {Array.from({ length: 5 }).map((_, i) => (
                        <ellipse
                           key={i}
                           cx={-20 + i * 10} cy="0"
                           rx="20" ry="60"
                           fill="none"
                           stroke="#b45309"
                           strokeWidth="3"
                           strokeOpacity={0.8}
                        />
                     ))}
                  </g>

                  {/* Magnet */}
                  <g transform={`translate(${magnetPos}, 150)`}>
                     <rect x="-60" y="-20" width="60" height="40" fill="#ef4444" rx="4" />
                     <rect x="0" y="-20" width="60" height="40" fill="#3b82f6" rx="4" />
                     <text x="-30" y="5" textAnchor="middle" className="text-xs font-black fill-white">N</text>
                     <text x="30" y="5" textAnchor="middle" className="text-xs font-black fill-white">S</text>

                     {/* Magnetic Field Lines (Visual) */}
                     {Array.from({ length: 6 }).map((_, i) => (
                        <path
                           key={i}
                           d={`M 60,${-15 + i * 6} Q 100,${-30 + i * 12} 140,${-15 + i * 6}`}
                           fill="none"
                           stroke="#fb923c"
                           strokeWidth="1"
                           strokeOpacity="0.3"
                        />
                     ))}
                  </g>

                  {/* Galvanometer */}
                  <g transform="translate(250, 250)">
                     <rect x="-50" y="-30" width="100" height="60" fill="#1e293b" rx="8" stroke="#334155" />
                     <path d="M -40,10 Q 0,-40 40,10" fill="none" stroke="#475569" strokeWidth="2" />
                     <line
                        x1="0" y1="10"
                        x2={inducedVoltage * 4} y2="-20"
                        stroke="#ef4444"
                        strokeWidth="3"
                        className="transition-all duration-100"
                     />
                     <text x="0" y="20" textAnchor="middle" className="text-[8px] font-black fill-slate-500">GALVANOMETER</text>
                  </g>
               </svg>

               <button
                  onClick={() => setIsMoving(true)}
                  disabled={isMoving}
                  className={`mt-8 px-8 py-3 rounded-xl font-black text-xs transition-all ${isMoving ? 'bg-slate-800 text-slate-500' : 'bg-orange-500 text-white shadow-lg shadow-orange-500/40'}`}
               >
                  {isMoving ? 'INDUCING CURRENT...' : 'PUSH MAGNET THROUGH COIL'}
               </button>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-orange-500/10 flex items-center justify-center border border-orange-500/20 shrink-0">
                     <span className="text-2xl">üß≤</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     <strong>Lenz's Law</strong>: The induced current creates a magnetic field that <strong>opposes</strong> the change that created it. Nature doesn't like change!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- MAGNETIC FLUX RENDERER ---
   const MagneticFluxRenderer = () => {
      const [angle, setAngle] = useState(0);
      const [fieldStrength, setFieldStrength] = useState(0.5);
      const [loopArea, setLoopArea] = useState(0.1);
      const [isAnimating, setIsAnimating] = useState(false);

      const flux = fieldStrength * loopArea * Math.cos(angle * Math.PI / 180);

      useEffect(() => {
         if (!isAnimating) return;
         const interval = setInterval(() => {
            setAngle(prev => (prev + 2) % 360);
         }, 50);
         return () => clearInterval(interval);
      }, [isAnimating]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-800 bg-slate-900/50">
               <h3 className="text-xl font-black tracking-tight text-cyan-400">MAGNETIC FLUX</h3>
               <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Œ¶ = BA cos Œ∏</p>
            </div>

            <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <svg width="400" height="350" viewBox="0 0 400 350">
                     {/* Magnetic field lines */}
                     {Array.from({ length: 8 }).map((_, i) => (
                        <line key={i} x1="50" y1={70 + i * 30} x2="350" y2={70 + i * 30}
                           stroke="#3b82f6" strokeWidth="2" strokeOpacity={0.3 + fieldStrength * 0.5}
                           markerEnd="url(#arrowB)" />
                     ))}
                     <defs>
                        <marker id="arrowB" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                           <path d="M0,0 L6,3 L0,6 Z" fill="#3b82f6" fillOpacity={0.5 + fieldStrength * 0.5} />
                        </marker>
                     </defs>

                     {/* Loop */}
                     <g transform={`translate(200, 180) rotate(${angle})`}>
                        <ellipse cx="0" cy="0" rx={80 * loopArea * 10} ry="60" fill="none"
                           stroke="#fbbf24" strokeWidth="4" />
                        <line x1="0" y1="-60" x2="0" y2="-100" stroke="#fbbf24" strokeWidth="2" />
                        <polygon points="0,-100 -6,-88 6,-88" fill="#fbbf24" />
                        <text x="15" y="-85" className="text-[10px] font-bold fill-fbbf24">nÃÇ</text>
                     </g>

                     {/* Angle arc */}
                     <path d={`M 200,120 A 60,60 0 0 1 ${200 + 60 * Math.sin(angle * Math.PI / 180)},${120 - 60 * Math.cos(angle * Math.PI / 180)}`}
                        fill="none" stroke="#22c55e" strokeWidth="2" strokeDasharray="4" />
                     <text x="220" y="105" className="text-xs font-bold fill-emerald-400">Œ∏ = {angle}¬∞</text>
                  </svg>
               </div>

               <div className="w-full md:w-80 bg-slate-900/50 border-l border-slate-800 p-6 flex flex-col gap-6">
                  <div className="p-4 bg-gradient-to-br from-cyan-900/30 to-cyan-800/20 rounded-2xl border border-cyan-500/20">
                     <p className="text-[10px] font-black text-cyan-400 uppercase tracking-widest mb-2">Magnetic Flux</p>
                     <p className="text-3xl font-black text-white">{(flux * 1000).toFixed(2)} <span className="text-sm text-slate-400">mWb</span></p>
                  </div>

                  <div className="space-y-4">
                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-xs font-bold text-slate-400">Angle (Œ∏)</label>
                           <span className="text-xs font-mono text-cyan-400">{angle}¬∞</span>
                        </div>
                        <input type="range" min="0" max="360" value={angle} onChange={(e) => setAngle(Number(e.target.value))}
                           className="w-full h-2 bg-slate-700 rounded-full appearance-none cursor-pointer accent-cyan-500" />
                     </div>

                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-xs font-bold text-slate-400">Field Strength (B)</label>
                           <span className="text-xs font-mono text-cyan-400">{fieldStrength.toFixed(2)} T</span>
                        </div>
                        <input type="range" min="0.1" max="1" step="0.05" value={fieldStrength}
                           onChange={(e) => setFieldStrength(Number(e.target.value))}
                           className="w-full h-2 bg-slate-700 rounded-full appearance-none cursor-pointer accent-cyan-500" />
                     </div>

                     <div>
                        <div className="flex justify-between mb-2">
                           <label className="text-xs font-bold text-slate-400">Loop Area (A)</label>
                           <span className="text-xs font-mono text-cyan-400">{loopArea.toFixed(2)} m¬≤</span>
                        </div>
                        <input type="range" min="0.05" max="0.2" step="0.01" value={loopArea}
                           onChange={(e) => setLoopArea(Number(e.target.value))}
                           className="w-full h-2 bg-slate-700 rounded-full appearance-none cursor-pointer accent-cyan-500" />
                     </div>
                  </div>

                  <button onClick={() => setIsAnimating(!isAnimating)}
                     className={`w-full py-3 rounded-xl font-black text-xs transition-all ${isAnimating
                        ? 'bg-red-500/20 text-red-400 border border-red-500/30'
                        : 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/30'}`}>
                     {isAnimating ? '‚è∏ STOP ROTATION' : '‚ñ∂ ROTATE LOOP'}
                  </button>

                  <div className="mt-auto p-4 bg-slate-800/50 rounded-xl border border-slate-700">
                     <p className="text-xs text-slate-400 leading-relaxed">
                        <strong className="text-cyan-400">KEY INSIGHT:</strong> Flux is maximum when the loop is perpendicular to the field (Œ∏=0¬∞) and zero when parallel (Œ∏=90¬∞).
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- LENZ'S LAW RENDERER ---
   const LenzsLawRenderer = () => {
      const [magnetPosition, setMagnetPosition] = useState(0);
      const [magnetDirection, setMagnetDirection] = useState<'approaching' | 'receding' | 'stationary'>('stationary');
      const [inducedCurrent, setInducedCurrent] = useState(0);
      const [coilPolarity, setCoilPolarity] = useState<'N' | 'S' | null>(null);

      useEffect(() => {
         if (magnetDirection === 'stationary') {
            setInducedCurrent(0);
            setCoilPolarity(null);
            return;
         }

         const interval = setInterval(() => {
            setMagnetPosition(prev => {
               const delta = magnetDirection === 'approaching' ? 3 : -3;
               const next = prev + delta;

               if (next > 150 || next < -150) {
                  setMagnetDirection('stationary');
                  return 0;
               }

               const currentMagnitude = Math.abs(delta) * 2;
               setInducedCurrent(magnetDirection === 'approaching' ? -currentMagnitude : currentMagnitude);
               setCoilPolarity(magnetDirection === 'approaching' ? 'N' : 'S');
               return next;
            });
         }, 30);

         return () => clearInterval(interval);
      }, [magnetDirection]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-800 bg-slate-900/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-purple-400">LENZ'S LAW</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Induced Current Opposes Change</p>
               </div>
               <div className={`px-4 py-2 rounded-xl border ${inducedCurrent !== 0
                  ? 'bg-yellow-500/10 border-yellow-500/30'
                  : 'bg-slate-800 border-slate-700'}`}>
                  <p className="text-[8px] font-black text-slate-400 uppercase">Induced Current</p>
                  <p className={`text-lg font-black ${inducedCurrent > 0 ? 'text-green-400' : inducedCurrent < 0 ? 'text-red-400' : 'text-slate-500'}`}>
                     {inducedCurrent > 0 ? '‚Üª ' : inducedCurrent < 0 ? '‚Ü∫ ' : ''}{Math.abs(inducedCurrent).toFixed(1)} A
                  </p>
               </div>
            </div>

            <div className="flex-1 flex flex-col items-center justify-center p-8 relative">
               <svg width="500" height="280" viewBox="0 0 500 280">
                  {/* Coil */}
                  <g transform="translate(250, 140)">
                     {Array.from({ length: 8 }).map((_, i) => (
                        <ellipse key={i} cx={-35 + i * 10} cy="0" rx="25" ry="70"
                           fill="none" stroke={inducedCurrent !== 0 ? '#fbbf24' : '#64748b'}
                           strokeWidth="3" strokeOpacity={0.8} />
                     ))}
                     {coilPolarity && (
                        <text x="-70" y="10" className="text-2xl font-black"
                           fill={coilPolarity === 'N' ? '#ef4444' : '#3b82f6'}>{coilPolarity}</text>
                     )}
                  </g>

                  {/* Magnet */}
                  <g transform={`translate(${80 + magnetPosition}, 140)`}>
                     <rect x="-50" y="-25" width="50" height="50" fill="#ef4444" rx="4" />
                     <rect x="0" y="-25" width="50" height="50" fill="#3b82f6" rx="4" />
                     <text x="-25" y="8" textAnchor="middle" className="text-lg font-black fill-white">N</text>
                     <text x="25" y="8" textAnchor="middle" className="text-lg font-black fill-white">S</text>
                     {magnetDirection !== 'stationary' && (
                        <text x={magnetDirection === 'approaching' ? 70 : -70} y="8"
                           className="text-2xl" fill="#22c55e">{magnetDirection === 'approaching' ? '‚Üí' : '‚Üê'}</text>
                     )}
                  </g>

                  {/* Field lines from coil (when current flows) */}
                  {inducedCurrent !== 0 && (
                     <g transform="translate(250, 140)" opacity={0.4}>
                        {Array.from({ length: 5 }).map((_, i) => (
                           <path key={i} d={`M -80,${-30 + i * 15} Q -120,${-50 + i * 25} -80,${-30 + i * 15 + 30}`}
                              fill="none" stroke={coilPolarity === 'N' ? '#ef4444' : '#3b82f6'} strokeWidth="2" />
                        ))}
                     </g>
                  )}
               </svg>

               <div className="flex gap-4 mt-8">
                  <button onClick={() => { setMagnetPosition(-150); setMagnetDirection('approaching'); }}
                     disabled={magnetDirection !== 'stationary'}
                     className={`px-6 py-3 rounded-xl font-black text-xs transition-all ${magnetDirection !== 'stationary'
                        ? 'bg-slate-800 text-slate-600'
                        : 'bg-green-500 text-white shadow-lg shadow-green-500/30 hover:bg-green-400'}`}>
                     PUSH MAGNET IN ‚Üí
                  </button>
                  <button onClick={() => { setMagnetPosition(150); setMagnetDirection('receding'); }}
                     disabled={magnetDirection !== 'stationary'}
                     className={`px-6 py-3 rounded-xl font-black text-xs transition-all ${magnetDirection !== 'stationary'
                        ? 'bg-slate-800 text-slate-600'
                        : 'bg-red-500 text-white shadow-lg shadow-red-500/30 hover:bg-red-400'}`}>
                     ‚Üê PULL MAGNET OUT
                  </button>
               </div>

               <div className="mt-6 p-4 bg-slate-900/50 rounded-xl border border-slate-700 max-w-lg text-center">
                  {magnetDirection === 'approaching' && (
                     <p className="text-sm text-slate-300">
                        <span className="text-purple-400 font-bold">APPROACHING:</span> Flux ‚Üë ‚Üí Coil creates <span className="text-red-400 font-bold">N pole</span> to REPEL incoming magnet
                     </p>
                  )}
                  {magnetDirection === 'receding' && (
                     <p className="text-sm text-slate-300">
                        <span className="text-purple-400 font-bold">RECEDING:</span> Flux ‚Üì ‚Üí Coil creates <span className="text-blue-400 font-bold">S pole</span> to ATTRACT departing magnet
                     </p>
                  )}
                  {magnetDirection === 'stationary' && (
                     <p className="text-sm text-slate-500">Move the magnet to see Lenz's Law in action!</p>
                  )}
               </div>
            </div>

            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <p className="text-xs text-slate-400 text-center">
                  <strong className="text-purple-400">KEY INSIGHT:</strong> The induced current always creates a magnetic field that <strong>opposes</strong> the change in flux. This is nature's way of conserving energy!
               </p>
            </div>
         </div>
      );
   };


   // --- BATTERY CONNECTIONS RENDERER ---
   const BatteryConnectionsRenderer = () => {
      const [mode, setMode] = useState<'series' | 'parallel'>('series');
      const [numBatteries, setNumBatteries] = useState(2);
      const [singleVoltage] = useState(1.5);
      const [singleCapacity] = useState(2000);

      const totalVoltage = mode === 'series' ? singleVoltage * numBatteries : singleVoltage;
      const totalCapacity = mode === 'parallel' ? singleCapacity * numBatteries : singleCapacity;

      return (
         <div className="flex flex-col h-full bg-slate-100 text-slate-900 font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-200 bg-white flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-amber-600">BATTERY CONNECTIONS</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Series vs Parallel</p>
               </div>
               <div className="flex gap-2">
                  <button onClick={() => setMode('series')}
                     className={`px-4 py-2 rounded-lg font-bold text-xs transition-all ${mode === 'series'
                        ? 'bg-amber-500 text-white shadow-lg'
                        : 'bg-slate-200 text-slate-600 hover:bg-slate-300'}`}>
                     SERIES
                  </button>
                  <button onClick={() => setMode('parallel')}
                     className={`px-4 py-2 rounded-lg font-bold text-xs transition-all ${mode === 'parallel'
                        ? 'bg-blue-500 text-white shadow-lg'
                        : 'bg-slate-200 text-slate-600 hover:bg-slate-300'}`}>
                     PARALLEL
                  </button>
               </div>
            </div>

            <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
               <div className="flex-1 flex items-center justify-center p-8 bg-slate-50">
                  <svg width="400" height="300" viewBox="0 0 400 300">
                     {mode === 'series' ? (
                        <g transform="translate(50, 150)">
                           {Array.from({ length: numBatteries }).map((_, i) => (
                              <g key={i} transform={`translate(${i * 80}, 0)`}>
                                 <rect x="0" y="-30" width="60" height="60" fill="#fef3c7" stroke="#f59e0b" strokeWidth="2" rx="4" />
                                 <line x1="10" y1="-15" x2="10" y2="15" stroke="#ef4444" strokeWidth="4" />
                                 <line x1="50" y1="-8" x2="50" y2="8" stroke="#1f2937" strokeWidth="4" />
                                 <text x="30" y="50" textAnchor="middle" className="text-[10px] font-bold fill-slate-600">{singleVoltage}V</text>
                                 {i < numBatteries - 1 && <line x1="60" y1="0" x2="80" y2="0" stroke="#1f2937" strokeWidth="3" />}
                              </g>
                           ))}
                           <line x1="-20" y1="0" x2="0" y2="0" stroke="#ef4444" strokeWidth="3" />
                           <line x1={numBatteries * 80 - 20} y1="0" x2={numBatteries * 80} y2="0" stroke="#1f2937" strokeWidth="3" />
                           <text x={numBatteries * 40 - 10} y="-60" textAnchor="middle" className="text-lg font-black fill-amber-600">
                              Total: {totalVoltage.toFixed(1)}V
                           </text>
                        </g>
                     ) : (
                        <g transform="translate(100, 50)">
                           {Array.from({ length: numBatteries }).map((_, i) => (
                              <g key={i} transform={`translate(0, ${i * 70})`}>
                                 <rect x="50" y="0" width="60" height="50" fill="#dbeafe" stroke="#3b82f6" strokeWidth="2" rx="4" />
                                 <line x1="60" y1="10" x2="60" y2="40" stroke="#ef4444" strokeWidth="4" />
                                 <line x1="100" y1="15" x2="100" y2="35" stroke="#1f2937" strokeWidth="4" />
                                 <line x1="0" y1="25" x2="50" y2="25" stroke="#ef4444" strokeWidth="2" />
                                 <line x1="110" y1="25" x2="160" y2="25" stroke="#1f2937" strokeWidth="2" />
                              </g>
                           ))}
                           <line x1="0" y1="25" x2="0" y2={numBatteries * 70 - 45} stroke="#ef4444" strokeWidth="3" />
                           <line x1="160" y1="25" x2="160" y2={numBatteries * 70 - 45} stroke="#1f2937" strokeWidth="3" />
                           <text x="80" y={numBatteries * 70 + 20} textAnchor="middle" className="text-lg font-black fill-blue-600">
                              Total: {totalVoltage.toFixed(1)}V, {totalCapacity}mAh
                           </text>
                        </g>
                     )}
                  </svg>
               </div>

               <div className="w-full md:w-72 bg-white border-l border-slate-200 p-6 flex flex-col gap-4">
                  <div>
                     <label className="text-xs font-bold text-slate-500 uppercase mb-2 block">Number of Batteries</label>
                     <div className="flex gap-2">
                        {[2, 3, 4].map(n => (
                           <button key={n} onClick={() => setNumBatteries(n)}
                              className={`flex-1 py-2 rounded-lg font-bold text-sm ${numBatteries === n
                                 ? 'bg-slate-800 text-white'
                                 : 'bg-slate-100 text-slate-600 hover:bg-slate-200'}`}>
                              {n}
                           </button>
                        ))}
                     </div>
                  </div>

                  <div className="p-4 bg-amber-50 rounded-xl border border-amber-200">
                     <p className="text-[10px] font-black text-amber-700 uppercase mb-1">Series Connection</p>
                     <p className="text-sm text-amber-900">Voltages ADD: {numBatteries} √ó {singleVoltage}V = <strong>{(numBatteries * singleVoltage).toFixed(1)}V</strong></p>
                     <p className="text-xs text-amber-700 mt-1">Capacity stays the same</p>
                  </div>

                  <div className="p-4 bg-blue-50 rounded-xl border border-blue-200">
                     <p className="text-[10px] font-black text-blue-700 uppercase mb-1">Parallel Connection</p>
                     <p className="text-sm text-blue-900">Voltage stays: <strong>{singleVoltage}V</strong></p>
                     <p className="text-sm text-blue-900">Capacity ADDS: {numBatteries} √ó {singleCapacity}mAh = <strong>{numBatteries * singleCapacity}mAh</strong></p>
                  </div>

                  <div className="mt-auto p-4 bg-slate-100 rounded-xl">
                     <p className="text-xs text-slate-600">
                        <strong className="text-slate-800">KEY INSIGHT:</strong> Series for more voltage (flashlights), parallel for longer life (power banks).
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- BULB POWER RENDERER ---
   const BulbPowerRenderer = () => {
      const [voltage, setVoltage] = useState(6);
      const [resistance] = useState(10);

      const current = voltage / resistance;
      const power = voltage * current;
      const brightness = Math.min(power / 10, 1);

      return (
         <div className="flex flex-col h-full bg-slate-900 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-700 bg-slate-800/50 flex justify-between items-center">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-yellow-400">BULB POWER</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">P = V √ó I = V¬≤/R</p>
               </div>
               <div className="text-right">
                  <p className="text-[10px] font-bold text-slate-500">Power Output</p>
                  <p className="text-2xl font-black text-yellow-400">{power.toFixed(1)} W</p>
               </div>
            </div>

            <div className="flex-1 flex flex-col md:flex-row overflow-hidden">
               <div className="flex-1 flex items-center justify-center p-8 relative">
                  <div className="relative">
                     {/* Bulb glow effect */}
                     <div className="absolute inset-0 flex items-center justify-center">
                        <div className="w-40 h-40 rounded-full blur-3xl transition-all duration-300"
                           style={{
                              backgroundColor: `rgba(253, 224, 71, ${brightness})`,
                              transform: `scale(${0.5 + brightness * 1.5})`
                           }} />
                     </div>

                     {/* Bulb SVG */}
                     <svg width="200" height="280" viewBox="0 0 200 280" className="relative z-10">
                        {/* Glass bulb */}
                        <ellipse cx="100" cy="100" rx="70" ry="80" fill={`rgba(253, 224, 71, ${brightness * 0.8})`}
                           stroke="#fbbf24" strokeWidth="3" />
                        {/* Filament */}
                        <path d="M 70,100 Q 80,80 90,100 Q 100,120 110,100 Q 120,80 130,100"
                           fill="none" stroke={brightness > 0.3 ? '#ffffff' : '#666666'}
                           strokeWidth="3" strokeLinecap="round"
                           style={{ filter: brightness > 0.5 ? 'drop-shadow(0 0 8px #fff)' : 'none' }} />
                        {/* Base */}
                        <rect x="70" y="170" width="60" height="30" fill="#64748b" rx="4" />
                        <rect x="75" y="200" width="50" height="10" fill="#475569" />
                        <rect x="80" y="210" width="40" height="10" fill="#334155" />
                        {/* Contact */}
                        <circle cx="100" cy="230" r="10" fill="#1e293b" stroke="#475569" strokeWidth="2" />
                     </svg>
                  </div>

                  {/* Circuit visualization */}
                  <div className="absolute bottom-8 left-8 right-8">
                     <svg width="100%" height="60" viewBox="0 0 400 60" preserveAspectRatio="xMidYMid meet">
                        <line x1="20" y1="30" x2="120" y2="30" stroke="#ef4444" strokeWidth="3" />
                        <rect x="120" y="15" width="60" height="30" fill="none" stroke="#fbbf24" strokeWidth="2" rx="4" />
                        <text x="150" y="35" textAnchor="middle" className="text-[10px] font-bold fill-yellow-400">BULB</text>
                        <line x1="180" y1="30" x2="280" y2="30" stroke="#3b82f6" strokeWidth="3" />
                        <rect x="280" y="20" width="40" height="20" fill="#1e293b" stroke="#64748b" strokeWidth="2" />
                        <text x="300" y="35" textAnchor="middle" className="text-[8px] font-bold fill-slate-400">{resistance}Œ©</text>
                        <line x1="320" y1="30" x2="380" y2="30" stroke="#3b82f6" strokeWidth="3" />
                     </svg>
                  </div>
               </div>

               <div className="w-full md:w-80 bg-slate-800/50 border-l border-slate-700 p-6 flex flex-col gap-6">
                  <div>
                     <div className="flex justify-between mb-2">
                        <label className="text-xs font-bold text-slate-400">Voltage (V)</label>
                        <span className="text-sm font-mono font-bold text-yellow-400">{voltage} V</span>
                     </div>
                     <input type="range" min="0" max="12" step="0.5" value={voltage}
                        onChange={(e) => setVoltage(Number(e.target.value))}
                        className="w-full h-3 bg-slate-700 rounded-full appearance-none cursor-pointer accent-yellow-500" />
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                     <div className="p-3 bg-slate-900/50 rounded-xl border border-slate-700">
                        <p className="text-[10px] font-bold text-slate-500 uppercase">Current (I)</p>
                        <p className="text-lg font-black text-blue-400">{current.toFixed(2)} A</p>
                     </div>
                     <div className="p-3 bg-slate-900/50 rounded-xl border border-slate-700">
                        <p className="text-[10px] font-bold text-slate-500 uppercase">Resistance (R)</p>
                        <p className="text-lg font-black text-slate-400">{resistance} Œ©</p>
                     </div>
                  </div>

                  <div className="p-4 bg-yellow-500/10 rounded-xl border border-yellow-500/20">
                     <p className="text-[10px] font-black text-yellow-500 uppercase mb-2">Power Calculation</p>
                     <div className="space-y-1 font-mono text-sm text-slate-300">
                        <p>P = V √ó I = {voltage} √ó {current.toFixed(2)}</p>
                        <p>P = V¬≤/R = {voltage}¬≤/{resistance}</p>
                        <p className="text-yellow-400 font-bold">P = {power.toFixed(2)} W</p>
                     </div>
                  </div>

                  <div className="mt-auto p-4 bg-slate-900 rounded-xl border border-slate-700">
                     <p className="text-xs text-slate-400">
                        <strong className="text-yellow-400">KEY INSIGHT:</strong> Power increases with the SQUARE of voltage. Doubling voltage quadruples brightness!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };


   // --- COUNTING TO 100 RENDERER ---
   const Counting100Renderer = () => {
      const [count, setCount] = useState(1);
      const [character, setCharacter] = useState('üêª'); // Bear, Rabbit, Fox
      const [isJumping, setIsJumping] = useState(false);

      const getStoneColor = (num: number) => {
         if (num <= 10) return 'bg-emerald-500';
         if (num <= 20) return 'bg-yellow-400';
         if (num <= 30) return 'bg-orange-500';
         if (num <= 40) return 'bg-red-500';
         if (num <= 50) return 'bg-purple-500';
         if (num <= 60) return 'bg-blue-600';
         if (num <= 70) return 'bg-slate-400';
         if (num <= 80) return 'bg-amber-400';
         if (num <= 90) return 'bg-pink-400';
         return 'bg-slate-100';
      };

      const handleNext = () => {
         if (count < 100) {
            setIsJumping(true);
            setCount(prev => prev + 1);
            setTimeout(() => setIsJumping(false), 300);
         }
      };

      return (
         <div className="flex flex-col h-full bg-sky-400 text-slate-900 font-sans overflow-hidden relative">
            {/* Sky Background */}
            <div className="absolute inset-0 bg-gradient-to-b from-sky-300 to-sky-500 pointer-events-none" />

            {/* Clouds */}
            <div className="absolute top-10 left-10 animate-pulse opacity-50">‚òÅÔ∏è</div>
            <div className="absolute top-20 right-20 animate-bounce opacity-50">‚òÅÔ∏è</div>

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center bg-white/20 backdrop-blur-sm border-b border-white/30">
               <div>
                  <h3 className="text-2xl font-black tracking-tight text-white drop-shadow-md">MOUNTAIN CLIMB</h3>
                  <p className="text-[10px] font-bold text-sky-900 uppercase tracking-widest">Counting to 100</p>
               </div>
               <div className="flex gap-2">
                  {['üêª', 'üê∞', 'ü¶ä'].map(c => (
                     <button
                        key={c}
                        onClick={() => setCharacter(c)}
                        className={`w-10 h-10 rounded-full flex items-center justify-center text-xl transition-all ${character === c ? 'bg-white shadow-lg scale-110' : 'bg-white/50 hover:bg-white/80'}`}
                     >
                        {c}
                     </button>
                  ))}
               </div>
            </div>

            {/* Mountain View */}
            <div className="flex-1 relative overflow-hidden flex items-center justify-center p-8">
               {/* The Mountain Path (Simplified) */}
               <div className="relative w-full max-w-md h-full flex flex-col-reverse items-center">
                  {/* Stepping Stones (Visible Window) */}
                  <div className="w-full h-full relative flex flex-col items-center justify-center">
                     {/* Current Stone */}
                     <div className="relative">
                        <div className={`w-32 h-16 rounded-[2rem] shadow-2xl flex items-center justify-center border-4 border-white/50 transition-colors duration-500 ${getStoneColor(count)}`}>
                           <span className="text-4xl font-black text-white drop-shadow-md">{count}</span>
                        </div>

                        {/* Character */}
                        <div
                           className={`absolute -top-16 left-1/2 -translate-x-1/2 text-6xl transition-all duration-300 ${isJumping ? '-translate-y-12 scale-110' : 'translate-y-0 scale-100'}`}
                        >
                           {character}
                        </div>
                     </div>

                     {/* Next Stone Preview */}
                     {count < 100 && (
                        <div className={`w-24 h-12 rounded-[1.5rem] opacity-40 mt-12 flex items-center justify-center border-2 border-white/30 ${getStoneColor(count + 1)}`}>
                           <span className="text-xl font-bold text-white">{count + 1}</span>
                        </div>
                     )}

                     {/* Previous Stone Preview */}
                     {count > 1 && (
                        <div className={`w-24 h-12 rounded-[1.5rem] opacity-40 mb-12 absolute bottom-0 flex items-center justify-center border-2 border-white/30 ${getStoneColor(count - 1)}`}>
                           <span className="text-xl font-bold text-white">{count - 1}</span>
                        </div>
                     )}
                  </div>
               </div>

               {/* Progress Bar (Vertical) */}
               <div className="absolute right-8 top-1/2 -translate-y-1/2 w-4 h-64 bg-white/20 rounded-full overflow-hidden border border-white/30 shadow-inner">
                  <div
                     className="absolute bottom-0 left-0 w-full bg-white transition-all duration-500 shadow-[0_0_10px_rgba(255,255,255,0.8)]"
                     style={{ height: `${count}%` }}
                  />
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/10 backdrop-blur-md border-t border-white/30 flex flex-col items-center gap-6">
               <div className="flex items-center gap-8 w-full max-w-xl">
                  <button
                     onClick={() => setCount(Math.max(1, count - 1))}
                     className="w-16 h-16 rounded-2xl bg-white/20 hover:bg-white/40 flex items-center justify-center text-2xl text-white transition-all active:scale-95 border border-white/30"
                  >
                     ‚¨ÖÔ∏è
                  </button>

                  <button
                     onClick={handleNext}
                     className="flex-1 h-20 rounded-3xl bg-white text-sky-600 font-black text-2xl shadow-xl shadow-sky-900/20 hover:scale-[1.02] active:scale-95 transition-all flex items-center justify-center gap-4"
                  >
                     TAP TO CLIMB! üèîÔ∏è
                  </button>

                  <button
                     onClick={() => setCount(Math.min(100, count + 1))}
                     className="w-16 h-16 rounded-2xl bg-white/20 hover:bg-white/40 flex items-center justify-center text-2xl text-white transition-all active:scale-95 border border-white/30"
                  >
                     ‚û°Ô∏è
                  </button>
               </div>

               {/* Slider */}
               <div className="w-full max-w-xl space-y-2">
                  <input
                     type="range"
                     min="1"
                     max="100"
                     value={count}
                     onChange={(e) => setCount(parseInt(e.target.value))}
                     className="w-full h-3 bg-white/20 rounded-full appearance-none cursor-pointer accent-white"
                  />
                  <div className="flex justify-between text-[10px] font-black text-white/70 uppercase tracking-widest">
                     <span>Base (1)</span>
                     <span>Summit (100)</span>
                  </div>
               </div>
            </div>

            {/* Celebration Overlay */}
            {count % 10 === 0 && !isJumping && (
               <div className="absolute inset-0 pointer-events-none flex items-center justify-center z-50 animate-bounce">
                  <div className="bg-white/90 backdrop-blur-md p-8 rounded-[3rem] shadow-2xl border-4 border-yellow-400 text-center">
                     <p className="text-4xl font-black text-yellow-600">WAY TO GO!</p>
                     <p className="text-xl font-bold text-sky-600">You reached {count}!</p>
                     <div className="text-4xl mt-4">‚ú®üéâüéä</div>
                  </div>
               </div>
            )}
         </div>
      );
   };


   // --- ONE-TO-ONE CORRESPONDENCE RENDERER ---
   const OneToOneCorrespondenceRenderer = () => {
      const [guests, setGuests] = useState([
         { id: 1, name: 'Rabbit', icon: 'üê∞', items: { plate: false, cup: false } },
         { id: 2, name: 'Bear', icon: 'üêª', items: { plate: false, cup: false } },
         { id: 3, name: 'Fox', icon: 'ü¶ä', items: { plate: false, cup: false } },
      ]);
      const [draggedItem, setDraggedItem] = useState<string | null>(null);

      const handleDrop = (guestId: number, itemType: 'plate' | 'cup') => {
         setGuests(prev => prev.map(g =>
            g.id === guestId ? { ...g, items: { ...g.items, [itemType]: true } } : g
         ));
         setDraggedItem(null);
      };

      const allServed = guests.every(g => g.items.plate && g.items.cup);

      return (
         <div className="flex flex-col h-full bg-pink-50 text-slate-900 font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 border-b border-pink-100 bg-white flex justify-between items-center shadow-sm">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-pink-500">BIRTHDAY PARTY</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">One-to-One Correspondence</p>
               </div>
               {allServed && (
                  <div className="bg-green-500 text-white px-4 py-1 rounded-full text-xs font-black animate-bounce">
                     PARTY READY! üéâ
                  </div>
               )}
            </div>

            <div className="flex-1 p-8 flex flex-col items-center justify-center gap-12">
               {/* Party Table */}
               <div className="flex gap-8">
                  {guests.map(guest => (
                     <div key={guest.id} className="flex flex-col items-center gap-4">
                        <div className="text-6xl mb-2">{guest.icon}</div>
                        <div className="flex gap-4">
                           {/* Plate Slot */}
                           <div
                              onDragOver={(e) => e.preventDefault()}
                              onDrop={() => handleDrop(guest.id, 'plate')}
                              className={`w-16 h-16 rounded-full border-4 border-dashed flex items-center justify-center transition-all ${guest.items.plate ? 'border-pink-500 bg-white scale-110' : 'border-slate-200 bg-slate-50'}`}
                           >
                              {guest.items.plate ? <span className="text-3xl">üçΩÔ∏è</span> : <span className="text-xs text-slate-300 font-bold">PLATE</span>}
                           </div>
                           {/* Cup Slot */}
                           <div
                              onDragOver={(e) => e.preventDefault()}
                              onDrop={() => handleDrop(guest.id, 'cup')}
                              className={`w-12 h-12 rounded-lg border-4 border-dashed flex items-center justify-center transition-all ${guest.items.cup ? 'border-blue-400 bg-white scale-110' : 'border-slate-200 bg-slate-50'}`}
                           >
                              {guest.items.cup ? <span className="text-2xl">ü•§</span> : <span className="text-[8px] text-slate-300 font-bold">CUP</span>}
                           </div>
                        </div>
                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">{guest.name}</p>
                     </div>
                  ))}
               </div>

               {/* Supply Area */}
               <div className="p-6 bg-white rounded-[2rem] shadow-xl border-2 border-pink-100 flex gap-8 items-center">
                  <div className="text-center">
                     <div
                        draggable
                        onDragStart={() => setDraggedItem('plate')}
                        className="w-20 h-20 bg-pink-100 rounded-full flex items-center justify-center text-4xl cursor-grab active:cursor-grabbing hover:scale-110 transition-transform shadow-md"
                     >
                        üçΩÔ∏è
                     </div>
                     <p className="text-[8px] font-black text-pink-400 mt-2 uppercase tracking-widest">Plates</p>
                  </div>
                  <div className="text-center">
                     <div
                        draggable
                        onDragStart={() => setDraggedItem('cup')}
                        className="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center text-3xl cursor-grab active:cursor-grabbing hover:scale-110 transition-transform shadow-md"
                     >
                        ü•§
                     </div>
                     <p className="text-[8px] font-black text-blue-400 mt-2 uppercase tracking-widest">Cups</p>
                  </div>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-white border-t border-pink-100">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-pink-500/10 flex items-center justify-center border border-pink-500/20 shrink-0">
                     <span className="text-2xl">üç∞</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     <strong>One-to-One Correspondence</strong> means matching one object from one group to exactly one object in another group. Each guest gets exactly one plate and one cup!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- SUBITIZING RENDERER ---
   const SubitizingRenderer = () => {
      const [fireflies, setFireflies] = useState<{ x: number, y: number }[]>([]);
      const [isVisible, setIsVisible] = useState(false);
      const [score, setScore] = useState(0);
      const [gameState, setGameState] = useState<'idle' | 'flashing' | 'guessing' | 'result'>('idle');
      const [correctCount, setCorrectCount] = useState(0);
      const [lastGuess, setLastGuess] = useState<number | null>(null);

      const startFlash = () => {
         const count = Math.floor(Math.random() * 6) + 1; // 1-6 for subitizing
         const newFireflies = Array.from({ length: count }, () => ({
            x: 20 + Math.random() * 60,
            y: 20 + Math.random() * 60
         }));
         setFireflies(newFireflies);
         setCorrectCount(count);
         setGameState('flashing');
         setIsVisible(true);

         setTimeout(() => {
            setIsVisible(false);
            setGameState('guessing');
         }, 1000); // 1 second flash
      };

      const handleGuess = (num: number) => {
         setLastGuess(num);
         setGameState('result');
         if (num === correctCount) {
            setScore(prev => prev + 1);
         }
      };

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden relative">
            {/* Night Sky Background */}
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,#1e1b4b_0%,#020617_100%)]" />

            {/* Stars */}
            <div className="absolute inset-0 opacity-30 pointer-events-none">
               {Array.from({ length: 50 }).map((_, i) => (
                  <div
                     key={i}
                     className="absolute w-1 h-1 bg-white rounded-full animate-pulse"
                     style={{ top: `${Math.random() * 100}%`, left: `${Math.random() * 100}%`, animationDelay: `${Math.random() * 3}s` }}
                  />
               ))}
            </div>

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-white/10 bg-black/20 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-yellow-400">FIREFLY CATCH</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Subitizing Practice</p>
               </div>
               <div className="bg-yellow-400/20 px-4 py-1 rounded-full border border-yellow-400/30">
                  <span className="text-xs font-black text-yellow-400">SCORE: {score}</span>
               </div>
            </div>

            {/* Garden View */}
            <div className="flex-1 relative flex items-center justify-center">
               {gameState === 'idle' && (
                  <button
                     onClick={startFlash}
                     className="px-8 py-4 bg-yellow-400 text-slate-950 font-black rounded-2xl shadow-xl shadow-yellow-400/20 hover:scale-105 active:scale-95 transition-all"
                  >
                     READY? FLASH! ‚ú®
                  </button>
               )}

               {isVisible && (
                  <div className="absolute inset-0">
                     {fireflies.map((f, i) => (
                        <div
                           key={i}
                           className="absolute w-6 h-6 bg-yellow-300 rounded-full blur-[2px] shadow-[0_0_20px_#fde047]"
                           style={{ top: `${f.y}%`, left: `${f.x}%` }}
                        >
                           <div className="absolute inset-0 bg-yellow-100 rounded-full animate-ping opacity-50" />
                        </div>
                     ))}
                  </div>
               )}

               {gameState === 'guessing' && (
                  <div className="flex flex-col items-center gap-8">
                     <p className="text-2xl font-black text-white drop-shadow-lg">How many did you see?</p>
                     <div className="grid grid-cols-3 gap-4">
                        {[1, 2, 3, 4, 5, 6].map(num => (
                           <button
                              key={num}
                              onClick={() => handleGuess(num)}
                              className="w-20 h-20 bg-white/10 hover:bg-white/20 border-2 border-white/20 rounded-2xl flex items-center justify-center text-3xl font-black transition-all hover:scale-110 active:scale-90"
                           >
                              {num}
                           </button>
                        ))}
                     </div>
                  </div>
               )}

               {gameState === 'result' && (
                  <div className="flex flex-col items-center gap-6 animate-in fade-in zoom-in duration-300">
                     <div className={`text-6xl font-black ${lastGuess === correctCount ? 'text-green-400' : 'text-red-400'}`}>
                        {lastGuess === correctCount ? 'CORRECT! ‚ú®' : 'OOPS! üåô'}
                     </div>
                     <p className="text-xl text-slate-300">There were <span className="text-white font-black">{correctCount}</span> fireflies.</p>
                     <button
                        onClick={startFlash}
                        className="mt-4 px-8 py-3 bg-white text-slate-950 font-black rounded-xl hover:bg-slate-200 transition-colors"
                     >
                        PLAY AGAIN
                     </button>
                  </div>
               )}
            </div>

            {/* Footer Insight */}
            <div className="relative z-10 p-6 bg-black/40 backdrop-blur-md border-t border-white/10">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-yellow-400/10 flex items-center justify-center border border-yellow-400/20 shrink-0">
                     <span className="text-2xl">üí°</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     <strong>Subitizing</strong> is the ability to instantly recognize the number of objects in a small group without counting them one by one. It's like "seeing" the number!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- PLACE VALUE TENS AND ONES RENDERER ---
   const PlaceValueTensOnesRenderer = () => {
      const [ones, setOnes] = useState(0);
      const [tens, setTens] = useState(0);
      const [isBundling, setIsBundling] = useState(false);

      const addCandy = () => {
         if (ones < 9) {
            setOnes(prev => prev + 1);
         } else {
            // Auto-bundle or prompt to bundle
            setIsBundling(true);
            setTimeout(() => {
               setOnes(0);
               setTens(prev => prev + 1);
               setIsBundling(false);
            }, 800);
         }
      };

      const reset = () => {
         setOnes(0);
         setTens(0);
      };

      return (
         <div className="flex flex-col h-full bg-slate-50 text-slate-900 font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-indigo-600">CANDY FACTORY</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Place Value: Tens & Ones</p>
               </div>
               <div className="flex gap-4">
                  <div className="text-center">
                     <div className="text-2xl font-black text-indigo-600">{tens}</div>
                     <div className="text-[8px] font-bold text-slate-400 uppercase">Tens</div>
                  </div>
                  <div className="text-center">
                     <div className="text-2xl font-black text-orange-500">{ones}</div>
                     <div className="text-[8px] font-bold text-slate-400 uppercase">Ones</div>
                  </div>
               </div>
            </div>

            <div className="flex-1 p-8 flex gap-8 items-center justify-center">
               {/* Tens Station */}
               <div className="flex-1 h-full bg-indigo-50/50 rounded-[3rem] border-4 border-dashed border-indigo-100 p-8 flex flex-wrap content-start gap-4 relative overflow-hidden">
                  <div className="absolute top-4 left-1/2 -translate-x-1/2 text-[10px] font-black text-indigo-300 uppercase tracking-widest">Tens Station (Boxes)</div>
                  {Array.from({ length: tens }).map((_, i) => (
                     <div key={i} className="w-16 h-24 bg-indigo-500 rounded-xl shadow-lg flex flex-col items-center justify-center gap-1 border-2 border-indigo-400 animate-in zoom-in duration-300">
                        <div className="grid grid-cols-2 gap-1">
                           {Array.from({ length: 10 }).map((_, j) => (
                              <div key={j} className="w-2 h-2 bg-indigo-200 rounded-full" />
                           ))}
                        </div>
                        <span className="text-[8px] font-black text-white">BOX OF 10</span>
                     </div>
                  ))}
                  {isBundling && (
                     <div className="w-16 h-24 bg-indigo-400 rounded-xl animate-bounce flex items-center justify-center border-2 border-indigo-300">
                        <span className="text-2xl">üì¶</span>
                     </div>
                  )}
               </div>

               {/* Ones Bin */}
               <div className="flex-1 h-full bg-orange-50/50 rounded-[3rem] border-4 border-dashed border-orange-100 p-8 flex flex-wrap content-start gap-4 relative">
                  <div className="absolute top-4 left-1/2 -translate-x-1/2 text-[10px] font-black text-orange-300 uppercase tracking-widest">Ones Bin (Candies)</div>
                  {Array.from({ length: ones }).map((_, i) => (
                     <div key={i} className="w-10 h-10 bg-orange-500 rounded-full shadow-md flex items-center justify-center border-2 border-orange-400 animate-in slide-in-from-top duration-300">
                        <span className="text-lg">üç¨</span>
                     </div>
                  ))}
               </div>
            </div>

            {/* Controls */}
            <div className="p-8 bg-white border-t border-slate-200 flex flex-col items-center gap-6">
               <div className="flex gap-4 w-full max-w-md">
                  <button
                     onClick={addCandy}
                     disabled={isBundling}
                     className="flex-1 h-16 bg-indigo-600 text-white font-black rounded-2xl shadow-lg shadow-indigo-200 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3 disabled:opacity-50"
                  >
                     <span className="text-2xl">üç¨</span>
                     ADD CANDY
                  </button>
                  <button
                     onClick={reset}
                     className="w-16 h-16 bg-slate-100 text-slate-400 rounded-2xl hover:bg-slate-200 transition-colors flex items-center justify-center"
                  >
                     üîÑ
                  </button>
               </div>

               <div className="text-center">
                  <p className="text-4xl font-black text-slate-800 tracking-tighter">
                     <span className="text-indigo-600">{tens}</span>
                     <span className="text-orange-500">{ones}</span>
                  </p>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">
                     {tens} Tens + {ones} Ones = {tens * 10 + ones}
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- ADDITION AS PUTTING TOGETHER RENDERER ---
   const AdditionPuttingTogetherRenderer = () => {
      const [group1, setGroup1] = useState(3);
      const [group2, setGroup2] = useState(2);
      const [isMerging, setIsMerging] = useState(false);
      const [showResult, setShowResult] = useState(false);

      const handleMerge = () => {
         setIsMerging(true);
         setTimeout(() => {
            setIsMerging(false);
            setShowResult(true);
         }, 1000);
      };

      const reset = () => {
         setShowResult(false);
         setIsMerging(false);
      };

      return (
         <div className="flex flex-col h-full bg-emerald-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Water Background */}
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,#ecfdf5_0%,#d1fae5_100%)]" />

            {/* Ripples */}
            <div className="absolute inset-0 opacity-20 pointer-events-none">
               <div className="absolute top-1/4 left-1/4 w-64 h-64 border-4 border-emerald-200 rounded-full animate-ping" />
               <div className="absolute bottom-1/4 right-1/4 w-48 h-48 border-4 border-emerald-200 rounded-full animate-ping [animation-delay:1s]" />
            </div>

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-emerald-100 bg-white/50 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-600">GARDEN POND</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Addition: Putting Together</p>
               </div>
               <div className="flex gap-4">
                  <div className="text-center px-4 py-1 bg-white rounded-full border border-emerald-100 shadow-sm">
                     <span className="text-lg font-black text-emerald-600">{group1} + {group2} = {showResult ? group1 + group2 : '?'}</span>
                  </div>
               </div>
            </div>

            {/* Pond View */}
            <div className="flex-1 relative flex items-center justify-center p-12">
               {!showResult ? (
                  <div className="w-full flex justify-between items-center gap-12">
                     {/* Group 1 */}
                     <div className="flex-1 flex flex-wrap justify-center gap-4 p-8 bg-white/30 rounded-[3rem] border-2 border-dashed border-emerald-200 relative">
                        <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase">Group A</div>
                        {Array.from({ length: group1 }).map((_, i) => (
                           <div key={i} className="w-16 h-16 bg-emerald-400 rounded-full shadow-lg flex items-center justify-center text-3xl animate-bounce" style={{ animationDelay: `${i * 0.1}s` }}>
                              üçÄ
                           </div>
                        ))}
                        <div className="absolute -bottom-12 flex gap-2">
                           <button onClick={() => setGroup1(Math.max(1, group1 - 1))} className="w-8 h-8 bg-white rounded-full shadow-sm border border-emerald-100 flex items-center justify-center text-emerald-600 font-black">-</button>
                           <button onClick={() => setGroup1(Math.min(10, group1 + 1))} className="w-8 h-8 bg-white rounded-full shadow-sm border border-emerald-100 flex items-center justify-center text-emerald-600 font-black">+</button>
                        </div>
                     </div>

                     {/* Merge Button */}
                     <button
                        onClick={handleMerge}
                        className={`w-24 h-24 rounded-full bg-emerald-600 text-white flex items-center justify-center text-4xl shadow-xl shadow-emerald-900/20 hover:scale-110 active:scale-90 transition-all z-20 ${isMerging ? 'animate-ping' : ''}`}
                     >
                        ‚ûï
                     </button>

                     {/* Group 2 */}
                     <div className="flex-1 flex flex-wrap justify-center gap-4 p-8 bg-white/30 rounded-[3rem] border-2 border-dashed border-emerald-200 relative">
                        <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-emerald-500 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase">Group B</div>
                        {Array.from({ length: group2 }).map((_, i) => (
                           <div key={i} className="w-16 h-16 bg-emerald-400 rounded-full shadow-lg flex items-center justify-center text-3xl animate-bounce" style={{ animationDelay: `${i * 0.1}s` }}>
                              üçÄ
                           </div>
                        ))}
                        <div className="absolute -bottom-12 flex gap-2">
                           <button onClick={() => setGroup2(Math.max(1, group2 - 1))} className="w-8 h-8 bg-white rounded-full shadow-sm border border-emerald-100 flex items-center justify-center text-emerald-600 font-black">-</button>
                           <button onClick={() => setGroup2(Math.min(10, group2 + 1))} className="w-8 h-8 bg-white rounded-full shadow-sm border border-emerald-100 flex items-center justify-center text-emerald-600 font-black">+</button>
                        </div>
                     </div>
                  </div>
               ) : (
                  <div className="w-full max-w-2xl p-12 bg-white/40 backdrop-blur-md rounded-[4rem] border-4 border-emerald-400 flex flex-wrap justify-center gap-6 animate-in zoom-in duration-500">
                     <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-emerald-600 text-white px-8 py-2 rounded-full text-xl font-black uppercase shadow-lg">PUT TOGETHER!</div>
                     {Array.from({ length: group1 + group2 }).map((_, i) => (
                        <div key={i} className="w-20 h-20 bg-emerald-500 rounded-full shadow-xl flex items-center justify-center text-4xl animate-bounce" style={{ animationDelay: `${i * 0.05}s` }}>
                           üçÄ
                        </div>
                     ))}
                  </div>
               )}
            </div>

            {/* Footer Controls */}
            <div className="relative z-10 p-8 bg-white/60 backdrop-blur-md border-t border-emerald-100 flex flex-col items-center gap-4">
               {showResult && (
                  <button
                     onClick={reset}
                     className="px-8 py-3 bg-emerald-600 text-white font-black rounded-xl shadow-lg hover:bg-emerald-700 transition-colors"
                  >
                     TRY ANOTHER PROBLEM
                  </button>
               )}
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20 shrink-0">
                     <span className="text-2xl">üê∏</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     <strong>Addition</strong> is the process of putting two or more groups together to find the total. When we combine {group1} and {group2}, we get {group1 + group2}!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- SUBTRACTION AS TAKING APART RENDERER ---
   const SubtractionTakingApartRenderer = () => {
      const [apples, setApples] = useState([
         { id: 1, picked: false }, { id: 2, picked: false }, { id: 3, picked: false },
         { id: 4, picked: false }, { id: 5, picked: false }, { id: 6, picked: false },
         { id: 7, picked: false }, { id: 8, picked: false }
      ]);
      const [isPicking, setIsPicking] = useState(false);

      const total = apples.length;
      const pickedCount = apples.filter(a => a.picked).length;
      const remainingCount = total - pickedCount;

      const handlePick = (id: number) => {
         setApples(prev => prev.map(a => a.id === id ? { ...a, picked: !a.picked } : a));
      };

      const reset = () => {
         setApples(apples.map(a => ({ ...a, picked: false })));
      };

      return (
         <div className="flex flex-col h-full bg-sky-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Background */}
            <div className="absolute inset-0 bg-gradient-to-b from-sky-200 to-emerald-50 pointer-events-none" />

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-sky-100 bg-white/50 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-red-500">APPLE ORCHARD</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Subtraction: Taking Apart</p>
               </div>
               <div className="flex gap-4">
                  <div className="text-center px-4 py-1 bg-white rounded-full border border-red-100 shadow-sm">
                     <span className="text-lg font-black text-red-500">{total} - {pickedCount} = {remainingCount}</span>
                  </div>
               </div>
            </div>

            {/* Orchard View */}
            <div className="flex-1 relative flex items-center justify-center p-12">
               {/* The Tree */}
               <div className="relative w-96 h-96">
                  {/* Trunk */}
                  <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-16 h-48 bg-amber-900 rounded-t-xl" />
                  {/* Leaves */}
                  <div className="absolute top-0 left-1/2 -translate-x-1/2 w-80 h-80 bg-emerald-500 rounded-full shadow-2xl border-8 border-emerald-400" />

                  {/* Apples on Tree */}
                  <div className="absolute inset-0 flex items-center justify-center p-12">
                     <div className="grid grid-cols-3 gap-8">
                        {apples.map(apple => (
                           <button
                              key={apple.id}
                              onClick={() => handlePick(apple.id)}
                              className={`w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-3xl transition-all duration-500 hover:scale-110 active:scale-90 ${apple.picked ? 'opacity-0 pointer-events-none translate-y-32' : 'opacity-100'}`}
                           >
                              üçé
                           </button>
                        ))}
                     </div>
                  </div>
               </div>

               {/* Basket */}
               <div className="absolute bottom-12 right-12 w-48 h-32 bg-amber-700 rounded-b-[3rem] border-t-8 border-amber-800 shadow-xl flex flex-wrap justify-center content-start p-4 gap-2">
                  <div className="absolute -top-6 left-1/2 -translate-x-1/2 bg-amber-800 text-white px-4 py-1 rounded-full text-[10px] font-black uppercase">Basket</div>
                  {apples.filter(a => a.picked).map(a => (
                     <div key={a.id} className="text-2xl animate-in slide-in-from-top-12 duration-500">üçé</div>
                  ))}
               </div>
            </div>

            {/* Footer Insight */}
            <div className="relative z-10 p-8 bg-white/60 backdrop-blur-md border-t border-sky-100 flex flex-col items-center gap-4">
               <div className="flex gap-4">
                  <button onClick={reset} className="px-6 py-2 bg-red-500 text-white font-black rounded-xl shadow-lg hover:bg-red-600 transition-colors">RESET TREE</button>
               </div>
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-red-500/10 flex items-center justify-center border border-red-500/20 shrink-0">
                     <span className="text-2xl">üß∫</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     <strong>Subtraction</strong> can be thought of as "taking apart" a group. We started with {total} apples, took away {pickedCount}, and now {remainingCount} are left on the tree!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- FACT FAMILIES RENDERER ---
   const FactFamiliesRenderer = () => {
      const [family, setFamily] = useState({ a: 3, b: 5, c: 8 });
      const [equations, setEquations] = useState([
         { id: 1, type: 'add', parts: [null, '+', null, '=', null], correct: [3, 5, 8] },
         { id: 2, type: 'add', parts: [null, '+', null, '=', null], correct: [5, 3, 8] },
         { id: 3, type: 'sub', parts: [null, '-', null, '=', null], correct: [8, 3, 5] },
         { id: 4, type: 'sub', parts: [null, '-', null, '=', null], correct: [8, 5, 3] },
      ]);
      const [selectedSlot, setSelectedSlot] = useState<{ eqId: number, slotIdx: number } | null>(null);

      const handleNumberClick = (num: number) => {
         if (selectedSlot) {
            setEquations(prev => prev.map(eq => {
               if (eq.id === selectedSlot.eqId) {
                  const newParts = [...eq.parts];
                  newParts[selectedSlot.slotIdx] = num;
                  return { ...eq, parts: newParts };
               }
               return eq;
            }));
            setSelectedSlot(null);
         }
      };

      const isCorrect = (eq: any) => {
         const values = eq.parts.filter((p: any) => typeof p === 'number');
         if (values.length < 3) return false;
         if (eq.type === 'add') return values[0] + values[1] === values[2];
         return values[0] - values[1] === values[2];
      };

      return (
         <div className="flex flex-col h-full bg-amber-50 text-slate-900 font-sans overflow-hidden">
            {/* Header */}
            <div className="p-6 bg-white border-b border-amber-100 flex justify-between items-center shadow-sm">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-amber-600">NUMBER HOUSE</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Fact Families (Addition & Subtraction)</p>
               </div>
               <div className="flex gap-2 bg-amber-100 px-4 py-2 rounded-2xl border border-amber-200">
                  {[family.a, family.b, family.c].map((n, i) => (
                     <div key={i} className="w-10 h-10 bg-white rounded-xl flex items-center justify-center text-xl font-black text-amber-600 shadow-sm">{n}</div>
                  ))}
               </div>
            </div>

            <div className="flex-1 p-8 flex flex-col items-center justify-center gap-8">
               {/* House Visualization */}
               <div className="relative w-full max-w-2xl bg-white rounded-[3rem] shadow-2xl border-4 border-amber-100 p-12 flex flex-col gap-6">
                  <div className="absolute -top-12 left-1/2 -translate-x-1/2 w-0 h-0 border-l-[150px] border-l-transparent border-r-[150px] border-r-transparent border-b-[100px] border-b-amber-500" />

                  {equations.map(eq => (
                     <div key={eq.id} className="flex items-center justify-center gap-4 p-4 bg-slate-50 rounded-2xl border-2 border-slate-100 transition-all">
                        {eq.parts.map((part, idx) => (
                           typeof part === 'string' ? (
                              <span key={idx} className="text-2xl font-black text-slate-400">{part}</span>
                           ) : (
                              <button
                                 key={idx}
                                 onClick={() => setSelectedSlot({ eqId: eq.id, slotIdx: idx })}
                                 className={`w-16 h-16 rounded-xl border-4 flex items-center justify-center text-2xl font-black transition-all ${selectedSlot?.eqId === eq.id && selectedSlot?.slotIdx === idx ? 'border-amber-500 bg-amber-50 scale-110' : part !== null ? (isCorrect(eq) ? 'border-green-400 bg-green-50 text-green-600' : 'border-slate-200 bg-white') : 'border-dashed border-slate-200 bg-slate-100'}`}
                              >
                                 {part}
                              </button>
                           )
                        ))}
                        {isCorrect(eq) && <span className="text-2xl animate-bounce">‚úÖ</span>}
                     </div>
                  ))}
               </div>

               {/* Number Palette */}
               <div className="flex gap-6 p-6 bg-white rounded-[2rem] shadow-xl border-2 border-amber-100">
                  {[family.a, family.b, family.c].map(num => (
                     <button
                        key={num}
                        onClick={() => handleNumberClick(num)}
                        className="w-20 h-20 bg-amber-500 text-white rounded-2xl flex items-center justify-center text-4xl font-black shadow-lg hover:scale-110 active:scale-90 transition-all"
                     >
                        {num}
                     </button>
                  ))}
                  <button
                     onClick={() => setEquations(equations.map(eq => ({ ...eq, parts: eq.parts.map(p => typeof p === 'string' ? p : null) })))}
                     className="w-20 h-20 bg-slate-100 text-slate-400 rounded-2xl flex items-center justify-center text-2xl hover:bg-slate-200 transition-colors"
                  >
                     üîÑ
                  </button>
               </div>
            </div>

            {/* Footer Insight */}
            <div className="p-6 bg-white border-t border-amber-100">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-amber-500/10 flex items-center justify-center border border-amber-500/20 shrink-0">
                     <span className="text-2xl">üè†</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     A <strong>Fact Family</strong> is a group of math facts that use the same three numbers. They show how addition and subtraction are related!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- POSITIVE AND NEGATIVE NUMBERS INTRO RENDERER ---
   const PositiveNegativeIntroRenderer = () => {
      const [floor, setFloor] = useState(0);
      const [isMoving, setIsMoving] = useState(false);

      const handleGoTo = (target: number) => {
         setIsMoving(true);
         setFloor(target);
         setTimeout(() => setIsMoving(false), 800);
      };

      return (
         <div className="flex flex-col h-full bg-slate-900 text-white font-sans overflow-hidden relative">
            {/* Background Layers */}
            <div className="absolute inset-0 flex flex-col">
               <div className="flex-1 bg-sky-400" /> {/* Sky */}
               <div className="h-1 bg-emerald-600" /> {/* Ground Line */}
               <div className="flex-1 bg-slate-800" /> {/* Underground */}
            </div>

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center bg-black/40 backdrop-blur-md border-b border-white/10">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-yellow-400">MAGIC ELEVATOR</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Intro to Positive & Negative Numbers</p>
               </div>
               <div className="bg-white/10 px-4 py-1 rounded-full border border-white/20">
                  <span className={`text-lg font-black ${floor > 0 ? 'text-sky-300' : floor < 0 ? 'text-orange-400' : 'text-white'}`}>
                     FLOOR: {floor > 0 ? `+${floor}` : floor}
                  </span>
               </div>
            </div>

            {/* Elevator Shaft View */}
            <div className="flex-1 relative flex items-center justify-center">
               {/* Shaft */}
               <div className="w-32 h-full bg-black/20 border-x-4 border-white/10 relative">
                  {/* Floor Markers */}
                  {[-3, -2, -1, 0, 1, 2, 3].map(f => (
                     <div
                        key={f}
                        className="absolute w-full h-px bg-white/10 flex items-center justify-end pr-2"
                        style={{ bottom: `${(f + 3) * 16.6}%` }}
                     >
                        <span className="text-[8px] font-bold text-white/30">{f > 0 ? `+${f}` : f}</span>
                     </div>
                  ))}

                  {/* Elevator Car */}
                  <div
                     className={`absolute left-2 right-2 h-20 bg-yellow-400 rounded-lg shadow-[0_0_30px_rgba(250,204,21,0.4)] flex flex-col items-center justify-center border-2 border-yellow-200 transition-all duration-700 ease-in-out z-20`}
                     style={{ bottom: `calc(${(floor + 3) * 16.6}% - 40px)` }}
                  >
                     <div className="text-2xl">üö†</div>
                     <span className="text-xs font-black text-slate-900">{floor > 0 ? `+${floor}` : floor}</span>
                     {isMoving && <div className="absolute -bottom-8 text-xl animate-bounce">‚ú®</div>}
                  </div>
               </div>

               {/* Environment Decorations */}
               <div className="absolute top-1/4 left-1/4 text-4xl opacity-50">‚òÅÔ∏è</div>
               <div className="absolute bottom-1/4 right-1/4 text-4xl opacity-20">ü™±</div>
               <div className="absolute bottom-1/3 left-1/3 text-4xl opacity-20">üíé</div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-black/60 backdrop-blur-xl border-t border-white/10 flex flex-col items-center gap-6">
               <div className="flex gap-4">
                  <div className="flex flex-col gap-2">
                     <p className="text-[8px] font-black text-sky-400 uppercase tracking-widest text-center">Above Ground (+)</p>
                     <div className="flex gap-2">
                        {[3, 2, 1].map(f => (
                           <button
                              key={f}
                              onClick={() => handleGoTo(f)}
                              className={`w-12 h-12 rounded-xl font-black transition-all ${floor === f ? 'bg-sky-400 text-white scale-110 shadow-lg shadow-sky-400/20' : 'bg-white/10 hover:bg-white/20 text-sky-200'}`}
                           >
                              +{f}
                           </button>
                        ))}
                     </div>
                  </div>

                  <button
                     onClick={() => handleGoTo(0)}
                     className={`w-12 h-12 mt-5 rounded-xl font-black transition-all ${floor === 0 ? 'bg-white text-slate-900 scale-110 shadow-lg' : 'bg-white/10 hover:bg-white/20 text-white'}`}
                  >
                     0
                  </button>

                  <div className="flex flex-col gap-2">
                     <p className="text-[8px] font-black text-orange-400 uppercase tracking-widest text-center">Below Ground (-)</p>
                     <div className="flex gap-2">
                        {[-1, -2, -3].map(f => (
                           <button
                              key={f}
                              onClick={() => handleGoTo(f)}
                              className={`w-12 h-12 rounded-xl font-black transition-all ${floor === f ? 'bg-orange-500 text-white scale-110 shadow-lg shadow-orange-500/20' : 'bg-white/10 hover:bg-white/20 text-orange-200'}`}
                           >
                              {f}
                           </button>
                        ))}
                     </div>
                  </div>
               </div>

               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-yellow-400/10 flex items-center justify-center border border-yellow-400/20 shrink-0">
                     <span className="text-2xl">‚ÜïÔ∏è</span>
                  </div>
                  <p className="text-xs text-slate-400 leading-relaxed">
                     <strong>Positive numbers</strong> are above zero (like floors above ground). <strong>Negative numbers</strong> are below zero (like basement floors). Zero is the starting point!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- SKIP COUNTING RENDERER ---
   const SkipCountingRenderer = () => {
      const [interval, setInterval] = useState(2);
      const [current, setCurrent] = useState(0);
      const [history, setHistory] = useState<number[]>([0]);
      const [isJumping, setIsJumping] = useState(false);

      const handleJump = () => {
         if (current + interval <= 50) {
            setIsJumping(true);
            const next = current + interval;
            setCurrent(next);
            setHistory(prev => [...prev, next]);
            setTimeout(() => setIsJumping(false), 500);
         }
      };

      const reset = (newInterval?: number) => {
         if (newInterval) setInterval(newInterval);
         setCurrent(0);
         setHistory([0]);
         setIsJumping(false);
      };

      return (
         <div className="flex flex-col h-full bg-emerald-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Pond Background */}
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,#ecfdf5_0%,#d1fae5_100%)]" />

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-emerald-100 bg-white/50 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-600">FROG JUMP</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Skip Counting (2s, 5s, 10s)</p>
               </div>
               <div className="flex gap-2">
                  {[2, 5, 10].map(i => (
                     <button
                        key={i}
                        onClick={() => reset(i)}
                        className={`px-4 py-1 rounded-full text-xs font-black transition-all ${interval === i ? 'bg-emerald-600 text-white shadow-lg' : 'bg-white text-emerald-600 border border-emerald-100 hover:bg-emerald-50'}`}
                     >
                        SKIP {i}s
                     </button>
                  ))}
               </div>
            </div>

            {/* Number Line View */}
            <div className="flex-1 relative flex items-center justify-center p-12 overflow-x-auto">
               <div className="relative w-full max-w-4xl h-64 flex items-center">
                  {/* The Line */}
                  <div className="absolute w-full h-2 bg-emerald-200 rounded-full" />

                  {/* Ticks & Numbers */}
                  {Array.from({ length: 51 }).map((_, i) => (
                     (i % 5 === 0 || i === current) && (
                        <div
                           key={i}
                           className="absolute flex flex-col items-center gap-2 transition-all duration-500"
                           style={{ left: `${(i / 50) * 100}%` }}
                        >
                           <div className={`w-1 h-4 ${i % 10 === 0 ? 'bg-emerald-600 h-6' : 'bg-emerald-300'}`} />
                           <span className={`text-[10px] font-black ${history.includes(i) ? 'text-emerald-600 scale-125' : 'text-slate-300'}`}>{i}</span>
                        </div>
                     )
                  ))}

                  {/* Jump Arcs */}
                  <svg className="absolute inset-0 w-full h-full pointer-events-none overflow-visible">
                     {history.slice(0, -1).map((val, idx) => {
                        const nextVal = history[idx + 1];
                        const x1 = (val / 50) * 100;
                        const x2 = (nextVal / 50) * 100;
                        const midX = (x1 + x2) / 2;
                        return (
                           <path
                              key={idx}
                              d={`M ${x1}% 50% Q ${midX}% 0% ${x2}% 50%`}
                              fill="none"
                              stroke="#10b981"
                              strokeWidth="3"
                              strokeDasharray="8 4"
                              className="animate-in fade-in duration-500"
                           />
                        );
                     })}
                  </svg>

                  {/* The Frog */}
                  <div
                     className={`absolute w-16 h-16 flex items-center justify-center text-4xl transition-all duration-500 ease-out z-20`}
                     style={{
                        left: `calc(${(current / 50) * 100}% - 32px)`,
                        bottom: isJumping ? '60%' : '40%',
                        transform: `scaleX(${isJumping ? 1.2 : 1})`
                     }}
                  >
                     üê∏
                  </div>
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/60 backdrop-blur-md border-t border-emerald-100 flex flex-col items-center gap-4">
               <div className="flex gap-4 w-full max-w-md">
                  <button
                     onClick={handleJump}
                     disabled={current + interval > 50 || isJumping}
                     className="flex-1 h-16 bg-emerald-600 text-white font-black rounded-2xl shadow-lg shadow-emerald-200 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3 disabled:opacity-50"
                  >
                     JUMP {interval}! üöÄ
                  </button>
                  <button
                     onClick={() => reset()}
                     className="w-16 h-16 bg-slate-100 text-slate-400 rounded-2xl hover:bg-slate-200 transition-colors flex items-center justify-center"
                  >
                     üîÑ
                  </button>
               </div>

               <div className="flex flex-wrap justify-center gap-2">
                  {history.map((h, i) => (
                     <span key={i} className="text-xs font-black text-emerald-600 bg-white px-2 py-1 rounded-lg border border-emerald-100 shadow-sm animate-in zoom-in">
                        {h}
                     </span>
                  ))}
               </div>
            </div>
         </div>
      );
   };


   // --- FRACTION INTRODUCTION RENDERER ---
   const FractionIntroRenderer = () => {
      const [denominator, setDenominator] = useState(4);
      const [numerator, setNumerator] = useState(1);

      const slices = Array.from({ length: denominator });

      const toggleSlice = (idx: number) => {
         // This is a simple model where we just count how many are selected
         // In a real app, we might track specific slices
         if (numerator === idx + 1) {
            setNumerator(idx);
         } else {
            setNumerator(idx + 1);
         }
      };

      return (
         <div className="flex flex-col h-full bg-orange-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-orange-100 bg-white/50 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-orange-600">PIZZA PARTY</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Introduction to Fractions</p>
               </div>
               <div className="flex items-center gap-4 bg-white px-6 py-2 rounded-2xl border border-orange-100 shadow-sm">
                  <div className="flex flex-col items-center">
                     <span className="text-2xl font-black text-orange-600 leading-none">{numerator}</span>
                     <div className="w-8 h-1 bg-slate-300 my-1 rounded-full" />
                     <span className="text-2xl font-black text-slate-600 leading-none">{denominator}</span>
                  </div>
                  <div className="text-[10px] font-bold text-slate-400 uppercase leading-tight">
                     {numerator} of {denominator}<br />parts
                  </div>
               </div>
            </div>

            {/* Pizza View */}
            <div className="flex-1 relative flex items-center justify-center p-12">
               <div className="relative w-80 h-80 bg-amber-100 rounded-full shadow-2xl border-8 border-amber-200 overflow-hidden">
                  {/* Slices */}
                  <svg className="absolute inset-0 w-full h-full" viewBox="0 0 100 100">
                     {slices.map((_, i) => {
                        const angle = (360 / denominator);
                        const startAngle = i * angle;
                        const endAngle = (i + 1) * angle;

                        // Path for a pie slice
                        const x1 = 50 + 50 * Math.cos((startAngle - 90) * Math.PI / 180);
                        const y1 = 50 + 50 * Math.sin((startAngle - 90) * Math.PI / 180);
                        const x2 = 50 + 50 * Math.cos((endAngle - 90) * Math.PI / 180);
                        const y2 = 50 + 50 * Math.sin((endAngle - 90) * Math.PI / 180);

                        const largeArcFlag = angle > 180 ? 1 : 0;
                        const d = `M 50 50 L ${x1} ${y1} A 50 50 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;

                        return (
                           <path
                              key={i}
                              d={d}
                              onClick={() => setNumerator(i + 1)}
                              className={`cursor-pointer transition-all duration-300 ${i < numerator ? 'fill-orange-500 stroke-orange-600 stroke-2' : 'fill-amber-50/50 stroke-amber-200 stroke-1 hover:fill-amber-100'}`}
                           />
                        );
                     })}
                  </svg>

                  {/* Toppings (Visual only) */}
                  <div className="absolute inset-0 pointer-events-none opacity-40">
                     {Array.from({ length: 12 }).map((_, i) => (
                        <div
                           key={i}
                           className="absolute w-4 h-4 bg-red-600 rounded-full"
                           style={{
                              top: `${20 + Math.random() * 60}%`,
                              left: `${20 + Math.random() * 60}%`,
                              transform: `rotate(${Math.random() * 360}deg)`
                           }}
                        />
                     ))}
                  </div>
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/60 backdrop-blur-md border-t border-orange-100 flex flex-col items-center gap-6">
               <div className="flex flex-col items-center gap-2">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Divide into how many slices?</p>
                  <div className="flex gap-2">
                     {[2, 3, 4, 6, 8].map(d => (
                        <button
                           key={d}
                           onClick={() => { setDenominator(d); setNumerator(1); }}
                           className={`w-12 h-12 rounded-xl font-black transition-all ${denominator === d ? 'bg-orange-600 text-white scale-110 shadow-lg' : 'bg-white text-orange-600 border border-orange-100 hover:bg-orange-50'}`}
                        >
                           {d}
                        </button>
                     ))}
                  </div>
               </div>

               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-orange-500/10 flex items-center justify-center border border-orange-500/20 shrink-0">
                     <span className="text-2xl">üçï</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     A <strong>Fraction</strong> tells us how many parts of a whole we have. The <strong>bottom number (denominator)</strong> is the total number of slices. The <strong>top number (numerator)</strong> is how many slices we've picked!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- MULTIPLICATION AS REPEATED ADDITION RENDERER ---
   const MultiplicationRepeatedAdditionRenderer = () => {
      const [groups, setGroups] = useState(3);
      const [perGroup, setPerGroup] = useState(4);
      const [showArray, setShowArray] = useState(true);

      const total = groups * perGroup;

      return (
         <div className="flex flex-col h-full bg-amber-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Background */}
            <div className="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,#fffbeb_0%,#fef3c7_100%)]" />

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-amber-100 bg-white/50 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-amber-700">EGG CARTON FARM</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Multiplication: Repeated Addition</p>
               </div>
               <div className="flex flex-col items-end">
                  <div className="text-xs font-bold text-amber-600 uppercase tracking-tighter">Equation</div>
                  <div className="text-2xl font-black text-slate-800">
                     {groups} √ó {perGroup} = {total}
                  </div>
               </div>
            </div>

            {/* Farm View */}
            <div className="flex-1 relative flex items-center justify-center p-8">
               <div className="grid gap-4 transition-all duration-500" style={{ gridTemplateColumns: `repeat(${perGroup}, minmax(0, 1fr))` }}>
                  {Array.from({ length: total }).map((_, i) => (
                     <div
                        key={i}
                        className="w-12 h-16 bg-white rounded-full shadow-lg flex items-center justify-center text-3xl border-2 border-amber-100 animate-in zoom-in duration-300"
                        style={{ animationDelay: `${i * 50}ms` }}
                     >
                        ü•ö
                     </div>
                  ))}
               </div>

               {/* Chickens (Visual Labels) */}
               <div className="absolute left-4 top-1/2 -translate-y-1/2 flex flex-col gap-4">
                  {Array.from({ length: groups }).map((_, i) => (
                     <div key={i} className="w-12 h-12 bg-white rounded-2xl shadow-md flex items-center justify-center text-2xl border border-amber-100">üêî</div>
                  ))}
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/60 backdrop-blur-md border-t border-amber-100 flex flex-col items-center gap-6">
               <div className="flex gap-12">
                  <div className="flex flex-col items-center gap-2">
                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">How many groups?</span>
                     <div className="flex gap-2">
                        {[2, 3, 4, 5, 6].map(n => (
                           <button
                              key={n}
                              onClick={() => setGroups(n)}
                              className={`w-10 h-10 rounded-xl font-black transition-all ${groups === n ? 'bg-amber-600 text-white scale-110 shadow-lg' : 'bg-white text-amber-600 border border-amber-100 hover:bg-amber-50'}`}
                           >
                              {n}
                           </button>
                        ))}
                     </div>
                  </div>
                  <div className="flex flex-col items-center gap-2">
                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">How many per group?</span>
                     <div className="flex gap-2">
                        {[2, 3, 4, 5, 6].map(n => (
                           <button
                              key={n}
                              onClick={() => setPerGroup(n)}
                              className={`w-10 h-10 rounded-xl font-black transition-all ${perGroup === n ? 'bg-amber-600 text-white scale-110 shadow-lg' : 'bg-white text-amber-600 border border-amber-100 hover:bg-amber-50'}`}
                           >
                              {n}
                           </button>
                        ))}
                     </div>
                  </div>
               </div>

               <div className="flex flex-col items-center gap-2">
                  <div className="text-lg font-black text-amber-700">
                     {Array.from({ length: groups }).map((_, i) => (
                        <span key={i}>
                           {perGroup}{i < groups - 1 ? ' + ' : ` = ${total}`}
                        </span>
                     ))}
                  </div>
                  <p className="text-xs text-slate-500 max-w-md text-center">
                     <strong>Multiplication</strong> is just adding the same number over and over! Here we have {groups} groups of {perGroup} eggs.
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- DIVISION AS FAIR SHARING RENDERER ---
   const DivisionFairSharingRenderer = () => {
      const [totalCoins, setTotalCoins] = useState(12);
      const [pirates, setPirates] = useState(3);
      const [piles, setPiles] = useState<number[]>([]);
      const [isDealing, setIsDealing] = useState(false);

      const handleDeal = () => {
         setIsDealing(true);
         const perPirate = Math.floor(totalCoins / pirates);
         const newPiles = Array(pirates).fill(0);

         let current = 0;
         const interval = setInterval(() => {
            if (current < totalCoins - (totalCoins % pirates)) {
               newPiles[current % pirates]++;
               setPiles([...newPiles]);
               current++;
            } else {
               clearInterval(interval);
               setIsDealing(false);
            }
         }, 100);
      };

      const reset = (newTotal?: number, newPirates?: number) => {
         if (newTotal !== undefined) setTotalCoins(newTotal);
         if (newPirates !== undefined) setPirates(newPirates);
         setPiles([]);
         setIsDealing(false);
      };

      const remainder = totalCoins % pirates;
      const perPirate = Math.floor(totalCoins / pirates);

      return (
         <div className="flex flex-col h-full bg-sky-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Ocean Background */}
            <div className="absolute inset-0 bg-gradient-to-b from-sky-300 to-blue-400" />
            <div className="absolute bottom-0 left-0 right-0 h-32 bg-amber-100" /> {/* Sand */}

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-white/20 bg-white/20 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-amber-900">TREASURE ISLAND</h3>
                  <p className="text-[10px] font-bold text-slate-600 uppercase tracking-widest">Division: Fair Sharing</p>
               </div>
               <div className="flex flex-col items-end">
                  <div className="text-xs font-bold text-amber-800 uppercase tracking-tighter">Equation</div>
                  <div className="text-2xl font-black text-slate-900">
                     {totalCoins} √∑ {pirates} = {perPirate} {remainder > 0 ? `R${remainder}` : ''}
                  </div>
               </div>
            </div>

            {/* Pirate View */}
            <div className="flex-1 relative flex flex-col items-center justify-center p-8">
               {/* Main Chest */}
               <div className="mb-12 relative">
                  <div className="w-32 h-24 bg-amber-800 rounded-lg border-4 border-amber-900 shadow-2xl flex flex-wrap justify-center p-2 gap-1 overflow-hidden">
                     {Array.from({ length: totalCoins - (piles.reduce((a, b) => a + b, 0)) }).map((_, i) => (
                        <div key={i} className="w-4 h-4 bg-yellow-400 rounded-full border border-yellow-600 shadow-sm" />
                     ))}
                  </div>
                  <div className="absolute -top-6 left-1/2 -translate-x-1/2 bg-amber-900 text-white px-3 py-1 rounded-full text-[10px] font-bold uppercase">Chest</div>
               </div>

               {/* Pirates and their piles */}
               <div className="flex gap-12 items-end">
                  {Array.from({ length: pirates }).map((_, i) => (
                     <div key={i} className="flex flex-col items-center gap-4">
                        <div className="relative flex flex-col-reverse items-center gap-1 min-h-[100px]">
                           {Array.from({ length: piles[i] || 0 }).map((_, j) => (
                              <div
                                 key={j}
                                 className="w-8 h-2 bg-yellow-400 rounded-full border border-yellow-600 shadow-sm animate-in slide-in-from-top-12 duration-300"
                              />
                           ))}
                        </div>
                        <div className="w-16 h-16 bg-white rounded-full shadow-lg flex items-center justify-center text-4xl border-4 border-amber-200">üè¥‚Äç‚ò†Ô∏è</div>
                        <div className="bg-amber-900 text-white px-2 py-1 rounded-lg text-xs font-black">{piles[i] || 0}</div>
                     </div>
                  ))}
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/60 backdrop-blur-md border-t border-white/20 flex flex-col items-center gap-6">
               <div className="flex gap-12">
                  <div className="flex flex-col items-center gap-2">
                     <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Total Coins</span>
                     <div className="flex gap-2">
                        {[10, 12, 15, 20].map(n => (
                           <button
                              key={n}
                              onClick={() => reset(n, pirates)}
                              className={`w-10 h-10 rounded-xl font-black transition-all ${totalCoins === n ? 'bg-amber-700 text-white scale-110 shadow-lg' : 'bg-white text-amber-700 border border-amber-100 hover:bg-amber-50'}`}
                           >
                              {n}
                           </button>
                        ))}
                     </div>
                  </div>
                  <div className="flex flex-col items-center gap-2">
                     <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Pirate Crew</span>
                     <div className="flex gap-2">
                        {[2, 3, 4, 5].map(n => (
                           <button
                              key={n}
                              onClick={() => reset(totalCoins, n)}
                              className={`w-10 h-10 rounded-xl font-black transition-all ${pirates === n ? 'bg-amber-700 text-white scale-110 shadow-lg' : 'bg-white text-amber-700 border border-amber-100 hover:bg-amber-50'}`}
                           >
                              {n}
                           </button>
                        ))}
                     </div>
                  </div>
               </div>

               <div className="flex gap-4 w-full max-w-md">
                  <button
                     onClick={handleDeal}
                     disabled={isDealing || piles.length > 0}
                     className="flex-1 h-14 bg-amber-700 text-white font-black rounded-2xl shadow-lg hover:bg-amber-800 transition-all disabled:opacity-50"
                  >
                     SHARE FAIRLY! üí∞
                  </button>
                  <button
                     onClick={() => reset()}
                     className="w-14 h-14 bg-white text-slate-400 rounded-2xl border border-amber-100 hover:bg-amber-50 transition-colors flex items-center justify-center"
                  >
                     üîÑ
                  </button>
               </div>

               <p className="text-xs text-slate-500 max-w-md text-center">
                  <strong>Division</strong> is sharing a total amount into equal groups. Each pirate gets {perPirate} coins {remainder > 0 ? `and ${remainder} are left in the chest!` : 'fair and square!'}
               </p>
            </div>
         </div>
      );
   };


   // --- MULTI-DIGIT ADDITION WITH REGROUPING RENDERER ---
   const MultiDigitAdditionRegroupingRenderer = () => {
      const [num1, setNum1] = useState(47);
      const [num2, setNum2] = useState(28);
      const [step, setStep] = useState(0); // 0: initial, 1: combine ones, 2: regroup, 3: combine tens
      const [regrouped, setRegrouped] = useState(false);

      const ones1 = num1 % 10;
      const tens1 = Math.floor(num1 / 10);
      const ones2 = num2 % 10;
      const tens2 = Math.floor(num2 / 10);

      const totalOnes = ones1 + ones2;
      const needsRegroup = totalOnes >= 10;
      const resultOnes = totalOnes % 10;
      const carry = needsRegroup ? 1 : 0;
      const resultTens = tens1 + tens2 + carry;

      const reset = () => {
         setStep(0);
         setRegrouped(false);
      };

      return (
         <div className="flex flex-col h-full bg-slate-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Background */}
            <div className="absolute inset-0 bg-slate-100 opacity-50" style={{ backgroundImage: 'radial-gradient(#cbd5e1 1px, transparent 1px)', backgroundSize: '20px 20px' }} />

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-slate-200 bg-white/80 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-blue-600">CONSTRUCTION CRANE</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Multi-Digit Addition: Regrouping</p>
               </div>
               <div className="flex gap-4 items-center">
                  <div className="text-right">
                     <div className="text-2xl font-black text-slate-800 tabular-nums">
                        {num1} + {num2} = {step === 3 ? num1 + num2 : '?'}
                     </div>
                  </div>
               </div>
            </div>

            {/* Construction Site */}
            <div className="flex-1 relative flex items-center justify-center p-8 gap-16">
               {/* Place Value Columns */}
               <div className="flex gap-8">
                  {/* Tens Column */}
                  <div className="flex flex-col items-center gap-4 p-6 bg-blue-50/50 rounded-3xl border-2 border-dashed border-blue-200 min-w-[120px]">
                     <span className="text-[10px] font-black text-blue-400 uppercase tracking-widest">Tens</span>
                     <div className="flex flex-col gap-2">
                        {Array.from({ length: tens1 }).map((_, i) => (
                           <div key={`t1-${i}`} className="w-6 h-20 bg-blue-500 rounded-sm border border-blue-600 shadow-sm" />
                        ))}
                        {Array.from({ length: tens2 }).map((_, i) => (
                           <div key={`t2-${i}`} className="w-6 h-20 bg-blue-400 rounded-sm border border-blue-500 shadow-sm" />
                        ))}
                        {step === 3 && carry === 1 && (
                           <div className="w-6 h-20 bg-orange-500 rounded-sm border border-orange-600 shadow-sm animate-in slide-in-from-right-12 duration-500" />
                        )}
                     </div>
                  </div>

                  {/* Ones Column */}
                  <div className="flex flex-col items-center gap-4 p-6 bg-orange-50/50 rounded-3xl border-2 border-dashed border-orange-200 min-w-[120px]">
                     <span className="text-[10px] font-black text-orange-400 uppercase tracking-widest">Ones</span>
                     <div className="grid grid-cols-2 gap-2">
                        {step < 2 ? (
                           <>
                              {Array.from({ length: ones1 }).map((_, i) => (
                                 <div key={`o1-${i}`} className="w-6 h-6 bg-orange-500 rounded-sm border border-orange-600 shadow-sm" />
                              ))}
                              {Array.from({ length: ones2 }).map((_, i) => (
                                 <div key={`o2-${i}`} className="w-6 h-6 bg-orange-400 rounded-sm border border-orange-500 shadow-sm" />
                              ))}
                           </>
                        ) : (
                           Array.from({ length: resultOnes }).map((_, i) => (
                              <div key={`ro-${i}`} className="w-6 h-6 bg-orange-500 rounded-sm border border-orange-600 shadow-sm animate-in zoom-in duration-300" />
                           ))
                        )}
                     </div>
                  </div>
               </div>

               {/* Step Visualizer */}
               <div className="w-64 flex flex-col gap-4">
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 0 ? 'bg-white border-blue-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">1. Look at the Ones</p>
                     <p className="text-[10px] text-slate-500">{ones1} + {ones2} = {totalOnes}</p>
                  </div>
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 1 ? 'bg-white border-blue-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">2. Regroup?</p>
                     <p className="text-[10px] text-slate-500">{totalOnes >= 10 ? 'Yes! 10 ones = 1 ten' : 'No need!'}</p>
                  </div>
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 2 ? 'bg-white border-blue-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">3. Add the Tens</p>
                     <p className="text-[10px] text-slate-500">{tens1} + {tens2} {carry > 0 ? '+ 1' : ''} = {resultTens}</p>
                  </div>
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/80 backdrop-blur-md border-t border-slate-200 flex flex-col items-center gap-6">
               <div className="flex gap-4 w-full max-w-md">
                  {step < 3 ? (
                     <button
                        onClick={() => setStep(s => s + 1)}
                        className="flex-1 h-14 bg-blue-600 text-white font-black rounded-2xl shadow-lg hover:bg-blue-700 transition-all flex items-center justify-center gap-2"
                     >
                        {step === 0 ? 'COMBINE ONES' : step === 1 ? 'REGROUP 10 ONES' : 'ADD TENS'} üèóÔ∏è
                     </button>
                  ) : (
                     <button
                        onClick={reset}
                        className="flex-1 h-14 bg-slate-800 text-white font-black rounded-2xl shadow-lg hover:bg-slate-900 transition-all"
                     >
                        START NEW BUILD
                     </button>
                  )}
               </div>

               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20 shrink-0">
                     <span className="text-2xl">üèóÔ∏è</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     When we have <strong>10 or more ones</strong>, we "regroup" them into a single ten-rod and move it to the tens column. This is what we call "carrying"!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- MULTI-DIGIT SUBTRACTION WITH BORROWING RENDERER ---
   const MultiDigitSubtractionBorrowingRenderer = () => {
      const [num1, setNum1] = useState(52);
      const [num2, setNum2] = useState(27);
      const [step, setStep] = useState(0); // 0: initial, 1: borrow, 2: subtract ones, 3: subtract tens

      const ones1 = num1 % 10;
      const tens1 = Math.floor(num1 / 10);
      const ones2 = num2 % 10;
      const tens2 = Math.floor(num2 / 10);

      const needsBorrow = ones1 < ones2;
      const borrowedOnes = ones1 + 10;
      const remainingTens = tens1 - 1;

      const reset = () => {
         setStep(0);
      };

      return (
         <div className="flex flex-col h-full bg-emerald-50 text-slate-900 font-sans overflow-hidden relative">
            {/* Vault Background */}
            <div className="absolute inset-0 bg-slate-200 opacity-30" style={{ backgroundImage: 'repeating-linear-gradient(45deg, #94a3b8 0, #94a3b8 1px, transparent 0, transparent 50%)', backgroundSize: '10px 10px' }} />

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-emerald-200 bg-white/80 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-emerald-700">BANK VAULT</h3>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Multi-Digit Subtraction: Borrowing</p>
               </div>
               <div className="flex gap-4 items-center">
                  <div className="text-right">
                     <div className="text-2xl font-black text-slate-800 tabular-nums">
                        {num1} - {num2} = {step === 3 ? num1 - num2 : '?'}
                     </div>
                  </div>
               </div>
            </div>

            {/* Vault Interior */}
            <div className="flex-1 relative flex items-center justify-center p-8 gap-16">
               {/* Place Value Safes */}
               <div className="flex gap-8">
                  {/* Tens Safe */}
                  <div className="flex flex-col items-center gap-4 p-6 bg-slate-800 rounded-3xl border-4 border-slate-700 min-w-[140px] shadow-2xl">
                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Tens (Bills)</span>
                     <div className="flex flex-col gap-2">
                        {Array.from({ length: step >= 1 ? remainingTens : tens1 }).map((_, i) => (
                           <div key={`t-${i}`} className="w-12 h-6 bg-emerald-500 rounded-sm border-2 border-emerald-600 shadow-sm flex items-center justify-center text-[10px] font-bold text-emerald-900">$10</div>
                        ))}
                        {step === 0 && needsBorrow && (
                           <div className="w-12 h-6 bg-emerald-400 rounded-sm border-2 border-emerald-500 opacity-50 border-dashed" />
                        )}
                     </div>
                  </div>

                  {/* Ones Safe */}
                  <div className="flex flex-col items-center gap-4 p-6 bg-slate-700 rounded-3xl border-4 border-slate-600 min-w-[140px] shadow-2xl">
                     <span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Ones (Coins)</span>
                     <div className="grid grid-cols-3 gap-2">
                        {Array.from({ length: step >= 1 ? borrowedOnes : ones1 }).map((_, i) => (
                           <div key={`o-${i}`} className={`w-6 h-6 bg-yellow-400 rounded-full border-2 border-yellow-600 shadow-sm flex items-center justify-center text-[8px] font-bold text-yellow-900 ${i >= ones1 ? 'animate-in zoom-in duration-500' : ''}`}>$1</div>
                        ))}
                     </div>
                  </div>
               </div>

               {/* Step Visualizer */}
               <div className="w-64 flex flex-col gap-4">
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 0 ? 'bg-white border-emerald-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">1. Check the Ones</p>
                     <p className="text-[10px] text-slate-500">Can we take {ones2} from {ones1}?</p>
                     {needsBorrow && <p className="text-[10px] text-red-500 font-bold">No! Need to borrow.</p>}
                  </div>
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 1 ? 'bg-white border-emerald-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">2. Borrow a Ten</p>
                     <p className="text-[10px] text-slate-500">Break $10 into ten $1 coins.</p>
                  </div>
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 2 ? 'bg-white border-emerald-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">3. Subtract Ones</p>
                     <p className="text-[10px] text-slate-500">{step >= 1 ? borrowedOnes : ones1} - {ones2} = {step >= 2 ? (step >= 1 ? borrowedOnes : ones1) - ones2 : '?'}</p>
                  </div>
                  <div className={`p-4 rounded-2xl border-2 transition-all ${step === 3 ? 'bg-white border-emerald-500 shadow-lg' : 'bg-slate-50 border-slate-200 opacity-50'}`}>
                     <p className="text-xs font-bold">4. Subtract Tens</p>
                     <p className="text-[10px] text-slate-500">{step >= 1 ? remainingTens : tens1} - {tens2} = {step === 3 ? (step >= 1 ? remainingTens : tens1) - tens2 : '?'}</p>
                  </div>
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-white/80 backdrop-blur-md border-t border-emerald-200 flex flex-col items-center gap-6">
               <div className="flex gap-4 w-full max-w-md">
                  {step < 3 ? (
                     <button
                        onClick={() => setStep(s => s + 1)}
                        className="flex-1 h-14 bg-emerald-600 text-white font-black rounded-2xl shadow-lg hover:bg-emerald-700 transition-all flex items-center justify-center gap-2"
                     >
                        {step === 0 ? 'BORROW FROM TENS' : step === 1 ? 'SUBTRACT ONES' : 'SUBTRACT TENS'} üè¶
                     </button>
                  ) : (
                     <button
                        onClick={reset}
                        className="flex-1 h-14 bg-slate-800 text-white font-black rounded-2xl shadow-lg hover:bg-slate-900 transition-all"
                     >
                        NEW WITHDRAWAL
                     </button>
                  )}
               </div>

               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-2xl bg-emerald-500/10 flex items-center justify-center border border-emerald-500/20 shrink-0">
                     <span className="text-2xl">üè¶</span>
                  </div>
                  <p className="text-xs text-slate-500 leading-relaxed">
                     When we don't have enough ones to subtract, we <strong>borrow</strong> one ten from the tens place and "break" it into 10 ones. Now we have plenty!
                  </p>
               </div>
            </div>
         </div>
      );
   };


   // --- MULTIPLICATION TABLES RENDERER ---
   const MultiplicationTablesRenderer = () => {
      const [selectedTable, setSelectedTable] = useState(2);
      const [hoveredProduct, setHoveredProduct] = useState<number | null>(null);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden relative">
            {/* Space Background */}
            <div className="absolute inset-0 overflow-hidden">
               {Array.from({ length: 50 }).map((_, i) => (
                  <div
                     key={i}
                     className="absolute bg-white rounded-full animate-pulse"
                     style={{
                        width: Math.random() * 3 + 'px',
                        height: Math.random() * 3 + 'px',
                        top: Math.random() * 100 + '%',
                        left: Math.random() * 100 + '%',
                        animationDelay: Math.random() * 5 + 's',
                        opacity: Math.random() * 0.7 + 0.3
                     }}
                  />
               ))}
            </div>

            {/* Header */}
            <div className="relative z-10 p-6 flex justify-between items-center border-b border-white/10 bg-black/40 backdrop-blur-md">
               <div>
                  <h3 className="text-xl font-black tracking-tight text-indigo-400">TIMES TABLE GALAXY</h3>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">Multiplication Tables (1-12)</p>
               </div>
               <div className="flex flex-col items-end">
                  <div className="text-xs font-bold text-indigo-500 uppercase tracking-tighter">Selected Table</div>
                  <div className="text-2xl font-black text-white">
                     The {selectedTable}s
                  </div>
               </div>
            </div>

            {/* Galaxy View */}
            <div className="flex-1 relative flex items-center justify-center p-8 gap-12">
               {/* Table Grid */}
               <div className="grid grid-cols-4 gap-4 max-w-md">
                  {Array.from({ length: 12 }).map((_, i) => {
                     const factor = i + 1;
                     const product = selectedTable * factor;
                     return (
                        <div
                           key={factor}
                           onMouseEnter={() => setHoveredProduct(product)}
                           onMouseLeave={() => setHoveredProduct(null)}
                           className={`group relative p-4 rounded-2xl border-2 transition-all cursor-pointer ${hoveredProduct === product ? 'bg-indigo-600/40 border-indigo-400 scale-105 shadow-lg shadow-indigo-500/20' : 'bg-white/5 border-white/10 hover:border-white/30'}`}
                        >
                           <div className="text-[10px] font-bold text-slate-500 mb-1">{selectedTable} √ó {factor}</div>
                           <div className="text-2xl font-black text-white tabular-nums">{product}</div>

                           {/* Orbiting Particle */}
                           {hoveredProduct === product && (
                              <div className="absolute inset-0 border-2 border-indigo-400/50 rounded-2xl animate-ping" />
                           )}
                        </div>
                     );
                  })}
               </div>

               {/* Planet Selector */}
               <div className="flex flex-col gap-2">
                  <span className="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-2">Select Planet</span>
                  <div className="grid grid-cols-3 gap-2">
                     {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12].map(n => (
                        <button
                           key={n}
                           onClick={() => setSelectedTable(n)}
                           className={`w-12 h-12 rounded-full font-black transition-all flex items-center justify-center border-2 ${selectedTable === n ? 'bg-indigo-600 border-indigo-400 text-white scale-110 shadow-lg shadow-indigo-500/40' : 'bg-black/40 border-white/10 text-slate-400 hover:border-white/30'}`}
                        >
                           {n}
                        </button>
                     ))}
                  </div>
               </div>
            </div>

            {/* Controls */}
            <div className="relative z-10 p-8 bg-black/60 backdrop-blur-md border-t border-white/10 flex flex-col items-center gap-6">
               <div className="max-w-2xl mx-auto flex items-center gap-6">
                  <div className="w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center border border-indigo-500/30 shrink-0">
                     <span className="text-2xl">üöÄ</span>
                  </div>
                  <div className="flex flex-col gap-1">
                     <p className="text-sm font-bold text-indigo-300">
                        {hoveredProduct ? `Did you know? ${selectedTable} times something is always ${hoveredProduct % 2 === 0 ? 'even' : 'odd'} here!` : 'Explore the galaxy of numbers!'}
                     </p>
                     <p className="text-xs text-slate-500 leading-relaxed">
                        Multiplication tables help us find patterns. For example, the 5s always end in 0 or 5, and the 9s digits always add up to 9!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };





   // --- STRESS RESPONSE VISUALIZER ---
   const StressResponseRenderer = () => {
      const [stressLevel, setStressLevel] = useState(50); // 0-100
      const [technique, setTechnique] = useState<string | null>(null);
      const [metrics, setMetrics] = useState({ hr: 72, bp: '120/80', cortisol: 'Normal', tension: 'Low' });
      const [time, setTime] = useState(0);

      useEffect(() => {
         // Base metrics based on stress level
         const hr = 60 + (stressLevel * 0.6);
         const sys = 110 + (stressLevel * 0.4);
         const dia = 70 + (stressLevel * 0.3);
         const tension = stressLevel < 30 ? 'Low' : stressLevel < 70 ? 'Moderate' : 'High';
         const cortisol = stressLevel < 40 ? 'Normal' : stressLevel < 80 ? 'Elevated' : 'High';

         setMetrics({
            hr: Math.round(hr),
            bp: `${Math.round(sys)}/${Math.round(dia)}`,
            cortisol,
            tension
         });
      }, [stressLevel]);

      useEffect(() => {
         let interval: any;
         if (technique) {
            interval = setInterval(() => {
               setStressLevel(prev => Math.max(0, prev - 2));
               setTime(t => t + 1);
               if (time > 10) {
                  setTechnique(null);
                  setTime(0);
               }
            }, 500);
         }
         return () => clearInterval(interval);
      }, [technique, time]);

      const startTechnique = (name: string) => {
         setTechnique(name);
         setTime(0);
      };

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col overflow-hidden text-white font-sans">
            <div className="p-6 bg-slate-900 border-b border-slate-800 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight">Stress Response System</h2>
                  <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest mt-1">Physiological Feedback Loop</p>
               </div>
               <div className="flex items-center gap-4">
                  <span className="text-[10px] font-bold text-slate-500">STRESS LEVEL</span>
                  <input
                     type="range" min="0" max="100" value={stressLevel}
                     onChange={(e) => setStressLevel(parseInt(e.target.value))}
                     className="w-32 accent-red-500"
                  />
                  <span className={`text-sm font-black w-8 ${stressLevel > 70 ? 'text-red-500' : 'text-emerald-500'}`}>{stressLevel}%</span>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Biological Map */}
               <div className="flex-1 relative p-12 flex items-center justify-center">
                  <div className="relative w-full max-w-lg aspect-square border-2 border-slate-800 rounded-[40px] bg-slate-900/50 flex flex-col items-center p-8">
                     <div className="w-24 h-24 bg-slate-800 rounded-3xl flex items-center justify-center border-2 border-slate-700 mb-8 relative">
                        <span className="text-2xl">üß†</span>
                        <div className={`absolute -bottom-2 px-2 py-0.5 rounded text-[8px] font-black ${stressLevel > 50 ? 'bg-red-500 animate-pulse' : 'bg-slate-700'}`}>AMYGDALA</div>
                     </div>

                     <div className="flex-1 w-full grid grid-cols-2 gap-8">
                        <div className="flex flex-col items-center justify-center gap-4">
                           <div className={`w-1 h-16 bg-gradient-to-b from-slate-700 to-red-500/50 ${stressLevel > 50 ? 'opacity-100' : 'opacity-20'}`} />
                           <div className="p-4 bg-slate-800 rounded-2xl border border-slate-700 text-center w-full">
                              <p className="text-[8px] font-black text-slate-500 uppercase mb-1">Hormonal</p>
                              <p className="text-xs font-bold text-red-400">Cortisol Release</p>
                              <p className="text-[8px] text-slate-400 mt-2">Long-term effects</p>
                           </div>
                        </div>
                        <div className="flex flex-col items-center justify-center gap-4">
                           <div className={`w-1 h-16 bg-gradient-to-b from-slate-700 to-orange-500/50 ${stressLevel > 30 ? 'opacity-100' : 'opacity-20'}`} />
                           <div className="p-4 bg-slate-800 rounded-2xl border border-slate-700 text-center w-full">
                              <p className="text-[8px] font-black text-slate-500 uppercase mb-1">Sympathetic</p>
                              <p className="text-xs font-bold text-orange-400">Adrenaline Spike</p>
                              <p className="text-[8px] text-slate-400 mt-2">Immediate effects</p>
                           </div>
                        </div>
                     </div>

                     {technique && (
                        <div className="absolute inset-0 bg-emerald-500/10 backdrop-blur-sm rounded-[40px] flex items-center justify-center flex-col">
                           <div className="w-16 h-16 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin mb-4" />
                           <p className="text-emerald-400 font-black uppercase tracking-widest">{technique}...</p>
                        </div>
                     )}
                  </div>
               </div>

               {/* Metrics Panel */}
               <div className="w-full lg:w-96 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-8">
                  <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Biometric Feedback</p>

                  <div className="grid grid-cols-1 gap-4">
                     {[
                        { label: 'Heart Rate', value: `${metrics.hr} bpm`, color: 'text-red-400', icon: '‚ù§Ô∏è' },
                        { label: 'Blood Pressure', value: metrics.bp, color: 'text-orange-400', icon: 'ü©∏' },
                        { label: 'Cortisol', value: metrics.cortisol, color: 'text-yellow-400', icon: 'üß™' },
                        { label: 'Muscle Tension', value: metrics.tension, color: 'text-blue-400', icon: 'üí™' }
                     ].map(m => (
                        <div key={m.label} className="bg-slate-950 p-5 rounded-3xl border border-slate-800 flex justify-between items-center">
                           <div>
                              <p className="text-[8px] font-bold text-slate-500 uppercase mb-1">{m.label}</p>
                              <p className={`text-xl font-black ${m.color}`}>{m.value}</p>
                           </div>
                           <span className="text-2xl opacity-50">{m.icon}</span>
                        </div>
                     ))}
                  </div>

                  <div className="mt-auto space-y-4">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Active Interventions</p>
                     <div className="grid grid-cols-1 gap-2">
                        <button
                           onClick={() => startTechnique('Deep Breathing')}
                           className="p-4 bg-emerald-500 text-slate-950 rounded-2xl font-black text-xs hover:bg-emerald-400 transition-all uppercase"
                        >
                           Deep Breathing
                        </button>
                        <button
                           onClick={() => startTechnique('Grounding')}
                           className="p-4 bg-blue-500 text-slate-950 rounded-2xl font-black text-xs hover:bg-blue-400 transition-all uppercase"
                        >
                           5-4-3-2-1 Grounding
                        </button>
                        <button
                           onClick={() => startTechnique('Muscle Relaxation')}
                           className="p-4 bg-purple-500 text-slate-950 rounded-2xl font-black text-xs hover:bg-purple-400 transition-all uppercase"
                        >
                           Progressive Relaxation
                        </button>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- FORCE CLASSIFICATION RENDERER (Balanced vs. Unbalanced) ---
   const ForceClassificationRenderer = () => {
      const [scenario, setScenario] = useState<'rest' | 'constant' | 'accel' | 'braking'>('rest');
      const [showNet, setShowNet] = useState(false);
      const [userGuess, setUserGuess] = useState<'balanced' | 'unbalanced' | null>(null);
      const [feedback, setFeedback] = useState<string | null>(null);

      const scenarios = {
         rest: { forces: { N: 50, S: 50, E: 0, W: 0 }, label: 'Object at Rest', correct: 'balanced', desc: 'Gravity and Normal force cancel out. No horizontal forces.' },
         constant: { forces: { N: 50, S: 50, E: 30, W: 30 }, label: 'Constant Velocity', correct: 'balanced', desc: 'Applied force equals Friction. Net force is zero!' },
         accel: { forces: { N: 50, S: 50, E: 60, W: 20 }, label: 'Accelerating Right', correct: 'unbalanced', desc: 'Applied force is greater than Friction. Object speeds up.' },
         braking: { forces: { N: 50, S: 50, E: 0, W: 40 }, label: 'Braking to a Stop', correct: 'unbalanced', desc: 'Only Friction is acting horizontally. Object slows down.' }
      };

      const current = scenarios[scenario];
      const netX = current.forces.E - current.forces.W;
      const netY = current.forces.N - current.forces.S;

      const handleGuess = (guess: 'balanced' | 'unbalanced') => {
         setUserGuess(guess);
         if (guess === current.correct) {
            setFeedback('CORRECT! ' + current.desc);
         } else {
            setFeedback('NOT QUITE. ' + current.desc);
         }
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            {/* Header */}
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Force Classification</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Balanced vs. Unbalanced Forces</p>
               </div>
               <div className="flex gap-2">
                  {Object.keys(scenarios).map(s => (
                     <button
                        key={s} onClick={() => { setScenario(s as any); setUserGuess(null); setFeedback(null); setShowNet(false); }}
                        className={`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all uppercase ${scenario === s ? 'bg-slate-900 text-white' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                           }`}
                     >
                        {s}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Simulation Stage */}
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '30px 30px' }} />

                  <div className="relative w-48 h-32 bg-blue-600 rounded-2xl shadow-2xl border-4 border-blue-700 flex items-center justify-center z-10">
                     <span className="text-white font-black text-sm uppercase tracking-tighter">{current.label}</span>

                     {/* Force Arrows */}
                     {/* North (Normal) */}
                     <div className="absolute bottom-full mb-2 flex flex-col items-center" style={{ height: `${current.forces.N}px` }}>
                        <div className="w-0 h-0 border-l-6 border-l-transparent border-r-6 border-r-transparent border-b-[10px] border-b-emerald-500" />
                        <div className="w-1.5 bg-emerald-500 flex-1" />
                        <span className="absolute -top-6 text-[8px] font-bold text-emerald-600">NORMAL</span>
                     </div>
                     {/* South (Gravity) */}
                     <div className="absolute top-full mt-2 flex flex-col items-center" style={{ height: `${current.forces.S}px` }}>
                        <div className="w-1.5 bg-red-500 flex-1" />
                        <div className="w-0 h-0 border-l-6 border-l-transparent border-r-6 border-r-transparent border-t-[10px] border-t-red-500" />
                        <span className="absolute -bottom-6 text-[8px] font-bold text-red-600">GRAVITY</span>
                     </div>
                     {/* East (Applied) */}
                     {current.forces.E > 0 && (
                        <div className="absolute left-full ml-2 flex items-center" style={{ width: `${current.forces.E}px` }}>
                           <div className="h-1.5 bg-blue-500 flex-1" />
                           <div className="w-0 h-0 border-t-6 border-t-transparent border-b-6 border-b-transparent border-l-[10px] border-l-blue-500" />
                           <span className="absolute -top-4 left-0 text-[8px] font-bold text-blue-600">APPLIED</span>
                        </div>
                     )}
                     {/* West (Friction) */}
                     {current.forces.W > 0 && (
                        <div className="absolute right-full mr-2 flex items-center" style={{ width: `${current.forces.W}px` }}>
                           <div className="w-0 h-0 border-t-6 border-t-transparent border-b-6 border-b-transparent border-r-[10px] border-r-amber-500" />
                           <div className="h-1.5 bg-amber-500 flex-1" />
                           <span className="absolute -top-4 right-0 text-[8px] font-bold text-amber-600">FRICTION</span>
                        </div>
                     )}

                     {/* Net Force Vector */}
                     {showNet && (Math.abs(netX) > 0 || Math.abs(netY) > 0) && (
                        <div
                           className="absolute z-20 pointer-events-none"
                           style={{
                              transform: `translate(${netX / 2}px, ${-netY / 2}px)`,
                              width: `${Math.abs(netX)}px`,
                              height: `${Math.abs(netY)}px`
                           }}
                        >
                           <div className="absolute inset-0 border-2 border-dashed border-slate-900 rounded-xl opacity-30" />
                           <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-slate-900 text-white text-[8px] font-black px-2 py-1 rounded whitespace-nowrap">
                              NET FORCE: {Math.sqrt(netX * netX + netY * netY).toFixed(0)}N
                           </div>
                        </div>
                     )}
                  </div>
               </div>

               {/* Analysis & Quiz */}
               <div className="w-full lg:w-96 bg-white border-l border-slate-200 p-8 flex flex-col gap-8 overflow-y-auto">
                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Analysis Challenge</p>
                     <h3 className="text-lg font-black text-slate-900 leading-tight">Are the forces on this object balanced?</h3>

                     <div className="grid grid-cols-2 gap-4">
                        <button
                           onClick={() => handleGuess('balanced')}
                           className={`py-4 rounded-2xl font-black text-sm border-2 transition-all ${userGuess === 'balanced' ? 'bg-emerald-500 border-emerald-600 text-white shadow-lg' : 'bg-white border-slate-100 hover:border-emerald-200 text-slate-600'
                              }`}
                        >
                           BALANCED
                        </button>
                        <button
                           onClick={() => handleGuess('unbalanced')}
                           className={`py-4 rounded-2xl font-black text-sm border-2 transition-all ${userGuess === 'unbalanced' ? 'bg-amber-500 border-amber-600 text-white shadow-lg' : 'bg-white border-slate-100 hover:border-amber-200 text-slate-600'
                              }`}
                        >
                           UNBALANCED
                        </button>
                     </div>

                     {feedback && (
                        <div className={`p-5 rounded-3xl border-2 animate-in fade-in slide-in-from-top-2 ${userGuess === current.correct ? 'bg-emerald-50 border-emerald-100 text-emerald-900' : 'bg-amber-50 border-amber-100 text-amber-900'
                           }`}>
                           <p className="text-xs font-bold leading-relaxed">{feedback}</p>
                           <button
                              onClick={() => setShowNet(true)}
                              className="mt-4 text-[10px] font-black underline uppercase tracking-widest opacity-60 hover:opacity-100"
                           >
                              Show Net Force Vector
                           </button>
                        </div>
                     )}
                  </div>

                  {/* Rules of Motion */}
                  <div className="mt-auto space-y-4">
                     <div className="p-6 bg-slate-900 rounded-3xl text-white">
                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-4 tracking-widest">The Golden Rules</p>
                        <ul className="space-y-4">
                           <li className="flex gap-3">
                              <span className="text-emerald-400 font-black">1.</span>
                              <p className="text-[10px] leading-relaxed"><strong>Balanced Forces</strong> mean NO change in motion (Rest or Constant Speed).</p>
                           </li>
                           <li className="flex gap-3">
                              <span className="text-amber-400 font-black">2.</span>
                              <p className="text-[10px] leading-relaxed"><strong>Unbalanced Forces</strong> mean the object IS accelerating (Speeding up or Slowing down).</p>
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- GRAVITY & FREE FALL RENDERER (Vacuum vs. Air) ---
   const GravityAccelerationRenderer = () => {
      const [isVacuum, setIsVacuum] = useState(false);
      const [height, setHeight] = useState(10); // meters
      const [isFalling, setIsFalling] = useState(false);
      const [time, setTime] = useState(0);
      const [obj1, setObj1] = useState({ y: 0, v: 0, a: 9.8, type: 'ball' });
      const [obj2, setObj2] = useState({ y: 0, v: 0, a: 9.8, type: 'feather' });
      const [history, setHistory] = useState<{ t: number, y1: number, y2: number }[]>([]);

      const g = 9.81;
      const dragFeather = isVacuum ? 0 : 0.8;
      const dragBall = isVacuum ? 0 : 0.05;

      useEffect(() => {
         let interval: any;
         if (isFalling) {
            const startTime = Date.now();
            interval = setInterval(() => {
               const elapsed = (Date.now() - startTime) / 1000;
               setTime(elapsed);

               // Physics update
               setObj1(prev => {
                  const airRes = dragBall * prev.v * prev.v;
                  const netA = g - (airRes / 1); // mass = 1
                  const newV = prev.v + netA * 0.03;
                  const newY = prev.y + newV * 0.03 * 20; // scale
                  return { ...prev, v: newV, y: newY > 300 ? 300 : newY };
               });

               setObj2(prev => {
                  const airRes = dragFeather * prev.v * prev.v;
                  const netA = g - (airRes / 0.1); // mass = 0.1
                  const newV = prev.v + netA * 0.03;
                  const newY = prev.y + newV * 0.03 * 20; // scale
                  return { ...prev, v: newV, y: newY > 300 ? 300 : newY };
               });

               setHistory(prev => [...prev.slice(-50), { t: elapsed, y1: obj1.y, y2: obj2.y }]);

               if (obj1.y >= 300 && obj2.y >= 300) {
                  setIsFalling(false);
               }
            }, 30);
         }
         return () => clearInterval(interval);
      }, [isFalling, isVacuum, dragBall, dragFeather]);

      const reset = () => {
         setIsFalling(false);
         setTime(0);
         setObj1({ y: 0, v: 0, a: 9.8, type: 'ball' });
         setObj2({ y: 0, v: 0, a: 9.8, type: 'feather' });
         setHistory([]);
      };

      return (
         <div className="w-full h-full bg-slate-900 flex flex-col overflow-hidden text-white font-sans">
            {/* Header */}
            <div className="p-6 bg-slate-800 border-b border-slate-700 flex justify-between items-center">
               <div>
                  <h2 className="text-xl font-black tracking-tight">Gravity & Free Fall</h2>
                  <p className="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Galileo's Experiment</p>
               </div>
               <div className="flex gap-4">
                  <div className="flex items-center gap-3 bg-slate-900 px-4 py-2 rounded-2xl border border-slate-700">
                     <span className="text-[10px] font-bold text-slate-500">VACUUM</span>
                     <button
                        onClick={() => { setIsVacuum(!isVacuum); reset(); }}
                        className={`w-12 h-6 rounded-full relative transition-colors ${isVacuum ? 'bg-emerald-500' : 'bg-slate-700'}`}
                     >
                        <div className={`absolute top-1 w-4 h-4 bg-white rounded-full transition-all ${isVacuum ? 'left-7' : 'left-1'}`} />
                     </button>
                  </div>
                  <button onClick={reset} className="p-2 bg-slate-700 rounded-xl hover:bg-slate-600 transition-colors">‚Ü∫</button>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Drop Zone */}
               <div className="flex-1 relative bg-slate-950 flex justify-center p-12">
                  {/* Vacuum Chamber Effect */}
                  {isVacuum && (
                     <div className="absolute inset-4 border-2 border-emerald-500/20 rounded-3xl bg-emerald-500/5 backdrop-blur-[2px]" />
                  )}

                  {/* Height Scale */}
                  <div className="absolute left-12 top-12 bottom-12 w-1 bg-slate-800 flex flex-col justify-between py-2">
                     {[10, 8, 6, 4, 2, 0].map(m => (
                        <div key={m} className="relative flex items-center">
                           <div className="w-4 h-[1px] bg-slate-600" />
                           <span className="absolute left-6 text-[8px] font-bold text-slate-500">{m}m</span>
                        </div>
                     ))}
                  </div>

                  <div className="relative w-64 h-[350px] flex justify-around items-start pt-10">
                     {/* Object 1: Ball */}
                     <div className="flex flex-col items-center">
                        <div
                           className="w-12 h-12 bg-slate-300 rounded-full shadow-2xl border-4 border-slate-400 flex items-center justify-center transition-transform duration-30"
                           style={{ transform: `translateY(${obj1.y}px)` }}
                        >
                           <div className="w-2 h-2 bg-slate-500 rounded-full opacity-50" />
                        </div>
                        <span className="mt-4 text-[8px] font-black text-slate-500 uppercase">Bowling Ball</span>
                     </div>

                     {/* Object 2: Feather */}
                     <div className="flex flex-col items-center">
                        <div
                           className="w-12 h-12 flex items-center justify-center transition-transform duration-30"
                           style={{ transform: `translateY(${obj2.y}px) rotate(${isFalling && !isVacuum ? Math.sin(time * 10) * 20 : 0}deg)` }}
                        >
                           <svg className="w-10 h-10 text-emerald-400 opacity-80" viewBox="0 0 24 24" fill="currentColor">
                              <path d="M21,3C21,3 18,3 15,6C12,9 12,13 12,13C12,13 11,12 9,12C7,12 3,15 3,15C3,15 7,16 9,18C11,20 12,24 12,24C12,24 15,20 15,18C15,16 14,15 14,15C14,15 18,15 21,12C24,9 21,3 21,3Z" />
                           </svg>
                        </div>
                        <span className="mt-4 text-[8px] font-black text-slate-500 uppercase">Feather</span>
                     </div>

                     {/* Ground */}
                     <div className="absolute bottom-0 left-0 right-0 h-2 bg-slate-800 rounded-full shadow-[0_0_20px_rgba(0,0,0,0.5)]" />
                  </div>

                  {/* Drop Button */}
                  <div className="absolute bottom-12 left-1/2 -translate-x-1/2">
                     <button
                        onClick={() => setIsFalling(true)}
                        disabled={isFalling}
                        className="px-12 py-4 bg-emerald-500 text-slate-900 rounded-2xl font-black text-xl shadow-[0_0_30px_rgba(16,185,129,0.3)] hover:bg-emerald-400 disabled:opacity-30 transition-all transform active:scale-95"
                     >
                        {isFalling ? 'FALLING...' : 'RELEASE'}
                     </button>
                  </div>
               </div>

               {/* Metrics & Analysis */}
               <div className="w-full lg:w-80 bg-slate-900 border-l border-slate-800 p-8 flex flex-col gap-10 overflow-y-auto">
                  <div className="space-y-8">
                     <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Live Telemetry</p>

                     <div className="space-y-4">
                        <div className="bg-slate-800 p-5 rounded-3xl border border-slate-700">
                           <div className="flex justify-between items-center mb-4">
                              <span className="text-[8px] font-bold text-slate-500 uppercase">Time Elapsed</span>
                              <span className="text-xl font-mono font-black text-emerald-400">{time.toFixed(2)}s</span>
                           </div>
                           <div className="space-y-4">
                              <div className="space-y-1">
                                 <div className="flex justify-between text-[10px] font-bold">
                                    <span className="text-slate-400">Ball Velocity</span>
                                    <span className="text-white">{obj1.v.toFixed(1)} m/s</span>
                                 </div>
                                 <div className="h-1 bg-slate-900 rounded-full overflow-hidden">
                                    <div className="h-full bg-blue-500 transition-all" style={{ width: `${(obj1.v / 20) * 100}%` }} />
                                 </div>
                              </div>
                              <div className="space-y-1">
                                 <div className="flex justify-between text-[10px] font-bold">
                                    <span className="text-slate-400">Feather Velocity</span>
                                    <span className="text-white">{obj2.v.toFixed(1)} m/s</span>
                                 </div>
                                 <div className="h-1 bg-slate-900 rounded-full overflow-hidden">
                                    <div className="h-full bg-emerald-500 transition-all" style={{ width: `${(obj2.v / 20) * 100}%` }} />
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>

                     {/* Graph Area */}
                     <div className="bg-slate-950 p-6 rounded-3xl border border-slate-800 h-48 flex flex-col">
                        <p className="text-[8px] font-bold text-slate-500 uppercase mb-4">Velocity vs. Time</p>
                        <div className="flex-1 relative border-l border-b border-slate-800">
                           <svg className="w-full h-full overflow-visible">
                              <polyline
                                 points={history.map((h, i) => `${(i / 50) * 100}%, ${100 - (h.y1 / 3)}%`).join(' ')}
                                 fill="none" stroke="#3b82f6" strokeWidth="2"
                              />
                              <polyline
                                 points={history.map((h, i) => `${(i / 50) * 100}%, ${100 - (h.y2 / 3)}%`).join(' ')}
                                 fill="none" stroke="#10b981" strokeWidth="2"
                              />
                           </svg>
                        </div>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-5 bg-emerald-500/10 rounded-3xl border border-emerald-500/20">
                     <div className="flex gap-3 mb-2">
                        <span className="text-emerald-400">üí°</span>
                        <h4 className="text-[10px] font-black text-emerald-400 uppercase">The Gravity Secret</h4>
                     </div>
                     <p className="text-[10px] text-slate-300 leading-relaxed">
                        In a <strong>Vacuum</strong>, all objects fall at the exact same rate regardless of mass!
                        Air resistance is what makes the feather slow down. Gravity pulls on everything equally.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- NET FORCE RENDERER (Vector Addition) ---
   const NetForceRenderer = () => {
      const [forces, setForces] = useState({ N: 0, S: 0, E: 0, W: 0 });
      const [showResultant, setShowResultant] = useState(true);
      const [showComponents, setShowComponents] = useState(true);
      const [mode, setMode] = useState<'1d' | '2d' | 'challenge'>('1d');
      const [target, setTarget] = useState({ x: 50, y: 0 });
      const [isBalanced, setIsBalanced] = useState(true);

      const netX = forces.E - forces.W;
      const netY = forces.N - forces.S;
      const magnitude = Math.sqrt(netX * netX + netY * netY);
      const angle = Math.atan2(netY, netX) * (180 / Math.PI);

      useEffect(() => {
         setIsBalanced(netX === 0 && netY === 0);
      }, [netX, netY]);

      const reset = () => {
         setForces({ N: 0, S: 0, E: 0, W: 0 });
         if (mode === 'challenge') {
            setTarget({ x: (Math.random() - 0.5) * 100, y: (Math.random() - 0.5) * 100 });
         }
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            {/* Header */}
            <div className="p-6 bg-white border-b border-slate-200 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900">Net Force & Vectors</h2>
                  <div className="flex gap-2 mt-2">
                     <button onClick={() => { setMode('1d'); reset(); }} className={`text-[10px] font-bold px-3 py-1 rounded-full ${mode === '1d' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-500'}`}>1D TUG-OF-WAR</button>
                     <button onClick={() => { setMode('2d'); reset(); }} className={`text-[10px] font-bold px-3 py-1 rounded-full ${mode === '2d' ? 'bg-purple-600 text-white' : 'bg-slate-100 text-slate-500'}`}>2D EXPLORATION</button>
                     <button onClick={() => { setMode('challenge'); reset(); }} className={`text-[10px] font-bold px-3 py-1 rounded-full ${mode === 'challenge' ? 'bg-amber-600 text-white' : 'bg-slate-100 text-slate-500'}`}>TARGET CHALLENGE</button>
                  </div>
               </div>
               <div className="flex gap-4">
                  <div className="text-center">
                     <p className="text-[8px] font-bold text-slate-400 uppercase">Net Force</p>
                     <p className="text-xl font-black text-slate-900">{magnitude.toFixed(1)} N</p>
                  </div>
                  <div className={`px-4 py-2 rounded-xl flex items-center justify-center font-black text-xs ${isBalanced ? 'bg-green-100 text-green-700' : 'bg-amber-100 text-amber-700'}`}>
                     {isBalanced ? 'BALANCED' : 'UNBALANCED'}
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Vector Stage */}
               <div className="flex-1 relative bg-white flex items-center justify-center p-12 overflow-hidden">
                  {/* Grid */}
                  <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  {/* The Crate */}
                  <div className="relative w-32 h-32 bg-amber-800 rounded-xl shadow-2xl border-4 border-amber-900 flex items-center justify-center z-10">
                     <div className="w-full h-full opacity-20" style={{ backgroundImage: 'repeating-linear-gradient(45deg, transparent, transparent 10px, #000 10px, #000 11px)' }} />
                     <span className="absolute text-white font-black text-xl opacity-50">CRATE</span>

                     {/* Resultant Vector */}
                     {showResultant && magnitude > 0 && (
                        <div
                           className="absolute origin-center transition-all duration-300"
                           style={{ transform: `rotate(${-angle}deg)`, width: `${magnitude * 2}px` }}
                        >
                           <div className="h-2 bg-emerald-500 rounded-full shadow-lg relative">
                              <div className="absolute right-[-8px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-l-[12px] border-l-emerald-500" />
                           </div>
                           <span className="absolute -top-6 right-0 text-[10px] font-black text-emerald-600 whitespace-nowrap">NET FORCE</span>
                        </div>
                     )}

                     {/* Component Vectors */}
                     {showComponents && (
                        <>
                           {forces.E > 0 && (
                              <div className="absolute left-1/2 w-[1px] h-1" style={{ width: `${forces.E * 2}px` }}>
                                 <div className="h-1 bg-blue-400 relative">
                                    <div className="absolute right-[-4px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-4 border-t-transparent border-b-4 border-b-transparent border-l-[6px] border-l-blue-400" />
                                 </div>
                              </div>
                           )}
                           {forces.W > 0 && (
                              <div className="absolute right-1/2 w-[1px] h-1" style={{ width: `${forces.W * 2}px`, transform: 'scaleX(-1)' }}>
                                 <div className="h-1 bg-blue-400 relative">
                                    <div className="absolute right-[-4px] top-1/2 -translate-y-1/2 w-0 h-0 border-t-4 border-t-transparent border-b-4 border-b-transparent border-l-[6px] border-l-blue-400" />
                                 </div>
                              </div>
                           )}
                           {forces.N > 0 && (
                              <div className="absolute bottom-1/2 w-1 h-[1px]" style={{ height: `${forces.N * 2}px`, transform: 'scaleY(-1)' }}>
                                 <div className="w-1 bg-purple-400 relative h-full">
                                    <div className="absolute top-[-4px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-l-transparent border-r-4 border-r-transparent border-b-[6px] border-b-purple-400" />
                                 </div>
                              </div>
                           )}
                           {forces.S > 0 && (
                              <div className="absolute top-1/2 w-1 h-[1px]" style={{ height: `${forces.S * 2}px` }}>
                                 <div className="w-1 bg-purple-400 relative h-full">
                                    <div className="absolute bottom-[-4px] left-1/2 -translate-x-1/2 w-0 h-0 border-l-4 border-l-transparent border-r-4 border-r-transparent border-t-[6px] border-t-purple-400" />
                                 </div>
                              </div>
                           )}
                        </>
                     )}
                  </div>

                  {/* Challenge Target */}
                  {mode === 'challenge' && (
                     <div
                        className="absolute w-12 h-12 border-4 border-dashed border-amber-400 rounded-full flex items-center justify-center animate-pulse"
                        style={{ transform: `translate(${target.x * 2}px, ${-target.y * 2}px)` }}
                     >
                        <span className="text-[8px] font-black text-amber-600">TARGET</span>
                     </div>
                  )}
               </div>

               {/* Controls */}
               <div className="w-full lg:w-80 bg-white border-l border-slate-200 p-6 flex flex-col gap-8 overflow-y-auto">
                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Force Applicators</p>

                     {/* East-West Controls */}
                     <div className="space-y-4">
                        <div className="space-y-2">
                           <div className="flex justify-between">
                              <label className="text-[10px] font-bold text-slate-500">EAST FORCE (E)</label>
                              <span className="text-[10px] font-black text-blue-600">{forces.E} N</span>
                           </div>
                           <input
                              type="range" min="0" max="100" step="5" value={forces.E}
                              onChange={(e) => setForces(f => ({ ...f, E: Number(e.target.value) }))}
                              className="w-full h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-500"
                           />
                        </div>
                        <div className="space-y-2">
                           <div className="flex justify-between">
                              <label className="text-[10px] font-bold text-slate-500">WEST FORCE (W)</label>
                              <span className="text-[10px] font-black text-blue-600">{forces.W} N</span>
                           </div>
                           <input
                              type="range" min="0" max="100" step="5" value={forces.W}
                              onChange={(e) => setForces(f => ({ ...f, W: Number(e.target.value) }))}
                              className="w-full h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-500"
                           />
                        </div>
                     </div>

                     {/* North-South Controls (2D only) */}
                     {mode !== '1d' && (
                        <div className="space-y-4 pt-4 border-t border-slate-100">
                           <div className="space-y-2">
                              <div className="flex justify-between">
                                 <label className="text-[10px] font-bold text-slate-500">NORTH FORCE (N)</label>
                                 <span className="text-[10px] font-black text-purple-600">{forces.N} N</span>
                              </div>
                              <input
                                 type="range" min="0" max="100" step="5" value={forces.N}
                                 onChange={(e) => setForces(f => ({ ...f, N: Number(e.target.value) }))}
                                 className="w-full h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-purple-500"
                              />
                           </div>
                           <div className="space-y-2">
                              <div className="flex justify-between">
                                 <label className="text-[10px] font-bold text-slate-500">SOUTH FORCE (S)</label>
                                 <span className="text-[10px] font-black text-purple-600">{forces.S} N</span>
                              </div>
                              <input
                                 type="range" min="0" max="100" step="5" value={forces.S}
                                 onChange={(e) => setForces(f => ({ ...f, S: Number(e.target.value) }))}
                                 className="w-full h-1 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-purple-500"
                              />
                           </div>
                        </div>
                     )}

                     <div className="pt-4 border-t border-slate-100 space-y-4">
                        <button
                           onClick={() => setShowResultant(!showResultant)}
                           className={`w-full py-2 rounded-lg text-[10px] font-bold transition-all ${showResultant ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-400'
                              }`}
                        >
                           {showResultant ? '‚úì SHOWING RESULTANT' : 'SHOW RESULTANT'}
                        </button>
                        <button
                           onClick={reset}
                           className="w-full py-2 bg-slate-900 text-white rounded-lg text-[10px] font-bold"
                        >
                           ‚Ü∫ RESET ALL FORCES
                        </button>
                     </div>
                  </div>

                  {/* Insight */}
                  <div className="mt-auto p-4 bg-blue-50 rounded-2xl border border-blue-100">
                     <p className="text-[10px] text-blue-800 leading-relaxed">
                        <strong>Vector Addition:</strong> Forces in the same direction add up.
                        Forces in opposite directions subtract. In 2D, they combine to create
                        a diagonal <strong>Resultant</strong> force!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- NEWTON'S THIRD LAW RENDERER (Action/Reaction) ---
   const NewtonThirdLawRenderer = () => {
      const [scenario, setScenario] = useState<'skaters' | 'boat' | 'balloon' | 'ball'>('skaters');
      const [massA, setMassA] = useState(60); // kg
      const [massB, setMassB] = useState(80); // kg
      const [isInteracting, setIsInteracting] = useState(false);
      const [posA, setPosA] = useState(0);
      const [posB, setPosB] = useState(0);
      const [velA, setVelA] = useState(0);
      const [velB, setVelB] = useState(0);
      const [showVectors, setShowVectors] = useState(true);

      const force = 100; // Newtons (constant for the push)

      useEffect(() => {
         let interval: any;
         if (isInteracting) {
            const startTime = Date.now();
            interval = setInterval(() => {
               const elapsed = (Date.now() - startTime) / 1000;

               if (elapsed < 0.2) { // Brief push phase
                  setVelA(-(force / massA) * elapsed * 10);
                  setVelB((force / massB) * elapsed * 10);
               } else {
                  // Coasting phase (simplified friction)
                  setVelA(v => v * 0.98);
                  setVelB(v => v * 0.98);
               }

               setPosA(p => p + velA);
               setPosB(p => p + velB);

               if (Math.abs(posA) > 200 || Math.abs(posB) > 200) {
                  setIsInteracting(false);
               }
            }, 30);
         }
         return () => clearInterval(interval);
      }, [isInteracting, velA, velB, massA, massB]);

      const reset = () => {
         setIsInteracting(false);
         setPosA(0);
         setPosB(0);
         setVelA(0);
         setVelB(0);
      };

      return (
         <div className="w-full h-full bg-white flex flex-col overflow-hidden text-slate-800 font-sans">
            {/* Header */}
            <div className="p-6 border-b border-slate-100 flex justify-between items-center">
               <div>
                  <h2 className="text-2xl font-black text-slate-900">Newton's Third Law</h2>
                  <p className="text-slate-500 text-sm font-medium">For every action, there is an equal and opposite reaction.</p>
               </div>
               <div className="flex gap-2">
                  {['skaters', 'boat', 'balloon', 'ball'].map(s => (
                     <button
                        key={s} onClick={() => { setScenario(s as any); reset(); }}
                        className={`px-4 py-2 rounded-xl text-xs font-bold transition-all uppercase tracking-wider ${scenario === s ? 'bg-slate-900 text-white shadow-lg' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'
                           }`}
                     >
                        {s}
                     </button>
                  ))}
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Simulation Stage */}
               <div className="flex-1 bg-slate-50 relative flex items-center justify-center p-12">
                  <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px)', backgroundSize: '40px 40px' }} />

                  <div className="relative w-full max-w-2xl h-64 flex items-center justify-center">
                     {/* Floor/Water Line */}
                     <div className="absolute bottom-10 left-0 right-0 h-1 bg-slate-300 rounded-full" />

                     {/* Object A */}
                     <div
                        className="absolute transition-transform duration-30 flex flex-col items-center"
                        style={{ transform: `translateX(${posA}px)`, left: 'calc(50% - 60px)' }}
                     >
                        {/* Force Vector A */}
                        {isInteracting && showVectors && (
                           <div className="absolute -left-16 top-1/2 -translate-y-1/2 flex items-center">
                              <div className="w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-r-[12px] border-r-red-500" />
                              <div className="h-2 bg-red-500 w-12" />
                              <span className="absolute -top-6 left-0 text-[10px] font-black text-red-600 whitespace-nowrap">REACTION</span>
                           </div>
                        )}

                        <div className={`w-20 h-32 rounded-2xl shadow-xl flex items-center justify-center border-4 ${scenario === 'skaters' ? 'bg-blue-500 border-blue-600' :
                           scenario === 'boat' ? 'bg-amber-500 border-amber-600' :
                              scenario === 'balloon' ? 'bg-red-500 border-red-600 rounded-full' : 'bg-slate-800 border-slate-900'
                           }`}>
                           <span className="text-white font-black text-xl">{massA}</span>
                        </div>
                        <span className="mt-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Object A</span>
                     </div>

                     {/* Object B */}
                     <div
                        className="absolute transition-transform duration-30 flex flex-col items-center"
                        style={{ transform: `translateX(${posB}px)`, right: 'calc(50% - 60px)' }}
                     >
                        {/* Force Vector B */}
                        {isInteracting && showVectors && (
                           <div className="absolute -right-16 top-1/2 -translate-y-1/2 flex items-center">
                              <div className="h-2 bg-blue-500 w-12" />
                              <div className="w-0 h-0 border-t-8 border-t-transparent border-b-8 border-b-transparent border-l-[12px] border-l-blue-500" />
                              <span className="absolute -top-6 right-0 text-[10px] font-black text-blue-600 whitespace-nowrap">ACTION</span>
                           </div>
                        )}

                        <div className={`w-20 h-32 rounded-2xl shadow-xl flex items-center justify-center border-4 ${scenario === 'skaters' ? 'bg-emerald-500 border-emerald-600' :
                           scenario === 'boat' ? 'bg-slate-700 border-slate-800' :
                              scenario === 'balloon' ? 'bg-slate-300 border-slate-400' : 'bg-white border-slate-200'
                           }`}>
                           <span className="text-white font-black text-xl">{massB}</span>
                        </div>
                        <span className="mt-2 text-[10px] font-bold text-slate-400 uppercase tracking-widest">Object B</span>
                     </div>
                  </div>

                  {/* Interaction Button */}
                  <div className="absolute bottom-12 left-1/2 -translate-x-1/2 flex gap-4">
                     <button
                        onClick={() => setIsInteracting(true)}
                        disabled={isInteracting}
                        className="px-10 py-4 bg-slate-900 text-white rounded-2xl font-black text-lg shadow-2xl hover:bg-slate-800 disabled:opacity-50 transition-all transform active:scale-95"
                     >
                        {scenario === 'skaters' ? 'PUSH OFF' : scenario === 'boat' ? 'JUMP' : scenario === 'balloon' ? 'RELEASE' : 'COLLIDE'}
                     </button>
                     <button onClick={reset} className="p-4 bg-white text-slate-400 rounded-2xl border border-slate-200 hover:text-slate-600 transition-colors">‚Ü∫</button>
                  </div>
               </div>

               {/* Controls & Analysis */}
               <div className="w-full lg:w-96 bg-white border-l border-slate-100 p-8 flex flex-col gap-10 overflow-y-auto">
                  <div className="space-y-8">
                     <div className="flex justify-between items-center">
                        <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Lab Controls</p>
                        <button
                           onClick={() => setShowVectors(!showVectors)}
                           className={`text-[10px] font-bold px-2 py-1 rounded ${showVectors ? 'bg-red-100 text-red-600' : 'bg-slate-100 text-slate-400'}`}
                        >
                           VECTORS: {showVectors ? 'ON' : 'OFF'}
                        </button>
                     </div>

                     {/* Mass Sliders */}
                     <div className="space-y-6">
                        <div className="space-y-3">
                           <div className="flex justify-between">
                              <label className="text-xs font-bold text-slate-500">Mass A (kg)</label>
                              <span className="text-xs font-black text-slate-900">{massA} kg</span>
                           </div>
                           <input
                              type="range" min="40" max="120" step="5" value={massA}
                              onChange={(e) => setMassA(Number(e.target.value))}
                              className="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-blue-500"
                           />
                        </div>
                        <div className="space-y-3">
                           <div className="flex justify-between">
                              <label className="text-xs font-bold text-slate-500">Mass B (kg)</label>
                              <span className="text-xs font-black text-slate-900">{massB} kg</span>
                           </div>
                           <input
                              type="range" min="40" max="120" step="5" value={massB}
                              onChange={(e) => setMassB(Number(e.target.value))}
                              className="w-full h-1.5 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                           />
                        </div>
                     </div>

                     {/* Real-time Data */}
                     <div className="bg-slate-50 rounded-3xl p-6 space-y-4">
                        <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Live Metrics</h3>
                        <div className="grid grid-cols-2 gap-4">
                           <div className="bg-white p-4 rounded-2xl border border-slate-100">
                              <p className="text-[8px] font-bold text-slate-400 uppercase">Vel A</p>
                              <p className="text-lg font-black text-blue-600">{Math.abs(velA).toFixed(2)} <span className="text-[10px]">m/s</span></p>
                           </div>
                           <div className="bg-white p-4 rounded-2xl border border-slate-100">
                              <p className="text-[8px] font-bold text-slate-400 uppercase">Vel B</p>
                              <p className="text-lg font-black text-emerald-600">{Math.abs(velB).toFixed(2)} <span className="text-[10px]">m/s</span></p>
                           </div>
                        </div>
                     </div>
                  </div>

                  {/* Insight Panel */}
                  <div className="mt-auto space-y-4">
                     <div className="p-5 bg-indigo-50 rounded-3xl border border-indigo-100">
                        <div className="flex gap-3 mb-2">
                           <span className="text-indigo-600 text-lg">üß†</span>
                           <h4 className="text-xs font-black text-indigo-900 uppercase tracking-tight">The Core Insight</h4>
                        </div>
                        <p className="text-xs text-indigo-800 leading-relaxed">
                           Notice that the <strong>Forces</strong> are always identical in size but opposite in direction.
                           However, the <strong>Result</strong> (velocity) depends on mass. Lighter objects move faster!
                        </p>
                     </div>

                     <div className="p-5 bg-slate-900 rounded-3xl text-white">
                        <p className="text-[10px] font-bold text-slate-400 uppercase mb-2">Did you know?</p>
                        <p className="text-[10px] leading-relaxed opacity-80">
                           When you walk, you push the Earth backward, and the Earth pushes you forward.
                           Because Earth is so massive, you don't notice it moving!
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ADVANCED FORCE LAB RENDERER (F=ma Experiments) ---
   const AdvancedForceLabRenderer = () => {
      const [force, setForce] = useState(3); // Newtons
      const [mass, setMass] = useState(2);   // kg
      const [mode, setMode] = useState<'exp1' | 'exp2' | 'free'>('free');
      const [isLaunching, setIsLaunching] = useState(false);
      const [position, setPosition] = useState(0);
      const [velocity, setVelocity] = useState(0);
      const [history, setHistory] = useState<{ t: number, v: number }[]>([]);
      const [experiments, setExperiments] = useState<{ f: number, m: number, a: number }[]>([]);
      const [prediction, setPrediction] = useState<number | null>(null);
      const [showPattern, setShowPattern] = useState(false);
      const [equation, setEquation] = useState<string[]>([]);

      const acceleration = force / mass;
      const targetAccel = 3.0; // For challenge/prediction

      useEffect(() => {
         let interval: any;
         if (isLaunching) {
            const startTime = Date.now();
            interval = setInterval(() => {
               const elapsed = (Date.now() - startTime) / 1000;
               const newVel = acceleration * elapsed;
               const newPos = 0.5 * acceleration * elapsed * elapsed * 50; // scaled for pixels

               setVelocity(newVel);
               setPosition(newPos);
               setHistory(prev => [...prev.slice(-40), { t: elapsed, v: newVel }]);

               if (newPos > 400) {
                  setIsLaunching(false);
                  setExperiments(prev => [...prev, { f: force, m: mass, a: acceleration }]);
               }
            }, 30);
         }
         return () => clearInterval(interval);
      }, [isLaunching, acceleration, force, mass]);

      const resetLaunch = () => {
         setIsLaunching(false);
         setPosition(0);
         setVelocity(0);
         setHistory([]);
      };

      const checkPattern = () => {
         if (experiments.length >= 3) {
            setShowPattern(true);
            setTimeout(() => setShowPattern(false), 5000);
         }
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col overflow-hidden text-slate-800 font-sans">
            {/* Header */}
            <div className="bg-white border-b border-slate-200 p-4 flex justify-between items-center shadow-sm">
               <div>
                  <h2 className="text-xl font-black text-slate-900 tracking-tight">Newton's Second Law Lab</h2>
                  <div className="flex gap-4 mt-1">
                     <button onClick={() => { setMode('exp1'); setMass(2); setExperiments([]); }} className={`text-[10px] font-bold px-3 py-1 rounded-full transition-all ${mode === 'exp1' ? 'bg-blue-600 text-white' : 'bg-slate-100 text-slate-500'}`}>EXP 1: VARY FORCE</button>
                     <button onClick={() => { setMode('exp2'); setForce(4); setExperiments([]); }} className={`text-[10px] font-bold px-3 py-1 rounded-full transition-all ${mode === 'exp2' ? 'bg-purple-600 text-white' : 'bg-slate-100 text-slate-500'}`}>EXP 2: VARY MASS</button>
                     <button onClick={() => setMode('free')} className={`text-[10px] font-bold px-3 py-1 rounded-full transition-all ${mode === 'free' ? 'bg-emerald-600 text-white' : 'bg-slate-100 text-slate-500'}`}>FREE EXPLORATION</button>
                  </div>
               </div>
               <div className="flex gap-3">
                  <div className="bg-slate-900 text-white px-4 py-2 rounded-xl flex flex-col items-center min-w-[80px]">
                     <span className="text-[8px] font-bold opacity-50 uppercase">Acceleration</span>
                     <span className="text-lg font-black">{acceleration.toFixed(2)} <span className="text-[10px]">m/s¬≤</span></span>
                  </div>
               </div>
            </div>

            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               {/* Main Lab Area */}
               <div className="flex-1 p-6 flex flex-col gap-6 overflow-y-auto">
                  {/* The Track */}
                  <div className="relative h-48 bg-white rounded-3xl border-2 border-slate-200 shadow-inner overflow-hidden flex items-end p-4">
                     <div className="absolute inset-0 opacity-5 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#000 1px, transparent 1px)', backgroundSize: '20px 20px' }} />

                     {/* Start Line */}
                     <div className="absolute left-10 bottom-0 top-0 w-1 bg-slate-100" />

                     {/* The Cart */}
                     <div
                        className="relative transition-transform duration-30"
                        style={{ transform: `translateX(${position}px)`, left: '40px' }}
                     >
                        {/* Force Arrow */}
                        {force > 0 && !isLaunching && (
                           <div className="absolute -left-12 top-4 flex items-center">
                              <div className="h-1 bg-amber-500" style={{ width: `${force * 10}px` }} />
                              <div className="w-0 h-0 border-t-4 border-t-transparent border-b-4 border-b-transparent border-l-[8px] border-l-amber-500" />
                           </div>
                        )}

                        {/* Cart Body */}
                        <div className="w-24 h-12 bg-slate-800 rounded-lg relative flex items-center justify-center">
                           <div className="text-white font-bold text-xs">{mass}kg</div>
                           {/* Wheels */}
                           <div className="absolute -bottom-2 left-2 w-4 h-4 bg-slate-900 rounded-full border-2 border-slate-700" />
                           <div className="absolute -bottom-2 right-2 w-4 h-4 bg-slate-900 rounded-full border-2 border-slate-700" />

                           {/* Mass Blocks */}
                           <div className="absolute -top-4 left-2 right-2 flex gap-1 justify-center">
                              {Array.from({ length: mass }).map((_, i) => (
                                 <div key={i} className="w-4 h-4 bg-slate-400 rounded-sm border border-slate-500" />
                              ))}
                           </div>
                        </div>
                     </div>

                     {/* Finish Line */}
                     <div className="absolute left-[440px] bottom-0 top-0 w-4 bg-checkered" style={{ backgroundImage: 'linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000), linear-gradient(45deg, #000 25%, transparent 25%, transparent 75%, #000 75%, #000)', backgroundSize: '10px 10px', backgroundPosition: '0 0, 5px 5px' }} />
                  </div>

                  {/* Controls & Graphs */}
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                     {/* Controls */}
                     <div className="bg-white p-6 rounded-3xl border border-slate-200 shadow-sm space-y-6">
                        <div className="flex justify-between items-center">
                           <h3 className="font-bold text-slate-900">Lab Settings</h3>
                           <button onClick={resetLaunch} className="text-[10px] font-bold text-slate-400 hover:text-slate-600">‚Ü∫ RESET</button>
                        </div>

                        {/* Force Slider */}
                        <div className="space-y-3">
                           <div className="flex justify-between items-end">
                              <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Applied Force (N)</label>
                              <span className="text-xl font-black text-amber-600">{force}N</span>
                           </div>
                           <div className="relative h-8 flex items-center">
                              <div className="absolute left-0 right-0 h-1 bg-slate-100 rounded-full" />
                              <input
                                 type="range" min="1" max="10" step="1" value={force}
                                 disabled={mode === 'exp2' || isLaunching}
                                 onChange={(e) => setForce(Number(e.target.value))}
                                 className="absolute w-full h-1 bg-transparent appearance-none cursor-pointer accent-amber-500 z-10"
                              />
                              {/* Spring Visual */}
                              <div className="absolute left-0 h-4 border-l-2 border-slate-300 flex items-center opacity-20 pointer-events-none" style={{ width: `${force * 10}%` }}>
                                 <svg className="w-full h-full" preserveAspectRatio="none">
                                    <path d="M 0 8 Q 5 0 10 8 Q 15 16 20 8" fill="none" stroke="currentColor" strokeWidth="1" />
                                 </svg>
                              </div>
                           </div>
                        </div>

                        {/* Mass Controls */}
                        <div className="space-y-3">
                           <label className="text-xs font-bold text-slate-500 uppercase tracking-wider">Object Mass (kg)</label>
                           <div className="flex items-center gap-4">
                              <button
                                 disabled={mode === 'exp1' || mass <= 1 || isLaunching}
                                 onClick={() => setMass(m => m - 1)}
                                 className="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center font-bold text-slate-600 hover:bg-slate-200 disabled:opacity-30"
                              >‚Äì</button>
                              <div className="flex-1 h-12 bg-slate-50 rounded-xl border border-slate-200 flex items-center justify-center font-black text-xl text-slate-800">
                                 {mass} kg
                              </div>
                              <button
                                 disabled={mode === 'exp1' || mass >= 8 || isLaunching}
                                 onClick={() => setMass(m => m + 1)}
                                 className="w-10 h-10 rounded-xl bg-slate-100 flex items-center justify-center font-bold text-slate-600 hover:bg-slate-200 disabled:opacity-30"
                              >+</button>
                           </div>
                        </div>

                        <button
                           onClick={() => setIsLaunching(true)}
                           disabled={isLaunching}
                           className={`w-full py-4 rounded-2xl font-black text-lg shadow-lg transition-all transform active:scale-95 ${isLaunching ? 'bg-slate-100 text-slate-400' : 'bg-slate-900 text-white hover:bg-slate-800'
                              }`}
                        >
                           {isLaunching ? 'LAUNCHING...' : 'üöÄ LAUNCH CART'}
                        </button>
                     </div>

                     {/* Velocity Graph */}
                     <div className="bg-slate-900 p-6 rounded-3xl shadow-xl flex flex-col">
                        <div className="flex justify-between items-center mb-4">
                           <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest">Velocity vs. Time</h3>
                           <div className="text-emerald-400 font-mono text-xs">Slope = {acceleration.toFixed(2)}</div>
                        </div>
                        <div className="flex-1 relative border-l border-b border-slate-700">
                           <svg className="w-full h-full overflow-visible">
                              {/* Grid Lines */}
                              {[0, 25, 50, 75, 100].map(p => (
                                 <line key={p} x1="0" y1={`${p}%`} x2="100%" y2={`${p}%`} stroke="#1e293b" strokeWidth="1" />
                              ))}
                              {/* Data Path */}
                              <polyline
                                 points={history.map((h, i) => `${(i / 40) * 100}%, ${100 - (h.v * 5)}%`).join(' ')}
                                 fill="none" stroke="#10b981" strokeWidth="3" strokeLinecap="round"
                              />
                           </svg>
                           <div className="absolute bottom-[-20px] left-1/2 -translate-x-1/2 text-[8px] text-slate-500 font-bold">TIME (s)</div>
                           <div className="absolute left-[-30px] top-1/2 -rotate-90 -translate-y-1/2 text-[8px] text-slate-500 font-bold">VELOCITY (m/s)</div>
                        </div>
                     </div>
                  </div>

                  {/* Data Table */}
                  <div className="bg-white rounded-3xl border border-slate-200 shadow-sm overflow-hidden">
                     <div className="bg-slate-50 px-6 py-3 border-b border-slate-200 flex justify-between items-center">
                        <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest">Experimental Data</h3>
                        <button onClick={() => setExperiments([])} className="text-[10px] font-bold text-slate-400">CLEAR ALL</button>
                     </div>
                     <div className="overflow-x-auto">
                        <table className="w-full text-left">
                           <thead>
                              <tr className="text-[10px] font-bold text-slate-400 uppercase border-b border-slate-100">
                                 <th className="px-6 py-3">Trial</th>
                                 <th className="px-6 py-3">Force (N)</th>
                                 <th className="px-6 py-3">Mass (kg)</th>
                                 <th className="px-6 py-3">Accel (m/s¬≤)</th>
                                 <th className="px-6 py-3">Status</th>
                              </tr>
                           </thead>
                           <tbody className="text-sm">
                              {experiments.map((exp, i) => (
                                 <tr key={i} className="border-b border-slate-50 hover:bg-slate-50 transition-colors">
                                    <td className="px-6 py-3 font-bold text-slate-400">#{i + 1}</td>
                                    <td className="px-6 py-3 font-black text-amber-600">{exp.f}N</td>
                                    <td className="px-6 py-3 font-black text-slate-700">{exp.m}kg</td>
                                    <td className="px-6 py-3 font-black text-blue-600">{exp.a.toFixed(2)}</td>
                                    <td className="px-6 py-3">
                                       <span className="px-2 py-1 bg-green-100 text-green-700 rounded-md text-[10px] font-bold">RECORDED</span>
                                    </td>
                                 </tr>
                              ))}
                              {experiments.length === 0 && (
                                 <tr>
                                    <td colSpan={5} className="px-6 py-8 text-center text-slate-400 italic text-xs">No data recorded yet. Launch the cart to capture data!</td>
                                 </tr>
                              )}
                           </tbody>
                        </table>
                     </div>
                  </div>
               </div>

               {/* Sidebar Analysis */}
               <div className="w-full lg:w-80 bg-white border-l border-slate-200 p-6 flex flex-col gap-8 overflow-y-auto">
                  <div className="space-y-6">
                     <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Analysis & Discovery</p>

                     {/* Discovery Sequence */}
                     <div className="space-y-4">
                        <div className="p-4 bg-blue-50 rounded-2xl border border-blue-100">
                           <p className="text-xs font-bold text-blue-900 mb-2">Current Goal:</p>
                           <p className="text-xs text-blue-800 leading-relaxed">
                              {mode === 'exp1' ? "Keep Mass at 2kg. Change Force to 2N, 4N, and 6N. What happens to acceleration?" :
                                 mode === 'exp2' ? "Keep Force at 4N. Change Mass to 1kg, 2kg, and 4kg. What happens to acceleration?" :
                                    "Explore freely! Can you find a combination that gives exactly 5.0 m/s¬≤ acceleration?"}
                           </p>
                        </div>

                        {experiments.length >= 3 && (
                           <div className="p-4 bg-emerald-50 rounded-2xl border border-emerald-100 animate-in fade-in slide-in-from-bottom-2">
                              <div className="flex gap-2 mb-2">
                                 <span className="text-emerald-600">‚ú®</span>
                                 <p className="text-xs font-bold text-emerald-900">Pattern Detected!</p>
                              </div>
                              <p className="text-[10px] text-emerald-800 leading-relaxed">
                                 {mode === 'exp1' ? "Notice that as Force doubles, Acceleration also doubles! They are directly proportional." :
                                    mode === 'exp2' ? "Notice that as Mass doubles, Acceleration is cut in half! They are inversely proportional." :
                                       "You've collected enough data to build the equation. Try the Equation Builder below!"}
                              </p>
                           </div>
                        )}
                     </div>

                     {/* Equation Builder */}
                     <div className="space-y-4">
                        <p className="text-[10px] font-bold text-slate-500 uppercase">Equation Builder</p>
                        <div className="flex flex-wrap gap-2 p-4 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-200 min-h-[60px] items-center justify-center">
                           {equation.map((tile, i) => (
                              <button
                                 key={i} onClick={() => setEquation(prev => prev.filter((_, idx) => idx !== i))}
                                 className="px-3 py-2 bg-white border border-slate-300 rounded-lg font-black text-sm shadow-sm hover:bg-red-50 hover:border-red-200 transition-colors"
                              >{tile}</button>
                           ))}
                           {equation.length === 0 && <span className="text-[10px] text-slate-400">Drag or click tiles to build the rule</span>}
                        </div>
                        <div className="flex flex-wrap gap-2 justify-center">
                           {['F', '=', 'm', '√ó', 'a', '√∑'].map(tile => (
                              <button
                                 key={tile} onClick={() => setEquation(prev => [...prev, tile])}
                                 className="px-3 py-2 bg-slate-100 rounded-lg font-black text-sm hover:bg-slate-200 transition-colors"
                              >{tile}</button>
                           ))}
                        </div>
                        {equation.join('') === 'F=m√óa' && (
                           <div className="p-3 bg-green-500 text-white rounded-xl text-center font-bold text-xs animate-bounce">
                              CORRECT! F = ma
                           </div>
                        )}
                     </div>
                  </div>

                  <div className="mt-auto p-4 bg-amber-50 rounded-2xl border border-amber-100">
                     <div className="flex gap-3">
                        <div className="text-amber-600 text-lg">üí°</div>
                        <p className="text-[10px] text-amber-800 leading-relaxed font-medium">
                           <strong>The Big Idea:</strong> Force is a "push" that causes acceleration.
                           Mass is "laziness" (inertia) that resists acceleration.
                           The more force you apply, the more it speeds up!
                        </p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- GAS LAW RENDERER (PV=nRT) ---
   // Stage 1: Core insight = Pressure, Volume, and Temperature are interconnected.
   // Stage 2: Primary = Piston (Volume), Secondary = Heat Source (Temperature).
   // Stage 3: Drag piston to change Volume; Slider for Temperature.
   // Stage 4: Real-time Pressure gauge and particle collision visualization.
   // Stage 5: State (volume, temp) -> Derived (pressure).
   // Stage 6: Challenge = "Reach 5.0 atm Pressure".
   const GasLawRenderer = () => {
      const [volume, setVolume] = useState(200); // px height
      const [temp, setTemp] = useState(300);     // Kelvin
      const [particles, setParticles] = useState<{ x: number, y: number, vx: number, vy: number }[]>([]);
      const [challengeMode, setChallengeMode] = useState(false);

      const pressure = (temp / volume) * 2; // Simplified Ideal Gas Law
      const isChallengeMet = challengeMode && pressure >= 4.9 && pressure <= 5.1;

      useEffect(() => {
         const newParticles = Array.from({ length: 20 }).map(() => ({
            x: Math.random() * 200,
            y: Math.random() * volume,
            vx: (Math.random() - 0.5) * (temp / 50),
            vy: (Math.random() - 0.5) * (temp / 50)
         }));
         setParticles(newParticles);
      }, []);

      useEffect(() => {
         const interval = setInterval(() => {
            setParticles(prev => prev.map(p => {
               let { x, y, vx, vy } = p;
               x += vx;
               y += vy;
               if (x < 0 || x > 200) vx *= -1;
               if (y < 0 || y > volume) vy *= -1;
               return { x, y, vx, vy };
            }));
         }, 30);
         return () => clearInterval(interval);
      }, [volume, temp]);

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Gas Law Lab</h2>
                     <p className="text-slate-500 text-sm">Ideal Gas Law: PV = nRT</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Reach 5.0 atm Pressure</p>
                           <p className="text-xs opacity-80">Adjust Volume and Temperature to hit exactly 5.0 atm.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 relative overflow-hidden items-center justify-center">
                  {/* The Container */}
                  <div className="relative w-[210px] bg-white border-4 border-slate-300 border-t-0 rounded-b-xl overflow-hidden" style={{ height: '250px' }}>
                     {/* The Piston */}
                     <div
                        className="absolute w-full bg-slate-400 border-b-4 border-slate-500 flex items-center justify-center cursor-ns-resize shadow-lg z-10"
                        style={{ height: '20px', top: `${250 - volume - 20}px` }}
                        onMouseDown={(e) => {
                           const startY = e.clientY;
                           const startVol = volume;
                           const handleMove = (moveEvent: MouseEvent) => {
                              const delta = startY - moveEvent.clientY;
                              setVolume(Math.max(50, Math.min(230, startVol + delta)));
                           };
                           const handleUp = () => {
                              window.removeEventListener('mousemove', handleMove);
                              window.removeEventListener('mouseup', handleUp);
                           };
                           window.addEventListener('mousemove', handleMove);
                           window.addEventListener('mouseup', handleUp);
                        }}
                     >
                        <div className="w-12 h-1 bg-slate-300 rounded-full" />
                     </div>

                     {/* Particles */}
                     <svg className="w-full h-full">
                        {particles.map((p, i) => (
                           <circle
                              key={i} cx={p.x} cy={250 - p.y} r="3"
                              fill={temp > 400 ? '#ef4444' : temp < 200 ? '#3b82f6' : '#94a3b8'}
                              className="transition-colors duration-500"
                           />
                        ))}
                     </svg>
                  </div>

                  {/* Pressure Gauge */}
                  <div className="absolute top-4 right-4 bg-white p-4 rounded-2xl shadow-xl border border-slate-100 flex flex-col items-center">
                     <div className="text-3xl font-black text-slate-900">{pressure.toFixed(1)}</div>
                     <div className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Pressure (atm)</div>
                     <div className="w-full h-1 bg-slate-100 rounded-full mt-2 overflow-hidden">
                        <div className="h-full bg-red-500 transition-all duration-300" style={{ width: `${Math.min(100, pressure * 10)}%` }} />
                     </div>
                  </div>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-around shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{volume}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Volume (V)</div>
                  </div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-amber-400">{temp}K</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Temp (T)</div>
                  </div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-emerald-400">{pressure.toFixed(2)}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Pressure (P)</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Lab Controls</p>

                  <div className="space-y-2">
                     <div className="flex justify-between">
                        <label className="text-[10px] font-bold text-slate-500">Temperature (K)</label>
                        <span className="text-[10px] font-bold text-amber-600">{temp} K</span>
                     </div>
                     <input
                        type="range" min="100" max="600" step="10" value={temp}
                        onChange={(e) => setTemp(Number(e.target.value))}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500"
                     />
                  </div>

                  <div className="p-4 bg-white rounded-xl border border-slate-200">
                     <p className="text-[10px] font-bold text-slate-500 uppercase mb-2">Instructions</p>
                     <p className="text-[10px] text-slate-600 leading-relaxed">
                        Drag the <strong>Piston</strong> up and down to change volume.
                        Use the slider to change <strong>Temperature</strong>.
                        Watch how the particles speed up and hit the walls harder!
                     </p>
                  </div>

                  <button
                     onClick={() => { setVolume(200); setTemp(300); }}
                     className="w-full py-3 bg-slate-200 text-slate-600 rounded-xl font-bold text-sm"
                  >
                     ‚Ü∫ RESET LAB
                  </button>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-amber-50 rounded-xl border border-amber-100">
                  <div className="flex gap-3">
                     <div className="text-amber-600 text-lg">üí°</div>
                     <p className="text-[10px] text-amber-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Pressure is caused by gas particles
                        colliding with the walls. If you decrease <strong>Volume</strong>,
                        they hit the walls more often. If you increase <strong>Temperature</strong>,
                        they hit the walls harder!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- EQUATION BALANCER RENDERER (Chemical Equations) ---
   // Stage 1: Core insight = Matter is conserved; atoms on the left must equal atoms on the right.
   // Stage 2: Primary = Coefficients, Secondary = Visual Atom Count.
   // Stage 3: Click arrows to change coefficients.
   // Stage 4: Real-time atom count comparison (Left vs Right).
   // Stage 5: State (coefficients) -> Derived (atom counts, balance status).
   // Stage 6: Challenge = "Balance the Combustion of Methane".
   const EquationBalancerRenderer = () => {
      const [coeffs, setCoeffs] = useState([1, 1, 1, 1]); // CH4 + O2 -> CO2 + H2O
      const [challengeMode, setChallengeMode] = useState(false);

      const reactants = [
         { name: 'CH‚ÇÑ', atoms: { C: 1, H: 4 } },
         { name: 'O‚ÇÇ', atoms: { O: 2 } }
      ];
      const products = [
         { name: 'CO‚ÇÇ', atoms: { C: 1, O: 2 } },
         { name: 'H‚ÇÇO', atoms: { H: 2, O: 1 } }
      ];

      const leftAtoms = {
         C: coeffs[0] * reactants[0].atoms.C,
         H: coeffs[0] * reactants[0].atoms.H,
         O: coeffs[1] * reactants[1].atoms.O
      };

      const rightAtoms = {
         C: coeffs[2] * products[0].atoms.C,
         H: coeffs[3] * products[1].atoms.H,
         O: coeffs[2] * products[0].atoms.O + coeffs[3] * products[1].atoms.O
      };

      const isBalanced = leftAtoms.C === rightAtoms.C &&
         leftAtoms.H === rightAtoms.H &&
         leftAtoms.O === rightAtoms.O;

      const isChallengeMet = challengeMode && isBalanced && coeffs.some(c => c > 1);

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Equation Balancer</h2>
                     <p className="text-slate-500 text-sm">Law of Conservation of Mass</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Balance Methane Combustion</p>
                           <p className="text-xs opacity-80">Adjust coefficients until C, H, and O atoms match on both sides.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 relative overflow-hidden justify-center">
                  {/* The Equation */}
                  <div className="flex items-center justify-center gap-4 text-2xl font-bold flex-wrap">
                     <div className="flex items-center gap-2">
                        <div className="flex flex-col items-center">
                           <button onClick={() => setCoeffs([coeffs[0] + 1, coeffs[1], coeffs[2], coeffs[3]])} className="text-xs text-slate-400 hover:text-slate-600">‚ñ≤</button>
                           <span className="text-blue-600 w-8 text-center">{coeffs[0]}</span>
                           <button onClick={() => setCoeffs([Math.max(1, coeffs[0] - 1), coeffs[1], coeffs[2], coeffs[3]])} className="text-xs text-slate-400 hover:text-slate-600">‚ñº</button>
                        </div>
                        <span>CH‚ÇÑ</span>
                     </div>
                     <span className="text-slate-300">+</span>
                     <div className="flex items-center gap-2">
                        <div className="flex flex-col items-center">
                           <button onClick={() => setCoeffs([coeffs[0], coeffs[1] + 1, coeffs[2], coeffs[3]])} className="text-xs text-slate-400 hover:text-slate-600">‚ñ≤</button>
                           <span className="text-blue-600 w-8 text-center">{coeffs[1]}</span>
                           <button onClick={() => setCoeffs([coeffs[0], Math.max(1, coeffs[1] - 1), coeffs[2], coeffs[3]])} className="text-xs text-slate-400 hover:text-slate-600">‚ñº</button>
                        </div>
                        <span>O‚ÇÇ</span>
                     </div>
                     <span className="text-slate-400 mx-4">‚Üí</span>
                     <div className="flex items-center gap-2">
                        <div className="flex flex-col items-center">
                           <button onClick={() => setCoeffs([coeffs[0], coeffs[1], coeffs[2] + 1, coeffs[3]])} className="text-xs text-slate-400 hover:text-slate-600">‚ñ≤</button>
                           <span className="text-emerald-600 w-8 text-center">{coeffs[2]}</span>
                           <button onClick={() => setCoeffs([coeffs[0], coeffs[1], Math.max(1, coeffs[2] - 1), coeffs[3]])} className="text-xs text-slate-400 hover:text-slate-600">‚ñº</button>
                        </div>
                        <span>CO‚ÇÇ</span>
                     </div>
                     <span className="text-slate-300">+</span>
                     <div className="flex items-center gap-2">
                        <div className="flex flex-col items-center">
                           <button onClick={() => setCoeffs([coeffs[0], coeffs[1], coeffs[2], coeffs[3] + 1])} className="text-xs text-slate-400 hover:text-slate-600">‚ñ≤</button>
                           <span className="text-emerald-600 w-8 text-center">{coeffs[3]}</span>
                           <button onClick={() => setCoeffs([coeffs[0], coeffs[1], coeffs[2], Math.max(1, coeffs[3] - 1)])} className="text-xs text-slate-400 hover:text-slate-600">‚ñº</button>
                        </div>
                        <span>H‚ÇÇO</span>
                     </div>
                  </div>

                  {/* Atom Count Comparison */}
                  <div className="mt-12 grid grid-cols-3 gap-8 max-w-md mx-auto w-full">
                     {['C', 'H', 'O'].map(atom => (
                        <div key={atom} className="flex flex-col items-center gap-2">
                           <div className="w-10 h-10 rounded-full bg-slate-800 text-white flex items-center justify-center font-bold">{atom}</div>
                           <div className="flex items-center gap-3 text-lg font-black">
                              <span className={leftAtoms[atom as keyof typeof leftAtoms] === rightAtoms[atom as keyof typeof rightAtoms] ? 'text-emerald-500' : 'text-red-500'}>
                                 {leftAtoms[atom as keyof typeof leftAtoms]}
                              </span>
                              <span className="text-slate-300">|</span>
                              <span className={leftAtoms[atom as keyof typeof leftAtoms] === rightAtoms[atom as keyof typeof rightAtoms] ? 'text-emerald-500' : 'text-red-500'}>
                                 {rightAtoms[atom as keyof typeof rightAtoms]}
                              </span>
                           </div>
                        </div>
                     ))}
                  </div>

                  {isBalanced && (
                     <div className="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none">
                        <div className="text-8xl font-black text-emerald-500/10 rotate-12">BALANCED</div>
                     </div>
                  )}
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-8 shadow-xl">
                  <div className={`text-xl font-black transition-all ${isBalanced ? 'text-emerald-400' : 'text-slate-500'}`}>
                     {isBalanced ? '‚úì EQUATION BALANCED' : '‚ö† EQUATION UNBALANCED'}
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Balancer Controls</p>

                  <div className="p-4 bg-white rounded-xl border border-slate-200 space-y-3">
                     <p className="text-[10px] font-bold text-slate-500 uppercase">Reactants (Left)</p>
                     <div className="text-xs text-slate-600">
                        Carbon: {leftAtoms.C}<br />
                        Hydrogen: {leftAtoms.H}<br />
                        Oxygen: {leftAtoms.O}
                     </div>
                  </div>

                  <div className="p-4 bg-white rounded-xl border border-slate-200 space-y-3">
                     <p className="text-[10px] font-bold text-slate-500 uppercase">Products (Right)</p>
                     <div className="text-xs text-slate-600">
                        Carbon: {rightAtoms.C}<br />
                        Hydrogen: {rightAtoms.H}<br />
                        Oxygen: {rightAtoms.O}
                     </div>
                  </div>

                  <button
                     onClick={() => setCoeffs([1, 1, 1, 1])}
                     className="w-full py-3 bg-slate-200 text-slate-600 rounded-xl font-bold text-sm"
                  >
                     ‚Ü∫ RESET COEFFICIENTS
                  </button>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-emerald-50 rounded-xl border border-emerald-100">
                  <div className="flex gap-3">
                     <div className="text-emerald-600 text-lg">üí°</div>
                     <p className="text-[10px] text-emerald-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Atoms are never created or destroyed in a
                        chemical reaction‚Äîthey just get rearranged! Balancing ensures that
                        every atom that goes in comes out in a new molecule.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ATOMIC BUILDER RENDERER (Atomic Structure) ---
   // Stage 1: Core insight = Protons define the element; Electrons define charge; Neutrons define stability.
   // Stage 2: Primary = Nucleus (P+N), Secondary = Electron Shells.
   // Stage 3: Add/Remove particles to build atoms.
   // Stage 4: Real-time Element Name, Atomic Number, Mass Number, and Charge.
   // Stage 5: State (protons, neutrons, electrons) -> Derived (element, charge, stability).
   // Stage 6: Challenge = "Build Carbon-12".
   const AtomicBuilderRenderer = () => {
      const [protons, setProtons] = useState(1);
      const [neutrons, setNeutrons] = useState(0);
      const [electrons, setElectrons] = useState(1);
      const [challengeMode, setChallengeMode] = useState(false);

      const elements = [
         { symbol: 'H', name: 'Hydrogen', p: 1 },
         { symbol: 'He', name: 'Helium', p: 2 },
         { symbol: 'Li', name: 'Lithium', p: 3 },
         { symbol: 'Be', name: 'Beryllium', p: 4 },
         { symbol: 'B', name: 'Boron', p: 5 },
         { symbol: 'C', name: 'Carbon', p: 6 },
         { symbol: 'N', name: 'Nitrogen', p: 7 },
         { symbol: 'O', name: 'Oxygen', p: 8 },
         { symbol: 'F', name: 'Fluorine', p: 9 },
         { symbol: 'Ne', name: 'Neon', p: 10 }
      ];

      const currentElement = elements.find(e => e.p === protons) || { symbol: '?', name: 'Unknown', p: protons };
      const massNumber = protons + neutrons;
      const charge = protons - electrons;
      const isStable = Math.abs(protons - neutrons) <= 1 || (protons === 1 && neutrons === 0);

      const isChallengeMet = challengeMode && protons === 6 && neutrons === 6 && electrons === 6;

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Atomic Builder</h2>
                     <p className="text-slate-500 text-sm">Build atoms and explore the periodic table</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Build Carbon-12</p>
                           <p className="text-xs opacity-80">Add exactly 6 protons, 6 neutrons, and 6 electrons.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 relative overflow-hidden items-center justify-center">
                  {/* Electron Shells */}
                  <div className="relative w-64 h-64 flex items-center justify-center">
                     <div className="absolute w-full h-full border-2 border-slate-200 rounded-full" />
                     <div className="absolute w-40 h-40 border-2 border-slate-200 rounded-full" />

                     {/* Nucleus */}
                     <div className="relative w-16 h-16 flex flex-wrap items-center justify-center gap-0.5 p-2 bg-slate-200 rounded-full shadow-inner overflow-hidden">
                        {[...Array(protons)].map((_, i) => (
                           <div key={`p-${i}`} className="w-3 h-3 bg-red-500 rounded-full shadow-sm animate-pulse" />
                        ))}
                        {[...Array(neutrons)].map((_, i) => (
                           <div key={`n-${i}`} className="w-3 h-3 bg-slate-400 rounded-full shadow-sm" />
                        ))}
                     </div>

                     {/* Electrons */}
                     {[...Array(electrons)].map((_, i) => {
                        const angle = (i * 360) / electrons;
                        const radius = i < 2 ? 80 : 128; // Shell 1 or 2
                        return (
                           <div
                              key={`e-${i}`}
                              className="absolute w-3 h-3 bg-blue-400 rounded-full shadow-lg transition-all duration-500"
                              style={{
                                 transform: `rotate(${angle}deg) translateY(-${radius / 2}px)`
                              }}
                           />
                        );
                     })}
                  </div>

                  {/* Info Overlay */}
                  <div className="absolute top-4 right-4 bg-white p-4 rounded-2xl shadow-xl border border-slate-100 flex flex-col items-center min-w-[100px]">
                     <div className="text-4xl font-black text-slate-900">{currentElement.symbol}</div>
                     <div className="text-[10px] font-bold text-slate-400 uppercase">{currentElement.name}</div>
                     <div className="mt-2 flex gap-4 border-t border-slate-100 pt-2 w-full justify-center">
                        <div className="text-center">
                           <div className="text-xs font-bold text-slate-800">{protons}</div>
                           <div className="text-[8px] text-slate-400 uppercase">Atomic #</div>
                        </div>
                        <div className="text-center">
                           <div className="text-xs font-bold text-slate-800">{massNumber}</div>
                           <div className="text-[8px] text-slate-400 uppercase">Mass #</div>
                        </div>
                     </div>
                  </div>

                  {/* Stability & Charge Indicators */}
                  <div className="absolute bottom-4 left-4 flex gap-2">
                     <div className={`px-3 py-1 rounded-full text-[10px] font-bold ${isStable ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'
                        }`}>
                        {isStable ? 'STABLE' : 'UNSTABLE'}
                     </div>
                     <div className={`px-3 py-1 rounded-full text-[10px] font-bold ${charge === 0 ? 'bg-slate-100 text-slate-700' : charge > 0 ? 'bg-amber-100 text-amber-700' : 'bg-blue-100 text-blue-700'
                        }`}>
                        {charge === 0 ? 'NEUTRAL' : charge > 0 ? `ION (+${charge})` : `ION (${charge})`}
                     </div>
                  </div>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-around shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-red-400">{protons}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Protons (+)</div>
                  </div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-slate-400">{neutrons}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Neutrons (0)</div>
                  </div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{electrons}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Electrons (-)</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Particle Controls</p>

                  <div className="space-y-4">
                     <div className="flex items-center justify-between">
                        <span className="text-xs font-bold text-slate-600">Protons</span>
                        <div className="flex gap-2">
                           <button onClick={() => setProtons(Math.max(1, protons - 1))} className="w-8 h-8 bg-white border border-slate-200 rounded-lg shadow-sm font-bold">-</button>
                           <button onClick={() => setProtons(Math.min(10, protons + 1))} className="w-8 h-8 bg-white border border-slate-200 rounded-lg shadow-sm font-bold">+</button>
                        </div>
                     </div>
                     <div className="flex items-center justify-between">
                        <span className="text-xs font-bold text-slate-600">Neutrons</span>
                        <div className="flex gap-2">
                           <button onClick={() => setNeutrons(Math.max(0, neutrons - 1))} className="w-8 h-8 bg-white border border-slate-200 rounded-lg shadow-sm font-bold">-</button>
                           <button onClick={() => setNeutrons(Math.min(12, neutrons + 1))} className="w-8 h-8 bg-white border border-slate-200 rounded-lg shadow-sm font-bold">+</button>
                        </div>
                     </div>
                     <div className="flex items-center justify-between">
                        <span className="text-xs font-bold text-slate-600">Electrons</span>
                        <div className="flex gap-2">
                           <button onClick={() => setElectrons(Math.max(0, electrons - 1))} className="w-8 h-8 bg-white border border-slate-200 rounded-lg shadow-sm font-bold">-</button>
                           <button onClick={() => setElectrons(Math.min(10, electrons + 1))} className="w-8 h-8 bg-white border border-slate-200 rounded-lg shadow-sm font-bold">+</button>
                        </div>
                     </div>
                  </div>

                  <button
                     onClick={() => { setProtons(1); setNeutrons(0); setElectrons(1); }}
                     className="w-full py-3 bg-slate-200 text-slate-600 rounded-xl font-bold text-sm"
                  >
                     ‚Ü∫ RESET ATOM
                  </button>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-red-50 rounded-xl border border-red-100">
                  <div className="flex gap-3">
                     <div className="text-red-600 text-lg">üí°</div>
                     <p className="text-[10px] text-red-800 leading-relaxed">
                        <strong>The Big Idea:</strong> The number of <strong>Protons</strong> determines
                        which element you have. <strong>Neutrons</strong> act like "glue" to keep
                        the nucleus stable. <strong>Electrons</strong> orbit the nucleus and
                        determine the atom's charge!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ENERGY COASTER RENDERER (PE/KE Conservation) ---
   // Stage 1: Core insight = Energy transforms between PE and KE but total is conserved.
   // Stage 2: Primary = Track Shape (Hill Heights), Secondary = Friction.
   // Stage 3: Drag points on the track to change hill heights.
   // Stage 4: Real-time energy bars (PE, KE, Heat).
   // Stage 5: State (track points, friction) -> Derived (velocity, energy).
   // Stage 6: Challenge = "Make it to the end".
   const EnergyCoasterRenderer = () => {
      const [points, setPoints] = useState([
         { x: 0, y: 50 },
         { x: 100, y: 200 },
         { x: 200, y: 100 },
         { x: 300, y: 200 }
      ]);
      const [friction, setFriction] = useState(0.02);
      const [isPlaying, setIsPlaying] = useState(false);
      const [progress, setProgress] = useState(0); // 0 to 1
      const [velocity, setVelocity] = useState(0);
      const [ke, setKe] = useState(0);
      const [pe, setPe] = useState(0);
      const [heat, setHeat] = useState(0);
      const [challengeMode, setChallengeMode] = useState(false);

      const getTrackY = (x: number) => {
         // Simple linear interpolation for the track
         for (let i = 0; i < points.length - 1; i++) {
            if (x >= points[i].x && x <= points[i + 1].x) {
               const t = (x - points[i].x) / (points[i + 1].x - points[i].x);
               return points[i].y + t * (points[i + 1].y - points[i].y);
            }
         }
         return points[points.length - 1].y;
      };

      useEffect(() => {
         let interval: any;
         if (isPlaying) {
            interval = setInterval(() => {
               setProgress(p => {
                  const nextP = p + 0.005;
                  if (nextP >= 1) {
                     setIsPlaying(false);
                     return 1;
                  }

                  const currentX = p * 300;
                  const nextX = nextP * 300;
                  const currentY = getTrackY(currentX);
                  const nextY = getTrackY(nextX);

                  // Physics: PE = mgh, KE = 1/2 mv^2
                  // For simplicity, m=1, g=10
                  const currentPE = (250 - currentY) * 0.1;
                  const nextPE = (250 - nextY) * 0.1;

                  // Energy conservation: PE_start = PE_now + KE_now + Heat
                  const startPE = (250 - points[0].y) * 0.1;
                  const currentHeat = heat + (friction * 0.5);
                  const currentKE = Math.max(0, startPE - currentPE - currentHeat);

                  setPe(currentPE);
                  setKe(currentKE);
                  setHeat(currentHeat);
                  setVelocity(Math.sqrt(2 * currentKE));

                  if (currentKE <= 0 && p > 0.05) {
                     setIsPlaying(false);
                     return p;
                  }

                  return nextP;
               });
            }, 30);
         }
         return () => clearInterval(interval);
      }, [isPlaying, points, friction, heat]);

      const reset = () => {
         setProgress(0);
         setVelocity(0);
         setKe(0);
         setPe((250 - points[0].y) * 0.1);
         setHeat(0);
         setIsPlaying(false);
      };

      const isChallengeMet = challengeMode && progress > 0.98;

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Energy Coaster</h2>
                     <p className="text-slate-500 text-sm">Conservation of Energy: PE + KE = Total</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Reach the End</p>
                           <p className="text-xs opacity-80">Design the hills so the cart has enough energy to reach the finish line.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 relative overflow-hidden">
                  <svg className="w-full h-full" viewBox="0 0 300 250">
                     {/* Track Path */}
                     <path
                        d={`M ${points.map(p => `${p.x} ${p.y}`).join(' L ')}`}
                        fill="none" stroke="#cbd5e1" strokeWidth="8" strokeLinecap="round" strokeLinejoin="round"
                     />
                     <path
                        d={`M ${points.map(p => `${p.x} ${p.y}`).join(' L ')}`}
                        fill="none" stroke="#94a3b8" strokeWidth="2" strokeDasharray="4 4"
                     />

                     {/* The Cart */}
                     <g transform={`translate(${progress * 300}, ${getTrackY(progress * 300)})`}>
                        <rect x="-10" y="-15" width="20" height="12" rx="2" fill="#ef4444" className="shadow-lg" />
                        <circle cx="-6" cy="-2" r="3" fill="#1e293b" />
                        <circle cx="6" cy="-2" r="3" fill="#1e293b" />
                     </g>

                     {/* Draggable Points */}
                     {points.map((p, i) => (
                        <circle
                           key={i} cx={p.x} cy={p.y} r="6"
                           fill="white" stroke="#3b82f6" strokeWidth="2"
                           className="cursor-ns-resize shadow-sm"
                           onMouseDown={(e) => {
                              const handleMove = (moveEvent: MouseEvent) => {
                                 const svg = (e.target as any).ownerSVGElement;
                                 const pt = svg.createSVGPoint();
                                 pt.x = moveEvent.clientX;
                                 pt.y = moveEvent.clientY;
                                 const svgP = pt.matrixTransform(svg.getScreenCTM().inverse());
                                 const newPoints = [...points];
                                 newPoints[i] = { ...newPoints[i], y: Math.max(20, Math.min(230, svgP.y)) };
                                 setPoints(newPoints);
                              };
                              const handleUp = () => {
                                 window.removeEventListener('mousemove', handleMove);
                                 window.removeEventListener('mouseup', handleUp);
                              };
                              window.addEventListener('mousemove', handleMove);
                              window.addEventListener('mouseup', handleUp);
                           }}
                        />
                     ))}
                  </svg>

                  {/* Energy Bars */}
                  <div className="absolute bottom-4 left-4 right-4 flex flex-col gap-2">
                     <div className="flex items-center gap-2">
                        <div className="w-12 text-[8px] font-bold text-slate-400 uppercase">PE</div>
                        <div className="flex-1 h-3 bg-slate-200 rounded-full overflow-hidden">
                           <div className="h-full bg-blue-500 transition-all duration-50" style={{ width: `${Math.min(100, pe * 4)}%` }} />
                        </div>
                     </div>
                     <div className="flex items-center gap-2">
                        <div className="w-12 text-[8px] font-bold text-slate-400 uppercase">KE</div>
                        <div className="flex-1 h-3 bg-slate-200 rounded-full overflow-hidden">
                           <div className="h-full bg-emerald-500 transition-all duration-50" style={{ width: `${Math.min(100, ke * 4)}%` }} />
                        </div>
                     </div>
                     <div className="flex items-center gap-2">
                        <div className="w-12 text-[8px] font-bold text-slate-400 uppercase">HEAT</div>
                        <div className="flex-1 h-3 bg-slate-200 rounded-full overflow-hidden">
                           <div className="h-full bg-orange-500 transition-all duration-50" style={{ width: `${Math.min(100, heat * 4)}%` }} />
                        </div>
                     </div>
                  </div>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-around shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{pe.toFixed(1)}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Potential</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">+</div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-emerald-400">{ke.toFixed(1)}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Kinetic</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">+</div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-orange-400">{heat.toFixed(1)}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Heat</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-white">{(pe + ke + heat).toFixed(1)}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Total</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Coaster Controls</p>

                  <div className="space-y-2">
                     <div className="flex justify-between">
                        <label className="text-[10px] font-bold text-slate-500">Friction</label>
                        <span className="text-[10px] font-bold text-orange-600">{(friction * 100).toFixed(0)}%</span>
                     </div>
                     <input
                        type="range" min="0" max="0.1" step="0.01" value={friction}
                        onChange={(e) => setFriction(Number(e.target.value))}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-orange-500"
                     />
                  </div>

                  <div className="flex gap-2">
                     <button
                        onClick={() => setIsPlaying(!isPlaying)}
                        className={`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${isPlaying ? 'bg-red-500 text-white shadow-lg' : 'bg-emerald-500 text-white shadow-lg'
                           }`}
                     >
                        {isPlaying ? '‚è∏ PAUSE' : '‚ñ∂ LAUNCH'}
                     </button>
                     <button
                        onClick={reset}
                        className="px-4 py-3 bg-slate-200 text-slate-600 rounded-xl font-bold text-sm"
                     >
                        ‚Ü∫
                     </button>
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-blue-50 rounded-xl border border-blue-100">
                  <div className="flex gap-3">
                     <div className="text-blue-600 text-lg">üí°</div>
                     <p className="text-[10px] text-blue-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Energy can't be created or destroyed.
                        As the cart goes down, <strong>Potential Energy</strong> turns into
                        <strong>Kinetic Energy</strong> (speed). Friction turns some of that
                        energy into <strong>Heat</strong>!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- FORCE LAB RENDERER (Newton's Laws / F=ma) ---
   // Stage 1: Core insight = Force causes acceleration; Mass resists it.
   // Stage 2: Primary = Applied Force (Arrow), Secondary = Mass (Blocks).
   // Stage 3: Drag arrow to apply force; Slider for mass.
   // Stage 4: a = F/m; Real-time velocity-time graph.
   // Stage 5: State (force, mass) -> Derived (acceleration, velocity, position).
   // Stage 6: Challenge = "Match the Acceleration".
   const ForceLabRenderer = () => {
      const [force, setForce] = useState(150); // Newtons
      const [mass, setMass] = useState(30);   // kg
      const [friction, setFriction] = useState(0.1);
      const [velocity, setVelocity] = useState(0);
      const [position, setPosition] = useState(0);
      const [isPlaying, setIsPlaying] = useState(false);
      const [history, setHistory] = useState<{ t: number, v: number }[]>([]);
      const [challengeMode, setChallengeMode] = useState(false);
      const [targetAcc, setTargetAcc] = useState(5);

      const netForce = Math.max(0, force - (friction * mass * 9.8));
      const acceleration = netForce / mass;

      useEffect(() => {
         let interval: any;
         if (isPlaying) {
            interval = setInterval(() => {
               setVelocity(v => v + acceleration * 0.05);
               setPosition(p => (p + velocity * 0.05) % 300);
               setHistory(h => [...h.slice(-40), { t: Date.now(), v: velocity }]);
            }, 50);
         }
         return () => clearInterval(interval);
      }, [isPlaying, acceleration, velocity]);

      const reset = () => {
         setVelocity(0);
         setPosition(0);
         setHistory([]);
         setIsPlaying(false);
      };

      const isChallengeMet = challengeMode && Math.abs(acceleration - targetAcc) < 0.2;

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Force & Motion Lab</h2>
                     <p className="text-slate-500 text-sm">Newton's Second Law: F = ma</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Match Acceleration = {targetAcc} m/s¬≤</p>
                           <p className="text-xs opacity-80">Adjust Force and Mass until the acceleration is exactly {targetAcc}.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 relative overflow-hidden">
                  {/* Track Area */}
                  <div className="flex-1 relative border-b-4 border-slate-300">
                     {/* The Cart */}
                     <div
                        className="absolute bottom-0 transition-all duration-50 ease-linear"
                        style={{ left: `${position}px` }}
                     >
                        <div className="relative">
                           {/* Force Arrow */}
                           <div
                              className="absolute -right-4 top-1/2 -translate-y-1/2 h-2 bg-amber-500 origin-left flex items-center"
                              style={{ width: `${force / 2}px` }}
                           >
                              <div className="absolute right-0 w-0 h-0 border-t-4 border-b-4 border-l-8 border-t-transparent border-b-transparent border-l-amber-500" />
                              <div className="absolute -top-6 left-1/2 -translate-x-1/2 text-[10px] font-bold text-amber-600 whitespace-nowrap">
                                 {force} N
                              </div>
                           </div>

                           {/* Cart Body */}
                           <div
                              className="bg-slate-800 rounded-lg shadow-xl flex items-center justify-center text-white font-bold text-xs"
                              style={{
                                 width: `${40 + mass}px`,
                                 height: '40px'
                              }}
                           >
                              {mass}kg
                           </div>
                           {/* Wheels */}
                           <div className="flex justify-around px-2 mt-1">
                              <div className="w-3 h-3 bg-slate-900 rounded-full" />
                              <div className="w-3 h-3 bg-slate-900 rounded-full" />
                           </div>
                        </div>
                     </div>
                  </div>

                  {/* Velocity Graph */}
                  <div className="h-32 mt-8 bg-white rounded-xl border border-slate-200 p-4 relative">
                     <div className="absolute top-2 left-2 text-[8px] font-bold text-slate-400 uppercase">Velocity vs Time</div>
                     <svg className="w-full h-full" viewBox="0 0 200 100" preserveAspectRatio="none">
                        <path
                           d={`M ${history.map((p, i) => `${(i / 40) * 200} ${100 - (p.v * 2)}`).join(' L ')}`}
                           fill="none" stroke="#3b82f6" strokeWidth="2"
                        />
                     </svg>
                     <div className="absolute bottom-2 right-2 text-[10px] font-bold text-blue-600">
                        v = {velocity.toFixed(1)} m/s
                     </div>
                  </div>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-amber-400">{force}N</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Force (F)</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">√∑</div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{mass}kg</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Mass (m)</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-emerald-400">{acceleration.toFixed(2)}</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Acc (m/s¬≤)</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Lab Controls</p>

                  <div className="space-y-2">
                     <div className="flex justify-between">
                        <label className="text-[10px] font-bold text-slate-500">Applied Force (N)</label>
                        <span className="text-[10px] font-bold text-amber-600">{force} N</span>
                     </div>
                     <input
                        type="range" min="0" max="500" step="10" value={force}
                        onChange={(e) => setForce(Number(e.target.value))}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500"
                     />
                  </div>

                  <div className="space-y-2">
                     <div className="flex justify-between">
                        <label className="text-[10px] font-bold text-slate-500">Mass (kg)</label>
                        <span className="text-[10px] font-bold text-blue-600">{mass} kg</span>
                     </div>
                     <input
                        type="range" min="5" max="100" step="5" value={mass}
                        onChange={(e) => setMass(Number(e.target.value))}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>

                  <div className="flex gap-2">
                     <button
                        onClick={() => setIsPlaying(!isPlaying)}
                        className={`flex-1 py-3 rounded-xl font-bold text-sm transition-all ${isPlaying ? 'bg-red-500 text-white shadow-lg' : 'bg-emerald-500 text-white shadow-lg'
                           }`}
                     >
                        {isPlaying ? '‚è∏ PAUSE' : '‚ñ∂ START MOTION'}
                     </button>
                     <button
                        onClick={reset}
                        className="px-4 py-3 bg-slate-200 text-slate-600 rounded-xl font-bold text-sm"
                     >
                        ‚Ü∫
                     </button>
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-amber-50 rounded-xl border border-amber-100">
                  <div className="flex gap-3">
                     <div className="text-amber-600 text-lg">üí°</div>
                     <p className="text-[10px] text-amber-800 leading-relaxed">
                        <strong>The Big Idea:</strong> Acceleration is directly proportional
                        to <strong>Force</strong> but inversely proportional to <strong>Mass</strong>.
                        Double the mass, and you'll need double the force to keep the same acceleration!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- TRIANGLE RENDERER (Angle Sum & Side Properties) ---
   // Stage 1: Core insight = Interior angles always sum to 180¬∞.
   // Stage 2: Primary = Vertices A, B, C.
   // Stage 3: Draggable Vertices + Real-time Measurements.
   // Stage 4: ‚à†A + ‚à†B + ‚à†C = 180¬∞.
   // Stage 5: State (A, B, C) ‚Üí Derived (angles, lengths, type).
   // Stage 6: Challenge = "Create a Right Triangle".
   const TriangleRenderer = () => {
      const [pA, setPA] = useState({ x: 100, y: 50 });
      const [pB, setPB] = useState({ x: 50, y: 200 });
      const [pC, setPC] = useState({ x: 250, y: 200 });
      const [challengeMode, setChallengeMode] = useState(false);

      // Calculate side lengths
      const dist = (p1: any, p2: any) => Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));
      const a = dist(pB, pC);
      const b = dist(pA, pC);
      const c = dist(pA, pB);

      // Calculate angles using Law of Cosines
      const getAngle = (s1: number, s2: number, opp: number) => {
         return Math.acos((s1 * s1 + s2 * s2 - opp * opp) / (2 * s1 * s2)) * (180 / Math.PI);
      };
      const angleA = getAngle(b, c, a);
      const angleB = getAngle(a, c, b);
      const angleC = getAngle(a, b, c);

      const isRight = Math.abs(angleA - 90) < 2 || Math.abs(angleB - 90) < 2 || Math.abs(angleC - 90) < 2;
      const isChallengeMet = challengeMode && isRight;

      const getType = () => {
         if (Math.abs(angleA - 60) < 2 && Math.abs(angleB - 60) < 2) return "Equilateral";
         if (Math.abs(angleA - angleB) < 2 || Math.abs(angleB - angleC) < 2 || Math.abs(angleA - angleC) < 2) return "Isosceles";
         if (isRight) return "Right";
         return "Scalene";
      };

      return (
         <div className="w-full h-full bg-white flex flex-col lg:flex-row overflow-hidden text-slate-800">
            <div className="flex-1 p-6 flex flex-col gap-6">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-900">Triangle Properties</h2>
                     <p className="text-slate-500 text-sm">Angles, sides, and types</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-500'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isChallengeMet ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Create a Right Triangle</p>
                           <p className="text-xs opacity-80">Drag the corners until one angle is exactly 90¬∞.</p>
                        </div>
                     </div>
                  </div>
               )}

               <div className="flex-1 flex items-center justify-center bg-slate-50 rounded-3xl border-2 border-dashed border-slate-200 p-8 relative overflow-hidden">
                  <svg className="w-full h-full max-w-[400px] max-h-[300px]" viewBox="0 0 300 250">
                     {/* Triangle Path */}
                     <path
                        d={`M ${pA.x} ${pA.y} L ${pB.x} ${pB.y} L ${pC.x} ${pC.y} Z`}
                        fill="#3b82f620" stroke="#3b82f6" strokeWidth="3" strokeLinejoin="round"
                     />

                     {/* Angle Labels */}
                     <text x={pA.x} y={pA.y - 15} textAnchor="middle" className="text-[10px] font-bold fill-slate-600">{angleA.toFixed(0)}¬∞</text>
                     <text x={pB.x - 20} y={pB.y + 15} textAnchor="middle" className="text-[10px] font-bold fill-slate-600">{angleB.toFixed(0)}¬∞</text>
                     <text x={pC.x + 20} y={pC.y + 15} textAnchor="middle" className="text-[10px] font-bold fill-slate-600">{angleC.toFixed(0)}¬∞</text>

                     {/* Draggable Handles */}
                     <circle cx={pA.x} cy={pA.y} r="8" fill="white" stroke="#3b82f6" strokeWidth="2" className="cursor-move shadow-sm" />
                     <circle cx={pB.x} cy={pB.y} r="8" fill="white" stroke="#3b82f6" strokeWidth="2" className="cursor-move shadow-sm" />
                     <circle cx={pC.x} cy={pC.y} r="8" fill="white" stroke="#3b82f6" strokeWidth="2" className="cursor-move shadow-sm" />
                  </svg>

                  <div className="absolute bottom-4 left-4 bg-white/80 backdrop-blur-sm px-3 py-1 rounded-full border border-slate-200 text-[10px] font-bold text-slate-500">
                     TYPE: <span className="text-blue-600">{getType().toUpperCase()}</span>
                  </div>
               </div>

               <div className="bg-slate-900 rounded-2xl p-6 flex items-center justify-center gap-4 shadow-xl">
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{angleA.toFixed(0)}¬∞</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Angle A</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">+</div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{angleB.toFixed(0)}¬∞</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Angle B</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">+</div>
                  <div className="flex flex-col items-center">
                     <div className="text-2xl font-black text-blue-400">{angleC.toFixed(0)}¬∞</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Angle C</div>
                  </div>
                  <div className="text-xl font-black text-slate-600">=</div>
                  <div className="flex flex-col items-center">
                     <div className="text-4xl font-black text-emerald-400">180¬∞</div>
                     <div className="text-[8px] font-bold text-slate-500 uppercase">Total Sum</div>
                  </div>
               </div>
            </div>

            <div className="w-full lg:w-80 bg-slate-50 border-l border-slate-200 p-6 flex flex-col gap-8">
               <div className="space-y-6">
                  <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Adjust Vertices</p>

                  {/* Vertex A Control */}
                  <div className="space-y-2">
                     <label className="text-[10px] font-bold text-slate-500">Vertex A (Top)</label>
                     <input
                        type="range" min="50" max="250" step="1" value={pA.x}
                        onChange={(e) => setPA({ ...pA, x: Number(e.target.value) })}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>

                  {/* Vertex B Control */}
                  <div className="space-y-2">
                     <label className="text-[10px] font-bold text-slate-500">Vertex B (Left)</label>
                     <input
                        type="range" min="20" max="140" step="1" value={pB.x}
                        onChange={(e) => setPB({ ...pB, x: Number(e.target.value) })}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>

                  {/* Vertex C Control */}
                  <div className="space-y-2">
                     <label className="text-[10px] font-bold text-slate-500">Vertex C (Right)</label>
                     <input
                        type="range" min="160" max="280" step="1" value={pC.x}
                        onChange={(e) => setPC({ ...pC, x: Number(e.target.value) })}
                        className="w-full h-1 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-500"
                     />
                  </div>
               </div>

               <div className="h-px bg-slate-200" />

               <div className="mt-auto p-4 bg-blue-50 rounded-xl border border-blue-100">
                  <div className="flex gap-3">
                     <div className="text-blue-600 text-lg">üí°</div>
                     <p className="text-[10px] text-blue-800 leading-relaxed">
                        <strong>The Big Idea:</strong> No matter how you stretch or move
                        the corners of a triangle, the <strong>three interior angles</strong>
                        will always add up to exactly <strong>180¬∞</strong>. Try it!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- SORTING ALGORITHM RENDERER (7-Stage Masterpiece) ---
   // Stage 1: Core insight = Efficiency and Strategy (Iterative vs Divide & Conquer)
   // Stage 2: Primary = Step Scrubber, Secondary = Algorithm Type, Array Size
   // Stage 3: Bar chart with color-coded states (Comparing, Swapping, Sorted)
   // Stage 4: Pre-calculated steps stored as immutable states
   // Stage 5: State (currentStep, algorithm) ‚Üí Derived (array, highlights)
   // Stage 6: Challenge = "Sort in minimum steps"
   const SortingRenderer = () => {
      const [algorithm, setAlgorithm] = useState<'bubble' | 'selection'>('bubble');
      const [arraySize, setArraySize] = useState(10);
      const [currentStep, setCurrentStep] = useState(0);
      const [isPlaying, setIsPlaying] = useState(false);
      const [speed, setSpeed] = useState(500);
      const [steps, setSteps] = useState<any[]>([]);

      // Generate initial random array and pre-calculate steps
      useEffect(() => {
         const initialArray = Array.from({ length: arraySize }, () => Math.floor(Math.random() * 90) + 10);
         const newSteps: any[] = [{ array: [...initialArray], comparing: [], swapping: [], sorted: [], desc: "Initial random array" }];

         if (algorithm === 'bubble') {
            const arr = [...initialArray];
            const n = arr.length;
            for (let i = 0; i < n; i++) {
               for (let j = 0; j < n - i - 1; j++) {
                  newSteps.push({ array: [...arr], comparing: [j, j + 1], swapping: [], sorted: Array.from({ length: i }, (_, k) => n - 1 - k), desc: `Comparing ${arr[j]} and ${arr[j + 1]}` });
                  if (arr[j] > arr[j + 1]) {
                     [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                     newSteps.push({ array: [...arr], comparing: [], swapping: [j, j + 1], sorted: Array.from({ length: i }, (_, k) => n - 1 - k), desc: `Swapping ${arr[j + 1]} and ${arr[j]}` });
                  }
               }
            }
            newSteps.push({ array: [...arr], comparing: [], swapping: [], sorted: Array.from({ length: n }, (_, k) => k), desc: "Array sorted!" });
         } else if (algorithm === 'selection') {
            const arr = [...initialArray];
            const n = arr.length;
            for (let i = 0; i < n - 1; i++) {
               let minIdx = i;
               newSteps.push({ array: [...arr], comparing: [i], swapping: [], sorted: Array.from({ length: i }, (_, k) => k), desc: `New pass: assume index ${i} is minimum` });
               for (let j = i + 1; j < n; j++) {
                  newSteps.push({ array: [...arr], comparing: [minIdx, j], swapping: [], sorted: Array.from({ length: i }, (_, k) => k), desc: `Comparing current min ${arr[minIdx]} with ${arr[j]}` });
                  if (arr[j] < arr[minIdx]) {
                     minIdx = j;
                     newSteps.push({ array: [...arr], comparing: [minIdx], swapping: [], sorted: Array.from({ length: i }, (_, k) => k), desc: `New minimum found: ${arr[minIdx]}` });
                  }
               }
               if (minIdx !== i) {
                  [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
                  newSteps.push({ array: [...arr], comparing: [], swapping: [i, minIdx], sorted: Array.from({ length: i }, (_, k) => k), desc: `Swapping ${arr[minIdx]} into position ${i}` });
               }
            }
            newSteps.push({ array: [...arr], comparing: [], swapping: [], sorted: Array.from({ length: n }, (_, k) => k), desc: "Array sorted!" });
         }

         setSteps(newSteps);
         setCurrentStep(0);
         setIsPlaying(false);
      }, [algorithm, arraySize]);

      // Playback logic
      useEffect(() => {
         if (!isPlaying) return;
         if (currentStep >= steps.length - 1) {
            setIsPlaying(false);
            return;
         }

         const timer = setTimeout(() => {
            setCurrentStep(prev => prev + 1);
         }, speed);

         return () => clearTimeout(timer);
      }, [isPlaying, currentStep, steps, speed]);

      const state = steps[currentStep] || { array: [], comparing: [], swapping: [], sorted: [], desc: "" };

      return (
         <div className="w-full h-full bg-slate-900 flex flex-col lg:flex-row overflow-hidden text-slate-200">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-6 flex flex-col gap-4">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-emerald-400 to-cyan-500">
                        Sorting Algorithms
                     </h2>
                     <p className="text-slate-400 text-sm">Visualize Time Complexity & Logic</p>
                  </div>
                  <div className="flex gap-2">
                     <button
                        onClick={() => setAlgorithm('bubble')}
                        className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${algorithm === 'bubble' ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-500/20' : 'bg-slate-800 text-slate-400'
                           }`}
                     >
                        BUBBLE SORT
                     </button>
                     <button
                        onClick={() => setAlgorithm('selection')}
                        className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${algorithm === 'selection' ? 'bg-emerald-600 text-white shadow-lg shadow-emerald-500/20' : 'bg-slate-800 text-slate-400'
                           }`}
                     >
                        SELECTION SORT
                     </button>
                  </div>
               </div>

               {/* Step Description */}
               <div className="p-4 bg-slate-800/50 rounded-xl border border-slate-700 min-h-[80px] flex items-center gap-4">
                  <div className="w-12 h-12 rounded-full bg-emerald-500/20 flex items-center justify-center text-emerald-400 font-mono font-bold shrink-0">
                     {currentStep}
                  </div>
                  <p className="text-lg font-medium text-slate-200">{state.desc}</p>
               </div>

               {/* Bar Chart */}
               <div className="flex-1 bg-slate-950 rounded-2xl border border-slate-800 p-8 flex items-end justify-center gap-1 shadow-inner">
                  {state.array.map((val: number, idx: number) => {
                     let color = "bg-slate-700";
                     if (state.comparing.includes(idx)) color = "bg-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.5)]";
                     if (state.swapping.includes(idx)) color = "bg-red-500 shadow-[0_0_15px_rgba(239,68,68,0.5)]";
                     if (state.sorted.includes(idx)) color = "bg-emerald-500";

                     return (
                        <div key={idx} className="flex flex-col items-center gap-2 flex-1 max-w-[40px]">
                           <span className={`text-[10px] font-mono font-bold ${state.comparing.includes(idx) || state.swapping.includes(idx) ? 'text-white' : 'text-slate-500'}`}>
                              {val}
                           </span>
                           <div
                              className={`w-full rounded-t-sm transition-all duration-200 ${color}`}
                              style={{ height: `${val * 3}px` }}
                           />
                        </div>
                     );
                  })}
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-80 bg-slate-900 border-l border-slate-800 p-6 flex flex-col gap-6 overflow-y-auto">
               <div className="flex gap-2">
                  <button
                     onClick={() => setIsPlaying(!isPlaying)}
                     className={`flex-1 py-4 rounded-xl font-bold text-lg transition-all ${isPlaying ? 'bg-slate-800 text-slate-300' : 'bg-emerald-500 text-white shadow-lg shadow-emerald-500/20'
                        }`}
                  >
                     {isPlaying ? '‚è∏ PAUSE' : '‚ñ∂ PLAY'}
                  </button>
                  <button
                     onClick={() => { setCurrentStep(0); setIsPlaying(false); }}
                     className="px-4 bg-slate-800 rounded-xl text-slate-400 hover:text-white transition-colors"
                  >
                     <i className="fa-solid fa-rotate-right"></i>
                  </button>
               </div>

               {/* Step Scrubber - PRIMARY */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">‚≠ê Step Scrubber</label>
                     <span className="text-sm font-mono font-bold text-emerald-400">{currentStep} / {steps.length - 1}</span>
                  </div>
                  <input
                     type="range" min="0" max={steps.length - 1} step="1" value={currentStep}
                     onChange={(e) => { setCurrentStep(Number(e.target.value)); setIsPlaying(false); }}
                     className="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-emerald-500"
                  />
               </div>

               <div className="h-px bg-slate-800" />

               {/* Array Size */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Array Size</label>
                     <span className="text-sm font-mono font-bold text-slate-300">{arraySize}</span>
                  </div>
                  <input
                     type="range" min="5" max="25" step="1" value={arraySize}
                     onChange={(e) => setArraySize(Number(e.target.value))}
                     className="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-slate-500"
                  />
               </div>

               {/* Speed */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Playback Speed</label>
                     <span className="text-sm font-mono font-bold text-slate-300">{speed}ms</span>
                  </div>
                  <input
                     type="range" min="50" max="1000" step="50" value={speed}
                     onChange={(e) => setSpeed(Number(e.target.value))}
                     className="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-slate-500"
                  />
               </div>

               {/* Educational Insight */}
               <div className="mt-auto p-4 bg-emerald-500/10 rounded-xl border border-emerald-500/20">
                  <div className="flex gap-3">
                     <div className="text-emerald-400 text-lg">üí°</div>
                     <p className="text-[10px] text-slate-300 leading-relaxed">
                        <strong>Complexity:</strong> Bubble sort is O(n¬≤), meaning steps grow exponentially with array size.
                        Notice how it "bubbles" the largest element to the end in each pass.
                        Selection sort finds the minimum and places it at the start.
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ELECTRIC CIRCUIT RENDERER (7-Stage Masterpiece) ---
   // Stage 1: Core insight = Ohm's Law (V = I * R). Flow depends on pressure (V) and friction (R).
   // Stage 2: Primary = Voltage, Secondary = Resistance, Circuit Type (Series/Parallel)
   // Stage 3: Schematic with animated electrons. Speed = Current.
   // Stage 4: I = V / R. Series: R = R1 + R2. Parallel: 1/R = 1/R1 + 1/R2.
   // Stage 5: State (V, R1, R2, type) ‚Üí Calculations ‚Üí Animation Speed
   // Stage 6: Challenge = "Match Current to 2.5A"
   const CircuitRenderer = () => {
      const [voltage, setVoltage] = useState(12);
      const [r1, setR1] = useState(4);
      const [r2, setR2] = useState(4);
      const [circuitType, setCircuitType] = useState<'series' | 'parallel'>('series');
      const [challengeMode, setChallengeMode] = useState(false);
      const [time, setTime] = useState(0);

      // Calculations
      const totalResistance = circuitType === 'series'
         ? r1 + r2
         : (r1 * r2) / (r1 + r2);

      const current = voltage / totalResistance; // I = V/R
      const power = voltage * current; // P = VI

      // Animation loop for electrons
      useEffect(() => {
         let animationId: number;
         const animate = () => {
            // Speed of electrons is proportional to current
            setTime(prev => prev + current * 0.05);
            animationId = requestAnimationFrame(animate);
         };
         animationId = requestAnimationFrame(animate);
         return () => cancelAnimationFrame(animationId);
      }, [current]);

      // Challenge logic
      const targetCurrent = 2.5;
      const isChallengeMet = challengeMode && Math.abs(current - targetCurrent) < 0.1;

      // SVG path for electrons
      const renderElectrons = () => {
         const electrons = [];
         const count = 15;
         const pathLength = 800; // Approximate total length of circuit path

         for (let i = 0; i < count; i++) {
            const offset = (time * 50 + (i * pathLength / count)) % pathLength;

            // Map offset to circuit coordinates
            let x = 0, y = 0;
            if (offset < 250) { // Top wire
               x = 100 + offset; y = 50;
            } else if (offset < 400) { // Right wire
               x = 350; y = 50 + (offset - 250);
            } else if (offset < 650) { // Bottom wire
               x = 350 - (offset - 400); y = 200;
            } else { // Left wire
               x = 100; y = 200 - (offset - 650);
            }

            electrons.push(<circle key={i} cx={x} cy={y} r="3" fill="#fbbf24" className="shadow-sm" />);
         }
         return electrons;
      };

      return (
         <div className="w-full h-full bg-slate-50 flex flex-col lg:flex-row overflow-hidden">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-6 flex flex-col gap-4">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold text-slate-800">Electric Circuits</h2>
                     <p className="text-slate-500 text-sm">Explore Ohm's Law & Circuit Topology</p>
                  </div>
                  <div className="flex gap-2">
                     <button
                        onClick={() => setCircuitType('series')}
                        className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${circuitType === 'series' ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200'
                           }`}
                     >
                        SERIES
                     </button>
                     <button
                        onClick={() => setCircuitType('parallel')}
                        className={`px-4 py-2 rounded-lg text-xs font-bold transition-all ${circuitType === 'parallel' ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-600 border border-slate-200'
                           }`}
                     >
                        PARALLEL
                     </button>
                  </div>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isChallengeMet ? 'bg-green-50 border-green-200' : 'bg-amber-50 border-amber-200'
                     }`}>
                     <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                           <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isChallengeMet ? 'bg-green-500 text-white' : 'bg-amber-500 text-white'
                              }`}>
                              {isChallengeMet ? '‚úì' : 'üéØ'}
                           </div>
                           <div>
                              <p className="font-bold text-slate-800">Goal: Match Current to {targetCurrent}A</p>
                              <p className="text-xs text-slate-600">Adjust Voltage and Resistance to find the balance.</p>
                           </div>
                        </div>
                        {isChallengeMet && <div className="text-green-600 font-black animate-bounce">CHALLENGE COMPLETE!</div>}
                     </div>
                  </div>
               )}

               <div className="flex-1 bg-white rounded-2xl border border-slate-200 shadow-inner relative overflow-hidden flex items-center justify-center">
                  <svg viewBox="0 0 450 300" className="w-full h-full max-w-[500px]">
                     {/* Circuit Wires */}
                     <rect x="100" y="50" width="250" height="150" fill="none" stroke="#334155" strokeWidth="4" rx="8" />

                     {/* Battery */}
                     <g transform="translate(100, 100)">
                        <rect x="-10" y="0" width="20" height="50" fill="#1e293b" rx="2" />
                        <rect x="-5" y="-5" width="10" height="5" fill="#ef4444" rx="1" />
                        <text x="-25" y="30" textAnchor="end" fill="#ef4444" fontSize="12" fontWeight="bold">{voltage}V</text>
                        <text x="0" y="65" textAnchor="middle" fill="#64748b" fontSize="10">BATTERY</text>
                     </g>

                     {/* Resistor 1 */}
                     <g transform="translate(225, 50)">
                        <rect x="-30" y="-15" width="60" height="30" fill="#f1f5f9" stroke="#334155" strokeWidth="2" rx="4" />
                        <line x1="-20" y1="-10" x2="-20" y2="10" stroke="#94a3b8" strokeWidth="2" />
                        <line x1="0" y1="-10" x2="0" y2="10" stroke="#94a3b8" strokeWidth="2" />
                        <line x1="20" y1="-10" x2="20" y2="10" stroke="#94a3b8" strokeWidth="2" />
                        <text x="0" y="-25" textAnchor="middle" fill="#334155" fontSize="12" fontWeight="bold">R1: {r1}Œ©</text>
                     </g>

                     {/* Resistor 2 (Series) */}
                     {circuitType === 'series' && (
                        <g transform="translate(350, 125)">
                           <rect x="-15" y="-30" width="30" height="60" fill="#f1f5f9" stroke="#334155" strokeWidth="2" rx="4" />
                           <text x="25" y="5" textAnchor="start" fill="#334155" fontSize="12" fontWeight="bold">R2: {r2}Œ©</text>
                        </g>
                     )}

                     {/* Resistor 2 (Parallel) */}
                     {circuitType === 'parallel' && (
                        <g>
                           <line x1="225" y1="50" x2="225" y2="120" stroke="#334155" strokeWidth="4" />
                           <line x1="350" y1="120" x2="225" y2="120" stroke="#334155" strokeWidth="4" />
                           <g transform="translate(287, 120)">
                              <rect x="-30" y="-15" width="60" height="30" fill="#f1f5f9" stroke="#334155" strokeWidth="2" rx="4" />
                              <text x="0" y="30" textAnchor="middle" fill="#334155" fontSize="12" fontWeight="bold">R2: {r2}Œ©</text>
                           </g>
                        </g>
                     )}

                     {/* Ammeter Display */}
                     <g transform="translate(225, 200)">
                        <circle r="35" fill="#1e293b" />
                        <text x="0" y="-5" textAnchor="middle" fill="#94a3b8" fontSize="8" fontWeight="bold">CURRENT</text>
                        <text x="0" y="15" textAnchor="middle" fill="#22d3ee" fontSize="18" fontWeight="bold" className="font-mono">
                           {current.toFixed(2)}A
                        </text>
                     </g>

                     {/* Electrons */}
                     {renderElectrons()}
                  </svg>

                  {/* Flow Intensity Overlay */}
                  <div className="absolute bottom-4 right-4 bg-white/80 backdrop-blur px-3 py-1 rounded-full border border-slate-200 text-[10px] font-bold text-slate-500 flex items-center gap-2">
                     <div className="w-2 h-2 rounded-full bg-fbbf24 animate-ping" />
                     ELECTRON FLOW INTENSITY: {(current * 10).toFixed(0)}%
                  </div>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-80 bg-white border-l border-slate-200 p-6 flex flex-col gap-6 overflow-y-auto">
               <button
                  onClick={() => setChallengeMode(!challengeMode)}
                  className={`w-full py-3 rounded-xl font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg' : 'bg-slate-100 text-slate-600 hover:bg-slate-200'
                     }`}
               >
                  {challengeMode ? 'üéØ CHALLENGE ON' : 'üéØ START CHALLENGE'}
               </button>

               {/* Voltage - PRIMARY */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">‚≠ê Voltage (V)</label>
                     <span className="text-xl font-mono font-bold text-indigo-600">{voltage}V</span>
                  </div>
                  <input
                     type="range" min="1" max="48" step="1" value={voltage}
                     onChange={(e) => setVoltage(Number(e.target.value))}
                     className="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                  />
                  <div className="flex justify-between text-[8px] text-slate-400 font-bold">
                     <span>1V (LOW)</span>
                     <span>48V (HIGH)</span>
                  </div>
               </div>

               <div className="h-px bg-slate-100" />

               {/* Resistance 1 */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Resistance 1 (Œ©)</label>
                     <span className="text-lg font-mono font-bold text-slate-700">{r1}Œ©</span>
                  </div>
                  <input
                     type="range" min="1" max="20" step="1" value={r1}
                     onChange={(e) => setR1(Number(e.target.value))}
                     className="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-slate-600"
                  />
               </div>

               {/* Resistance 2 */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Resistance 2 (Œ©)</label>
                     <span className="text-lg font-mono font-bold text-slate-700">{r2}Œ©</span>
                  </div>
                  <input
                     type="range" min="1" max="20" step="1" value={r2}
                     onChange={(e) => setR2(Number(e.target.value))}
                     className="w-full h-2 bg-slate-100 rounded-lg appearance-none cursor-pointer accent-slate-600"
                  />
               </div>

               {/* Metrics Summary */}
               <div className="grid grid-cols-2 gap-2">
                  <div className="bg-slate-50 p-3 rounded-xl border border-slate-100">
                     <div className="text-[8px] font-black text-slate-400 uppercase">Total R</div>
                     <div className="text-sm font-bold text-slate-800">{totalResistance.toFixed(1)}Œ©</div>
                  </div>
                  <div className="bg-slate-50 p-3 rounded-xl border border-slate-100">
                     <div className="text-[8px] font-black text-slate-400 uppercase">Power (P)</div>
                     <div className="text-sm font-bold text-slate-800">{power.toFixed(0)}W</div>
                  </div>
               </div>

               {/* Educational Insight */}
               <div className="mt-auto p-4 bg-indigo-50 rounded-xl border border-indigo-100">
                  <div className="flex gap-3">
                     <div className="text-indigo-600 text-lg">üí°</div>
                     <p className="text-[10px] text-indigo-800 leading-relaxed">
                        <strong>Ohm's Law:</strong> Current (I) is like the speed of water.
                        Voltage (V) is the pressure pushing it, and Resistance (R) is the pipe size.
                        In <strong>Series</strong>, resistors add up. In <strong>Parallel</strong>,
                        they provide more paths, actually <em>lowering</em> total resistance!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- WAVE INTERFERENCE RENDERER (7-Stage Masterpiece) ---
   // Stage 1: Core insight = Superposition principle (Constructive vs Destructive)
   // Stage 2: Primary = Phase Shift, Secondary = Frequencies, Amplitudes
   // Stage 3: Three-panel view (Wave 1, Wave 2, Resultant)
   // Stage 4: y = A*sin(kx - œât + œÜ), Resultant = y1 + y2
   // Stage 5: State (amp, freq, phase) ‚Üí Animation Frame ‚Üí SVG Path
   // Stage 6: Challenge = "Create a Standing Wave" or "Perfect Silence (Destructive)"
   const WaveInterferenceRenderer = () => {
      const [amp1, setAmp1] = useState(40);
      const [freq1, setFreq1] = useState(1.0);
      const [amp2, setAmp2] = useState(40);
      const [freq2, setFreq2] = useState(1.0);
      const [phase, setPhase] = useState(0); // degrees
      const [isAnimating, setIsAnimating] = useState(true);
      const [time, setTime] = useState(0);
      const [challengeMode, setChallengeMode] = useState(false);

      // Animation loop
      useEffect(() => {
         if (!isAnimating) return;
         let animationId: number;
         const startTime = performance.now();
         const animate = (now: number) => {
            setTime((now - startTime) / 1000);
            animationId = requestAnimationFrame(animate);
         };
         animationId = requestAnimationFrame(animate);
         return () => cancelAnimationFrame(animationId);
      }, [isAnimating]);

      const width = 600;
      const height = 120;
      const points = 100;
      const step = width / points;

      const generatePath = (a: number, f: number, p: number, t: number) => {
         const pathPoints = [];
         const phaseRad = (p * Math.PI) / 180;
         for (let i = 0; i <= points; i++) {
            const x = i * step;
            // y = A * sin(k*x - œâ*t + œÜ)
            // k = 2œÄ/Œª, œâ = 2œÄf
            const y = a * Math.sin((i / 10) * f - 5 * t + phaseRad);
            pathPoints.push(`${x},${height / 2 + y}`);
         }
         return `M ${pathPoints.join(" L ")}`;
      };

      const generateResultantPath = (t: number) => {
         const pathPoints = [];
         const phaseRad = (phase * Math.PI) / 180;
         for (let i = 0; i <= points; i++) {
            const x = i * step;
            const y1 = amp1 * Math.sin((i / 10) * freq1 - 5 * t);
            const y2 = amp2 * Math.sin((i / 10) * freq2 - 5 * t + phaseRad);
            pathPoints.push(`${x},${height / 2 + (y1 + y2)}`);
         }
         return `M ${pathPoints.join(" L ")}`;
      };

      // Challenge logic: Destructive interference
      // Occurs when freq1 == freq2, amp1 == amp2, and phase == 180
      const isDestructive = Math.abs(freq1 - freq2) < 0.01 &&
         Math.abs(amp1 - amp2) < 2 &&
         Math.abs(Math.abs(phase) - 180) < 5;

      const isConstructive = Math.abs(freq1 - freq2) < 0.01 &&
         Math.abs(phase % 360) < 5;

      return (
         <div className="w-full h-full bg-slate-950 flex flex-col lg:flex-row overflow-hidden text-slate-200">
            {/* VISUALIZATION AREA */}
            <div className="flex-1 p-6 flex flex-col gap-4">
               <div className="flex justify-between items-center">
                  <div>
                     <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-blue-500">
                        Wave Interference
                     </h2>
                     <p className="text-slate-400 text-sm">The Principle of Superposition</p>
                  </div>
                  <button
                     onClick={() => setChallengeMode(!challengeMode)}
                     className={`px-4 py-2 rounded-full text-xs font-bold transition-all ${challengeMode ? 'bg-amber-500 text-white shadow-lg shadow-amber-500/20' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'
                        }`}
                  >
                     {challengeMode ? 'üéØ CHALLENGE ACTIVE' : 'üéØ START CHALLENGE'}
                  </button>
               </div>

               {challengeMode && (
                  <div className={`p-4 rounded-xl border-2 transition-all ${isDestructive ? 'bg-emerald-500/10 border-emerald-500/50' : 'bg-amber-500/10 border-amber-500/50'
                     }`}>
                     <div className="flex items-center gap-3">
                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-xl ${isDestructive ? 'bg-emerald-500 text-white' : 'bg-amber-500 text-white'
                           }`}>
                           {isDestructive ? '‚úì' : 'üéØ'}
                        </div>
                        <div>
                           <p className="font-bold text-sm">Goal: Create "Perfect Silence"</p>
                           <p className="text-xs opacity-80">Adjust Phase Shift to cancel Wave 1 with Wave 2 (Destructive Interference).</p>
                        </div>
                        {isDestructive && (
                           <div className="ml-auto animate-bounce text-emerald-400 font-black">SUCCESS!</div>
                        )}
                     </div>
                  </div>
               )}

               <div className="flex-1 flex flex-col gap-2 min-h-0">
                  {/* Wave 1 */}
                  <div className="flex-1 bg-slate-900/50 rounded-xl border border-slate-800 p-2 relative overflow-hidden">
                     <div className="absolute top-2 left-2 text-[10px] font-bold text-cyan-400 uppercase tracking-widest">Wave A</div>
                     <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full preserve-3d">
                        <line x1="0" y1={height / 2} x2={width} y2={height / 2} stroke="#1e293b" strokeWidth="1" strokeDasharray="4 4" />
                        <path d={generatePath(amp1, freq1, 0, time)} fill="none" stroke="#22d3ee" strokeWidth="3" strokeLinecap="round" />
                     </svg>
                  </div>

                  {/* Wave 2 */}
                  <div className="flex-1 bg-slate-900/50 rounded-xl border border-slate-800 p-2 relative overflow-hidden">
                     <div className="absolute top-2 left-2 text-[10px] font-bold text-purple-400 uppercase tracking-widest">Wave B</div>
                     <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full">
                        <line x1="0" y1={height / 2} x2={width} y2={height / 2} stroke="#1e293b" strokeWidth="1" strokeDasharray="4 4" />
                        <path d={generatePath(amp2, freq2, phase, time)} fill="none" stroke="#a855f7" strokeWidth="3" strokeLinecap="round" />
                     </svg>
                  </div>

                  {/* Resultant */}
                  <div className="flex-[1.5] bg-slate-900 rounded-xl border-2 border-slate-800 p-2 relative overflow-hidden shadow-inner">
                     <div className="absolute top-2 left-2 text-[10px] font-bold text-white uppercase tracking-widest flex items-center gap-2">
                        Resultant Wave (A + B)
                        {isDestructive && <span className="text-emerald-400 text-[8px] animate-pulse">DESTRUCTIVE</span>}
                        {isConstructive && <span className="text-cyan-400 text-[8px] animate-pulse">CONSTRUCTIVE</span>}
                     </div>
                     <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full">
                        <defs>
                           <linearGradient id="waveGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                              <stop offset="0%" stopColor="#22d3ee" />
                              <stop offset="100%" stopColor="#a855f7" />
                           </linearGradient>
                        </defs>
                        <line x1="0" y1={height / 2} x2={width} y2={height / 2} stroke="#1e293b" strokeWidth="2" />
                        <path d={generateResultantPath(time)} fill="none" stroke="url(#waveGradient)" strokeWidth="4" strokeLinecap="round" />
                     </svg>
                  </div>
               </div>
            </div>

            {/* CONTROL PANEL */}
            <div className="w-full lg:w-80 bg-slate-900 border-l border-slate-800 p-6 flex flex-col gap-6 overflow-y-auto">
               <button
                  onClick={() => setIsAnimating(!isAnimating)}
                  className={`w-full py-3 rounded-xl font-bold transition-all ${isAnimating ? 'bg-slate-800 text-slate-300' : 'bg-cyan-500 text-white shadow-lg shadow-cyan-500/20'
                     }`}
               >
                  {isAnimating ? '‚è∏ PAUSE WAVE' : '‚ñ∂ RESUME WAVE'}
               </button>

               {/* Phase Shift - PRIMARY */}
               <div className="space-y-3">
                  <div className="flex justify-between items-end">
                     <label className="text-[10px] font-black text-slate-500 uppercase tracking-tighter">‚≠ê Phase Shift (œÜ)</label>
                     <span className="text-xl font-mono font-bold text-white">{phase}¬∞</span>
                  </div>
                  <input
                     type="range" min="-180" max="180" step="1" value={phase}
                     onChange={(e) => setPhase(Number(e.target.value))}
                     className="w-full h-2 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-purple-500"
                  />
                  <div className="flex justify-between text-[8px] text-slate-600 font-bold">
                     <span>-180¬∞</span>
                     <span>0¬∞ (SYNC)</span>
                     <span>180¬∞ (OPPOSITE)</span>
                  </div>
               </div>

               <div className="h-px bg-slate-800" />

               {/* Wave A Controls */}
               <div className="space-y-4">
                  <div className="text-[10px] font-bold text-cyan-500 uppercase tracking-widest">Wave A Settings</div>
                  <div className="space-y-2">
                     <div className="flex justify-between text-[10px] text-slate-400">
                        <span>Amplitude</span>
                        <span className="text-cyan-400">{amp1}</span>
                     </div>
                     <input
                        type="range" min="0" max="50" value={amp1}
                        onChange={(e) => setAmp1(Number(e.target.value))}
                        className="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                     />
                  </div>
                  <div className="space-y-2">
                     <div className="flex justify-between text-[10px] text-slate-400">
                        <span>Frequency</span>
                        <span className="text-cyan-400">{freq1.toFixed(1)}Hz</span>
                     </div>
                     <input
                        type="range" min="0.5" max="3" step="0.1" value={freq1}
                        onChange={(e) => setFreq1(Number(e.target.value))}
                        className="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-cyan-500"
                     />
                  </div>
               </div>

               {/* Wave B Controls */}
               <div className="space-y-4">
                  <div className="text-[10px] font-bold text-purple-500 uppercase tracking-widest">Wave B Settings</div>
                  <div className="space-y-2">
                     <div className="flex justify-between text-[10px] text-slate-400">
                        <span>Amplitude</span>
                        <span className="text-purple-400">{amp2}</span>
                     </div>
                     <input
                        type="range" min="0" max="50" value={amp2}
                        onChange={(e) => setAmp2(Number(e.target.value))}
                        className="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-purple-500"
                     />
                  </div>
                  <div className="space-y-2">
                     <div className="flex justify-between text-[10px] text-slate-400">
                        <span>Frequency</span>
                        <span className="text-purple-400">{freq2.toFixed(1)}Hz</span>
                     </div>
                     <input
                        type="range" min="0.5" max="3" step="0.1" value={freq2}
                        onChange={(e) => setFreq2(Number(e.target.value))}
                        className="w-full h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-purple-500"
                     />
                  </div>
               </div>

               {/* Educational Insight */}
               <div className="mt-auto p-4 bg-blue-500/10 rounded-xl border border-blue-500/20">
                  <div className="flex gap-3">
                     <div className="text-blue-400 text-lg">üí°</div>
                     <p className="text-[10px] text-slate-300 leading-relaxed">
                        <strong>Superposition:</strong> When two waves meet, their amplitudes add up.
                        If they are "in phase" (peaks align), they create a larger wave.
                        If they are "out of phase" (peak meets trough), they can cancel each other out entirely!
                     </p>
                  </div>
               </div>
            </div>
         </div>
      );
   };

   // --- ENHANCED PROJECTILE MOTION RENDERER ---
   const ProjectileRenderer = () => {
      const [angle, setAngle] = useState(45);
      const [velocity, setVelocity] = useState(25);
      const [isAnimating, setIsAnimating] = useState(false);
      const [animationProgress, setAnimationProgress] = useState(0);
      const [shots, setShots] = useState<{ hit: boolean, range: number }[]>([]);
      const [showResult, setShowResult] = useState<'hit' | 'miss' | null>(null);

      const g = 9.8;
      const scale = 4;
      const targetX = 550; // Target position
      const targetWidth = 40;

      // Physics calculations
      const radian = angle * (Math.PI / 180);
      const vx = velocity * Math.cos(radian);
      const vy = velocity * Math.sin(radian);
      const totalTime = (2 * vy) / g;
      const range = (velocity * velocity * Math.sin(2 * radian)) / g;
      const maxHeight = (vy * vy) / (2 * g);
      const flightTime = totalTime;

      // Generate trajectory points
      const trajectoryPoints: string[] = [];
      for (let t = 0; t <= totalTime; t += 0.05) {
         const x = vx * t * scale;
         const y = (vy * t - 0.5 * g * t * t) * scale;
         trajectoryPoints.push(`${50 + x},${450 - y}`);
      }

      // Animation position
      const animT = animationProgress * totalTime;
      const animX = 50 + vx * animT * scale;
      const animY = 450 - (vy * animT - 0.5 * g * animT * animT) * scale;

      // Check if hit target
      const landingX = 50 + range * scale;
      const isHit = landingX >= targetX && landingX <= targetX + targetWidth;

      // Launch animation
      const handleLaunch = () => {
         if (isAnimating) return;
         setShowResult(null);
         setIsAnimating(true);
         setAnimationProgress(0);

         const startTime = Date.now();
         const duration = Math.max(1000, totalTime * 400); // Animation duration

         const animate = () => {
            const elapsed = Date.now() - startTime;
            const progress = Math.min(1, elapsed / duration);
            setAnimationProgress(progress);

            if (progress < 1) {
               requestAnimationFrame(animate);
            } else {
               setIsAnimating(false);
               setShots(prev => [...prev, { hit: isHit, range: Math.round(range) }]);
               setShowResult(isHit ? 'hit' : 'miss');
            }
         };
         requestAnimationFrame(animate);
      };

      return (
         <div className="w-full h-full bg-gradient-to-b from-sky-100 to-sky-50 flex flex-col">
            {/* Main Visualization */}
            <div className="flex-1 relative overflow-hidden">
               <svg viewBox="0 0 800 500" className="w-full h-full">
                  {/* Sky gradient */}
                  <defs>
                     <linearGradient id="skyGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stopColor="#e0f2fe" />
                        <stop offset="100%" stopColor="#f0f9ff" />
                     </linearGradient>
                     <linearGradient id="groundGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stopColor="#4ade80" />
                        <stop offset="100%" stopColor="#16a34a" />
                     </linearGradient>
                     <linearGradient id="targetGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                        <stop offset="0%" stopColor="#fbbf24" />
                        <stop offset="100%" stopColor="#f59e0b" />
                     </linearGradient>
                  </defs>

                  <rect width="800" height="450" fill="url(#skyGradient)" />

                  {/* Ground */}
                  <rect x="0" y="450" width="800" height="50" fill="url(#groundGradient)" />

                  {/* Distance markers */}
                  {[0, 100, 200, 300, 400, 500, 600].map(d => (
                     <g key={d}>
                        <line x1={50 + d * scale / 10} y1="445" x2={50 + d * scale / 10} y2="455" stroke="#166534" strokeWidth="2" />
                        <text x={50 + d * scale / 10} y="475" textAnchor="middle" fill="#166534" fontSize="10" fontWeight="bold">{d / 10}m</text>
                     </g>
                  ))}

                  {/* Target */}
                  <g>
                     <rect x={targetX} y="380" width={targetWidth} height="70" fill="url(#targetGradient)" rx="4" />
                     <rect x={targetX + 5} y="390" width={targetWidth - 10} height="3" fill="#fff" opacity="0.5" />
                     <rect x={targetX + 5} y="400" width={targetWidth - 10} height="3" fill="#fff" opacity="0.5" />
                     <rect x={targetX + 5} y="410" width={targetWidth - 10} height="3" fill="#fff" opacity="0.5" />
                     <text x={targetX + targetWidth / 2} y="365" textAnchor="middle" fill="#b45309" fontSize="12" fontWeight="bold">üéØ TARGET</text>
                  </g>

                  {/* Trajectory prediction line */}
                  {!isAnimating && (
                     <polyline
                        points={trajectoryPoints.join(" ")}
                        fill="none"
                        stroke="#6366f1"
                        strokeWidth="2"
                        strokeDasharray="8 4"
                        opacity="0.4"
                     />
                  )}

                  {/* Animated trajectory (during flight) */}
                  {isAnimating && (
                     <polyline
                        points={trajectoryPoints.slice(0, Math.floor(animationProgress * trajectoryPoints.length)).join(" ")}
                        fill="none"
                        stroke="#6366f1"
                        strokeWidth="3"
                     />
                  )}

                  {/* Cannon base */}
                  <circle cx="50" cy="450" r="25" fill="#1e293b" />
                  <circle cx="50" cy="450" r="18" fill="#334155" />

                  {/* Cannon barrel */}
                  <g transform={`translate(50, 450) rotate(${-angle})`}>
                     <rect x="0" y="-12" width="70" height="24" fill="#475569" rx="6" />
                     <rect x="60" y="-8" width="15" height="16" fill="#334155" rx="3" />
                  </g>

                  {/* Angle arc indicator */}
                  <path
                     d={`M 85 450 A 35 35 0 0 0 ${50 + 35 * Math.cos(radian)} ${450 - 35 * Math.sin(radian)}`}
                     fill="none" stroke="#6366f1" strokeWidth="2"
                  />
                  <text x="90" y={430} fill="#6366f1" fontSize="14" fontWeight="bold">{angle}¬∞</text>

                  {/* Projectile (animated or at start) */}
                  {isAnimating ? (
                     <g>
                        <circle cx={animX} cy={animY} r="10" fill="#ef4444">
                           <animate attributeName="r" values="10;12;10" dur="0.2s" repeatCount="indefinite" />
                        </circle>
                        <circle cx={animX} cy={animY} r="6" fill="#fbbf24" />
                     </g>
                  ) : (
                     <g transform={`translate(${50 + 80 * Math.cos(radian)}, ${450 - 80 * Math.sin(radian)})`}>
                        <circle r="10" fill="#ef4444" />
                        <circle r="6" fill="#fbbf24" />
                     </g>
                  )}

                  {/* Result indicator */}
                  {showResult && (
                     <g>
                        <rect x="300" y="180" width="200" height="60" fill={showResult === 'hit' ? '#22c55e' : '#ef4444'} rx="12" />
                        <text x="400" y="218" textAnchor="middle" fill="white" fontSize="24" fontWeight="bold">
                           {showResult === 'hit' ? 'üéØ HIT!' : '‚ùå MISS'}
                        </text>
                     </g>
                  )}
               </svg>
            </div>

            {/* Control Panel */}
            <div className="bg-white border-t border-slate-200 p-4 shadow-lg">
               <div className="max-w-4xl mx-auto">
                  <div className="grid grid-cols-12 gap-4 items-end">
                     {/* Angle Control */}
                     <div className="col-span-3">
                        <label className="text-xs font-black uppercase text-slate-400 block mb-2">
                           <i className="fa-solid fa-angle mr-1"></i> Launch Angle
                        </label>
                        <div className="flex items-center gap-2">
                           <input
                              type="range" min="5" max="85" value={angle}
                              onChange={(e) => !isAnimating && setAngle(Number(e.target.value))}
                              className="flex-1 h-2 bg-indigo-100 rounded-full accent-indigo-500"
                              disabled={isAnimating}
                           />
                           <span className="w-12 text-lg font-mono font-bold text-indigo-600">{angle}¬∞</span>
                        </div>
                     </div>

                     {/* Velocity Control */}
                     <div className="col-span-3">
                        <label className="text-xs font-black uppercase text-slate-400 block mb-2">
                           <i className="fa-solid fa-gauge-high mr-1"></i> Initial Velocity
                        </label>
                        <div className="flex items-center gap-2">
                           <input
                              type="range" min="10" max="50" value={velocity}
                              onChange={(e) => !isAnimating && setVelocity(Number(e.target.value))}
                              className="flex-1 h-2 bg-amber-100 rounded-full accent-amber-500"
                              disabled={isAnimating}
                           />
                           <span className="w-16 text-lg font-mono font-bold text-amber-600">{velocity} m/s</span>
                        </div>
                     </div>

                     {/* Physics Metrics */}
                     <div className="col-span-4 grid grid-cols-3 gap-2">
                        <div className="bg-slate-50 p-2 rounded-lg text-center">
                           <div className="text-[9px] font-black uppercase text-slate-400">Range</div>
                           <div className="text-sm font-mono font-bold text-slate-700">{range.toFixed(1)}m</div>
                        </div>
                        <div className="bg-slate-50 p-2 rounded-lg text-center">
                           <div className="text-[9px] font-black uppercase text-slate-400">Max Height</div>
                           <div className="text-sm font-mono font-bold text-slate-700">{maxHeight.toFixed(1)}m</div>
                        </div>
                        <div className="bg-slate-50 p-2 rounded-lg text-center">
                           <div className="text-[9px] font-black uppercase text-slate-400">Flight Time</div>
                           <div className="text-sm font-mono font-bold text-slate-700">{flightTime.toFixed(2)}s</div>
                        </div>
                     </div>

                     {/* Launch Button */}
                     <div className="col-span-2">
                        <button
                           onClick={handleLaunch}
                           disabled={isAnimating}
                           className={`w-full py-3 rounded-xl font-black uppercase tracking-wider shadow-lg transition-all ${isAnimating
                              ? 'bg-slate-300 cursor-not-allowed'
                              : 'bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600 active:scale-95'
                              }`}
                        >
                           {isAnimating ? 'üöÄ Flying...' : 'üéØ LAUNCH!'}
                        </button>
                     </div>
                  </div>

                  {/* Shot History */}
                  {shots.length > 0 && (
                     <div className="mt-3 pt-3 border-t border-slate-100 flex items-center gap-2 flex-wrap">
                        <span className="text-xs font-bold text-slate-400 uppercase">Shots:</span>
                        {shots.slice(-5).map((shot, i) => (
                           <span key={i} className={`px-2 py-1 rounded text-xs font-bold ${shot.hit ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>
                              {shot.range}m {shot.hit ? '‚úì' : '‚úó'}
                           </span>
                        ))}
                        <span className="ml-auto text-xs font-bold text-slate-400">
                           {shots.filter(s => s.hit).length}/{shots.length} hits
                        </span>
                     </div>
                  )}
               </div>
            </div>
         </div>
      );
   };

   // --- LORENTZ FORCE RENDERER ---
   const LorentzForceRenderer = () => {
      const [velocity, setVelocity] = useState(50);
      const [fieldStrength, setFieldStrength] = useState(0.5);
      const [charge, setCharge] = useState<'positive' | 'negative'>('positive');
      const [particlePos, setParticlePos] = useState({ x: 200, y: 200 });
      const [particleVel, setParticleVel] = useState({ vx: 2, vy: 0 });
      const [isAnimating, setIsAnimating] = useState(false);
      const [trail, setTrail] = useState<{x: number, y: number}[]>([]);

      const q = charge === 'positive' ? 1 : -1;
      const force = q * velocity * fieldStrength;

      useEffect(() => {
         if (!isAnimating) return;
         const interval = setInterval(() => {
            setParticlePos(prev => {
               const newX = prev.x + particleVel.vx;
               const newY = prev.y + particleVel.vy;
               const forceMag = q * fieldStrength * 0.1;
               setParticleVel(v => ({
                  vx: v.vx - forceMag * v.vy,
                  vy: v.vy + forceMag * v.vx
               }));
               if (newX < 50 || newX > 350 || newY < 50 || newY > 350) {
                  setParticleVel({ vx: velocity / 25, vy: 0 });
                  setTrail([]);
                  return { x: 200, y: 200 };
               }
               setTrail(t => [...t.slice(-50), { x: newX, y: newY }]);
               return { x: newX, y: newY };
            });
         }, 30);
         return () => clearInterval(interval);
      }, [isAnimating, fieldStrength, q, velocity, particleVel]);

      const resetSimulation = () => {
         setParticlePos({ x: 200, y: 200 });
         setParticleVel({ vx: velocity / 25, vy: 0 });
         setTrail([]);
      };

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-800 bg-slate-900/50">
               <h3 className="text-xl font-black tracking-tight text-purple-400">LORENTZ FORCE</h3>
               <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">F = qv √ó B</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <svg width="400" height="400" viewBox="0 0 400 400" className="bg-slate-900/50 rounded-2xl">
                     {Array.from({ length: 7 }).map((_, i) =>
                        Array.from({ length: 7 }).map((_, j) => (
                           <g key={`${i}-${j}`} transform={`translate(${70 + i * 40}, ${70 + j * 40})`}>
                              <circle r="12" fill="none" stroke="#3b82f6" strokeWidth="1" opacity={0.3 + fieldStrength * 0.5} />
                              <line x1="-6" y1="-6" x2="6" y2="6" stroke="#3b82f6" strokeWidth="2" opacity={0.5 + fieldStrength * 0.5} />
                              <line x1="6" y1="-6" x2="-6" y2="6" stroke="#3b82f6" strokeWidth="2" opacity={0.5 + fieldStrength * 0.5} />
                           </g>
                        ))
                     )}
                     {trail.length > 1 && (
                        <path d={`M ${trail.map(p => `${p.x},${p.y}`).join(' L ')}`} fill="none"
                           stroke={charge === 'positive' ? '#ef4444' : '#3b82f6'} strokeWidth="3" opacity="0.6" />
                     )}
                     <g transform={`translate(${particlePos.x}, ${particlePos.y})`}>
                        <circle r="15" fill={charge === 'positive' ? '#ef4444' : '#3b82f6'} className="drop-shadow-lg" />
                        <text textAnchor="middle" dy="5" className="text-sm font-black fill-white">{charge === 'positive' ? '+' : '‚àí'}</text>
                        <line x1="0" y1="0" x2={particleVel.vx * 10} y2={particleVel.vy * 10} stroke="#22c55e" strokeWidth="3" markerEnd="url(#arrowV)" />
                     </g>
                     <defs>
                        <marker id="arrowV" markerWidth="6" markerHeight="6" refX="5" refY="3" orient="auto">
                           <path d="M0,0 L6,3 L0,6 Z" fill="#22c55e" />
                        </marker>
                     </defs>
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-slate-900/50 border-t lg:border-t-0 lg:border-l border-slate-800 p-6 flex flex-col gap-4">
                  <div className="p-4 bg-gradient-to-br from-purple-900/30 to-purple-800/20 rounded-2xl border border-purple-500/20">
                     <p className="text-[10px] font-black text-purple-400 uppercase tracking-widest mb-2">Force Magnitude</p>
                     <p className="text-3xl font-black text-white">{Math.abs(force).toFixed(2)} <span className="text-sm text-slate-400">N</span></p>
                  </div>
                  <div className="space-y-4">
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Velocity (m/s)</label>
                        <input type="range" min="10" max="100" value={velocity}
                           onChange={(e) => { setVelocity(Number(e.target.value)); resetSimulation(); }}
                           className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-green-500" />
                     </div>
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Field Strength (T)</label>
                        <input type="range" min="0.1" max="1" step="0.1" value={fieldStrength}
                           onChange={(e) => { setFieldStrength(Number(e.target.value)); resetSimulation(); }}
                           className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500" />
                     </div>
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Charge</label>
                        <div className="flex gap-2 mt-2">
                           {(['positive', 'negative'] as const).map(c => (
                              <button key={c} onClick={() => { setCharge(c); resetSimulation(); }}
                                 className={`flex-1 py-2 rounded-xl font-bold text-xs transition-all ${charge === c ? c === 'positive' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white' : 'bg-slate-800 text-slate-400'}`}>
                                 {c === 'positive' ? '+' : '‚àí'}
                              </button>
                           ))}
                        </div>
                     </div>
                  </div>
                  <div className="flex gap-2 mt-4">
                     <button onClick={() => setIsAnimating(!isAnimating)}
                        className={`flex-1 py-3 rounded-xl font-black text-xs transition-all ${isAnimating ? 'bg-orange-500 text-white' : 'bg-purple-500 text-white'}`}>
                        {isAnimating ? 'PAUSE' : 'START'}
                     </button>
                     <button onClick={resetSimulation} className="px-4 py-3 rounded-xl font-black text-xs bg-slate-800 text-slate-400 hover:bg-slate-700">RESET</button>
                  </div>
               </div>
            </div>
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <p className="text-xs text-slate-400 text-center"><strong>Right-Hand Rule</strong>: Point fingers in velocity direction, curl toward B field. Thumb shows force on positive charge.</p>
            </div>
         </div>
      );
   };

   // --- INDUCTANCE RENDERER ---
   const InductanceRenderer = () => {
      const [inductance, setInductance] = useState(0.5);
      const [resistance, setResistance] = useState(10);
      const [voltage, setVoltage] = useState(12);
      const [isConnected, setIsConnected] = useState(false);
      const [time, setTime] = useState(0);
      const [current, setCurrent] = useState(0);

      const tau = inductance / resistance;
      const maxCurrent = voltage / resistance;

      useEffect(() => {
         if (!isConnected) { setCurrent(0); setTime(0); return; }
         const interval = setInterval(() => {
            setTime(t => {
               const newT = t + 0.02;
               setCurrent(maxCurrent * (1 - Math.exp(-newT / tau)));
               return newT;
            });
         }, 50);
         return () => clearInterval(interval);
      }, [isConnected, tau, maxCurrent]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-800 bg-slate-900/50">
               <h3 className="text-xl font-black tracking-tight text-amber-400">RL CIRCUIT - INDUCTANCE</h3>
               <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">œÑ = L/R = {tau.toFixed(3)}s</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <svg width="400" height="350" viewBox="0 0 400 350">
                     <g transform="translate(50, 175)">
                        <line x1="0" y1="-20" x2="0" y2="20" stroke="#fbbf24" strokeWidth="4" />
                        <line x1="10" y1="-35" x2="10" y2="35" stroke="#fbbf24" strokeWidth="4" />
                        <text x="-5" y="55" className="text-xs font-bold fill-slate-400">{voltage}V</text>
                     </g>
                     <line x1="50" y1="140" x2="50" y2="50" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                     <line x1="50" y1="50" x2="350" y2="50" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                     <line x1="350" y1="50" x2="350" y2="140" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                     <g transform="translate(350, 175)">
                        <path d="M 0,-35 Q 15,-25 0,-15 Q -15,-5 0,5 Q 15,15 0,25 Q -15,35 0,35" fill="none" stroke="#a855f7" strokeWidth="4" />
                        <text x="20" y="5" className="text-xs font-bold fill-purple-400">{inductance}H</text>
                     </g>
                     <line x1="350" y1="210" x2="350" y2="300" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                     <line x1="350" y1="300" x2="200" y2="300" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                     <g transform="translate(200, 300)">
                        <path d="M -50,0 L -40,0 L -35,-10 L -25,10 L -15,-10 L -5,10 L 5,-10 L 15,10 L 25,-10 L 35,10 L 40,0 L 50,0" fill="none" stroke="#f97316" strokeWidth="3" />
                        <text x="-10" y="25" className="text-xs font-bold fill-orange-400">{resistance}Œ©</text>
                     </g>
                     <line x1="150" y1="300" x2="50" y2="300" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                     <line x1="50" y1="300" x2="50" y2="210" stroke={isConnected ? '#22c55e' : '#475569'} strokeWidth="3" />
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-slate-900/50 border-t lg:border-t-0 lg:border-l border-slate-800 p-6 flex flex-col gap-4">
                  <div className="p-4 bg-gradient-to-br from-green-900/30 to-green-800/20 rounded-2xl border border-green-500/20">
                     <p className="text-[10px] font-black text-green-400 uppercase tracking-widest mb-2">Current</p>
                     <p className="text-3xl font-black text-white">{current.toFixed(3)} <span className="text-sm text-slate-400">A</span></p>
                     <div className="w-full h-2 bg-slate-800 rounded-full mt-2 overflow-hidden">
                        <div className="h-full bg-green-500 transition-all duration-100" style={{ width: `${(current / maxCurrent) * 100}%` }} />
                     </div>
                  </div>
                  <div className="space-y-3">
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase">Inductance (H)</label>
                        <input type="range" min="0.1" max="2" step="0.1" value={inductance} onChange={(e) => setInductance(Number(e.target.value))}
                           className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500" />
                     </div>
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase">Resistance (Œ©)</label>
                        <input type="range" min="5" max="50" value={resistance} onChange={(e) => setResistance(Number(e.target.value))}
                           className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-orange-500" />
                     </div>
                  </div>
                  <button onClick={() => setIsConnected(!isConnected)}
                     className={`w-full py-4 rounded-xl font-black text-sm transition-all ${isConnected ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}`}>
                     {isConnected ? 'DISCONNECT' : 'CONNECT CIRCUIT'}
                  </button>
               </div>
            </div>
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <p className="text-xs text-slate-400 text-center"><strong>Key Insight:</strong> Inductors resist changes in current. After ~5œÑ, current reaches 99% of maximum.</p>
            </div>
         </div>
      );
   };

   // --- TRANSFORMERS RENDERER ---
   const TransformersRenderer = () => {
      const [primaryTurns, setPrimaryTurns] = useState(100);
      const [secondaryTurns, setSecondaryTurns] = useState(200);
      const [primaryVoltage, setPrimaryVoltage] = useState(120);
      const [isAnimating, setIsAnimating] = useState(false);
      const [phase, setPhase] = useState(0);

      const turnsRatio = secondaryTurns / primaryTurns;
      const secondaryVoltage = primaryVoltage * turnsRatio;
      const transformerType = turnsRatio > 1 ? 'Step-Up' : turnsRatio < 1 ? 'Step-Down' : 'Isolation';

      useEffect(() => {
         if (!isAnimating) return;
         const interval = setInterval(() => setPhase(p => (p + 0.1) % (2 * Math.PI)), 50);
         return () => clearInterval(interval);
      }, [isAnimating]);

      return (
         <div className="flex flex-col h-full bg-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-slate-800 bg-slate-900/50">
               <h3 className="text-xl font-black tracking-tight text-yellow-400">TRANSFORMER</h3>
               <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">{transformerType} ‚Ä¢ Turns Ratio: {turnsRatio.toFixed(2)}</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <svg width="450" height="350" viewBox="0 0 450 350">
                     <rect x="170" y="60" width="110" height="230" fill="none" stroke="#64748b" strokeWidth="20" rx="10" />
                     <g transform="translate(140, 175)">
                        {Array.from({ length: 8 }).map((_, i) => (
                           <ellipse key={i} cx="0" cy={-70 + i * 20} rx="30" ry="8" fill="none" stroke="#ef4444" strokeWidth="4" opacity={0.5 + 0.5 * Math.sin(phase + i * 0.5)} />
                        ))}
                        <text x="-60" y="0" className="text-xs font-bold fill-red-400">Primary</text>
                     </g>
                     <g transform="translate(310, 175)">
                        {Array.from({ length: Math.min(12, Math.ceil(secondaryTurns / 20)) }).map((_, i) => (
                           <ellipse key={i} cx="0" cy={-70 + i * (140 / Math.min(12, Math.ceil(secondaryTurns / 20)))} rx="30" ry="8" fill="none" stroke="#3b82f6" strokeWidth="4" opacity={0.5 + 0.5 * Math.sin(phase + i * 0.3 + Math.PI)} />
                        ))}
                        <text x="40" y="0" className="text-xs font-bold fill-blue-400">Secondary</text>
                     </g>
                     <g transform="translate(50, 175)">
                        <text className="text-lg font-black fill-red-400">{primaryVoltage}V</text>
                     </g>
                     <g transform="translate(380, 175)">
                        <text className="text-lg font-black fill-blue-400">{secondaryVoltage.toFixed(0)}V</text>
                     </g>
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-slate-900/50 border-t lg:border-t-0 lg:border-l border-slate-800 p-6 flex flex-col gap-4">
                  <div className={`p-4 rounded-2xl border ${turnsRatio > 1 ? 'bg-gradient-to-br from-green-900/30 to-green-800/20 border-green-500/20' : 'bg-gradient-to-br from-orange-900/30 to-orange-800/20 border-orange-500/20'}`}>
                     <p className="text-3xl font-black text-white">{turnsRatio.toFixed(2)}:1</p>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                     <div className="p-3 bg-red-900/20 rounded-xl border border-red-500/20">
                        <p className="text-[10px] font-bold text-red-400">Primary V</p>
                        <p className="text-lg font-black">{primaryVoltage}V</p>
                     </div>
                     <div className="p-3 bg-blue-900/20 rounded-xl border border-blue-500/20">
                        <p className="text-[10px] font-bold text-blue-400">Secondary V</p>
                        <p className="text-lg font-black">{secondaryVoltage.toFixed(0)}V</p>
                     </div>
                  </div>
                  <div className="space-y-3">
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase">Primary Turns</label>
                        <input type="range" min="50" max="200" value={primaryTurns} onChange={(e) => setPrimaryTurns(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500" />
                     </div>
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase">Secondary Turns</label>
                        <input type="range" min="50" max="400" value={secondaryTurns} onChange={(e) => setSecondaryTurns(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500" />
                     </div>
                  </div>
                  <button onClick={() => setIsAnimating(!isAnimating)}
                     className={`w-full py-4 rounded-xl font-black text-sm transition-all ${isAnimating ? 'bg-orange-500 text-white' : 'bg-yellow-500 text-slate-900'}`}>
                     {isAnimating ? 'STOP' : 'ENERGIZE'}
                  </button>
               </div>
            </div>
            <div className="p-6 bg-slate-900/50 border-t border-slate-800">
               <p className="text-xs text-slate-400 text-center"><strong>V‚ÇÅ/V‚ÇÇ = N‚ÇÅ/N‚ÇÇ</strong> ‚Ä¢ Higher voltage means lower current.</p>
            </div>
         </div>
      );
   };

   // --- DAY NIGHT CYCLE RENDERER ---
   const DayNightCycleRenderer = () => {
      const [rotation, setRotation] = useState(0);
      const [isSpinning, setIsSpinning] = useState(false);
      const [speed, setSpeed] = useState(1);

      useEffect(() => {
         if (!isSpinning) return;
         const interval = setInterval(() => setRotation(r => (r + speed) % 360), 50);
         return () => clearInterval(interval);
      }, [isSpinning, speed]);

      return (
         <div className="flex flex-col h-full bg-gradient-to-b from-slate-900 via-indigo-950 to-slate-900 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-white/10 bg-white/5">
               <h3 className="text-xl font-black tracking-tight text-yellow-300">DAY AND NIGHT</h3>
               <p className="text-[10px] font-bold text-white/50 uppercase tracking-widest">Earth's Rotation</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <div className="absolute inset-0 overflow-hidden">
                     {Array.from({ length: 50 }).map((_, i) => (
                        <div key={i} className="absolute w-1 h-1 bg-white rounded-full animate-pulse" style={{ left: `${Math.random() * 100}%`, top: `${Math.random() * 100}%`, animationDelay: `${Math.random() * 2}s` }} />
                     ))}
                  </div>
                  <svg width="400" height="400" viewBox="0 0 400 400" className="relative z-10">
                     <g transform="translate(50, 200)">
                        <circle r="40" fill="#fbbf24" className="drop-shadow-[0_0_30px_rgba(251,191,36,0.8)]" />
                        {Array.from({ length: 12 }).map((_, i) => (
                           <line key={i} x1="50" y1="0" x2="65" y2="0" stroke="#fbbf24" strokeWidth="3" transform={`rotate(${i * 30})`} />
                        ))}
                        <text y="70" textAnchor="middle" className="text-xs font-bold fill-yellow-300">SUN</text>
                     </g>
                     <g opacity="0.3">
                        {Array.from({ length: 5 }).map((_, i) => (
                           <line key={i} x1="90" y1={180 + i * 10} x2="180" y2={180 + i * 10} stroke="#fbbf24" strokeWidth="2" strokeDasharray="10,5">
                              <animate attributeName="stroke-dashoffset" from="15" to="0" dur="1s" repeatCount="indefinite" />
                           </line>
                        ))}
                     </g>
                     <g transform={`translate(250, 200) rotate(${rotation})`}>
                        <circle r="70" fill="#1e3a5f" />
                        <ellipse cx="0" cy="0" rx="10" ry="70" fill="#1e293b" opacity="0.5" />
                        <ellipse cx="-30" cy="-20" rx="25" ry="20" fill="#22c55e" opacity="0.8" />
                        <ellipse cx="20" cy="10" rx="20" ry="25" fill="#22c55e" opacity="0.8" />
                     </g>
                     <text x="250" y="290" textAnchor="middle" className="text-xs font-bold fill-blue-300">EARTH</text>
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-black/30 border-t lg:border-t-0 lg:border-l border-white/10 p-6 flex flex-col gap-4">
                  <div className="p-4 bg-gradient-to-br from-yellow-900/30 to-orange-900/20 rounded-2xl border border-yellow-500/20">
                     <p className="text-[10px] font-black text-yellow-400 uppercase tracking-widest mb-2">Earth Rotation</p>
                     <p className="text-3xl font-black text-white">{rotation.toFixed(0)}¬∞</p>
                  </div>
                  <div>
                     <label className="text-[10px] font-black text-slate-400 uppercase">Rotation Speed</label>
                     <input type="range" min="0.5" max="5" step="0.5" value={speed} onChange={(e) => setSpeed(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-yellow-500" />
                  </div>
                  <button onClick={() => setIsSpinning(!isSpinning)}
                     className={`w-full py-4 rounded-xl font-black text-sm transition-all ${isSpinning ? 'bg-orange-500 text-white' : 'bg-yellow-400 text-slate-900'}`}>
                     {isSpinning ? 'STOP ROTATION' : 'SPIN EARTH'}
                  </button>
               </div>
            </div>
            <div className="p-6 bg-black/30 border-t border-white/10">
               <p className="text-xs text-white/60 text-center"><strong>Why Day & Night?</strong> Earth spins like a top! The side facing the Sun has day. One full spin = 24 hours.</p>
            </div>
         </div>
      );
   };

   // --- MOON PHASES RENDERER ---
   const MoonPhasesRenderer = () => {
      const [dayOfMonth, setDayOfMonth] = useState(0);
      const [isAnimating, setIsAnimating] = useState(false);

      const phases = [
         { name: 'New Moon', day: 0, emoji: 'üåë' },
         { name: 'Waxing Crescent', day: 4, emoji: 'üåí' },
         { name: 'First Quarter', day: 7, emoji: 'üåì' },
         { name: 'Waxing Gibbous', day: 11, emoji: 'üåî' },
         { name: 'Full Moon', day: 15, emoji: 'üåï' },
         { name: 'Waning Gibbous', day: 18, emoji: 'üåñ' },
         { name: 'Last Quarter', day: 22, emoji: 'üåó' },
         { name: 'Waning Crescent', day: 26, emoji: 'üåò' },
      ];

      const currentPhase = phases.reduce((closest, phase) => Math.abs(phase.day - dayOfMonth) < Math.abs(closest.day - dayOfMonth) ? phase : closest);
      const moonAngle = (dayOfMonth / 29.5) * 360;
      const illumination = Math.abs(Math.cos((moonAngle * Math.PI) / 180));

      useEffect(() => {
         if (!isAnimating) return;
         const interval = setInterval(() => setDayOfMonth(d => (d + 0.5) % 30), 200);
         return () => clearInterval(interval);
      }, [isAnimating]);

      return (
         <div className="flex flex-col h-full bg-gradient-to-b from-indigo-950 via-slate-900 to-indigo-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-white/10 bg-white/5">
               <h3 className="text-xl font-black tracking-tight text-blue-200">MOON PHASES</h3>
               <p className="text-[10px] font-bold text-white/50 uppercase tracking-widest">The Lunar Cycle</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <div className="absolute inset-0">
                     {Array.from({ length: 80 }).map((_, i) => (
                        <div key={i} className="absolute w-0.5 h-0.5 bg-white/60 rounded-full" style={{ left: `${Math.random() * 100}%`, top: `${Math.random() * 100}%` }} />
                     ))}
                  </div>
                  <svg width="400" height="400" viewBox="0 0 400 400" className="relative z-10">
                     <g transform="translate(200, 200)">
                        <circle r="40" fill="#3b82f6" />
                        <ellipse cx="-10" cy="-10" rx="15" ry="12" fill="#22c55e" opacity="0.8" />
                        <text y="60" textAnchor="middle" className="text-[10px] font-bold fill-blue-300">EARTH</text>
                     </g>
                     <circle cx="200" cy="200" r="120" fill="none" stroke="white" strokeWidth="1" strokeDasharray="5,5" opacity="0.3" />
                     <g opacity="0.2">
                        {Array.from({ length: 8 }).map((_, i) => (
                           <line key={i} x1="0" y1={120 + i * 20} x2="100" y2={120 + i * 20} stroke="#fbbf24" strokeWidth="3" />
                        ))}
                     </g>
                     <g transform={`translate(${200 + 120 * Math.cos((moonAngle - 90) * Math.PI / 180)}, ${200 + 120 * Math.sin((moonAngle - 90) * Math.PI / 180)})`}>
                        <circle r="25" fill="#1e293b" />
                        <clipPath id="moonLit">
                           <rect x={-25 + (1 - illumination) * 25} y="-25" width={50 * illumination} height="50" />
                        </clipPath>
                        <circle r="25" fill="#e2e8f0" clipPath="url(#moonLit)" />
                     </g>
                     {phases.map((phase, i) => {
                        const angle = (phase.day / 29.5) * 360 - 90;
                        const x = 200 + 160 * Math.cos(angle * Math.PI / 180);
                        const y = 200 + 160 * Math.sin(angle * Math.PI / 180);
                        return (
                           <g key={i} transform={`translate(${x}, ${y})`} opacity={currentPhase.day === phase.day ? 1 : 0.4}>
                              <text textAnchor="middle" dy="5" className="text-lg">{phase.emoji}</text>
                           </g>
                        );
                     })}
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-black/30 border-t lg:border-t-0 lg:border-l border-white/10 p-6 flex flex-col gap-4">
                  <div className="p-6 bg-gradient-to-br from-indigo-900/50 to-purple-900/30 rounded-2xl border border-indigo-500/20 text-center">
                     <p className="text-6xl mb-2">{currentPhase.emoji}</p>
                     <p className="text-xl font-black text-white">{currentPhase.name}</p>
                     <p className="text-sm text-indigo-300">Day {Math.round(dayOfMonth)} of 30</p>
                  </div>
                  <div>
                     <label className="text-[10px] font-black text-slate-400 uppercase">Day of Lunar Cycle</label>
                     <input type="range" min="0" max="29" step="1" value={dayOfMonth} onChange={(e) => setDayOfMonth(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-indigo-500" />
                  </div>
                  <div className="grid grid-cols-4 gap-2">
                     {phases.map((phase) => (
                        <button key={phase.day} onClick={() => setDayOfMonth(phase.day)} className={`p-2 rounded-lg text-center transition-all ${Math.abs(dayOfMonth - phase.day) < 2 ? 'bg-indigo-500' : 'bg-white/10 hover:bg-white/20'}`}>
                           <span className="text-xl">{phase.emoji}</span>
                        </button>
                     ))}
                  </div>
                  <button onClick={() => setIsAnimating(!isAnimating)}
                     className={`w-full py-4 rounded-xl font-black text-sm transition-all ${isAnimating ? 'bg-orange-500 text-white' : 'bg-indigo-500 text-white'}`}>
                     {isAnimating ? 'PAUSE CYCLE' : 'WATCH FULL CYCLE'}
                  </button>
               </div>
            </div>
            <div className="p-6 bg-black/30 border-t border-white/10">
               <p className="text-xs text-white/60 text-center"><strong>Why Phases?</strong> We see the part of the Moon lit by the Sun. As it orbits Earth, we see different amounts!</p>
            </div>
         </div>
      );
   };

   // --- TIME DILATION RENDERER ---
   const TimeDilationRenderer = () => {
      const [velocity, setVelocity] = useState(0);
      const [isAnimating, setIsAnimating] = useState(false);
      const [earthTime, setEarthTime] = useState(0);
      const [spaceshipTime, setSpaceshipTime] = useState(0);

      const vFraction = velocity / 100;
      const gamma = 1 / Math.sqrt(1 - vFraction * vFraction);
      const timeDilation = gamma > 1 ? gamma : 1;

      useEffect(() => {
         if (!isAnimating) return;
         const interval = setInterval(() => {
            setEarthTime(t => t + 0.1);
            setSpaceshipTime(t => t + 0.1 / timeDilation);
         }, 100);
         return () => clearInterval(interval);
      }, [isAnimating, timeDilation]);

      const resetClocks = () => { setEarthTime(0); setSpaceshipTime(0); };

      return (
         <div className="flex flex-col h-full bg-gradient-to-b from-slate-950 via-purple-950/50 to-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-purple-500/20 bg-purple-900/20">
               <h3 className="text-xl font-black tracking-tight text-purple-300">TIME DILATION</h3>
               <p className="text-[10px] font-bold text-purple-400/60 uppercase tracking-widest">Special Relativity</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <svg width="500" height="350" viewBox="0 0 500 350">
                     {Array.from({ length: 30 }).map((_, i) => (
                        <circle key={i} cx={Math.random() * 500} cy={Math.random() * 350} r="1" fill="white" opacity="0.5" />
                     ))}
                     <g transform="translate(100, 175)">
                        <circle r="50" fill="#3b82f6" />
                        <ellipse cx="-15" cy="-15" rx="20" ry="15" fill="#22c55e" opacity="0.8" />
                        <text y="75" textAnchor="middle" className="text-xs font-bold fill-blue-300">EARTH</text>
                        <g transform="translate(0, -80)">
                           <circle r="25" fill="#1e293b" stroke="#3b82f6" strokeWidth="2" />
                           <line x1="0" y1="0" x2={15 * Math.sin(earthTime * 0.5)} y2={-15 * Math.cos(earthTime * 0.5)} stroke="#22c55e" strokeWidth="2" />
                           <text y="40" textAnchor="middle" className="text-[10px] font-bold fill-green-400">{earthTime.toFixed(1)}s</text>
                        </g>
                     </g>
                     <g transform="translate(350, 175)">
                        {velocity > 50 && (
                           <g opacity={velocity / 200}>
                              {Array.from({ length: 5 }).map((_, i) => (
                                 <ellipse key={i} cx={-30 - i * 15} cy="0" rx="20" ry="10" fill="#a855f7" opacity={0.3 - i * 0.05} />
                              ))}
                           </g>
                        )}
                        <ellipse cx="0" cy="0" rx="40" ry="15" fill="#6366f1" />
                        <ellipse cx="20" cy="0" rx="15" ry="10" fill="#818cf8" />
                        <ellipse cx="-45" cy="0" rx={5 + velocity / 20} ry={3 + velocity / 40} fill="#f97316" opacity={0.5 + velocity / 200} />
                        <text y="45" textAnchor="middle" className="text-xs font-bold fill-purple-300">SPACESHIP</text>
                        <g transform="translate(0, -55)">
                           <circle r="25" fill="#1e293b" stroke="#a855f7" strokeWidth="2" />
                           <line x1="0" y1="0" x2={15 * Math.sin(spaceshipTime * 0.5)} y2={-15 * Math.cos(spaceshipTime * 0.5)} stroke="#f97316" strokeWidth="2" />
                           <text y="40" textAnchor="middle" className="text-[10px] font-bold fill-orange-400">{spaceshipTime.toFixed(1)}s</text>
                        </g>
                     </g>
                     <g transform="translate(250, 300)">
                        <text textAnchor="middle" className="text-sm font-bold fill-slate-400">v = {(vFraction * 100).toFixed(0)}% speed of light</text>
                     </g>
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-purple-950/30 border-t lg:border-t-0 lg:border-l border-purple-500/20 p-6 flex flex-col gap-4">
                  <div className="p-4 bg-gradient-to-br from-purple-900/50 to-pink-900/30 rounded-2xl border border-purple-500/30">
                     <p className="text-[10px] font-black text-purple-300 uppercase tracking-widest mb-2">Lorentz Factor (Œ≥)</p>
                     <p className="text-4xl font-black text-white">{timeDilation.toFixed(3)}</p>
                     <p className="text-xs text-purple-400 mt-1">Time slows by {((1 - 1/timeDilation) * 100).toFixed(1)}%</p>
                  </div>
                  <div className="grid grid-cols-2 gap-3">
                     <div className="p-3 bg-green-900/20 rounded-xl border border-green-500/20">
                        <p className="text-[10px] font-bold text-green-400">Earth Time</p>
                        <p className="text-xl font-black">{earthTime.toFixed(1)}s</p>
                     </div>
                     <div className="p-3 bg-orange-900/20 rounded-xl border border-orange-500/20">
                        <p className="text-[10px] font-bold text-orange-400">Ship Time</p>
                        <p className="text-xl font-black">{spaceshipTime.toFixed(1)}s</p>
                     </div>
                  </div>
                  <div>
                     <label className="text-[10px] font-black text-slate-400 uppercase">Velocity (% of c)</label>
                     <input type="range" min="0" max="99" value={velocity} onChange={(e) => { setVelocity(Number(e.target.value)); resetClocks(); }}
                        className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-500" />
                  </div>
                  <div className="flex gap-2">
                     <button onClick={() => setIsAnimating(!isAnimating)}
                        className={`flex-1 py-3 rounded-xl font-black text-sm transition-all ${isAnimating ? 'bg-orange-500 text-white' : 'bg-purple-500 text-white'}`}>
                        {isAnimating ? 'PAUSE' : 'START CLOCKS'}
                     </button>
                     <button onClick={resetClocks} className="px-4 py-3 rounded-xl font-black text-xs bg-slate-800 text-slate-400">RESET</button>
                  </div>
               </div>
            </div>
            <div className="p-6 bg-purple-950/30 border-t border-purple-500/20">
               <p className="text-xs text-purple-300/80 text-center"><strong>Einstein's Discovery:</strong> Moving clocks run slower! At 99% light speed, 1 year on ship = 7 years on Earth.</p>
            </div>
         </div>
      );
   };

   // --- ATOM STRUCTURE RENDERER ---
   const AtomStructureRenderer = () => {
      const [protons, setProtons] = useState(6);
      const [neutrons, setNeutrons] = useState(6);
      const [electrons, setElectrons] = useState(6);
      const [isAnimating, setIsAnimating] = useState(true);
      const [orbitAngle, setOrbitAngle] = useState(0);

      const elements: Record<number, { symbol: string; name: string }> = {
         1: { symbol: 'H', name: 'Hydrogen' }, 2: { symbol: 'He', name: 'Helium' },
         3: { symbol: 'Li', name: 'Lithium' }, 4: { symbol: 'Be', name: 'Beryllium' },
         5: { symbol: 'B', name: 'Boron' }, 6: { symbol: 'C', name: 'Carbon' },
         7: { symbol: 'N', name: 'Nitrogen' }, 8: { symbol: 'O', name: 'Oxygen' },
         9: { symbol: 'F', name: 'Fluorine' }, 10: { symbol: 'Ne', name: 'Neon' },
      };

      const element = elements[protons] || { symbol: '?', name: 'Unknown' };
      const charge = protons - electrons;
      const isIon = charge !== 0;

      const shells = [2, 8, 8];
      const electronConfig: number[] = [];
      let remaining = electrons;
      for (const max of shells) {
         const inShell = Math.min(remaining, max);
         electronConfig.push(inShell);
         remaining -= inShell;
         if (remaining <= 0) break;
      }

      useEffect(() => {
         if (!isAnimating) return;
         const interval = setInterval(() => setOrbitAngle(a => (a + 2) % 360), 50);
         return () => clearInterval(interval);
      }, [isAnimating]);

      return (
         <div className="flex flex-col h-full bg-gradient-to-b from-slate-950 via-cyan-950/30 to-slate-950 text-white font-sans overflow-hidden">
            <div className="p-6 border-b border-cyan-500/20 bg-cyan-900/20">
               <h3 className="text-xl font-black tracking-tight text-cyan-300">ATOM STRUCTURE</h3>
               <p className="text-[10px] font-bold text-cyan-400/60 uppercase tracking-widest">Build Your Own Atom</p>
            </div>
            <div className="flex-1 flex flex-col lg:flex-row overflow-hidden">
               <div className="flex-1 relative flex items-center justify-center p-8">
                  <svg width="400" height="400" viewBox="0 0 400 400">
                     {electronConfig.map((count, shellIndex) => count > 0 && (
                        <circle key={shellIndex} cx="200" cy="200" r={80 + shellIndex * 50} fill="none" stroke="#22d3ee" strokeWidth="1" opacity="0.3" strokeDasharray="5,5" />
                     ))}
                     <g transform="translate(200, 200)">
                        {Array.from({ length: Math.min(protons + neutrons, 20) }).map((_, i) => {
                           const angle = (i / Math.min(protons + neutrons, 20)) * Math.PI * 2 + (i % 2) * 0.3;
                           const r = 8 + (i % 3) * 6;
                           const x = r * Math.cos(angle);
                           const y = r * Math.sin(angle);
                           return <circle key={i} cx={x} cy={y} r="10" fill={i < protons ? '#ef4444' : '#64748b'} stroke={i < protons ? '#fca5a5' : '#94a3b8'} strokeWidth="2" />;
                        })}
                        <text textAnchor="middle" dy="5" className="text-lg font-black fill-white">{element.symbol}</text>
                     </g>
                     {electronConfig.map((count, shellIndex) =>
                        Array.from({ length: count }).map((_, eIndex) => {
                           const baseAngle = (eIndex / count) * 360;
                           const angle = ((baseAngle + orbitAngle * (shellIndex + 1) * 0.5) % 360) * Math.PI / 180;
                           const radius = 80 + shellIndex * 50;
                           return (
                              <g key={`${shellIndex}-${eIndex}`} transform={`translate(${200 + radius * Math.cos(angle)}, ${200 + radius * Math.sin(angle)})`}>
                                 <circle r="8" fill="#3b82f6" className="drop-shadow-[0_0_8px_rgba(59,130,246,0.8)]" />
                                 <text textAnchor="middle" dy="3" className="text-[8px] font-bold fill-white">e‚Åª</text>
                              </g>
                           );
                        })
                     )}
                     <g transform="translate(20, 350)">
                        <circle cx="10" cy="0" r="8" fill="#ef4444" />
                        <text x="25" y="4" className="text-[10px] fill-slate-400">Proton (+)</text>
                        <circle cx="100" cy="0" r="8" fill="#64748b" />
                        <text x="115" y="4" className="text-[10px] fill-slate-400">Neutron (0)</text>
                        <circle cx="200" cy="0" r="8" fill="#3b82f6" />
                        <text x="215" y="4" className="text-[10px] fill-slate-400">Electron (‚àí)</text>
                     </g>
                  </svg>
               </div>
               <div className="w-full lg:w-80 bg-cyan-950/30 border-t lg:border-t-0 lg:border-l border-cyan-500/20 p-6 flex flex-col gap-4">
                  <div className={`p-4 rounded-2xl border ${isIon ? 'bg-gradient-to-br from-yellow-900/50 to-orange-900/30 border-yellow-500/30' : 'bg-gradient-to-br from-cyan-900/50 to-blue-900/30 border-cyan-500/30'}`}>
                     <div className="flex items-baseline gap-2">
                        <p className="text-4xl font-black text-white">{element.symbol}</p>
                        <div className="text-xs"><p className="text-slate-400">{protons + neutrons}</p><p className="text-slate-400">{protons}</p></div>
                     </div>
                     <p className="text-lg font-bold text-cyan-300">{element.name}</p>
                     {isIon && <p className="text-sm text-yellow-400 mt-1">Ion: {charge > 0 ? `+${charge}` : charge} charge</p>}
                  </div>
                  <div className="grid grid-cols-3 gap-2">
                     <div className="p-2 bg-red-900/30 rounded-xl text-center border border-red-500/20">
                        <p className="text-2xl font-black text-red-400">{protons}</p>
                        <p className="text-[10px] text-slate-400">Protons</p>
                     </div>
                     <div className="p-2 bg-slate-700/50 rounded-xl text-center border border-slate-500/20">
                        <p className="text-2xl font-black text-slate-300">{neutrons}</p>
                        <p className="text-[10px] text-slate-400">Neutrons</p>
                     </div>
                     <div className="p-2 bg-blue-900/30 rounded-xl text-center border border-blue-500/20">
                        <p className="text-2xl font-black text-blue-400">{electrons}</p>
                        <p className="text-[10px] text-slate-400">Electrons</p>
                     </div>
                  </div>
                  <div className="space-y-3">
                     <div>
                        <label className="text-[10px] font-black text-red-400 uppercase">Protons (defines element)</label>
                        <input type="range" min="1" max="10" value={protons} onChange={(e) => setProtons(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500" />
                     </div>
                     <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase">Neutrons (isotope)</label>
                        <input type="range" min="0" max="15" value={neutrons} onChange={(e) => setNeutrons(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-slate-500" />
                     </div>
                     <div>
                        <label className="text-[10px] font-black text-blue-400 uppercase">Electrons (charge)</label>
                        <input type="range" min="0" max="12" value={electrons} onChange={(e) => setElectrons(Number(e.target.value))} className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500" />
                     </div>
                  </div>
                  <button onClick={() => setIsAnimating(!isAnimating)}
                     className={`w-full py-3 rounded-xl font-black text-sm transition-all ${isAnimating ? 'bg-orange-500 text-white' : 'bg-cyan-500 text-white'}`}>
                     {isAnimating ? 'PAUSE ELECTRONS' : 'ANIMATE'}
                  </button>
               </div>
            </div>
            <div className="p-6 bg-cyan-950/30 border-t border-cyan-500/20">
               <p className="text-xs text-cyan-300/80 text-center"><strong>Key Insight:</strong> Protons define the element. Neutrons create isotopes. Electrons determine charge!</p>
            </div>
         </div>
      );
   };

   // --- ENTREPRENEURSHIP: MINDSET & FOUNDATIONAL SKILLS RENDERERS ---

   const GrowthMindsetRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [currentScenario, setCurrentScenario] = useState(0);
      const [feedback, setFeedback] = useState('');

      const scenarios = [
         { situation: "You failed your first business pitch.", fixed: "I'm just not good at this.", growth: "What can I learn to improve my next pitch?", correct: 'growth' },
         { situation: "A competitor launched a similar product.", fixed: "They'll always be better than me.", growth: "How can I differentiate and innovate?", correct: 'growth' },
         { situation: "Your mentor criticizes your business plan.", fixed: "They don't understand my vision.", growth: "Their feedback could help me strengthen weak points.", correct: 'growth' },
         { situation: "You made a costly mistake.", fixed: "I'm not cut out for entrepreneurship.", growth: "This mistake taught me a valuable lesson.", correct: 'growth' },
         { situation: "Sales are declining.", fixed: "The market just doesn't want my product.", growth: "Time to research and adapt to customer needs.", correct: 'growth' },
      ];

      const handleChoice = (choice: string) => {
         if (choice === scenarios[currentScenario].correct) {
            setScore(s => s + 20);
            setFeedback('‚úì Growth mindset! Entrepreneurs embrace challenges as learning opportunities.');
         } else {
            setFeedback('‚úó That\'s a fixed mindset response. Try reframing challenges as growth opportunities.');
         }
         setTimeout(() => {
            if (currentScenario < scenarios.length - 1) {
               setCurrentScenario(c => c + 1);
               setFeedback('');
            } else {
               setPhase('result');
            }
         }, 2000);
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üå± GROWTH MINDSET</h2>
                  <p className="text-emerald-300 text-sm mt-1">Fixed vs Growth Thinking</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Growth Mindset:</strong> Believing abilities can be developed through dedication and hard work.</p>
                  <p className="mt-2"><strong>Fixed Mindset:</strong> Believing talents are innate and unchangeable.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üß†</div>
               <h3 className="text-2xl font-bold mb-4">How Entrepreneurs Think</h3>
               <p className="text-lg text-emerald-200 max-w-md mb-8">Learn to recognize and choose growth mindset responses to entrepreneurial challenges.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-emerald-500 hover:bg-emerald-400 rounded-xl font-bold text-lg transition-all transform hover:scale-105">
                  START CHALLENGE ‚Üí
               </button>
            </div>
            <p className="text-xs text-emerald-300/60 text-center">Key Insight: 90% of successful entrepreneurs attribute their success to a growth mindset.</p>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 80 ? 'üèÜ' : score >= 60 ? 'üåü' : 'üí™'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-emerald-300 text-lg mb-6">{score >= 80 ? 'Outstanding growth mindset!' : score >= 60 ? 'Good progress!' : 'Keep developing your growth mindset!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentScenario(0); }} className="px-6 py-3 bg-emerald-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8">
            <div className="flex justify-between items-center mb-6">
               <span className="text-sm text-emerald-300">Scenario {currentScenario + 1}/{scenarios.length}</span>
               <span className="px-4 py-2 bg-emerald-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="flex-1 flex flex-col justify-center">
               <div className="bg-black/30 rounded-2xl p-6 mb-6">
                  <p className="text-xl font-bold text-center">{scenarios[currentScenario].situation}</p>
               </div>
               {feedback ? (
                  <div className={`text-center p-4 rounded-xl ${feedback.startsWith('‚úì') ? 'bg-green-500/30' : 'bg-red-500/30'}`}>
                     <p className="text-lg">{feedback}</p>
                  </div>
               ) : (
                  <div className="grid gap-4">
                     <button onClick={() => handleChoice('fixed')} className="p-4 bg-red-900/50 hover:bg-red-800/50 rounded-xl text-left transition-all">
                        <span className="text-red-400 font-bold">Fixed Mindset:</span>
                        <p className="mt-1">{scenarios[currentScenario].fixed}</p>
                     </button>
                     <button onClick={() => handleChoice('growth')} className="p-4 bg-green-900/50 hover:bg-green-800/50 rounded-xl text-left transition-all">
                        <span className="text-green-400 font-bold">Growth Mindset:</span>
                        <p className="mt-1">{scenarios[currentScenario].growth}</p>
                     </button>
                  </div>
               )}
            </div>
         </div>
      );
   };

   const OpportunityRecognitionRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [timeLeft, setTimeLeft] = useState(30);
      const [opportunities, setOpportunities] = useState<{id: number; text: string; isReal: boolean; found: boolean}[]>([]);

      const allOpportunities = [
         { text: "Long lines at coffee shops during morning rush", isReal: true },
         { text: "People complaining about parking in downtown", isReal: true },
         { text: "Students struggling with math homework", isReal: true },
         { text: "Elderly neighbors need help with technology", isReal: true },
         { text: "Local restaurants throwing away unsold food", isReal: true },
         { text: "Everyone already has everything they need", isReal: false },
         { text: "There are no more problems left to solve", isReal: false },
         { text: "Pet owners traveling need pet care", isReal: true },
      ];

      useEffect(() => {
         if (phase === 'play' && timeLeft > 0) {
            const timer = setTimeout(() => setTimeLeft(t => t - 1), 1000);
            return () => clearTimeout(timer);
         } else if (timeLeft === 0) setPhase('result');
      }, [phase, timeLeft]);

      const startGame = () => {
         setOpportunities(allOpportunities.map((o, i) => ({ ...o, id: i, found: false })));
         setPhase('play');
         setTimeLeft(30);
         setScore(0);
      };

      const handleClick = (id: number) => {
         const opp = opportunities.find(o => o.id === id);
         if (opp && !opp.found) {
            if (opp.isReal) setScore(s => s + 15);
            else setScore(s => Math.max(0, s - 10));
            setOpportunities(ops => ops.map(o => o.id === id ? { ...o, found: true } : o));
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîç OPPORTUNITY RECOGNITION</h2>
                  <p className="text-amber-300 text-sm mt-1">Spotting Problems Worth Solving</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Opportunity Recognition:</strong> The ability to identify unmet needs, inefficiencies, or problems that could be solved with a business solution.</p>
                  <p className="mt-2">Look for: Pain points, frustrations, gaps in the market, and underserved customers.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üí°</div>
               <h3 className="text-2xl font-bold mb-4">Find Real Opportunities</h3>
               <p className="text-lg text-amber-200 max-w-md mb-8">Spot genuine business opportunities while avoiding false signals. You have 30 seconds!</p>
               <button onClick={startGame} className="px-8 py-4 bg-amber-500 hover:bg-amber-400 rounded-xl font-bold text-lg transition-all">
                  START SPOTTING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">üéØ</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}</h2>
            <p className="text-amber-300 mb-6">You found {opportunities.filter(o => o.found && o.isReal).length} real opportunities!</p>
            <button onClick={startGame} className="px-6 py-3 bg-amber-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-2xl font-black">‚è±Ô∏è {timeLeft}s</span>
               <span className="px-4 py-2 bg-amber-500/30 rounded-full font-bold">Score: {score}</span>
            </div>
            <p className="text-center mb-4 text-amber-200">Click on REAL business opportunities (avoid false ones!)</p>
            <div className="grid grid-cols-2 gap-3 flex-1">
               {opportunities.map(opp => (
                  <button key={opp.id} onClick={() => handleClick(opp.id)} disabled={opp.found}
                     className={`p-4 rounded-xl text-left text-sm transition-all ${opp.found ? (opp.isReal ? 'bg-green-500/50' : 'bg-red-500/50') : 'bg-black/30 hover:bg-black/50'}`}>
                     {opp.text}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   const CalculatedRiskRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [balance, setBalance] = useState(10000);
      const [round, setRound] = useState(0);
      const [lastResult, setLastResult] = useState('');

      const decisions = [
         { scenario: "Invest $2,000 in market research before launching?", risk: 2000, successChance: 0.7, reward: 5000 },
         { scenario: "Spend $5,000 on a trade show booth?", risk: 5000, successChance: 0.5, reward: 15000 },
         { scenario: "Hire a part-time assistant for $1,500/month?", risk: 1500, successChance: 0.8, reward: 4000 },
         { scenario: "Invest $3,000 in online advertising?", risk: 3000, successChance: 0.6, reward: 8000 },
      ];

      const makeDecision = (takeRisk: boolean) => {
         const decision = decisions[round];
         if (takeRisk) {
            const success = Math.random() < decision.successChance;
            if (success) {
               setBalance(b => b + decision.reward);
               setLastResult(`‚úì Success! You gained $${decision.reward.toLocaleString()}`);
            } else {
               setBalance(b => b - decision.risk);
               setLastResult(`‚úó It didn't work out. You lost $${decision.risk.toLocaleString()}`);
            }
         } else {
            setLastResult("You played it safe. No risk, no reward.");
         }
         setTimeout(() => {
            if (round < decisions.length - 1) { setRound(r => r + 1); setLastResult(''); }
            else setPhase('result');
         }, 2000);
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">‚öñÔ∏è CALCULATED RISK</h2>
                  <p className="text-violet-300 text-sm mt-1">Smart Risk Assessment</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Calculated Risk:</strong> Making informed decisions by weighing potential rewards against possible losses.</p>
                  <p className="mt-2">Formula: Expected Value = (Probability √ó Reward) - (Risk √ó Failure Rate)</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üé≤</div>
               <h3 className="text-2xl font-bold mb-4">Manage Your Startup Budget</h3>
               <p className="text-lg text-violet-200 max-w-md mb-8">Start with $10,000. Make smart investment decisions. Calculate the expected value before deciding!</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-violet-500 hover:bg-violet-400 rounded-xl font-bold text-lg">
                  START INVESTING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{balance >= 15000 ? 'üèÜ' : balance >= 10000 ? 'üìà' : 'üìâ'}</div>
            <h2 className="text-3xl font-black mb-2">Final Balance: ${balance.toLocaleString()}</h2>
            <p className="text-violet-300 mb-6">{balance >= 15000 ? 'Excellent risk management!' : balance >= 10000 ? 'You grew your capital!' : 'Learning experience!'}</p>
            <button onClick={() => { setPhase('intro'); setBalance(10000); setRound(0); }} className="px-6 py-3 bg-violet-500 rounded-xl font-bold">PLAY AGAIN</button>
         </div>
      );

      const currentDecision = decisions[round];
      const expectedValue = (currentDecision.successChance * currentDecision.reward) - ((1 - currentDecision.successChance) * currentDecision.risk);

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Decision {round + 1}/{decisions.length}</span>
               <span className="px-4 py-2 bg-violet-500/30 rounded-full font-bold">üí∞ ${balance.toLocaleString()}</span>
            </div>
            {lastResult ? (
               <div className={`flex-1 flex items-center justify-center text-xl ${lastResult.startsWith('‚úì') ? 'text-green-400' : lastResult.startsWith('‚úó') ? 'text-red-400' : 'text-gray-400'}`}>
                  {lastResult}
               </div>
            ) : (
               <div className="flex-1 flex flex-col justify-center">
                  <div className="bg-black/30 rounded-2xl p-6 mb-6">
                     <p className="text-xl font-bold text-center mb-4">{currentDecision.scenario}</p>
                     <div className="grid grid-cols-3 gap-4 text-center text-sm">
                        <div className="bg-red-900/30 p-3 rounded-xl">
                           <p className="text-red-400 font-bold">Risk</p>
                           <p>${currentDecision.risk.toLocaleString()}</p>
                        </div>
                        <div className="bg-green-900/30 p-3 rounded-xl">
                           <p className="text-green-400 font-bold">Potential Reward</p>
                           <p>${currentDecision.reward.toLocaleString()}</p>
                        </div>
                        <div className="bg-blue-900/30 p-3 rounded-xl">
                           <p className="text-blue-400 font-bold">Success Rate</p>
                           <p>{(currentDecision.successChance * 100).toFixed(0)}%</p>
                        </div>
                     </div>
                     <p className="text-center mt-4 text-violet-300">Expected Value: <span className={expectedValue > 0 ? 'text-green-400' : 'text-red-400'}>${expectedValue.toFixed(0)}</span></p>
                  </div>
                  <div className="grid grid-cols-2 gap-4">
                     <button onClick={() => makeDecision(true)} className="p-4 bg-green-600 hover:bg-green-500 rounded-xl font-bold">TAKE THE RISK</button>
                     <button onClick={() => makeDecision(false)} className="p-4 bg-gray-600 hover:bg-gray-500 rounded-xl font-bold">PLAY IT SAFE</button>
                  </div>
               </div>
            )}
         </div>
      );
   };

   const ResilienceGritRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [motivation, setMotivation] = useState(100);
      const [day, setDay] = useState(1);
      const [successes, setSuccesses] = useState(0);

      const challenges = [
         { event: "First customer complained publicly", drain: 20, response: "Learn and improve", boost: 15 },
         { event: "Investor said no", drain: 25, response: "Find 10 more investors", boost: 20 },
         { event: "Key employee quit", drain: 30, response: "Hire someone better", boost: 25 },
         { event: "Product launch delayed", drain: 15, response: "Use time to improve", boost: 10 },
         { event: "Competitor copied your idea", drain: 20, response: "Innovate further", boost: 15 },
      ];

      const handleChallenge = (bounce: boolean) => {
         const challenge = challenges[day - 1];
         if (bounce) {
            setMotivation(m => Math.min(100, m - challenge.drain + challenge.boost));
            setSuccesses(s => s + 1);
         } else {
            setMotivation(m => m - challenge.drain);
         }
         if (day >= challenges.length || motivation <= 0) setPhase('result');
         else setDay(d => d + 1);
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-rose-900 via-pink-900 to-red-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üí™ RESILIENCE & GRIT</h2>
                  <p className="text-rose-300 text-sm mt-1">Bouncing Back from Setbacks</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Resilience:</strong> The ability to recover quickly from difficulties.</p>
                  <p className="mt-2"><strong>Grit:</strong> Passion and perseverance for long-term goals despite setbacks.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üî•</div>
               <h3 className="text-2xl font-bold mb-4">Survive the Startup Journey</h3>
               <p className="text-lg text-rose-200 max-w-md mb-8">Face challenges and choose how to respond. Maintain your motivation to succeed!</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-rose-500 hover:bg-rose-400 rounded-xl font-bold text-lg">
                  BEGIN JOURNEY ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-rose-900 via-pink-900 to-red-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{motivation > 0 ? 'üèÜ' : 'üíî'}</div>
            <h2 className="text-3xl font-black mb-2">{motivation > 0 ? 'You Made It!' : 'Burned Out'}</h2>
            <p className="text-rose-300 mb-2">Bounced back {successes} times</p>
            <p className="text-rose-300 mb-6">Final motivation: {motivation}%</p>
            <button onClick={() => { setPhase('intro'); setMotivation(100); setDay(1); setSuccesses(0); }} className="px-6 py-3 bg-rose-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-rose-900 via-pink-900 to-red-900 text-white p-8">
            <div className="flex justify-between mb-4">
               <span className="text-sm">Day {day}</span>
               <span className="px-4 py-2 bg-rose-500/30 rounded-full font-bold">üî• {motivation}%</span>
            </div>
            <div className="w-full bg-black/30 rounded-full h-4 mb-6">
               <div className="bg-gradient-to-r from-rose-500 to-orange-500 h-4 rounded-full transition-all" style={{ width: `${motivation}%` }}></div>
            </div>
            <div className="flex-1 flex flex-col justify-center">
               <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
                  <p className="text-red-400 text-sm mb-2">‚ö†Ô∏è SETBACK</p>
                  <p className="text-xl font-bold">{challenges[day - 1].event}</p>
                  <p className="text-rose-300 mt-2">Motivation drain: -{challenges[day - 1].drain}%</p>
               </div>
               <div className="grid grid-cols-2 gap-4">
                  <button onClick={() => handleChallenge(true)} className="p-4 bg-green-600 hover:bg-green-500 rounded-xl font-bold text-sm">
                     üîÑ BOUNCE BACK<br/><span className="text-xs opacity-75">{challenges[day - 1].response}</span>
                  </button>
                  <button onClick={() => handleChallenge(false)} className="p-4 bg-gray-600 hover:bg-gray-500 rounded-xl font-bold text-sm">
                     üòî GIVE UP<br/><span className="text-xs opacity-75">Accept the loss</span>
                  </button>
               </div>
            </div>
         </div>
      );
   };

   const ScamperCreativityRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentTechnique, setCurrentTechnique] = useState(0);
      const [ideas, setIdeas] = useState<string[]>([]);
      const [inputValue, setInputValue] = useState('');

      const scamper = [
         { letter: 'S', name: 'Substitute', prompt: 'What can you substitute in a coffee shop?', example: 'Substitute baristas with self-serve machines' },
         { letter: 'C', name: 'Combine', prompt: 'What can you combine with a gym?', example: 'Combine gym with coworking space' },
         { letter: 'A', name: 'Adapt', prompt: 'How can you adapt a bookstore?', example: 'Adapt to include book-themed escape rooms' },
         { letter: 'M', name: 'Modify', prompt: 'What can you modify about restaurants?', example: 'Modify to complete darkness dining experience' },
         { letter: 'P', name: 'Put to other uses', prompt: 'How else can you use a parking lot?', example: 'Use for weekend farmers markets' },
         { letter: 'E', name: 'Eliminate', prompt: 'What can you eliminate from hotels?', example: 'Eliminate check-in desks with app-based entry' },
         { letter: 'R', name: 'Reverse/Rearrange', prompt: 'What can you reverse about retail?', example: 'Reverse: customers set prices' },
      ];

      const submitIdea = () => {
         if (inputValue.trim()) {
            setIdeas([...ideas, inputValue.trim()]);
            setInputValue('');
            if (currentTechnique < scamper.length - 1) setCurrentTechnique(c => c + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-yellow-900 via-amber-800 to-orange-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üí° SCAMPER CREATIVITY</h2>
                  <p className="text-yellow-300 text-sm mt-1">Innovation Technique</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>SCAMPER:</strong> A creative thinking technique using 7 strategies:</p>
                  <p className="mt-1">Substitute, Combine, Adapt, Modify, Put to other uses, Eliminate, Reverse</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üé®</div>
               <h3 className="text-2xl font-bold mb-4">Generate Business Ideas</h3>
               <p className="text-lg text-yellow-200 max-w-md mb-8">Use SCAMPER techniques to innovate on existing businesses and create new opportunities.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-yellow-500 hover:bg-yellow-400 rounded-xl font-bold text-lg text-black">
                  START CREATING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-yellow-900 via-amber-800 to-orange-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üéâ Your SCAMPER Ideas!</h2>
            <div className="flex-1 overflow-auto">
               {ideas.map((idea, i) => (
                  <div key={i} className="bg-black/30 rounded-xl p-4 mb-3">
                     <span className="text-yellow-400 font-bold">{scamper[i].letter}:</span> {idea}
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setIdeas([]); setCurrentTechnique(0); }} className="px-6 py-3 bg-yellow-500 rounded-xl font-bold text-black mt-4">CREATE MORE</button>
         </div>
      );

      const current = scamper[currentTechnique];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-yellow-900 via-amber-800 to-orange-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {scamper.map((s, i) => (
                  <div key={i} className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${i === currentTechnique ? 'bg-yellow-500 text-black' : i < currentTechnique ? 'bg-green-500' : 'bg-black/30'}`}>
                     {s.letter}
                  </div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4">
               <p className="text-yellow-400 font-bold text-2xl mb-2">{current.letter} = {current.name}</p>
               <p className="text-lg mb-4">{current.prompt}</p>
               <p className="text-sm text-yellow-300/60">Example: {current.example}</p>
            </div>
            <input
               type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Type your idea..." onKeyDown={(e) => e.key === 'Enter' && submitIdea()}
               className="w-full p-4 rounded-xl bg-black/30 border border-yellow-500/30 text-white mb-4"
            />
            <button onClick={submitIdea} className="px-6 py-3 bg-yellow-500 rounded-xl font-bold text-black">SUBMIT & NEXT ‚Üí</button>
         </div>
      );
   };

   const CriticalThinkingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [currentQ, setCurrentQ] = useState(0);

      const questions = [
         { statement: "Our product failed because the market wasn't ready.", fallacy: "External Attribution Bias", answer: "B", options: ["A: Valid reasoning", "B: Logical fallacy - may ignore internal issues", "C: Insufficient data"] },
         { statement: "This famous entrepreneur uses this method, so it must work.", fallacy: "Appeal to Authority", answer: "B", options: ["A: Sound logic", "B: Logical fallacy - success isn't always replicable", "C: Needs more research"] },
         { statement: "We've always done it this way, so we should continue.", fallacy: "Appeal to Tradition", answer: "B", options: ["A: Good reasoning", "B: Logical fallacy - past ‚â† optimal", "C: Depends on context"] },
         { statement: "If we don't launch now, competitors will destroy us.", fallacy: "False Dilemma", answer: "B", options: ["A: Valid urgency", "B: Logical fallacy - false binary choice", "C: True statement"] },
      ];

      const handleAnswer = (answer: string) => {
         if (answer === questions[currentQ].answer) setScore(s => s + 25);
         if (currentQ < questions.length - 1) setCurrentQ(c => c + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üßê CRITICAL THINKING</h2>
                  <p className="text-cyan-300 text-sm mt-1">Spot Logical Fallacies</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Critical Thinking:</strong> Analyzing information objectively to form reasoned judgments.</p>
                  <p className="mt-2">Key skill: Identifying logical fallacies that can lead to poor business decisions.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üî¨</div>
               <h3 className="text-2xl font-bold mb-4">Analyze Business Statements</h3>
               <p className="text-lg text-cyan-200 max-w-md mb-8">Identify logical fallacies in common business reasoning to make better decisions.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-cyan-500 hover:bg-cyan-400 rounded-xl font-bold text-lg">
                  START ANALYSIS ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-blue-900 to-indigo-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 75 ? 'üèÜ' : 'üìö'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-cyan-300 mb-6">{score >= 75 ? 'Sharp critical thinker!' : 'Keep practicing logic!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentQ(0); }} className="px-6 py-3 bg-cyan-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Question {currentQ + 1}/{questions.length}</span>
               <span className="px-4 py-2 bg-cyan-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6">
               <p className="text-xl font-bold italic">"{questions[currentQ].statement}"</p>
            </div>
            <div className="flex-1 flex flex-col gap-3">
               {questions[currentQ].options.map((opt, i) => (
                  <button key={i} onClick={() => handleAnswer(opt[0])} className="p-4 bg-cyan-900/50 hover:bg-cyan-800/50 rounded-xl text-left transition-all">
                     {opt}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   const SelfRelianceRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [resources, setResources] = useState({ money: 500, time: 40, skills: 3 });
      const [tasksCompleted, setTasksCompleted] = useState(0);

      const tasks = [
         { name: "Build a landing page", diy: { time: 8, skills: 1 }, outsource: { money: 200 } },
         { name: "Create a logo", diy: { time: 4, skills: 1 }, outsource: { money: 100 } },
         { name: "Write marketing copy", diy: { time: 6, skills: 1 }, outsource: { money: 150 } },
         { name: "Set up accounting", diy: { time: 10, skills: 1 }, outsource: { money: 300 } },
      ];

      const handleTask = (diy: boolean) => {
         const task = tasks[tasksCompleted];
         if (diy) {
            if (resources.time >= task.diy.time && resources.skills >= task.diy.skills) {
               setResources(r => ({ ...r, time: r.time - task.diy.time, skills: r.skills + 1 }));
               setTasksCompleted(t => t + 1);
            }
         } else {
            if (resources.money >= task.outsource.money) {
               setResources(r => ({ ...r, money: r.money - task.outsource.money }));
               setTasksCompleted(t => t + 1);
            }
         }
         if (tasksCompleted >= tasks.length - 1) setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-zinc-800 to-neutral-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîß SELF-RELIANCE</h2>
                  <p className="text-slate-300 text-sm mt-1">Bootstrap Your Startup</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Self-Reliance:</strong> The ability to do things yourself when resources are limited.</p>
                  <p className="mt-2">DIY builds skills but costs time. Outsourcing saves time but costs money.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üõ†Ô∏è</div>
               <h3 className="text-2xl font-bold mb-4">Build vs Buy Decisions</h3>
               <p className="text-lg text-slate-200 max-w-md mb-8">Manage limited resources. Choose when to DIY and when to outsource.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-slate-500 hover:bg-slate-400 rounded-xl font-bold text-lg">
                  START BUILDING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-zinc-800 to-neutral-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">üéâ</div>
            <h2 className="text-3xl font-black mb-4">Startup Launched!</h2>
            <div className="grid grid-cols-3 gap-4 mb-6">
               <div className="text-center"><p className="text-2xl">üí∞</p><p>${resources.money}</p><p className="text-xs text-slate-400">Remaining</p></div>
               <div className="text-center"><p className="text-2xl">‚è∞</p><p>{resources.time}h</p><p className="text-xs text-slate-400">Time Left</p></div>
               <div className="text-center"><p className="text-2xl">üìö</p><p>{resources.skills}</p><p className="text-xs text-slate-400">Skills Gained</p></div>
            </div>
            <button onClick={() => { setPhase('intro'); setResources({ money: 500, time: 40, skills: 3 }); setTasksCompleted(0); }} className="px-6 py-3 bg-slate-500 rounded-xl font-bold">PLAY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-zinc-800 to-neutral-900 text-white p-8">
            <div className="grid grid-cols-3 gap-4 mb-6">
               <div className="bg-green-900/30 p-3 rounded-xl text-center"><p className="text-green-400">üí∞ ${resources.money}</p></div>
               <div className="bg-blue-900/30 p-3 rounded-xl text-center"><p className="text-blue-400">‚è∞ {resources.time}h</p></div>
               <div className="bg-purple-900/30 p-3 rounded-xl text-center"><p className="text-purple-400">üìö {resources.skills} skills</p></div>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6">
               <p className="text-xl font-bold text-center">{tasks[tasksCompleted]?.name || 'Complete!'}</p>
            </div>
            {tasks[tasksCompleted] && (
               <div className="grid grid-cols-2 gap-4">
                  <button onClick={() => handleTask(true)} className="p-4 bg-purple-600 hover:bg-purple-500 rounded-xl text-sm"
                     disabled={resources.time < tasks[tasksCompleted].diy.time}>
                     üîß DIY<br/>
                     <span className="text-xs">-{tasks[tasksCompleted].diy.time}h, +1 skill</span>
                  </button>
                  <button onClick={() => handleTask(false)} className="p-4 bg-green-600 hover:bg-green-500 rounded-xl text-sm"
                     disabled={resources.money < tasks[tasksCompleted].outsource.money}>
                     üí∏ OUTSOURCE<br/>
                     <span className="text-xs">-${tasks[tasksCompleted].outsource.money}</span>
                  </button>
               </div>
            )}
         </div>
      );
   };

   const AdaptabilityPivotRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [scenario, setScenario] = useState(0);
      const [pivotScore, setPivotScore] = useState(0);

      const scenarios = [
         { situation: "Your B2B software isn't selling to enterprises.", pivot: "Pivot to SMB market with simpler pricing", persist: "Keep trying to land big clients", correct: 'pivot' },
         { situation: "Users love your app but won't pay for it.", pivot: "Switch to freemium with premium features", persist: "Keep the current pricing model", correct: 'pivot' },
         { situation: "Initial market research was slightly off on timing.", pivot: "Completely rebuild the product", persist: "Adjust marketing and wait for market", correct: 'persist' },
         { situation: "You have strong product-market fit in a niche.", pivot: "Expand to broader market immediately", persist: "Dominate the niche first", correct: 'persist' },
      ];

      const handleChoice = (choice: string) => {
         if (choice === scenarios[scenario].correct) setPivotScore(s => s + 25);
         if (scenario < scenarios.length - 1) setScenario(s => s + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-teal-900 via-emerald-900 to-green-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîÑ ADAPTABILITY & PIVOT</h2>
                  <p className="text-teal-300 text-sm mt-1">When to Pivot vs Persist</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Pivot:</strong> A structured course correction to test a new hypothesis.</p>
                  <p className="mt-2"><strong>Key:</strong> Pivot when data shows a fundamental flaw. Persist when adjustments can work.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üîÄ</div>
               <h3 className="text-2xl font-bold mb-4">Pivot or Persist?</h3>
               <p className="text-lg text-teal-200 max-w-md mb-8">Learn when to change direction and when to stay the course.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-teal-500 hover:bg-teal-400 rounded-xl font-bold text-lg">
                  START SCENARIOS ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-teal-900 via-emerald-900 to-green-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{pivotScore >= 75 ? 'üèÜ' : 'üìà'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {pivotScore}%</h2>
            <p className="text-teal-300 mb-6">{pivotScore >= 75 ? 'Expert decision maker!' : 'Learning when to pivot takes practice!'}</p>
            <button onClick={() => { setPhase('intro'); setPivotScore(0); setScenario(0); }} className="px-6 py-3 bg-teal-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-teal-900 via-emerald-900 to-green-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Scenario {scenario + 1}/{scenarios.length}</span>
               <span className="px-4 py-2 bg-teal-500/30 rounded-full font-bold">Score: {pivotScore}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6">
               <p className="text-xl font-bold text-center">{scenarios[scenario].situation}</p>
            </div>
            <div className="grid grid-cols-1 gap-4">
               <button onClick={() => handleChoice('pivot')} className="p-4 bg-orange-600 hover:bg-orange-500 rounded-xl text-left">
                  üîÑ <strong>PIVOT:</strong> {scenarios[scenario].pivot}
               </button>
               <button onClick={() => handleChoice('persist')} className="p-4 bg-blue-600 hover:bg-blue-500 rounded-xl text-left">
                  üí™ <strong>PERSIST:</strong> {scenarios[scenario].persist}
               </button>
            </div>
         </div>
      );
   };

   const EmpathyMappingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [quadrant, setQuadrant] = useState(0);
      const [responses, setResponses] = useState<Record<string, string>>({});
      const [inputValue, setInputValue] = useState('');

      const quadrants = [
         { name: 'THINKS', icon: 'üí≠', prompt: 'What does your customer think about their problem?', color: 'from-blue-600 to-blue-800' },
         { name: 'FEELS', icon: '‚ù§Ô∏è', prompt: 'What emotions does your customer experience?', color: 'from-red-600 to-red-800' },
         { name: 'SAYS', icon: 'üí¨', prompt: 'What does your customer say to others about this?', color: 'from-green-600 to-green-800' },
         { name: 'DOES', icon: 'üèÉ', prompt: 'What actions does your customer take?', color: 'from-purple-600 to-purple-800' },
      ];

      const submitResponse = () => {
         if (inputValue.trim()) {
            setResponses({ ...responses, [quadrants[quadrant].name]: inputValue });
            setInputValue('');
            if (quadrant < quadrants.length - 1) setQuadrant(q => q + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üéØ EMPATHY MAPPING</h2>
                  <p className="text-pink-300 text-sm mt-1">Understand Your Customer</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Empathy Map:</strong> A tool to understand customers by exploring what they Think, Feel, Say, and Do.</p>
                  <p className="mt-2">Used in design thinking to build customer-centric products.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üé≠</div>
               <h3 className="text-2xl font-bold mb-4">Build an Empathy Map</h3>
               <p className="text-lg text-pink-200 max-w-md mb-8">Create a complete picture of your target customer's experience.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-pink-500 hover:bg-pink-400 rounded-xl font-bold text-lg">
                  START MAPPING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">Your Empathy Map</h2>
            <div className="grid grid-cols-2 gap-4 flex-1">
               {quadrants.map((q) => (
                  <div key={q.name} className={`bg-gradient-to-br ${q.color} rounded-xl p-4`}>
                     <p className="font-bold text-lg">{q.icon} {q.name}</p>
                     <p className="text-sm mt-2 opacity-90">{responses[q.name]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setQuadrant(0); setResponses({}); }} className="px-6 py-3 bg-pink-500 rounded-xl font-bold mt-4">CREATE NEW MAP</button>
         </div>
      );

      const current = quadrants[quadrant];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {quadrants.map((q, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= quadrant ? 'bg-pink-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className={`bg-gradient-to-br ${current.color} rounded-2xl p-6 mb-6 text-center`}>
               <p className="text-4xl mb-2">{current.icon}</p>
               <p className="text-2xl font-black mb-2">{current.name}</p>
               <p className="text-lg opacity-90">{current.prompt}</p>
            </div>
            <input
               type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Enter your observation..." onKeyDown={(e) => e.key === 'Enter' && submitResponse()}
               className="w-full p-4 rounded-xl bg-black/30 border border-pink-500/30 text-white mb-4"
            />
            <button onClick={submitResponse} className="px-6 py-3 bg-pink-500 rounded-xl font-bold">NEXT QUADRANT ‚Üí</button>
         </div>
      );
   };

   const EthicalLeadershipRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [dilemma, setDilemma] = useState(0);

      const dilemmas = [
         { situation: "You discover your product has a minor defect. No one has complained yet.", ethical: "Issue a recall and fix it proactively", unethical: "Wait and see if anyone notices", correct: 'ethical' },
         { situation: "A competitor's employee wants to share their trade secrets with you.", ethical: "Decline and compete fairly", unethical: "Accept the inside information", correct: 'ethical' },
         { situation: "You can cut costs by using cheaper materials that are just below safety standards.", ethical: "Maintain higher quality standards", unethical: "Use cheaper materials to boost margins", correct: 'ethical' },
         { situation: "Your marketing team suggests exaggerating product benefits in ads.", ethical: "Insist on accurate, honest advertising", unethical: "Approve the exaggerated claims", correct: 'ethical' },
      ];

      const handleChoice = (choice: string) => {
         if (choice === dilemmas[dilemma].correct) setScore(s => s + 25);
         if (dilemma < dilemmas.length - 1) setDilemma(d => d + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-violet-900 to-purple-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">‚öñÔ∏è ETHICAL LEADERSHIP</h2>
                  <p className="text-indigo-300 text-sm mt-1">Values-Based Decision Making</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Ethical Leadership:</strong> Making decisions that prioritize integrity, transparency, and social responsibility.</p>
                  <p className="mt-2">Long-term success is built on trust and ethical practices.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üëë</div>
               <h3 className="text-2xl font-bold mb-4">Navigate Ethical Dilemmas</h3>
               <p className="text-lg text-indigo-200 max-w-md mb-8">Face real business ethics scenarios and make principled choices.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-indigo-500 hover:bg-indigo-400 rounded-xl font-bold text-lg">
                  FACE DILEMMAS ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-violet-900 to-purple-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score === 100 ? 'üëë' : score >= 50 ? 'üìà' : 'ü§î'}</div>
            <h2 className="text-3xl font-black mb-2">Ethics Score: {score}%</h2>
            <p className="text-indigo-300 mb-6">{score === 100 ? 'Exemplary ethical leader!' : 'Ethics require constant practice.'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setDilemma(0); }} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-violet-900 to-purple-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Dilemma {dilemma + 1}/{dilemmas.length}</span>
               <span className="px-4 py-2 bg-indigo-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6">
               <p className="text-xl font-bold text-center">{dilemmas[dilemma].situation}</p>
            </div>
            <div className="grid grid-cols-1 gap-4">
               <button onClick={() => handleChoice('ethical')} className="p-4 bg-green-600 hover:bg-green-500 rounded-xl text-left">
                  ‚úì <strong>Ethical:</strong> {dilemmas[dilemma].ethical}
               </button>
               <button onClick={() => handleChoice('unethical')} className="p-4 bg-red-600 hover:bg-red-500 rounded-xl text-left">
                  ‚úó <strong>Unethical:</strong> {dilemmas[dilemma].unethical}
               </button>
            </div>
         </div>
      );
   };

   // --- ENTREPRENEURSHIP: IDEATION & DESIGN THINKING RENDERERS ---

   const DesignThinkingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentStep, setCurrentStep] = useState(0);
      const [responses, setResponses] = useState<string[]>([]);
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { name: 'EMPATHIZE', icon: '‚ù§Ô∏è', prompt: 'Describe a problem someone faces daily', color: 'from-pink-600 to-rose-700' },
         { name: 'DEFINE', icon: 'üéØ', prompt: 'Reframe as a "How Might We" statement', color: 'from-purple-600 to-indigo-700' },
         { name: 'IDEATE', icon: 'üí°', prompt: 'List 3 wild solution ideas', color: 'from-yellow-500 to-orange-600' },
         { name: 'PROTOTYPE', icon: 'üîß', prompt: 'Describe a quick test version', color: 'from-green-500 to-teal-600' },
         { name: 'TEST', icon: 'üß™', prompt: 'How would you get user feedback?', color: 'from-blue-500 to-cyan-600' },
      ];

      const submitResponse = () => {
         if (inputValue.trim()) {
            setResponses([...responses, inputValue.trim()]);
            setInputValue('');
            if (currentStep < steps.length - 1) setCurrentStep(s => s + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üé® DESIGN THINKING</h2>
                  <p className="text-purple-300 text-sm mt-1">Human-Centered Innovation</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Design Thinking:</strong> A 5-stage process for creative problem-solving:</p>
                  <p className="mt-1">Empathize ‚Üí Define ‚Üí Ideate ‚Üí Prototype ‚Üí Test</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="flex gap-2 mb-6">{steps.map((s, i) => <span key={i} className="text-3xl">{s.icon}</span>)}</div>
               <h3 className="text-2xl font-bold mb-4">Walk Through the Process</h3>
               <p className="text-lg text-purple-200 max-w-md mb-8">Experience all 5 stages of design thinking to solve a real problem.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-purple-500 hover:bg-purple-400 rounded-xl font-bold text-lg">
                  START DESIGNING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üéâ Your Design Sprint!</h2>
            <div className="flex-1 overflow-auto space-y-3">
               {steps.map((step, i) => (
                  <div key={i} className={`bg-gradient-to-r ${step.color} rounded-xl p-4`}>
                     <p className="font-bold">{step.icon} {step.name}</p>
                     <p className="text-sm mt-1 opacity-90">{responses[i]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setResponses([]); setCurrentStep(0); }} className="px-6 py-3 bg-purple-500 rounded-xl font-bold mt-4">START NEW</button>
         </div>
      );

      const current = steps[currentStep];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {steps.map((s, i) => (
                  <div key={i} className={`flex-1 h-3 rounded-full transition-all ${i <= currentStep ? `bg-gradient-to-r ${s.color}` : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className={`bg-gradient-to-r ${current.color} rounded-2xl p-6 mb-6 text-center`}>
               <p className="text-4xl mb-2">{current.icon}</p>
               <p className="text-2xl font-black">{current.name}</p>
               <p className="mt-2 opacity-90">{current.prompt}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your response..." className="flex-1 p-4 rounded-xl bg-black/30 border border-purple-500/30 text-white mb-4 resize-none" />
            <button onClick={submitResponse} className="px-6 py-3 bg-purple-500 rounded-xl font-bold">NEXT STEP ‚Üí</button>
         </div>
      );
   };

   const ProblemSolutionFitRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [matches, setMatches] = useState<{problem: string; solution: string; correct: boolean}[]>([]);
      const [selectedProblem, setSelectedProblem] = useState<string | null>(null);

      const problems = ["Long commute", "Expensive gym", "Lonely elderly", "Food waste"];
      const solutions = ["Carpooling app", "Home workout videos", "Companion calling service", "Leftover marketplace"];
      const correctPairs: Record<string, string> = {
         "Long commute": "Carpooling app",
         "Expensive gym": "Home workout videos",
         "Lonely elderly": "Companion calling service",
         "Food waste": "Leftover marketplace"
      };

      const handleSolutionClick = (solution: string) => {
         if (selectedProblem) {
            const correct = correctPairs[selectedProblem] === solution;
            setMatches([...matches, { problem: selectedProblem, solution, correct }]);
            setSelectedProblem(null);
            if (matches.length >= 3) setTimeout(() => setPhase('result'), 500);
         }
      };

      const score = matches.filter(m => m.correct).length * 25;

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-red-900 to-pink-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîó PROBLEM-SOLUTION FIT</h2>
                  <p className="text-orange-300 text-sm mt-1">Match Problems to Solutions</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Problem-Solution Fit:</strong> Ensuring your solution directly addresses a real customer problem.</p>
                  <p className="mt-2">Key: The solution must solve the problem better than alternatives.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üß©</div>
               <h3 className="text-2xl font-bold mb-4">Find the Right Match</h3>
               <p className="text-lg text-orange-200 max-w-md mb-8">Connect each problem to its best solution. Good fit = successful startup!</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-orange-500 hover:bg-orange-400 rounded-xl font-bold text-lg">
                  START MATCHING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-red-900 to-pink-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score === 100 ? 'üèÜ' : 'üìä'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-orange-300 mb-6">{score === 100 ? 'Perfect problem-solution fit!' : 'Some matches need work!'}</p>
            <button onClick={() => { setPhase('intro'); setMatches([]); }} className="px-6 py-3 bg-orange-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const usedProblems = matches.map(m => m.problem);
      const usedSolutions = matches.map(m => m.solution);

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-red-900 to-pink-900 text-white p-8">
            <p className="text-center mb-4">Click a problem, then click its solution</p>
            <div className="grid grid-cols-2 gap-4 flex-1">
               <div className="space-y-2">
                  <p className="font-bold text-center text-orange-300">PROBLEMS</p>
                  {problems.map(p => (
                     <button key={p} onClick={() => !usedProblems.includes(p) && setSelectedProblem(p)}
                        disabled={usedProblems.includes(p)}
                        className={`w-full p-3 rounded-xl text-sm transition-all ${usedProblems.includes(p) ? 'bg-green-500/50' : selectedProblem === p ? 'bg-orange-500 ring-2 ring-white' : 'bg-black/30 hover:bg-black/50'}`}>
                        {p}
                     </button>
                  ))}
               </div>
               <div className="space-y-2">
                  <p className="font-bold text-center text-pink-300">SOLUTIONS</p>
                  {solutions.map(s => (
                     <button key={s} onClick={() => selectedProblem && !usedSolutions.includes(s) && handleSolutionClick(s)}
                        disabled={usedSolutions.includes(s) || !selectedProblem}
                        className={`w-full p-3 rounded-xl text-sm transition-all ${usedSolutions.includes(s) ? 'bg-green-500/50' : 'bg-black/30 hover:bg-black/50'}`}>
                        {s}
                     </button>
                  ))}
               </div>
            </div>
         </div>
      );
   };

   const CustomerDiscoveryRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentQ, setCurrentQ] = useState(0);
      const [score, setScore] = useState(0);

      const questions = [
         { q: "Which question is best to ask potential customers?", good: "What's the hardest part of your day?", bad: "Would you buy my product?", correct: 'good' },
         { q: "How should you conduct customer interviews?", good: "Listen more than you talk (80/20 rule)", bad: "Pitch your idea and ask for feedback", correct: 'good' },
         { q: "When should you mention your solution?", good: "After understanding their problems deeply", bad: "At the start to gauge interest", correct: 'good' },
         { q: "What's a red flag in customer discovery?", good: "Everyone says they'd 'definitely' buy", bad: "People describe specific pain points", correct: 'good' },
      ];

      const handleAnswer = (answer: string) => {
         if (answer === questions[currentQ].correct) setScore(s => s + 25);
         if (currentQ < questions.length - 1) setCurrentQ(q => q + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üî¨ CUSTOMER DISCOVERY</h2>
                  <p className="text-blue-300 text-sm mt-1">Talk to Real Customers</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Customer Discovery:</strong> The process of validating your assumptions by talking to potential customers.</p>
                  <p className="mt-2">Goal: Learn what customers actually need, not what you think they need.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üéôÔ∏è</div>
               <h3 className="text-2xl font-bold mb-4">Master the Interview</h3>
               <p className="text-lg text-blue-200 max-w-md mb-8">Learn the right way to talk to customers and validate your ideas.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-blue-500 hover:bg-blue-400 rounded-xl font-bold text-lg">
                  START LEARNING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 75 ? 'üèÜ' : 'üìö'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-blue-300 mb-6">{score >= 75 ? 'Interview master!' : 'Keep practicing your interview skills!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentQ(0); }} className="px-6 py-3 bg-blue-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Question {currentQ + 1}/{questions.length}</span>
               <span className="px-4 py-2 bg-blue-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6">
               <p className="text-xl font-bold text-center">{questions[currentQ].q}</p>
            </div>
            <div className="space-y-4">
               <button onClick={() => handleAnswer('good')} className="w-full p-4 bg-green-900/50 hover:bg-green-800/50 rounded-xl text-left">
                  ‚úì {questions[currentQ].good}
               </button>
               <button onClick={() => handleAnswer('bad')} className="w-full p-4 bg-red-900/50 hover:bg-red-800/50 rounded-xl text-left">
                  ‚úó {questions[currentQ].bad}
               </button>
            </div>
         </div>
      );
   };

   const UserPersonasRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [step, setStep] = useState(0);
      const [persona, setPersona] = useState({ name: '', age: '', job: '', goal: '', pain: '' });

      const fields = [
         { key: 'name', label: 'Name', placeholder: 'e.g., Busy Betty', icon: 'üë§' },
         { key: 'age', label: 'Age & Location', placeholder: 'e.g., 35, San Francisco', icon: 'üìç' },
         { key: 'job', label: 'Job Title', placeholder: 'e.g., Marketing Manager', icon: 'üíº' },
         { key: 'goal', label: 'Main Goal', placeholder: 'e.g., Save time on daily tasks', icon: 'üéØ' },
         { key: 'pain', label: 'Biggest Pain Point', placeholder: 'e.g., Too many meetings', icon: 'üò§' },
      ];

      const handleNext = () => {
         if (step < fields.length - 1) setStep(s => s + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-fuchsia-900 via-purple-900 to-violet-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üë• USER PERSONAS</h2>
                  <p className="text-fuchsia-300 text-sm mt-1">Know Your Customer</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>User Persona:</strong> A semi-fictional representation of your ideal customer based on research.</p>
                  <p className="mt-2">Helps teams align on who they're building for.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üé≠</div>
               <h3 className="text-2xl font-bold mb-4">Create a User Persona</h3>
               <p className="text-lg text-fuchsia-200 max-w-md mb-8">Build a detailed profile of your ideal customer step by step.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-fuchsia-500 hover:bg-fuchsia-400 rounded-xl font-bold text-lg">
                  START BUILDING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-fuchsia-900 via-purple-900 to-violet-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üéâ Your Persona</h2>
            <div className="bg-black/30 rounded-2xl p-6 flex-1">
               <div className="text-center mb-4">
                  <div className="text-6xl mb-2">üë§</div>
                  <p className="text-2xl font-black">{persona.name || 'New Persona'}</p>
                  <p className="text-fuchsia-300">{persona.age}</p>
               </div>
               <div className="space-y-3">
                  <div className="bg-white/10 p-3 rounded-xl"><span className="font-bold">üíº Job:</span> {persona.job}</div>
                  <div className="bg-white/10 p-3 rounded-xl"><span className="font-bold">üéØ Goal:</span> {persona.goal}</div>
                  <div className="bg-white/10 p-3 rounded-xl"><span className="font-bold">üò§ Pain:</span> {persona.pain}</div>
               </div>
            </div>
            <button onClick={() => { setPhase('intro'); setStep(0); setPersona({ name: '', age: '', job: '', goal: '', pain: '' }); }} className="px-6 py-3 bg-fuchsia-500 rounded-xl font-bold mt-4">CREATE ANOTHER</button>
         </div>
      );

      const current = fields[step];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-fuchsia-900 via-purple-900 to-violet-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {fields.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-fuchsia-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{current.icon}</p>
               <p className="text-xl font-bold">{current.label}</p>
            </div>
            <input
               type="text" value={persona[current.key as keyof typeof persona]}
               onChange={(e) => setPersona({ ...persona, [current.key]: e.target.value })}
               placeholder={current.placeholder}
               className="w-full p-4 rounded-xl bg-black/30 border border-fuchsia-500/30 text-white mb-4"
            />
            <button onClick={handleNext} className="px-6 py-3 bg-fuchsia-500 rounded-xl font-bold">
               {step < fields.length - 1 ? 'NEXT ‚Üí' : 'FINISH'}
            </button>
         </div>
      );
   };

   const ValuePropositionRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [step, setStep] = useState(0);
      const [vp, setVp] = useState({ customer: '', problem: '', solution: '', benefit: '' });

      const steps = [
         { key: 'customer', label: 'Target Customer', prompt: 'Who is your ideal customer?', example: 'Busy professionals aged 25-40' },
         { key: 'problem', label: 'Problem', prompt: 'What problem do they face?', example: 'No time to cook healthy meals' },
         { key: 'solution', label: 'Solution', prompt: 'What do you offer?', example: 'Pre-portioned meal kits with 15-min recipes' },
         { key: 'benefit', label: 'Key Benefit', prompt: 'What makes you different?', example: 'Save 5 hours/week while eating healthy' },
      ];

      const handleNext = () => {
         if (step < steps.length - 1) setStep(s => s + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üíé VALUE PROPOSITION</h2>
                  <p className="text-green-300 text-sm mt-1">Your Unique Promise</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Value Proposition:</strong> A clear statement of how your product solves problems and delivers benefits.</p>
                  <p className="mt-2">Formula: For [customer] who [problem], our [product] provides [benefit].</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üí∞</div>
               <h3 className="text-2xl font-bold mb-4">Craft Your Value Prop</h3>
               <p className="text-lg text-green-200 max-w-md mb-8">Build a compelling value proposition that tells customers why they should choose you.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-green-500 hover:bg-green-400 rounded-xl font-bold text-lg">
                  START CRAFTING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üéâ Your Value Proposition</h2>
            <div className="bg-black/30 rounded-2xl p-6 flex-1">
               <p className="text-xl leading-relaxed">
                  For <span className="text-green-400 font-bold">{vp.customer}</span> who{' '}
                  <span className="text-yellow-400 font-bold">{vp.problem}</span>, our solution provides{' '}
                  <span className="text-blue-400 font-bold">{vp.solution}</span> so they can{' '}
                  <span className="text-pink-400 font-bold">{vp.benefit}</span>.
               </p>
            </div>
            <button onClick={() => { setPhase('intro'); setStep(0); setVp({ customer: '', problem: '', solution: '', benefit: '' }); }} className="px-6 py-3 bg-green-500 rounded-xl font-bold mt-4">CREATE NEW</button>
         </div>
      );

      const current = steps[step];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {steps.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-green-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4">
               <p className="text-xl font-bold mb-2">{current.label}</p>
               <p className="text-green-300">{current.prompt}</p>
               <p className="text-sm text-green-400/60 mt-2">Example: {current.example}</p>
            </div>
            <input
               type="text" value={vp[current.key as keyof typeof vp]}
               onChange={(e) => setVp({ ...vp, [current.key]: e.target.value })}
               placeholder="Enter your answer..."
               className="w-full p-4 rounded-xl bg-black/30 border border-green-500/30 text-white mb-4"
            />
            <button onClick={handleNext} className="px-6 py-3 bg-green-500 rounded-xl font-bold">
               {step < steps.length - 1 ? 'NEXT ‚Üí' : 'FINISH'}
            </button>
         </div>
      );
   };

   const PrototypingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [fidelity, setFidelity] = useState<'low' | 'medium' | 'high' | null>(null);
      const [score, setScore] = useState(0);
      const [currentQ, setCurrentQ] = useState(0);

      const scenarios = [
         { situation: "Testing if users understand your app's navigation", best: 'low', reason: 'Paper sketches are fastest for testing basic UX' },
         { situation: "Pitching to investors next week", best: 'high', reason: 'High-fidelity creates professional impression' },
         { situation: "Validating a new feature concept", best: 'medium', reason: 'Clickable wireframes balance speed and clarity' },
         { situation: "First day exploring an idea", best: 'low', reason: 'Quick sketches help you iterate faster' },
      ];

      const handleAnswer = (answer: 'low' | 'medium' | 'high') => {
         if (answer === scenarios[currentQ].best) setScore(s => s + 25);
         setFidelity(answer);
         setTimeout(() => {
            setFidelity(null);
            if (currentQ < scenarios.length - 1) setCurrentQ(q => q + 1);
            else setPhase('result');
         }, 2000);
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-sky-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîß PROTOTYPING</h2>
                  <p className="text-sky-300 text-sm mt-1">Build to Learn</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Prototyping:</strong> Creating quick, testable versions of your product.</p>
                  <p className="mt-2">Types: Low-fidelity (sketches), Medium (wireframes), High (polished mockups)</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üõ†Ô∏è</div>
               <h3 className="text-2xl font-bold mb-4">Choose the Right Prototype</h3>
               <p className="text-lg text-sky-200 max-w-md mb-8">Learn when to use different fidelity levels for maximum learning.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-sky-500 hover:bg-sky-400 rounded-xl font-bold text-lg">
                  START LEARNING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-sky-900 via-blue-900 to-indigo-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 75 ? 'üèÜ' : 'üìö'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-sky-300 mb-6">{score >= 75 ? 'Prototyping pro!' : 'Keep practicing!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentQ(0); }} className="px-6 py-3 bg-sky-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-sky-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Scenario {currentQ + 1}/{scenarios.length}</span>
               <span className="px-4 py-2 bg-sky-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6">
               <p className="text-xl font-bold text-center">{scenarios[currentQ].situation}</p>
            </div>
            {fidelity ? (
               <div className={`flex-1 flex flex-col items-center justify-center ${fidelity === scenarios[currentQ].best ? 'text-green-400' : 'text-red-400'}`}>
                  <p className="text-2xl mb-2">{fidelity === scenarios[currentQ].best ? '‚úì Correct!' : '‚úó Not ideal'}</p>
                  <p className="text-center opacity-75">{scenarios[currentQ].reason}</p>
               </div>
            ) : (
               <div className="grid grid-cols-3 gap-4 flex-1">
                  <button onClick={() => handleAnswer('low')} className="bg-yellow-900/50 hover:bg-yellow-800/50 rounded-xl p-4 flex flex-col items-center justify-center">
                     <span className="text-3xl mb-2">üìù</span>
                     <span className="font-bold">LOW</span>
                     <span className="text-xs opacity-75">Paper sketches</span>
                  </button>
                  <button onClick={() => handleAnswer('medium')} className="bg-blue-900/50 hover:bg-blue-800/50 rounded-xl p-4 flex flex-col items-center justify-center">
                     <span className="text-3xl mb-2">üñºÔ∏è</span>
                     <span className="font-bold">MEDIUM</span>
                     <span className="text-xs opacity-75">Wireframes</span>
                  </button>
                  <button onClick={() => handleAnswer('high')} className="bg-purple-900/50 hover:bg-purple-800/50 rounded-xl p-4 flex flex-col items-center justify-center">
                     <span className="text-3xl mb-2">‚ú®</span>
                     <span className="font-bold">HIGH</span>
                     <span className="text-xs opacity-75">Polished</span>
                  </button>
               </div>
            )}
         </div>
      );
   };

   const IterativeDesignRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [iteration, setIteration] = useState(1);
      const [productScore, setProductScore] = useState(30);
      const [actions, setActions] = useState<string[]>([]);

      const improvements = [
         { action: 'User Testing', boost: 15, description: 'Observe real users' },
         { action: 'A/B Test', boost: 10, description: 'Compare two versions' },
         { action: 'Feedback Survey', boost: 8, description: 'Collect opinions' },
         { action: 'Analytics Review', boost: 12, description: 'Study user data' },
      ];

      const handleImprovement = (improvement: typeof improvements[0]) => {
         setProductScore(s => Math.min(100, s + improvement.boost));
         setActions([...actions, improvement.action]);
         if (iteration >= 4) setPhase('result');
         else setIteration(i => i + 1);
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîÑ ITERATIVE DESIGN</h2>
                  <p className="text-lime-300 text-sm mt-1">Build ‚Üí Measure ‚Üí Learn</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Iterative Design:</strong> Continuously improving your product through cycles of building, testing, and learning.</p>
                  <p className="mt-2">Each iteration should make your product better based on real feedback.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üîÅ</div>
               <h3 className="text-2xl font-bold mb-4">Improve Your Product</h3>
               <p className="text-lg text-lime-200 max-w-md mb-8">Start with an MVP and iterate your way to product-market fit!</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-lime-500 hover:bg-lime-400 rounded-xl font-bold text-lg text-black">
                  START ITERATING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{productScore >= 80 ? 'üöÄ' : 'üìà'}</div>
            <h2 className="text-3xl font-black mb-2">Product Score: {productScore}%</h2>
            <p className="text-lime-300 mb-4">{productScore >= 80 ? 'Ready for launch!' : 'Keep iterating!'}</p>
            <div className="text-sm opacity-75 mb-6">Iterations: {actions.join(' ‚Üí ')}</div>
            <button onClick={() => { setPhase('intro'); setIteration(1); setProductScore(30); setActions([]); }} className="px-6 py-3 bg-lime-500 rounded-xl font-bold text-black">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-8">
            <div className="flex justify-between mb-4">
               <span className="text-sm">Iteration {iteration}/4</span>
               <span className="px-4 py-2 bg-lime-500/30 rounded-full font-bold">Score: {productScore}%</span>
            </div>
            <div className="w-full bg-black/30 rounded-full h-6 mb-6">
               <div className="bg-gradient-to-r from-lime-500 to-green-400 h-6 rounded-full transition-all flex items-center justify-end pr-2" style={{ width: `${productScore}%` }}>
                  <span className="text-xs font-bold text-black">{productScore}%</span>
               </div>
            </div>
            <p className="text-center mb-4 text-lime-200">Choose an improvement method:</p>
            <div className="grid grid-cols-2 gap-3 flex-1">
               {improvements.map((imp, i) => (
                  <button key={i} onClick={() => handleImprovement(imp)} className="bg-black/30 hover:bg-black/50 rounded-xl p-4 text-center transition-all">
                     <p className="font-bold text-lg">{imp.action}</p>
                     <p className="text-xs opacity-75">{imp.description}</p>
                     <p className="text-lime-400 mt-2">+{imp.boost}%</p>
                  </button>
               ))}
            </div>
         </div>
      );
   };

   const BlueOceanRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentQ, setCurrentQ] = useState(0);
      const [strategy, setStrategy] = useState<string[]>([]);

      const questions = [
         { q: "What can you ELIMINATE that the industry takes for granted?", example: "Cirque du Soleil eliminated animal acts" },
         { q: "What can you REDUCE below industry standards?", example: "Southwest reduced seat classes" },
         { q: "What can you RAISE above industry standards?", example: "Apple raised design quality" },
         { q: "What can you CREATE that the industry never offered?", example: "Netflix created binge-watching" },
      ];

      const [inputValue, setInputValue] = useState('');

      const submitAnswer = () => {
         if (inputValue.trim()) {
            setStrategy([...strategy, inputValue.trim()]);
            setInputValue('');
            if (currentQ < questions.length - 1) setCurrentQ(q => q + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-cyan-900 to-teal-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üåä BLUE OCEAN STRATEGY</h2>
                  <p className="text-cyan-300 text-sm mt-1">Create Uncontested Markets</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Blue Ocean:</strong> Creating new market space instead of competing in existing ones.</p>
                  <p className="mt-2">Use the ERRC framework: Eliminate, Reduce, Raise, Create</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üåä</div>
               <h3 className="text-2xl font-bold mb-4">Find Your Blue Ocean</h3>
               <p className="text-lg text-cyan-200 max-w-md mb-8">Use the ERRC framework to differentiate from competitors.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-cyan-500 hover:bg-cyan-400 rounded-xl font-bold text-lg">
                  START STRATEGY ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-cyan-900 to-teal-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üéâ Your Blue Ocean Strategy</h2>
            <div className="flex-1 space-y-3 overflow-auto">
               {['ELIMINATE', 'REDUCE', 'RAISE', 'CREATE'].map((action, i) => (
                  <div key={i} className="bg-black/30 rounded-xl p-4">
                     <p className="font-bold text-cyan-400">{action}</p>
                     <p className="mt-1">{strategy[i]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setStrategy([]); setCurrentQ(0); }} className="px-6 py-3 bg-cyan-500 rounded-xl font-bold mt-4">CREATE NEW</button>
         </div>
      );

      const actions = ['ELIMINATE', 'REDUCE', 'RAISE', 'CREATE'];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-cyan-900 to-teal-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {actions.map((a, i) => (
                  <div key={i} className={`flex-1 text-center py-2 rounded-full text-xs font-bold ${i === currentQ ? 'bg-cyan-500' : i < currentQ ? 'bg-green-500' : 'bg-black/30'}`}>
                     {a}
                  </div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4">
               <p className="text-xl font-bold mb-2">{questions[currentQ].q}</p>
               <p className="text-sm text-cyan-300/60">Example: {questions[currentQ].example}</p>
            </div>
            <input
               type="text" value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your answer..." onKeyDown={(e) => e.key === 'Enter' && submitAnswer()}
               className="w-full p-4 rounded-xl bg-black/30 border border-cyan-500/30 text-white mb-4"
            />
            <button onClick={submitAnswer} className="px-6 py-3 bg-cyan-500 rounded-xl font-bold">NEXT ‚Üí</button>
         </div>
      );
   };

   const TrendAnalysisRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [currentQ, setCurrentQ] = useState(0);

      const trends = [
         { trend: "Remote work tools", direction: 'üìà', timing: 'NOW', correct: 'ride' },
         { trend: "DVD rentals", direction: 'üìâ', timing: 'PAST', correct: 'avoid' },
         { trend: "AI assistants", direction: 'üìà', timing: 'NOW', correct: 'ride' },
         { trend: "Print newspapers", direction: 'üìâ', timing: 'PAST', correct: 'avoid' },
         { trend: "Sustainable products", direction: 'üìà', timing: 'EARLY', correct: 'ride' },
      ];

      const handleAnswer = (answer: string) => {
         if (answer === trends[currentQ].correct) setScore(s => s + 20);
         if (currentQ < trends.length - 1) setCurrentQ(q => q + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üìä TREND ANALYSIS</h2>
                  <p className="text-amber-300 text-sm mt-1">Ride the Right Waves</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Trend Analysis:</strong> Identifying market trends to time your startup for success.</p>
                  <p className="mt-2">Key: Enter rising markets, avoid declining ones.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üìà</div>
               <h3 className="text-2xl font-bold mb-4">Spot Market Trends</h3>
               <p className="text-lg text-amber-200 max-w-md mb-8">Learn to identify which trends to ride and which to avoid.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-amber-500 hover:bg-amber-400 rounded-xl font-bold text-lg text-black">
                  START ANALYZING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 80 ? 'üèÜ' : 'üìä'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-amber-300 mb-6">{score >= 80 ? 'Trend master!' : 'Keep studying the markets!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentQ(0); }} className="px-6 py-3 bg-amber-500 rounded-xl font-bold text-black">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Trend {currentQ + 1}/{trends.length}</span>
               <span className="px-4 py-2 bg-amber-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-4xl mb-2">{trends[currentQ].direction}</p>
               <p className="text-2xl font-bold">{trends[currentQ].trend}</p>
               <p className="text-amber-300 mt-2">Timing: {trends[currentQ].timing}</p>
            </div>
            <div className="grid grid-cols-2 gap-4">
               <button onClick={() => handleAnswer('ride')} className="p-6 bg-green-600 hover:bg-green-500 rounded-xl font-bold text-center">
                  üèÑ RIDE IT<br/><span className="text-xs opacity-75">Build here</span>
               </button>
               <button onClick={() => handleAnswer('avoid')} className="p-6 bg-red-600 hover:bg-red-500 rounded-xl font-bold text-center">
                  üö´ AVOID<br/><span className="text-xs opacity-75">Skip it</span>
               </button>
            </div>
         </div>
      );
   };

   const FirstPrinciplesRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [step, setStep] = useState(0);
      const [answers, setAnswers] = useState<string[]>([]);
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { q: "Pick a common assumption (e.g., 'Batteries are expensive')", icon: 'ü§î' },
         { q: "Break it down: What are the raw components?", icon: 'üî¨' },
         { q: "What are the actual costs of each component?", icon: 'üí∞' },
         { q: "How could you rebuild it cheaper or better?", icon: 'üöÄ' },
      ];

      const submitAnswer = () => {
         if (inputValue.trim()) {
            setAnswers([...answers, inputValue.trim()]);
            setInputValue('');
            if (step < steps.length - 1) setStep(s => s + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-gray-800 to-zinc-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üî¨ FIRST PRINCIPLES</h2>
                  <p className="text-slate-300 text-sm mt-1">Think Like Elon Musk</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>First Principles:</strong> Breaking down problems to fundamental truths, then building up from there.</p>
                  <p className="mt-2">Example: SpaceX questioned why rockets cost so much by examining material costs.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üß™</div>
               <h3 className="text-2xl font-bold mb-4">Challenge Assumptions</h3>
               <p className="text-lg text-slate-200 max-w-md mb-8">Break down a problem to its fundamentals and rebuild innovative solutions.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-slate-500 hover:bg-slate-400 rounded-xl font-bold text-lg">
                  START THINKING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-gray-800 to-zinc-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üéâ Your First Principles Analysis</h2>
            <div className="flex-1 space-y-3 overflow-auto">
               {steps.map((s, i) => (
                  <div key={i} className="bg-black/30 rounded-xl p-4">
                     <p className="font-bold text-slate-400">{s.icon} Step {i + 1}</p>
                     <p className="mt-1">{answers[i]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setAnswers([]); setStep(0); }} className="px-6 py-3 bg-slate-500 rounded-xl font-bold mt-4">ANALYZE NEW</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-gray-800 to-zinc-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {steps.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-slate-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{steps[step].icon}</p>
               <p className="text-xl font-bold">{steps[step].q}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your analysis..."
               className="flex-1 p-4 rounded-xl bg-black/30 border border-slate-500/30 text-white mb-4 resize-none" />
            <button onClick={submitAnswer} className="px-6 py-3 bg-slate-500 rounded-xl font-bold">
               {step < steps.length - 1 ? 'NEXT STEP ‚Üí' : 'FINISH'}
            </button>
         </div>
      );
   };

   // --- ENTREPRENEURSHIP: BUSINESS MODELS & STRATEGY RENDERERS ---

   const LeanCanvasRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentBlock, setCurrentBlock] = useState(0);
      const [canvas, setCanvas] = useState<Record<string, string>>({});
      const [inputValue, setInputValue] = useState('');

      const blocks = [
         { key: 'problem', label: 'Problem', prompt: 'Top 3 problems you solve', icon: '‚ùó' },
         { key: 'solution', label: 'Solution', prompt: 'Top 3 features', icon: '‚úÖ' },
         { key: 'uvp', label: 'Unique Value Prop', prompt: 'Single clear message', icon: 'üíé' },
         { key: 'advantage', label: 'Unfair Advantage', prompt: "What can't be copied", icon: 'üõ°Ô∏è' },
         { key: 'customers', label: 'Customer Segments', prompt: 'Target customers', icon: 'üë•' },
         { key: 'channels', label: 'Channels', prompt: 'Path to customers', icon: 'üì¢' },
         { key: 'revenue', label: 'Revenue Streams', prompt: 'How you make money', icon: 'üí∞' },
         { key: 'costs', label: 'Cost Structure', prompt: 'Main costs', icon: 'üìä' },
         { key: 'metrics', label: 'Key Metrics', prompt: 'Numbers to track', icon: 'üìà' },
      ];

      const submitBlock = () => {
         if (inputValue.trim()) {
            setCanvas({ ...canvas, [blocks[currentBlock].key]: inputValue.trim() });
            setInputValue('');
            if (currentBlock < blocks.length - 1) setCurrentBlock(b => b + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üìã LEAN CANVAS</h2>
                  <p className="text-indigo-300 text-sm mt-1">One-Page Business Plan</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Lean Canvas:</strong> A 1-page business model template for startups.</p>
                  <p className="mt-2">Created by Ash Maurya, adapted from Business Model Canvas.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üìù</div>
               <h3 className="text-2xl font-bold mb-4">Build Your Lean Canvas</h3>
               <p className="text-lg text-indigo-200 max-w-md mb-8">Fill in all 9 blocks to create a complete business model.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-indigo-500 hover:bg-indigo-400 rounded-xl font-bold text-lg">
                  START BUILDING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white p-6 overflow-auto">
            <h2 className="text-xl font-black mb-4 text-center">üéâ Your Lean Canvas</h2>
            <div className="grid grid-cols-3 gap-2 flex-1">
               {blocks.map((b) => (
                  <div key={b.key} className="bg-black/30 rounded-lg p-2 text-xs">
                     <p className="font-bold text-indigo-300">{b.icon} {b.label}</p>
                     <p className="mt-1 opacity-90">{canvas[b.key]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setCanvas({}); setCurrentBlock(0); }} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold mt-4">CREATE NEW</button>
         </div>
      );

      const current = blocks[currentBlock];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {blocks.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= currentBlock ? 'bg-indigo-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{current.icon}</p>
               <p className="text-xl font-bold">{current.label}</p>
               <p className="text-sm opacity-75 mt-1">{current.prompt}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Enter your answer..." className="flex-1 p-4 rounded-xl bg-black/30 border border-indigo-500/30 text-white mb-4 resize-none" />
            <button onClick={submitBlock} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold">
               {currentBlock < blocks.length - 1 ? 'NEXT BLOCK ‚Üí' : 'FINISH'}
            </button>
         </div>
      );
   };

   const BusinessModelCanvasRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentBlock, setCurrentBlock] = useState(0);
      const [canvas, setCanvas] = useState<Record<string, string>>({});
      const [inputValue, setInputValue] = useState('');

      const blocks = [
         { key: 'partners', label: 'Key Partners', prompt: 'Who are your key partners?', icon: 'ü§ù' },
         { key: 'activities', label: 'Key Activities', prompt: 'What do you do?', icon: '‚öôÔ∏è' },
         { key: 'resources', label: 'Key Resources', prompt: 'What do you need?', icon: 'üß∞' },
         { key: 'value', label: 'Value Propositions', prompt: 'What value do you deliver?', icon: 'üíé' },
         { key: 'relations', label: 'Customer Relations', prompt: 'How do you interact?', icon: 'üí¨' },
         { key: 'channels', label: 'Channels', prompt: 'How do you reach them?', icon: 'üì¢' },
         { key: 'segments', label: 'Customer Segments', prompt: 'Who do you serve?', icon: 'üë•' },
         { key: 'costs', label: 'Cost Structure', prompt: 'What are your costs?', icon: 'üí∏' },
         { key: 'revenue', label: 'Revenue Streams', prompt: 'How do you earn?', icon: 'üí∞' },
      ];

      const submitBlock = () => {
         if (inputValue.trim()) {
            setCanvas({ ...canvas, [blocks[currentBlock].key]: inputValue.trim() });
            setInputValue('');
            if (currentBlock < blocks.length - 1) setCurrentBlock(b => b + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üè¢ BUSINESS MODEL CANVAS</h2>
                  <p className="text-blue-300 text-sm mt-1">Strategic Planning Tool</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Business Model Canvas:</strong> A strategic template for developing new or documenting existing business models.</p>
                  <p className="mt-2">Created by Alexander Osterwalder.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üóÇÔ∏è</div>
               <h3 className="text-2xl font-bold mb-4">Design Your Business Model</h3>
               <p className="text-lg text-blue-200 max-w-md mb-8">Complete all 9 building blocks of your business.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-blue-500 hover:bg-blue-400 rounded-xl font-bold text-lg">
                  START DESIGNING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-6 overflow-auto">
            <h2 className="text-xl font-black mb-4 text-center">üéâ Your Business Model Canvas</h2>
            <div className="grid grid-cols-3 gap-2 flex-1">
               {blocks.map((b) => (
                  <div key={b.key} className="bg-black/30 rounded-lg p-2 text-xs">
                     <p className="font-bold text-blue-300">{b.icon} {b.label}</p>
                     <p className="mt-1 opacity-90">{canvas[b.key]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setCanvas({}); setCurrentBlock(0); }} className="px-6 py-3 bg-blue-500 rounded-xl font-bold mt-4">CREATE NEW</button>
         </div>
      );

      const current = blocks[currentBlock];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8">
            <p className="text-center text-sm mb-4">Block {currentBlock + 1}/{blocks.length}</p>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{current.icon}</p>
               <p className="text-xl font-bold">{current.label}</p>
               <p className="text-sm opacity-75 mt-1">{current.prompt}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Enter your answer..." className="flex-1 p-4 rounded-xl bg-black/30 border border-blue-500/30 text-white mb-4 resize-none" />
            <button onClick={submitBlock} className="px-6 py-3 bg-blue-500 rounded-xl font-bold">NEXT ‚Üí</button>
         </div>
      );
   };

   const B2bVsB2cRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [currentQ, setCurrentQ] = useState(0);

      const scenarios = [
         { scenario: "Selling accounting software to small businesses", answer: 'B2B', reason: 'Business customers' },
         { scenario: "E-commerce store selling shoes to individuals", answer: 'B2C', reason: 'Consumer customers' },
         { scenario: "Cloud hosting services for startups", answer: 'B2B', reason: 'Business customers' },
         { scenario: "Food delivery app for hungry consumers", answer: 'B2C', reason: 'Individual consumers' },
         { scenario: "Wholesale supplier to retail stores", answer: 'B2B', reason: 'Business-to-business' },
      ];

      const handleAnswer = (answer: string) => {
         if (answer === scenarios[currentQ].answer) setScore(s => s + 20);
         if (currentQ < scenarios.length - 1) setCurrentQ(q => q + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üîÑ B2B vs B2C</h2>
                  <p className="text-orange-300 text-sm mt-1">Know Your Market</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>B2B:</strong> Business-to-Business - selling to other companies.</p>
                  <p className="mt-2"><strong>B2C:</strong> Business-to-Consumer - selling to individual customers.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="flex gap-4 text-5xl mb-6"><span>üè¢</span><span>‚ÜîÔ∏è</span><span>üè†</span></div>
               <h3 className="text-2xl font-bold mb-4">Classify Business Models</h3>
               <p className="text-lg text-orange-200 max-w-md mb-8">Learn to identify B2B vs B2C businesses.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-orange-500 hover:bg-orange-400 rounded-xl font-bold text-lg">
                  START LEARNING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 80 ? 'üèÜ' : 'üìö'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-orange-300 mb-6">{score >= 80 ? 'Business model expert!' : 'Keep practicing!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentQ(0); }} className="px-6 py-3 bg-orange-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Question {currentQ + 1}/{scenarios.length}</span>
               <span className="px-4 py-2 bg-orange-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-xl font-bold">{scenarios[currentQ].scenario}</p>
            </div>
            <div className="grid grid-cols-2 gap-4">
               <button onClick={() => handleAnswer('B2B')} className="p-6 bg-blue-600 hover:bg-blue-500 rounded-xl font-bold">
                  üè¢ B2B<br/><span className="text-xs opacity-75">Business customers</span>
               </button>
               <button onClick={() => handleAnswer('B2C')} className="p-6 bg-green-600 hover:bg-green-500 rounded-xl font-bold">
                  üè† B2C<br/><span className="text-xs opacity-75">Consumer customers</span>
               </button>
            </div>
         </div>
      );
   };

   const RevenueModelsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [currentModel, setCurrentModel] = useState(0);
      const [selectedModels, setSelectedModels] = useState<string[]>([]);

      const models = [
         { name: 'Subscription', icon: 'üîÑ', example: 'Netflix, Spotify', desc: 'Recurring payments' },
         { name: 'Freemium', icon: 'üÜì', example: 'Dropbox, Slack', desc: 'Free + paid tiers' },
         { name: 'Marketplace', icon: 'üõí', example: 'Airbnb, Uber', desc: 'Take a cut' },
         { name: 'Advertising', icon: 'üì∫', example: 'Google, Facebook', desc: 'Sell attention' },
         { name: 'Licensing', icon: 'üìú', example: 'Microsoft, Adobe', desc: 'Sell usage rights' },
         { name: 'Transaction Fee', icon: 'üí≥', example: 'Stripe, PayPal', desc: 'Fee per transaction' },
      ];

      const toggleModel = (name: string) => {
         if (selectedModels.includes(name)) {
            setSelectedModels(selectedModels.filter(m => m !== name));
         } else {
            setSelectedModels([...selectedModels, name]);
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üí∞ REVENUE MODELS</h2>
                  <p className="text-green-300 text-sm mt-1">How Businesses Make Money</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Revenue Model:</strong> The strategy for generating income from your product or service.</p>
                  <p className="mt-2">Different models suit different businesses.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üíµ</div>
               <h3 className="text-2xl font-bold mb-4">Explore Revenue Models</h3>
               <p className="text-lg text-green-200 max-w-md mb-8">Learn about different ways businesses generate revenue.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-green-500 hover:bg-green-400 rounded-xl font-bold text-lg">
                  START EXPLORING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">Your Selected Models</h2>
            <div className="flex-1 space-y-3 overflow-auto">
               {selectedModels.map((name) => {
                  const model = models.find(m => m.name === name)!;
                  return (
                     <div key={name} className="bg-black/30 rounded-xl p-4 flex items-center gap-4">
                        <span className="text-3xl">{model.icon}</span>
                        <div>
                           <p className="font-bold">{model.name}</p>
                           <p className="text-sm opacity-75">{model.example}</p>
                        </div>
                     </div>
                  );
               })}
            </div>
            <button onClick={() => { setPhase('intro'); setSelectedModels([]); }} className="px-6 py-3 bg-green-500 rounded-xl font-bold mt-4">EXPLORE AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <p className="text-center mb-4">Select models that fit your business:</p>
            <div className="grid grid-cols-2 gap-3 flex-1">
               {models.map((model) => (
                  <button key={model.name} onClick={() => toggleModel(model.name)}
                     className={`p-4 rounded-xl text-center transition-all ${selectedModels.includes(model.name) ? 'bg-green-500 ring-2 ring-white' : 'bg-black/30 hover:bg-black/50'}`}>
                     <span className="text-3xl">{model.icon}</span>
                     <p className="font-bold mt-2">{model.name}</p>
                     <p className="text-xs opacity-75">{model.desc}</p>
                  </button>
               ))}
            </div>
            <button onClick={() => selectedModels.length > 0 && setPhase('result')} disabled={selectedModels.length === 0}
               className="px-6 py-3 bg-green-500 rounded-xl font-bold mt-4 disabled:opacity-50">
               VIEW SELECTION ({selectedModels.length})
            </button>
         </div>
      );
   };

   const UnitEconomicsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [price, setPrice] = useState(50);
      const [cogs, setCogs] = useState(20);
      const [cac, setCac] = useState(30);
      const [ltv, setLtv] = useState(150);

      const margin = ((price - cogs) / price * 100).toFixed(1);
      const ltvCacRatio = (ltv / cac).toFixed(2);
      const paybackMonths = (cac / (price - cogs)).toFixed(1);
      const isHealthy = parseFloat(ltvCacRatio) >= 3;

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üìä UNIT ECONOMICS</h2>
                  <p className="text-cyan-300 text-sm mt-1">Per-Customer Profitability</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Unit Economics:</strong> Revenue and costs on a per-unit (customer) basis.</p>
                  <p className="mt-2">Key metrics: LTV (Lifetime Value), CAC (Customer Acquisition Cost), LTV:CAC ratio</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üßÆ</div>
               <h3 className="text-2xl font-bold mb-4">Calculate Your Unit Economics</h3>
               <p className="text-lg text-cyan-200 max-w-md mb-8">Adjust your business metrics and see if you're profitable per customer.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-cyan-500 hover:bg-cyan-400 rounded-xl font-bold text-lg">
                  START CALCULATING ‚Üí
               </button>
            </div>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-blue-900 to-indigo-900 text-white p-6">
            <div className="flex justify-between items-start mb-4">
               <h2 className="text-xl font-black">üìä UNIT ECONOMICS</h2>
               <button onClick={() => setShowInfo(!showInfo)} className="w-8 h-8 rounded-full bg-white/20 flex items-center justify-center">‚ÑπÔ∏è</button>
            </div>
            {showInfo && <div className="bg-black/30 rounded-xl p-3 mb-4 text-xs"><p>Adjust sliders to see how metrics affect profitability.</p></div>}
            <div className="space-y-4 mb-4">
               <div><label className="text-xs text-cyan-300">Price per Unit: ${price}</label><input type="range" min="10" max="200" value={price} onChange={(e) => setPrice(Number(e.target.value))} className="w-full accent-cyan-500" /></div>
               <div><label className="text-xs text-cyan-300">Cost of Goods Sold: ${cogs}</label><input type="range" min="5" max="100" value={cogs} onChange={(e) => setCogs(Number(e.target.value))} className="w-full accent-cyan-500" /></div>
               <div><label className="text-xs text-cyan-300">CAC (Acquisition Cost): ${cac}</label><input type="range" min="10" max="200" value={cac} onChange={(e) => setCac(Number(e.target.value))} className="w-full accent-cyan-500" /></div>
               <div><label className="text-xs text-cyan-300">LTV (Lifetime Value): ${ltv}</label><input type="range" min="50" max="500" value={ltv} onChange={(e) => setLtv(Number(e.target.value))} className="w-full accent-cyan-500" /></div>
            </div>
            <div className={`p-4 rounded-xl ${isHealthy ? 'bg-green-900/50' : 'bg-red-900/50'}`}>
               <div className="grid grid-cols-3 gap-4 text-center">
                  <div><p className="text-xs opacity-75">Margin</p><p className="text-xl font-bold">{margin}%</p></div>
                  <div><p className="text-xs opacity-75">LTV:CAC</p><p className="text-xl font-bold">{ltvCacRatio}x</p></div>
                  <div><p className="text-xs opacity-75">Payback</p><p className="text-xl font-bold">{paybackMonths}mo</p></div>
               </div>
               <p className="text-center mt-3 font-bold">{isHealthy ? '‚úÖ Healthy Unit Economics!' : '‚ö†Ô∏è Improve your metrics'}</p>
            </div>
         </div>
      );
   };

   const CacCalculatorRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [marketing, setMarketing] = useState(10000);
      const [sales, setSales] = useState(5000);
      const [customers, setCustomers] = useState(50);

      const cac = customers > 0 ? ((marketing + sales) / customers).toFixed(2) : '0';
      const isGood = parseFloat(cac) < 100;

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-red-900 via-orange-900 to-yellow-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üí≥ CAC CALCULATOR</h2>
                  <p className="text-red-300 text-sm mt-1">Customer Acquisition Cost</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>CAC:</strong> Total cost to acquire one new customer.</p>
                  <p className="mt-2">Formula: (Marketing + Sales Costs) √∑ New Customers</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üéØ</div>
               <h3 className="text-2xl font-bold mb-4">Calculate Your CAC</h3>
               <p className="text-lg text-red-200 max-w-md mb-8">Find out how much you spend to acquire each customer.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-red-500 hover:bg-red-400 rounded-xl font-bold text-lg">
                  START CALCULATING ‚Üí
               </button>
            </div>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-red-900 via-orange-900 to-yellow-900 text-white p-6">
            <h2 className="text-xl font-black mb-4">üí≥ CAC CALCULATOR</h2>
            <div className="space-y-4 flex-1">
               <div className="bg-black/30 p-4 rounded-xl">
                  <label className="text-sm">Marketing Spend: ${marketing.toLocaleString()}</label>
                  <input type="range" min="0" max="50000" step="1000" value={marketing} onChange={(e) => setMarketing(Number(e.target.value))} className="w-full accent-red-500" />
               </div>
               <div className="bg-black/30 p-4 rounded-xl">
                  <label className="text-sm">Sales Costs: ${sales.toLocaleString()}</label>
                  <input type="range" min="0" max="30000" step="500" value={sales} onChange={(e) => setSales(Number(e.target.value))} className="w-full accent-red-500" />
               </div>
               <div className="bg-black/30 p-4 rounded-xl">
                  <label className="text-sm">New Customers Acquired: {customers}</label>
                  <input type="range" min="1" max="200" value={customers} onChange={(e) => setCustomers(Number(e.target.value))} className="w-full accent-red-500" />
               </div>
            </div>
            <div className={`p-6 rounded-xl mt-4 text-center ${isGood ? 'bg-green-900/50' : 'bg-red-900/50'}`}>
               <p className="text-sm opacity-75">Your CAC</p>
               <p className="text-4xl font-black">${cac}</p>
               <p className="text-sm mt-2">{isGood ? '‚úÖ Great CAC!' : '‚ö†Ô∏è Consider reducing costs or improving conversion'}</p>
            </div>
         </div>
      );
   };

   const LtvCalculatorRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [arpu, setArpu] = useState(50);
      const [margin, setMargin] = useState(70);
      const [churnRate, setChurnRate] = useState(5);

      const ltv = churnRate > 0 ? ((arpu * (margin / 100)) / (churnRate / 100)).toFixed(0) : '‚àû';
      const lifespan = churnRate > 0 ? (100 / churnRate).toFixed(1) : '‚àû';

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üíé LTV CALCULATOR</h2>
                  <p className="text-purple-300 text-sm mt-1">Customer Lifetime Value</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>LTV:</strong> Total revenue expected from a customer over their lifetime.</p>
                  <p className="mt-2">Formula: (ARPU √ó Margin) √∑ Churn Rate</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üëë</div>
               <h3 className="text-2xl font-bold mb-4">Calculate Customer LTV</h3>
               <p className="text-lg text-purple-200 max-w-md mb-8">Understand how much each customer is worth over time.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-purple-500 hover:bg-purple-400 rounded-xl font-bold text-lg">
                  START CALCULATING ‚Üí
               </button>
            </div>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-6">
            <h2 className="text-xl font-black mb-4">üíé LTV CALCULATOR</h2>
            <div className="space-y-4 flex-1">
               <div className="bg-black/30 p-4 rounded-xl">
                  <label className="text-sm">Monthly ARPU: ${arpu}</label>
                  <input type="range" min="10" max="200" value={arpu} onChange={(e) => setArpu(Number(e.target.value))} className="w-full accent-purple-500" />
               </div>
               <div className="bg-black/30 p-4 rounded-xl">
                  <label className="text-sm">Gross Margin: {margin}%</label>
                  <input type="range" min="10" max="95" value={margin} onChange={(e) => setMargin(Number(e.target.value))} className="w-full accent-purple-500" />
               </div>
               <div className="bg-black/30 p-4 rounded-xl">
                  <label className="text-sm">Monthly Churn Rate: {churnRate}%</label>
                  <input type="range" min="1" max="20" value={churnRate} onChange={(e) => setChurnRate(Number(e.target.value))} className="w-full accent-purple-500" />
               </div>
            </div>
            <div className="grid grid-cols-2 gap-4 mt-4">
               <div className="bg-purple-800/50 p-4 rounded-xl text-center">
                  <p className="text-sm opacity-75">Customer LTV</p>
                  <p className="text-3xl font-black">${ltv}</p>
               </div>
               <div className="bg-purple-800/50 p-4 rounded-xl text-center">
                  <p className="text-sm opacity-75">Avg Lifespan</p>
                  <p className="text-3xl font-black">{lifespan} mo</p>
               </div>
            </div>
         </div>
      );
   };

   const ScalabilityRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [currentQ, setCurrentQ] = useState(0);

      const questions = [
         { q: "Your costs increase linearly with each new customer.", scalable: false, reason: "True scalability means costs grow slower than revenue" },
         { q: "You use cloud infrastructure that auto-scales.", scalable: true, reason: "Cloud allows handling more load without proportional cost" },
         { q: "Each sale requires a 1-hour personalized demo.", scalable: false, reason: "High-touch sales limit growth rate" },
         { q: "Your product is digital with near-zero marginal cost.", scalable: true, reason: "Digital products scale infinitely" },
      ];

      const handleAnswer = (isScalable: boolean) => {
         if (isScalable === questions[currentQ].scalable) setScore(s => s + 25);
         if (currentQ < questions.length - 1) setCurrentQ(q => q + 1);
         else setPhase('result');
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-sky-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üìà SCALABILITY</h2>
                  <p className="text-sky-300 text-sm mt-1">Can Your Business Grow?</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Scalability:</strong> The ability to grow revenue faster than costs.</p>
                  <p className="mt-2">Key: Can you 10x customers without 10x costs?</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üöÄ</div>
               <h3 className="text-2xl font-bold mb-4">Test Scalability</h3>
               <p className="text-lg text-sky-200 max-w-md mb-8">Learn to identify scalable vs non-scalable business characteristics.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-sky-500 hover:bg-sky-400 rounded-xl font-bold text-lg">
                  START TESTING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-sky-900 via-blue-900 to-indigo-900 text-white p-8 items-center justify-center">
            <div className="text-6xl mb-4">{score >= 75 ? 'üöÄ' : 'üìö'}</div>
            <h2 className="text-3xl font-black mb-2">Score: {score}%</h2>
            <p className="text-sky-300 mb-6">{score >= 75 ? 'Scalability expert!' : 'Keep learning!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrentQ(0); }} className="px-6 py-3 bg-sky-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-sky-900 via-blue-900 to-indigo-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="text-sm">Question {currentQ + 1}/{questions.length}</span>
               <span className="px-4 py-2 bg-sky-500/30 rounded-full font-bold">Score: {score}%</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-xl font-bold">{questions[currentQ].q}</p>
            </div>
            <div className="grid grid-cols-2 gap-4">
               <button onClick={() => handleAnswer(true)} className="p-6 bg-green-600 hover:bg-green-500 rounded-xl font-bold">
                  ‚úÖ SCALABLE
               </button>
               <button onClick={() => handleAnswer(false)} className="p-6 bg-red-600 hover:bg-red-500 rounded-xl font-bold">
                  ‚ùå NOT SCALABLE
               </button>
            </div>
         </div>
      );
   };

   const FranchisingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [franchiseFee, setFranchiseFee] = useState(25000);
      const [royaltyRate, setRoyaltyRate] = useState(5);
      const [franchisees, setFranchisees] = useState(10);
      const [avgRevenue, setAvgRevenue] = useState(500000);

      const initialFees = franchiseFee * franchisees;
      const annualRoyalties = (royaltyRate / 100) * avgRevenue * franchisees;
      const totalAnnual = initialFees + annualRoyalties;

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üè™ FRANCHISING</h2>
                  <p className="text-amber-300 text-sm mt-1">Scale Through Partners</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Franchising:</strong> Licensing your business model to independent operators.</p>
                  <p className="mt-2">Revenue: Initial franchise fees + ongoing royalties.</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üçî</div>
               <h3 className="text-2xl font-bold mb-4">Franchise Revenue Calculator</h3>
               <p className="text-lg text-amber-200 max-w-md mb-8">Model potential revenue from franchising your business.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-amber-500 hover:bg-amber-400 rounded-xl font-bold text-lg text-black">
                  START MODELING ‚Üí
               </button>
            </div>
         </div>
      );

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-6">
            <h2 className="text-xl font-black mb-4">üè™ FRANCHISE MODEL</h2>
            <div className="space-y-3 flex-1">
               <div className="bg-black/30 p-3 rounded-xl">
                  <label className="text-xs">Franchise Fee: ${franchiseFee.toLocaleString()}</label>
                  <input type="range" min="5000" max="100000" step="5000" value={franchiseFee} onChange={(e) => setFranchiseFee(Number(e.target.value))} className="w-full accent-amber-500" />
               </div>
               <div className="bg-black/30 p-3 rounded-xl">
                  <label className="text-xs">Royalty Rate: {royaltyRate}%</label>
                  <input type="range" min="1" max="12" value={royaltyRate} onChange={(e) => setRoyaltyRate(Number(e.target.value))} className="w-full accent-amber-500" />
               </div>
               <div className="bg-black/30 p-3 rounded-xl">
                  <label className="text-xs">Number of Franchisees: {franchisees}</label>
                  <input type="range" min="1" max="100" value={franchisees} onChange={(e) => setFranchisees(Number(e.target.value))} className="w-full accent-amber-500" />
               </div>
               <div className="bg-black/30 p-3 rounded-xl">
                  <label className="text-xs">Avg Franchisee Revenue: ${avgRevenue.toLocaleString()}</label>
                  <input type="range" min="100000" max="2000000" step="50000" value={avgRevenue} onChange={(e) => setAvgRevenue(Number(e.target.value))} className="w-full accent-amber-500" />
               </div>
            </div>
            <div className="grid grid-cols-3 gap-2 mt-4">
               <div className="bg-amber-800/50 p-3 rounded-xl text-center">
                  <p className="text-xs opacity-75">Initial Fees</p>
                  <p className="text-lg font-bold">${(initialFees / 1000).toFixed(0)}K</p>
               </div>
               <div className="bg-amber-800/50 p-3 rounded-xl text-center">
                  <p className="text-xs opacity-75">Annual Royalties</p>
                  <p className="text-lg font-bold">${(annualRoyalties / 1000).toFixed(0)}K</p>
               </div>
               <div className="bg-green-800/50 p-3 rounded-xl text-center">
                  <p className="text-xs opacity-75">Year 1 Total</p>
                  <p className="text-lg font-bold">${(totalAnnual / 1000).toFixed(0)}K</p>
               </div>
            </div>
         </div>
      );
   };

   const SocialEnterpriseRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [step, setStep] = useState(0);
      const [enterprise, setEnterprise] = useState({ mission: '', impact: '', revenue: '', sustainability: '' });
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { key: 'mission', label: 'Social Mission', prompt: 'What social problem do you solve?', icon: '‚ù§Ô∏è' },
         { key: 'impact', label: 'Impact Metrics', prompt: 'How do you measure impact?', icon: 'üìä' },
         { key: 'revenue', label: 'Revenue Model', prompt: 'How do you make money?', icon: 'üí∞' },
         { key: 'sustainability', label: 'Sustainability', prompt: 'How do you ensure long-term impact?', icon: '‚ôªÔ∏è' },
      ];

      const submitStep = () => {
         if (inputValue.trim()) {
            setEnterprise({ ...enterprise, [steps[step].key]: inputValue.trim() });
            setInputValue('');
            if (step < steps.length - 1) setStep(s => s + 1);
            else setPhase('result');
         }
      };

      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8">
            <div className="flex justify-between items-start mb-6">
               <div>
                  <h2 className="text-3xl font-black">üåç SOCIAL ENTERPRISE</h2>
                  <p className="text-emerald-300 text-sm mt-1">Profit With Purpose</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            </div>
            {showInfo && (
               <div className="bg-black/30 rounded-xl p-4 mb-4 text-sm">
                  <p><strong>Social Enterprise:</strong> A business that prioritizes social/environmental impact alongside profit.</p>
                  <p className="mt-2">Examples: TOMS, Patagonia, Warby Parker</p>
               </div>
            )}
            <div className="flex-1 flex flex-col justify-center items-center text-center">
               <div className="text-6xl mb-6">üå±</div>
               <h3 className="text-2xl font-bold mb-4">Design Your Social Enterprise</h3>
               <p className="text-lg text-emerald-200 max-w-md mb-8">Create a business model that combines profit with positive impact.</p>
               <button onClick={() => setPhase('play')} className="px-8 py-4 bg-emerald-500 hover:bg-emerald-400 rounded-xl font-bold text-lg">
                  START DESIGNING ‚Üí
               </button>
            </div>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8">
            <h2 className="text-2xl font-black mb-4 text-center">üåç Your Social Enterprise</h2>
            <div className="flex-1 space-y-3 overflow-auto">
               {steps.map((s) => (
                  <div key={s.key} className="bg-black/30 rounded-xl p-4">
                     <p className="font-bold text-emerald-300">{s.icon} {s.label}</p>
                     <p className="mt-1">{enterprise[s.key as keyof typeof enterprise]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setStep(0); setEnterprise({ mission: '', impact: '', revenue: '', sustainability: '' }); }} className="px-6 py-3 bg-emerald-500 rounded-xl font-bold mt-4">CREATE NEW</button>
         </div>
      );

      const current = steps[step];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8">
            <div className="flex gap-1 mb-6">
               {steps.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-emerald-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{current.icon}</p>
               <p className="text-xl font-bold">{current.label}</p>
               <p className="text-sm opacity-75 mt-1">{current.prompt}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your answer..." className="flex-1 p-4 rounded-xl bg-black/30 border border-emerald-500/30 text-white mb-4 resize-none" />
            <button onClick={submitStep} className="px-6 py-3 bg-emerald-500 rounded-xl font-bold">
               {step < steps.length - 1 ? 'NEXT ‚Üí' : 'FINISH'}
            </button>
         </div>
      );
   };

   // ============================================
   // ENTREPRENEURSHIP: MARKETING & SALES (10)
   // ============================================

   // 31. FOUR PS MARKETING - Interactive Marketing Mix Builder
   const FourPsMarketingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [ps, setPs] = useState({ product: '', price: '', place: '', promotion: '' });
      const [currentP, setCurrentP] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const pItems = [
         { key: 'product', icon: 'üì¶', label: 'Product', desc: 'What are you selling? Define features, benefits, and USP.' },
         { key: 'price', icon: 'üí∞', label: 'Price', desc: 'How much will it cost? Consider value, competition, and margins.' },
         { key: 'place', icon: 'üìç', label: 'Place', desc: 'Where will you sell? Define distribution channels.' },
         { key: 'promotion', icon: 'üì¢', label: 'Promotion', desc: 'How will people know? Plan your marketing communications.' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">The Marketing Mix (4Ps)</p>
                  <p>Framework for creating a comprehensive marketing strategy by addressing Product, Price, Place, and Promotion.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üéØ</p>
            <h2 className="text-3xl font-bold mb-4">The 4Ps of Marketing</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Build a complete marketing mix strategy by defining all four Ps for your product or service.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-pink-500 rounded-2xl font-bold text-xl hover:bg-pink-400 transition-all">START BUILDING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üéØ Your Marketing Mix</h2>
            <div className="grid grid-cols-2 gap-4 flex-1">
               {pItems.map((p) => (
                  <div key={p.key} className="bg-black/30 rounded-xl p-4">
                     <div className="flex items-center gap-2 mb-2">
                        <span className="text-2xl">{p.icon}</span>
                        <span className="font-bold text-lg">{p.label}</span>
                     </div>
                     <p className="text-sm opacity-90">{ps[p.key as keyof typeof ps] || 'Not defined'}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setPs({ product: '', price: '', place: '', promotion: '' }); setCurrentP(0); }} className="px-6 py-3 bg-pink-500 rounded-xl font-bold mt-4">CREATE NEW MIX</button>
         </div>
      );

      const submitP = () => {
         const key = pItems[currentP].key as keyof typeof ps;
         setPs({ ...ps, [key]: inputValue });
         setInputValue('');
         if (currentP < 3) setCurrentP(currentP + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {pItems.map((p, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= currentP ? 'bg-pink-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-5xl mb-2">{pItems[currentP].icon}</p>
               <p className="text-2xl font-bold">{pItems[currentP].label}</p>
               <p className="text-sm opacity-75 mt-2">{pItems[currentP].desc}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder={`Define your ${pItems[currentP].label.toLowerCase()}...`}
               className="flex-1 p-4 rounded-xl bg-black/30 border border-pink-500/30 text-white mb-4 resize-none" />
            <button onClick={submitP} className="px-6 py-3 bg-pink-500 rounded-xl font-bold">
               {currentP < 3 ? 'NEXT P ‚Üí' : 'COMPLETE MIX'}
            </button>
         </div>
      );
   };

   // 32. BRANDING IDENTITY - Brand Building Exercise
   const BrandingIdentityRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [brand, setBrand] = useState({ name: '', personality: '', values: '', voice: '' });
      const [step, setStep] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { key: 'name', icon: '‚ú®', label: 'Brand Name', prompt: 'What is your brand name and tagline?' },
         { key: 'personality', icon: 'üé≠', label: 'Personality', prompt: 'Describe your brand as if it were a person' },
         { key: 'values', icon: 'üíé', label: 'Core Values', prompt: 'What principles guide your brand?' },
         { key: 'voice', icon: 'üó£Ô∏è', label: 'Brand Voice', prompt: 'How does your brand communicate?' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Brand Identity</p>
                  <p>The visual and emotional elements that define how your brand is perceived. Strong brands create emotional connections.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üé®</p>
            <h2 className="text-3xl font-bold mb-4">Build Your Brand Identity</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Create a consistent brand persona that resonates with your target audience.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-purple-500 rounded-2xl font-bold text-xl hover:bg-purple-400 transition-all">START BRANDING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üé® Brand Identity Card</h2>
            <div className="bg-black/30 rounded-2xl p-6 flex-1">
               {steps.map((s) => (
                  <div key={s.key} className="mb-4 border-b border-white/10 pb-4 last:border-0">
                     <div className="flex items-center gap-2 mb-1">
                        <span className="text-xl">{s.icon}</span>
                        <span className="font-bold">{s.label}</span>
                     </div>
                     <p className="text-sm opacity-80 ml-8">{brand[s.key as keyof typeof brand]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setBrand({ name: '', personality: '', values: '', voice: '' }); setStep(0); }} className="px-6 py-3 bg-purple-500 rounded-xl font-bold mt-4">CREATE NEW BRAND</button>
         </div>
      );

      const submitStep = () => {
         setBrand({ ...brand, [steps[step].key]: inputValue });
         setInputValue('');
         if (step < 3) setStep(step + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {steps.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-purple-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{steps[step].icon}</p>
               <p className="text-xl font-bold">{steps[step].label}</p>
               <p className="text-sm opacity-75 mt-2">{steps[step].prompt}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your answer..." className="flex-1 p-4 rounded-xl bg-black/30 border border-purple-500/30 text-white mb-4 resize-none" />
            <button onClick={submitStep} className="px-6 py-3 bg-purple-500 rounded-xl font-bold">
               {step < 3 ? 'NEXT ‚Üí' : 'COMPLETE BRAND'}
            </button>
         </div>
      );
   };

   // 33. DIGITAL MARKETING - Channel Selection Game
   const DigitalMarketingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);
      const [selections, setSelections] = useState<string[]>([]);

      const scenarios = [
         { goal: 'Build brand awareness for a new product', best: 'social_media', options: [
            { id: 'email', label: 'üìß Email Marketing', score: 5 },
            { id: 'social_media', label: 'üì± Social Media Ads', score: 10 },
            { id: 'seo', label: 'üîç SEO', score: 6 }
         ]},
         { goal: 'Drive immediate sales during a holiday', best: 'ppc', options: [
            { id: 'ppc', label: 'üí∞ PPC Advertising', score: 10 },
            { id: 'content', label: 'üìù Content Marketing', score: 4 },
            { id: 'influencer', label: 'üåü Influencer Marketing', score: 7 }
         ]},
         { goal: 'Nurture leads who downloaded your ebook', best: 'email_automation', options: [
            { id: 'email_automation', label: 'ü§ñ Email Automation', score: 10 },
            { id: 'retargeting', label: 'üéØ Retargeting Ads', score: 6 },
            { id: 'webinar', label: 'üé• Webinars', score: 7 }
         ]},
         { goal: 'Establish thought leadership in B2B', best: 'linkedin', options: [
            { id: 'linkedin', label: 'üíº LinkedIn Content', score: 10 },
            { id: 'tiktok', label: 'üìπ TikTok', score: 2 },
            { id: 'podcast', label: 'üéôÔ∏è Podcast', score: 8 }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-blue-900 via-cyan-900 to-teal-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Digital Marketing Channels</p>
                  <p>Different channels serve different goals. Matching the right channel to your objective maximizes ROI.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üì±</p>
            <h2 className="text-3xl font-bold mb-4">Digital Marketing Channels</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Match the best digital marketing channel to each business goal.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-blue-500 rounded-2xl font-bold text-xl hover:bg-blue-400 transition-all">START MATCHING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-blue-900 via-cyan-900 to-teal-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 30 ? 'üèÜ' : score >= 20 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">Channel Mastery Score</h2>
            <p className="text-5xl font-bold text-blue-400 mb-4">{score}/{scenarios.length * 10}</p>
            <p className="text-lg opacity-80 mb-8">{score >= 30 ? 'Digital marketing expert!' : score >= 20 ? 'Good understanding!' : 'Keep learning channels!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); setSelections([]); }} className="px-6 py-3 bg-blue-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (optScore: number, optId: string) => {
         setScore(score + optScore);
         setSelections([...selections, optId]);
         if (current < scenarios.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const s = scenarios[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-cyan-900 to-teal-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {scenarios.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i < current ? 'bg-blue-400' : i === current ? 'bg-blue-300' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-sm opacity-60 mb-2">GOAL {current + 1} of {scenarios.length}</p>
               <p className="text-xl font-bold">{s.goal}</p>
            </div>
            <p className="text-center mb-4 opacity-80">Select the best channel:</p>
            <div className="flex flex-col gap-3">
               {s.options.map((opt) => (
                  <button key={opt.id} onClick={() => handleSelect(opt.score, opt.id)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-blue-500/30 transition-all text-left font-medium">
                     {opt.label}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 34. CONTENT STRATEGY - Content Calendar Builder
   const ContentStrategyRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [content, setContent] = useState<{type: string; topic: string; platform: string}[]>([]);
      const [currentType, setCurrentType] = useState('');
      const [topic, setTopic] = useState('');
      const [platform, setPlatform] = useState('');

      const contentTypes = ['üìù Blog Post', 'üìπ Video', 'üéôÔ∏è Podcast', 'üìä Infographic', 'üì± Social Post'];
      const platforms = ['Website', 'YouTube', 'LinkedIn', 'Instagram', 'Twitter', 'TikTok'];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Content Strategy</p>
                  <p>A documented plan for creating, publishing, and managing content. Consistent content builds authority and attracts customers.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üìÖ</p>
            <h2 className="text-3xl font-bold mb-4">Content Strategy Builder</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Plan your content calendar by selecting content types, topics, and platforms.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-orange-500 rounded-2xl font-bold text-xl hover:bg-orange-400 transition-all">START PLANNING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-4">üìÖ Your Content Calendar</h2>
            <div className="flex-1 overflow-auto">
               {content.map((c, i) => (
                  <div key={i} className="bg-black/30 rounded-xl p-4 mb-3 flex items-center gap-4">
                     <span className="text-2xl">{c.type.split(' ')[0]}</span>
                     <div className="flex-1">
                        <p className="font-bold">{c.topic}</p>
                        <p className="text-sm opacity-70">{c.type.split(' ').slice(1).join(' ')} ‚Ä¢ {c.platform}</p>
                     </div>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setContent([]); }} className="px-6 py-3 bg-orange-500 rounded-xl font-bold mt-4">CREATE NEW PLAN</button>
         </div>
      );

      const addContent = () => {
         if (currentType && topic && platform) {
            setContent([...content, { type: currentType, topic, platform }]);
            setCurrentType('');
            setTopic('');
            setPlatform('');
         }
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-8">
            <p className="text-sm text-center mb-4 opacity-70">Added: {content.length} content pieces</p>
            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <p className="text-sm mb-2 opacity-80">Content Type:</p>
               <div className="flex flex-wrap gap-2">
                  {contentTypes.map((t) => (
                     <button key={t} onClick={() => setCurrentType(t)}
                        className={`px-3 py-1 rounded-full text-sm ${currentType === t ? 'bg-orange-500' : 'bg-black/30'}`}>{t}</button>
                  ))}
               </div>
            </div>
            <input value={topic} onChange={(e) => setTopic(e.target.value)} placeholder="Topic/Title..."
               className="p-3 rounded-xl bg-black/30 border border-orange-500/30 text-white mb-4" />
            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <p className="text-sm mb-2 opacity-80">Platform:</p>
               <div className="flex flex-wrap gap-2">
                  {platforms.map((p) => (
                     <button key={p} onClick={() => setPlatform(p)}
                        className={`px-3 py-1 rounded-full text-sm ${platform === p ? 'bg-orange-500' : 'bg-black/30'}`}>{p}</button>
                  ))}
               </div>
            </div>
            <div className="flex gap-3">
               <button onClick={addContent} className="flex-1 px-6 py-3 bg-orange-500 rounded-xl font-bold">ADD CONTENT</button>
               <button onClick={() => content.length > 0 && setPhase('result')} className="px-6 py-3 bg-orange-700 rounded-xl font-bold">VIEW PLAN</button>
            </div>
         </div>
      );
   };

   // 35. EMAIL MARKETING - Email Campaign Builder
   const EmailMarketingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [email, setEmail] = useState({ subject: '', preview: '', cta: '', segment: '' });
      const [step, setStep] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { key: 'segment', icon: 'üë•', label: 'Audience Segment', prompt: 'Who is this email for? (New subscribers, VIPs, etc.)' },
         { key: 'subject', icon: 'üìß', label: 'Subject Line', prompt: 'Write a compelling subject line (50 chars max)' },
         { key: 'preview', icon: 'üëÄ', label: 'Preview Text', prompt: 'What preview text appears after the subject?' },
         { key: 'cta', icon: 'üîò', label: 'Call to Action', prompt: 'What action should readers take?' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-indigo-900 via-blue-900 to-violet-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Email Marketing</p>
                  <p>One of the highest ROI marketing channels. Key metrics: open rate, click-through rate, conversion rate.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üìß</p>
            <h2 className="text-3xl font-bold mb-4">Email Campaign Builder</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Design an effective email campaign with compelling subject lines and clear CTAs.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-indigo-500 rounded-2xl font-bold text-xl hover:bg-indigo-400 transition-all">BUILD CAMPAIGN ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-blue-900 to-violet-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üìß Email Preview</h2>
            <div className="bg-white text-black rounded-xl p-6 flex-1">
               <p className="text-xs text-gray-500 mb-2">To: {email.segment}</p>
               <p className="font-bold text-lg mb-1">{email.subject}</p>
               <p className="text-gray-600 text-sm mb-4">{email.preview}</p>
               <div className="border-t pt-4">
                  <button className="px-6 py-2 bg-indigo-600 text-white rounded-lg font-bold">{email.cta}</button>
               </div>
            </div>
            <button onClick={() => { setPhase('intro'); setEmail({ subject: '', preview: '', cta: '', segment: '' }); setStep(0); }} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold mt-4">CREATE NEW EMAIL</button>
         </div>
      );

      const submitStep = () => {
         setEmail({ ...email, [steps[step].key]: inputValue });
         setInputValue('');
         if (step < 3) setStep(step + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-blue-900 to-violet-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {steps.map((_, i) => (
                  <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-indigo-400' : 'bg-black/30'}`}></div>
               ))}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{steps[step].icon}</p>
               <p className="text-xl font-bold">{steps[step].label}</p>
               <p className="text-sm opacity-75 mt-2">{steps[step].prompt}</p>
            </div>
            <input value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your answer..." className="p-4 rounded-xl bg-black/30 border border-indigo-500/30 text-white mb-4" />
            <button onClick={submitStep} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold">
               {step < 3 ? 'NEXT ‚Üí' : 'PREVIEW EMAIL'}
            </button>
         </div>
      );
   };

   // 36. INFLUENCER MARKETING - Influencer Selection Game
   const InfluencerMarketingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const scenarios = [
         { brand: 'Sustainable Fashion Startup', budget: '$5K', best: 'micro', options: [
            { id: 'mega', label: 'üëë Mega (1M+ followers)', followers: '2M', rate: '$10K', fit: 'Low', score: 2 },
            { id: 'micro', label: 'üåü Micro (10K-100K)', followers: '50K', rate: '$500', fit: 'High', score: 10 },
            { id: 'macro', label: '‚≠ê Macro (100K-1M)', followers: '500K', rate: '$5K', fit: 'Medium', score: 5 }
         ]},
         { brand: 'National Beverage Launch', budget: '$100K', best: 'macro', options: [
            { id: 'nano', label: 'üí´ Nano (1K-10K)', followers: '5K', rate: '$100', fit: 'High', score: 4 },
            { id: 'macro', label: '‚≠ê Macro (100K-1M)', followers: '800K', rate: '$15K', fit: 'High', score: 10 },
            { id: 'micro', label: 'üåü Micro (10K-100K)', followers: '30K', rate: '$300', fit: 'Medium', score: 6 }
         ]},
         { brand: 'Local Restaurant', budget: '$1K', best: 'nano', options: [
            { id: 'nano', label: 'üí´ Nano (1K-10K)', followers: '3K', rate: '$50', fit: 'Very High', score: 10 },
            { id: 'micro', label: 'üåü Micro (10K-100K)', followers: '25K', rate: '$400', fit: 'Medium', score: 5 },
            { id: 'macro', label: '‚≠ê Macro (100K-1M)', followers: '200K', rate: '$3K', fit: 'Low', score: 2 }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-rose-900 via-pink-900 to-fuchsia-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Influencer Tiers</p>
                  <p>Nano (1K-10K), Micro (10K-100K), Macro (100K-1M), Mega (1M+). Smaller influencers often have higher engagement rates.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üåü</p>
            <h2 className="text-3xl font-bold mb-4">Influencer Selection</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Choose the right influencer tier for each brand scenario.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-rose-500 rounded-2xl font-bold text-xl hover:bg-rose-400 transition-all">START SELECTING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-rose-900 via-pink-900 to-fuchsia-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 25 ? 'üèÜ' : score >= 15 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">Selection Score</h2>
            <p className="text-5xl font-bold text-rose-400 mb-4">{score}/{scenarios.length * 10}</p>
            <p className="text-lg opacity-80 mb-8">{score >= 25 ? 'Influencer marketing pro!' : score >= 15 ? 'Good instincts!' : 'Study influencer tiers!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-rose-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (optScore: number) => {
         setScore(score + optScore);
         if (current < scenarios.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const s = scenarios[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-rose-900 via-pink-900 to-fuchsia-900 text-white p-8">
            <div className="bg-black/30 rounded-2xl p-4 mb-4 text-center">
               <p className="text-lg font-bold">{s.brand}</p>
               <p className="text-sm opacity-70">Budget: {s.budget}</p>
            </div>
            <p className="text-center mb-4 opacity-80">Select the best influencer:</p>
            <div className="flex flex-col gap-3 flex-1">
               {s.options.map((opt) => (
                  <button key={opt.id} onClick={() => handleSelect(opt.score)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-rose-500/30 transition-all text-left">
                     <p className="font-bold">{opt.label}</p>
                     <p className="text-sm opacity-70">Followers: {opt.followers} ‚Ä¢ Rate: {opt.rate} ‚Ä¢ Fit: {opt.fit}</p>
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 37. SALES FUNNEL - Funnel Builder
   const SalesFunnelRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Funnel Optimization Lab - Master conversion psychology and identify funnel leaks
      const scenarios = [
         {
            title: "The Leaky Bucket",
            context: "Your SaaS funnel: 10,000 visitors ‚Üí 500 signups (5%) ‚Üí 50 trials (10%) ‚Üí 5 paid (10%). Industry benchmarks: Visitor‚ÜíSignup 3%, Signup‚ÜíTrial 30%, Trial‚ÜíPaid 25%.",
            question: "Where should you focus optimization efforts FIRST?",
            opts: [
               'Top of funnel - get more visitors since you\'re above benchmark',
               'Middle of funnel - signup to trial is way below benchmark (10% vs 30%)',
               'Bottom of funnel - trial to paid is below benchmark',
               'All stages equally - optimize everything at once'
            ],
            correct: 1,
            wrongExplanations: [
               "You're ABOVE benchmark on visitors‚Üísignup (5% vs 3%). Optimizing your strength wastes resources. Fix the biggest leak first.",
               "", // Correct
               "Trial‚ÜíPaid (10% vs 25%) is bad, but fixing it only improves 50 trials ‚Üí maybe 12 paid. Fixing Signup‚ÜíTrial could give you 150 trials ‚Üí 37 paid. Fix the bigger leak first.",
               "Optimizing everything dilutes focus. Startups win by finding the biggest lever and pulling hard. Identify your constraint."
            ],
            realWorld: "Dropbox found their signup‚Üíactivation was leaky (users signed up but never uploaded files). They added an onboarding checklist and 2x'd activation. The insight: fix one stage at a time, starting with the worst relative to benchmarks.",
            concept: "funnel_diagnostics",
            why: "Funnel optimization is about finding constraints. A 3x improvement in your worst stage (10%‚Üí30%) has more impact than 1.5x improvement in three stages. Your Signup‚ÜíTrial is 3x below benchmark - that's your constraint. Fix it before touching anything else."
         },
         {
            title: "The Conversion Killer",
            context: "Your landing page converts at 1.5% (industry: 3%). You have data: Time on page is high (4 min avg), scroll depth is good (70% reach CTA), but CTA clicks are low (2%). Bounce rate is normal (40%).",
            question: "What's the MOST LIKELY problem?",
            opts: [
               'The headline isn\'t compelling enough',
               'The CTA button color/placement is wrong',
               'The value proposition is unclear or the CTA copy doesn\'t match intent',
               'You need more social proof on the page'
            ],
            correct: 2,
            wrongExplanations: [
               "If the headline was bad, time-on-page and scroll depth would be poor. People ARE reading - they just aren't clicking. The problem is downstream.",
               "Button color rarely matters more than 5-10%. High engagement + low CTA clicks suggests a VALUE problem, not a design problem.",
               "", // Correct
               "More social proof might help marginally, but high engagement with low CTA clicks suggests people understand the product but don't see enough value to take action."
            ],
            realWorld: "Basecamp tested 37 landing page variations. The winner wasn't about colors or buttons - it was about clearly stating what happens AFTER you click. 'Start your free trial' beat 'Get started' by 30% because it reduced uncertainty.",
            concept: "conversion_psychology",
            why: "High engagement + low conversion = disconnect between content and CTA. Users are interested (they're reading) but the CTA doesn't match their readiness or the value proposition isn't clear. The fix: clarify what happens next and why it's worth their time."
         },
         {
            title: "The Pricing Page Paradox",
            context: "You offer 3 tiers: Basic ($9), Pro ($29), Enterprise ($99). Traffic splits: Basic page 50%, Pro 35%, Enterprise 15%. But conversions: Basic 8%, Pro 2%, Enterprise 5%. Basic customers churn at 15%/month, Pro at 3%/month.",
            question: "What's the strategic problem with this funnel?",
            opts: [
               'Enterprise pricing is too high - lower it to get more volume',
               'You\'re optimizing for the wrong tier - Pro has best LTV but lowest conversion',
               'Basic tier is cannibalizing Pro - too many features at low price',
               'Both B and C - you need to restructure to push users toward Pro'
            ],
            correct: 3,
            wrongExplanations: [
               "Enterprise at 5% conversion with presumably high LTV is fine. The problem is your funnel pushes people to Basic, which churns fast.",
               "This is PART of the problem. Pro has best retention (3% churn) but worst conversion (2%). But WHY is Pro converting poorly?",
               "This is PART of the problem. If Basic has too many features, value-conscious buyers choose it instead of Pro. But you need to fix both issues.",
               "" // Correct
            ],
            realWorld: "Slack deliberately made their free tier limited enough that growing teams HAD to upgrade. They optimized for paid conversion, not free signups. Result: 30% of free teams convert to paid - unheard of in freemium.",
            concept: "tier_optimization",
            why: "Your funnel is broken in two ways: 1) Basic is too attractive (50% traffic, 8% conversion) but churns fast (15%/mo). 2) Pro has best retention but converts poorly - likely because Basic offers too much. Solution: Nerf Basic, add value to Pro, restructure pricing page to anchor on Pro."
         },
         {
            title: "The Email Sequence Mystery",
            context: "Your trial‚Üípaid nurture sequence: Email 1 (Day 1): 45% open, 8% click. Email 2 (Day 3): 35% open, 5% click. Email 3 (Day 7): 20% open, 2% click. Email 4 (Day 10): 12% open, 1% click. Trial conversion: 8% (industry: 15%).",
            question: "What does this data tell you about your sequence?",
            opts: [
               'Your subject lines are getting worse - focus on better copywriting',
               'Email fatigue is normal - this sequence is fine',
               'Users are losing interest because emails aren\'t driving product engagement',
               'You\'re sending too many emails - reduce frequency'
            ],
            correct: 2,
            wrongExplanations: [
               "Declining opens are NORMAL in sequences (email fatigue). The real problem: clicks are low AND declining. If emails drove product value, engagement would stay higher.",
               "This sequence is NOT fine. 8% trial conversion vs 15% industry benchmark means you're leaving 50%+ on the table. Something is broken.",
               "", // Correct
               "Frequency isn't the issue. The issue is that emails aren't creating product 'aha moments.' Fewer bad emails won't help."
            ],
            realWorld: "Slack's onboarding emails don't sell - they teach ONE feature per email and measure whether users TRY that feature. Their 'aha moment' is sending 2,000 messages as a team. Every email drives toward that metric.",
            concept: "activation_sequences",
            why: "Email opens declining is normal. But click decline + low trial conversion means your emails aren't driving the 'aha moment.' Winning sequences: 1) Identify your activation metric (Slack: 2K messages, Dropbox: 1 file), 2) Make every email drive toward that metric, 3) Measure product engagement, not email engagement."
         },
         {
            title: "The Retargeting Trap",
            context: "You're retargeting cart abandoners: Audience of 10,000 abandoners. Retargeting ad CTR: 2% (good). Landing page conversion: 15% (good). But ROI is negative - you're spending $5 to acquire customers worth $3.",
            question: "What's wrong with this retargeting strategy?",
            opts: [
               'Your ads aren\'t compelling enough',
               'Landing page needs optimization',
               'You\'re retargeting ALL abandoners instead of segmenting by intent',
               'Retargeting doesn\'t work - stop doing it'
            ],
            correct: 2,
            wrongExplanations: [
               "2% CTR is good for retargeting. Ad creative isn't the problem - targeting is.",
               "15% conversion is excellent. The landing page is working.",
               "", // Correct
               "Retargeting works extremely well when done right. The issue is strategy, not the channel."
            ],
            realWorld: "Amazon segments cart abandoners: 1) Added item but left immediately (low intent - minimal spend), 2) Filled cart and entered checkout (high intent - aggressive retargeting), 3) Abandoned at payment (friction - offer support). Same channel, 5x different CPAs.",
            concept: "retargeting_segmentation",
            why: "Treating all abandoners equally wastes money. Someone who left after 10 seconds has different intent than someone who reached the payment page. Segment by: 1) Time on site, 2) Cart value, 3) Checkout progress, 4) Return visits. Spend more on high-intent, less on low-intent."
         }
      ];

      const conceptLabels: { [key: string]: string } = {
         funnel_diagnostics: "Funnel Constraint Analysis",
         conversion_psychology: "Conversion Psychology & CTA Optimization",
         tier_optimization: "Pricing Tier Strategy",
         activation_sequences: "Activation & Onboarding Sequences",
         retargeting_segmentation: "Behavioral Retargeting Segmentation"
      };

      const infoTopics: { [k: string]: { title: string; content: string } } = {
         aida: {
            title: "AIDA Framework",
            content: "Attention ‚Üí Interest ‚Üí Desire ‚Üí Action. Classic funnel stages. But modern funnels add: Awareness ‚Üí Consideration ‚Üí Conversion ‚Üí Retention ‚Üí Advocacy. The best funnels optimize for RETENTION, not just initial conversion. A 5% improvement in retention often beats 25% improvement in acquisition."
         },
         metrics: {
            title: "Key Funnel Metrics",
            content: "Track: 1) Stage-by-stage conversion rates, 2) Time between stages, 3) Drop-off points, 4) Cohort retention, 5) CAC payback period. Compare to industry benchmarks: SaaS visitor‚Üítrial 2-5%, trial‚Üípaid 15-25%, B2C e-commerce cart‚Üípurchase 2-4%. Your biggest gap = your biggest opportunity."
         },
         psychology: {
            title: "Conversion Psychology",
            content: "Cialdini's 6 principles: 1) Reciprocity (give before asking), 2) Scarcity (limited time/quantity), 3) Authority (expert endorsement), 4) Consistency (small commitments lead to big ones), 5) Liking (similarity, compliments), 6) Social proof (others are doing it). Use ethically."
         },
         testing: {
            title: "A/B Testing Fundamentals",
            content: "Rules: 1) Test ONE variable at a time, 2) Run until statistical significance (95%+ confidence), 3) Test big changes first (headlines, offers), then small (colors, buttons), 4) Document everything, 5) Winning tests often reveal customer psychology insights more valuable than the lift itself."
         }
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         if (idx === s.correct) {
            setScore(prev => prev + 1);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Correct! Mastered ${conceptLabels[s.concept]}`]);
         } else {
            setGameLog(prev => [...prev, `‚úó ${s.title}: Missed. Fell for "${s.opts[idx].substring(0, 40)}..."`]);
            if (!conceptGaps.includes(s.concept)) {
               setConceptGaps(prev => [...prev, s.concept]);
            }
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setAnswered(false);
            setSelected(null);
         }
      };

      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 3 ? 'C' : 'D';
      const s = scenarios[scenario];

      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-6">
               <div className="text-6xl mb-4">üîª</div>
               <h2 className="text-2xl font-bold mb-2">Funnel Optimization Lab</h2>
               <p className="text-slate-300 text-center mb-4 max-w-md">
                  Master the art of diagnosing and fixing conversion funnels like a growth expert.
               </p>
               <div className="bg-black/30 rounded-xl p-4 mb-6 max-w-md text-sm">
                  <p className="text-blue-400 font-bold mb-2">üéØ What You'll Learn:</p>
                  <ul className="text-slate-300 space-y-1 text-xs">
                     <li>‚Ä¢ How to find the biggest leaks in any funnel</li>
                     <li>‚Ä¢ Why high engagement doesn't always mean high conversion</li>
                     <li>‚Ä¢ The psychology behind why people don't convert</li>
                     <li>‚Ä¢ Real optimization strategies from Dropbox, Slack, Amazon</li>
                  </ul>
               </div>
               <button
                  onClick={() => setPhase('play')}
                  className="px-8 py-3 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl font-bold hover:from-blue-400 hover:to-indigo-400 transition-all"
               >
                  Start Optimizing
               </button>
            </div>
         );
      }

      if (phase === 'result') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-6 overflow-auto">
               <div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? 'üîª' : grade === 'C' ? 'üìä' : 'üìö'}</div>
               <h2 className="text-2xl font-bold mb-2">Funnel Analysis Complete</h2>
               <div className="text-4xl font-bold text-blue-400 mb-2">{score}/{scenarios.length}</div>
               <div className="text-5xl mb-4">{grade}</div>
               <p className="text-slate-400 mb-4 text-center">
                  {grade === 'A' ? 'Conversion expert! You think like a growth lead.' :
                   grade === 'B' ? 'Strong funnel intuition. Some optimization gaps to fill.' :
                   grade === 'C' ? 'Decent foundation, but missing key conversion concepts.' :
                   'Funnel optimization requires more study. Review the fundamentals.'}
               </p>

               {conceptGaps.length > 0 && (
                  <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4">
                     <p className="text-blue-400 font-bold text-sm mb-2">üìö Concepts to Study:</p>
                     <ul className="text-slate-300 text-xs space-y-1">
                        {conceptGaps.map(gap => (
                           <li key={gap}>‚Ä¢ {conceptLabels[gap]}</li>
                        ))}
                     </ul>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4 max-h-32 overflow-y-auto">
                  <p className="text-blue-400 font-bold text-sm mb-2">Session Log:</p>
                  {gameLog.map((entry, i) => (
                     <p key={i} className="text-xs text-slate-300">{entry}</p>
                  ))}
               </div>

               <button
                  onClick={() => {
                     setPhase('intro');
                     setScenario(0);
                     setScore(0);
                     setAnswered(false);
                     setSelected(null);
                     setGameLog([]);
                     setConceptGaps([]);
                  }}
                  className="px-6 py-2 bg-blue-600 rounded-lg hover:bg-blue-500"
               >
                  Try Again
               </button>
            </div>
         );
      }

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-blue-500/30 flex justify-between items-center">
               <span className="font-bold">üîª Funnel Lab</span>
               <span className="text-blue-400">{scenario + 1}/{scenarios.length}</span>
               <span className="text-indigo-400">Score: {score}</span>
            </div>

            <div className="flex-1 p-4 overflow-auto">
               <div className="bg-black/30 rounded-xl p-3 mb-3">
                  <p className="font-bold text-blue-400 mb-2">{s.title}</p>
                  <p className="text-sm text-slate-300">{s.context}</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-3">
                  <p className="font-medium text-white">{s.question}</p>
               </div>

               <div className="grid gap-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600'
                                 : i === selected
                                    ? 'bg-red-600'
                                    : 'bg-black/30'
                              : 'bg-black/30 hover:bg-blue-600/50'
                        }`}
                     >
                        {opt}
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-3">
                     {selected !== s.correct && s.wrongExplanations[selected!] && (
                        <div className="p-3 bg-red-900/50 rounded-lg border border-red-500/30">
                           <p className="text-xs text-red-300 font-bold mb-1">‚ùå Why This Was Wrong:</p>
                           <p className="text-sm text-red-100">{s.wrongExplanations[selected!]}</p>
                        </div>
                     )}
                     <div className="p-3 bg-green-900/50 rounded-lg border border-green-500/30">
                        <p className="text-xs text-green-300 font-bold mb-1">‚úì Optimization Insight:</p>
                        <p className="text-sm text-green-100">{s.why}</p>
                     </div>
                     <div className="p-3 bg-blue-900/50 rounded-lg border border-blue-500/30">
                        <p className="text-xs text-blue-300 font-bold mb-1">üìñ Real World:</p>
                        <p className="text-sm text-blue-100">{s.realWorld}</p>
                     </div>
                     <button
                        onClick={next}
                        className="w-full py-2 bg-blue-600 rounded-lg hover:bg-blue-500"
                     >
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-blue-500/30 flex gap-2 justify-center flex-wrap">
               {Object.keys(infoTopics).map(k => (
                  <button
                     key={k}
                     onClick={() => { setInfoTopic(k); setShowInfo(true); }}
                     className="text-xs text-blue-400 hover:text-blue-300"
                  >
                     ‚ÑπÔ∏è {infoTopics[k].title}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 38. PUBLIC RELATIONS - PR Crisis Simulator
   const PublicRelationsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const crises = [
         { scenario: 'A customer posts a viral video complaining about your product defect', best: 'acknowledge', options: [
            { id: 'ignore', label: 'üôà Ignore and hope it blows over', score: 0 },
            { id: 'acknowledge', label: '‚úÖ Publicly acknowledge, apologize, offer solution', score: 10 },
            { id: 'blame', label: 'üëÜ Blame the customer for misuse', score: -5 }
         ]},
         { scenario: 'A journalist wants to interview you about industry concerns', best: 'prepare', options: [
            { id: 'decline', label: '‚ùå Decline all interviews', score: 3 },
            { id: 'prepare', label: 'üìã Prepare key messages and do the interview', score: 10 },
            { id: 'wing', label: 'üé§ Do it spontaneously without prep', score: 2 }
         ]},
         { scenario: 'Your competitor spreads false information about you', best: 'factual', options: [
            { id: 'attack', label: '‚öîÔ∏è Attack them back publicly', score: 1 },
            { id: 'factual', label: 'üìä Release factual corrections professionally', score: 10 },
            { id: 'legal', label: '‚öñÔ∏è Immediately threaten lawsuits', score: 4 }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Public Relations</p>
                  <p>Managing your public image and reputation. Crisis communication requires speed, transparency, and empathy.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üì∞</p>
            <h2 className="text-3xl font-bold mb-4">PR Crisis Simulator</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Navigate PR scenarios and protect your brand's reputation.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-emerald-500 rounded-2xl font-bold text-xl hover:bg-emerald-400 transition-all">START SIMULATION ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 25 ? 'üèÜ' : score >= 15 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">PR Score</h2>
            <p className="text-5xl font-bold text-emerald-400 mb-4">{score}/{crises.length * 10}</p>
            <p className="text-lg opacity-80 mb-8">{score >= 25 ? 'PR expert!' : score >= 15 ? 'Good instincts!' : 'Study crisis management!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-emerald-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (optScore: number) => {
         setScore(score + optScore);
         if (current < crises.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const c = crises[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-8">
            <div className="bg-red-500/20 border border-red-500/50 rounded-2xl p-6 mb-6 text-center">
               <p className="text-sm opacity-70 mb-2">‚ö†Ô∏è CRISIS {current + 1} of {crises.length}</p>
               <p className="text-lg font-bold">{c.scenario}</p>
            </div>
            <p className="text-center mb-4 opacity-80">How do you respond?</p>
            <div className="flex flex-col gap-3 flex-1">
               {c.options.map((opt) => (
                  <button key={opt.id} onClick={() => handleSelect(opt.score)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-emerald-500/30 transition-all text-left font-medium">
                     {opt.label}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 39. GUERRILLA MARKETING - Creative Campaign Ideas
   const GuerrillaMarketingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const tactics = [
         { name: 'Flash Mob', icon: 'üíÉ', desc: 'Coordinated public performance', viral: 9, cost: 2, risk: 4 },
         { name: 'Street Art', icon: 'üé®', desc: 'Creative murals or chalk art', viral: 7, cost: 1, risk: 5 },
         { name: 'Pop-Up Experience', icon: 'üé™', desc: 'Temporary immersive installation', viral: 8, cost: 5, risk: 2 },
         { name: 'Sticker Campaign', icon: 'üè∑Ô∏è', desc: 'Strategic sticker placement', viral: 5, cost: 1, risk: 6 },
         { name: 'Viral Stunt', icon: 'üé¨', desc: 'Attention-grabbing public act', viral: 10, cost: 4, risk: 8 }
      ];

      const scenarios = [
         { goal: 'Launch a coffee shop on a tiny budget', best: 'Sticker Campaign' },
         { goal: 'Create massive buzz for a movie premiere', best: 'Viral Stunt' },
         { goal: 'Promote a dance studio opening', best: 'Flash Mob' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Guerrilla Marketing</p>
                  <p>Unconventional, low-cost tactics designed to generate buzz and word-of-mouth. High creativity, high impact.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üé≠</p>
            <h2 className="text-3xl font-bold mb-4">Guerrilla Marketing</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Match unconventional marketing tactics to business scenarios.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-lime-500 rounded-2xl font-bold text-xl hover:bg-lime-400 transition-all text-black">START ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= scenarios.length * 8 ? 'üèÜ' : '‚≠ê'}</p>
            <h2 className="text-3xl font-bold mb-4">Creativity Score</h2>
            <p className="text-5xl font-bold text-lime-400 mb-4">{score}/{scenarios.length * 10}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-lime-500 rounded-xl font-bold text-black">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (tactic: string) => {
         const isCorrect = tactic === scenarios[current].best;
         setScore(score + (isCorrect ? 10 : 4));
         if (current < scenarios.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-8">
            <div className="bg-black/30 rounded-2xl p-4 mb-4 text-center">
               <p className="text-sm opacity-70">Scenario {current + 1}/{scenarios.length}</p>
               <p className="text-lg font-bold mt-2">{scenarios[current].goal}</p>
            </div>
            <p className="text-center mb-4 opacity-80">Select the best tactic:</p>
            <div className="grid grid-cols-1 gap-2 flex-1 overflow-auto">
               {tactics.map((t) => (
                  <button key={t.name} onClick={() => handleSelect(t.name)}
                     className="p-3 bg-black/30 rounded-xl hover:bg-lime-500/30 transition-all text-left flex items-center gap-3">
                     <span className="text-2xl">{t.icon}</span>
                     <div>
                        <p className="font-bold">{t.name}</p>
                        <p className="text-xs opacity-70">{t.desc}</p>
                     </div>
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 40. COPYWRITING - Headline Writing Practice
   const CopywritingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const headlines = [
         { product: 'Time Management App', best: 'b', options: [
            { id: 'a', text: 'Our App is Great for Time', score: 3 },
            { id: 'b', text: 'Get 3 Extra Hours in Your Day', score: 10 },
            { id: 'c', text: 'Download Our Time App Now', score: 4 }
         ]},
         { product: 'Organic Dog Food', best: 'c', options: [
            { id: 'a', text: 'Buy Organic Dog Food', score: 3 },
            { id: 'b', text: 'Food for Dogs That is Organic', score: 2 },
            { id: 'c', text: 'Give Your Best Friend 5 More Healthy Years', score: 10 }
         ]},
         { product: 'Online Coding Course', best: 'a', options: [
            { id: 'a', text: 'From Zero to Your First Job in 12 Weeks', score: 10 },
            { id: 'b', text: 'Learn Coding Online', score: 3 },
            { id: 'c', text: 'Programming Classes Available', score: 2 }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Copywriting Principles</p>
                  <p>Focus on benefits, not features. Use specific numbers. Create urgency. Address the reader directly.</p>
               </div>
            )}
            <p className="text-6xl mb-4">‚úçÔ∏è</p>
            <h2 className="text-3xl font-bold mb-4">Headline Writing</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Choose the most effective headline for each product.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-amber-500 rounded-2xl font-bold text-xl hover:bg-amber-400 transition-all text-black">START WRITING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 25 ? 'üèÜ' : score >= 15 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">Copywriting Score</h2>
            <p className="text-5xl font-bold text-amber-400 mb-4">{score}/{headlines.length * 10}</p>
            <p className="text-lg opacity-80 mb-8">{score >= 25 ? 'Master copywriter!' : score >= 15 ? 'Good eye for copy!' : 'Study the greats!'}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-amber-500 rounded-xl font-bold text-black">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (optScore: number) => {
         setScore(score + optScore);
         if (current < headlines.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const h = headlines[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-8">
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-sm opacity-70 mb-2">Product {current + 1}/{headlines.length}</p>
               <p className="text-xl font-bold">üì¶ {h.product}</p>
            </div>
            <p className="text-center mb-4 opacity-80">Pick the best headline:</p>
            <div className="flex flex-col gap-3 flex-1">
               {h.options.map((opt) => (
                  <button key={opt.id} onClick={() => handleSelect(opt.score)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-amber-500/30 transition-all text-left">
                     <p className="font-bold text-lg">"{opt.text}"</p>
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // ============================================
   // ENTREPRENEURSHIP: FINANCIAL LITERACY (10)
   // ============================================

   // 41. BOOTSTRAPPING - Resource Management Simulator
   const BootstrappingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [budget, setBudget] = useState(10000);
      const [month, setMonth] = useState(1);
      const [decisions, setDecisions] = useState<string[]>([]);

      const scenarios = [
         { situation: 'You need office space', options: [
            { label: 'üè¢ Rent office ($2000/mo)', cost: 2000, benefit: 'Professional image' },
            { label: 'üè† Work from home ($0)', cost: 0, benefit: 'Save money' },
            { label: '‚òï Coworking ($500/mo)', cost: 500, benefit: 'Networking' }
         ]},
         { situation: 'Marketing your product', options: [
            { label: 'üì∫ Paid ads ($3000)', cost: 3000, benefit: 'Fast reach' },
            { label: 'üì± Social media ($0)', cost: 0, benefit: 'Organic growth' },
            { label: 'ü§ù Partnerships ($500)', cost: 500, benefit: 'Credibility' }
         ]},
         { situation: 'Hiring help', options: [
            { label: 'üëî Full-time ($4000/mo)', cost: 4000, benefit: 'Dedicated team' },
            { label: 'üéØ Freelancer ($1000)', cost: 1000, benefit: 'Flexible' },
            { label: 'ü§ñ Automation ($500)', cost: 500, benefit: 'Scalable' }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Bootstrapping</p>
                  <p>Building a business with minimal external funding. Focus on revenue, frugality, and creative resource management.</p>
               </div>
            )}
            <p className="text-6xl mb-4">ü•æ</p>
            <h2 className="text-3xl font-bold mb-4">Bootstrapping Simulator</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Start with $10,000 and make smart decisions to grow your business.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-green-500 rounded-2xl font-bold text-xl hover:bg-green-400 transition-all">START BOOTSTRAP ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{budget > 5000 ? 'üèÜ' : budget > 0 ? '‚≠ê' : 'üí∏'}</p>
            <h2 className="text-3xl font-bold mb-4">Final Balance</h2>
            <p className="text-5xl font-bold text-green-400 mb-4">${budget.toLocaleString()}</p>
            <div className="text-sm opacity-80 mb-6">
               {decisions.map((d, i) => <p key={i}>Month {i+1}: {d}</p>)}
            </div>
            <button onClick={() => { setPhase('intro'); setBudget(10000); setMonth(1); setDecisions([]); }} className="px-6 py-3 bg-green-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const handleChoice = (cost: number, label: string) => {
         setBudget(budget - cost);
         setDecisions([...decisions, label]);
         if (month < scenarios.length) setMonth(month + 1);
         else setPhase('result');
      };

      const s = scenarios[month - 1];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-green-900 via-emerald-900 to-teal-900 text-white p-8">
            <div className="flex justify-between mb-6">
               <span className="bg-black/30 px-4 py-2 rounded-xl">Month {month}/3</span>
               <span className="bg-green-500/30 px-4 py-2 rounded-xl font-bold">${budget.toLocaleString()}</span>
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-xl font-bold">{s.situation}</p>
            </div>
            <div className="flex flex-col gap-3 flex-1">
               {s.options.map((opt) => (
                  <button key={opt.label} onClick={() => handleChoice(opt.cost, opt.label)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-green-500/30 transition-all text-left">
                     <p className="font-bold">{opt.label}</p>
                     <p className="text-sm opacity-70">Cost: ${opt.cost} ‚Ä¢ {opt.benefit}</p>
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 42. CASH FLOW - Cash Flow Tracker
   const CashFlowRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [inflows, setInflows] = useState<{name: string; amount: number}[]>([]);
      const [outflows, setOutflows] = useState<{name: string; amount: number}[]>([]);
      const [name, setName] = useState('');
      const [amount, setAmount] = useState('');
      const [isInflow, setIsInflow] = useState(true);

      const totalIn = inflows.reduce((sum, i) => sum + i.amount, 0);
      const totalOut = outflows.reduce((sum, o) => sum + o.amount, 0);
      const netCashFlow = totalIn - totalOut;

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Cash Flow</p>
                  <p>Cash In - Cash Out = Net Cash Flow. Positive cash flow keeps your business alive. Track it religiously!</p>
               </div>
            )}
            <p className="text-6xl mb-4">üíµ</p>
            <h2 className="text-3xl font-bold mb-4">Cash Flow Tracker</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Track your money coming in and going out to understand your cash position.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-blue-500 rounded-2xl font-bold text-xl hover:bg-blue-400 transition-all">START TRACKING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üíµ Cash Flow Summary</h2>
            <div className="grid grid-cols-2 gap-4 mb-6">
               <div className="bg-green-500/20 rounded-xl p-4 text-center">
                  <p className="text-sm opacity-70">Total Inflows</p>
                  <p className="text-2xl font-bold text-green-400">+${totalIn.toLocaleString()}</p>
               </div>
               <div className="bg-red-500/20 rounded-xl p-4 text-center">
                  <p className="text-sm opacity-70">Total Outflows</p>
                  <p className="text-2xl font-bold text-red-400">-${totalOut.toLocaleString()}</p>
               </div>
            </div>
            <div className={`rounded-xl p-6 text-center mb-6 ${netCashFlow >= 0 ? 'bg-green-500/30' : 'bg-red-500/30'}`}>
               <p className="text-sm opacity-70">Net Cash Flow</p>
               <p className={`text-4xl font-bold ${netCashFlow >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                  {netCashFlow >= 0 ? '+' : ''}{netCashFlow.toLocaleString()}
               </p>
            </div>
            <button onClick={() => { setPhase('intro'); setInflows([]); setOutflows([]); }} className="px-6 py-3 bg-blue-500 rounded-xl font-bold">START OVER</button>
         </div>
      );

      const addEntry = () => {
         if (name && amount) {
            const entry = { name, amount: parseFloat(amount) };
            if (isInflow) setInflows([...inflows, entry]);
            else setOutflows([...outflows, entry]);
            setName('');
            setAmount('');
         }
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-violet-900 text-white p-8">
            <div className="flex gap-2 mb-4">
               <button onClick={() => setIsInflow(true)} className={`flex-1 py-2 rounded-xl font-bold ${isInflow ? 'bg-green-500' : 'bg-black/30'}`}>+ Inflow</button>
               <button onClick={() => setIsInflow(false)} className={`flex-1 py-2 rounded-xl font-bold ${!isInflow ? 'bg-red-500' : 'bg-black/30'}`}>- Outflow</button>
            </div>
            <input value={name} onChange={(e) => setName(e.target.value)} placeholder="Description..."
               className="p-3 rounded-xl bg-black/30 border border-blue-500/30 text-white mb-2" />
            <input value={amount} onChange={(e) => setAmount(e.target.value)} placeholder="Amount..." type="number"
               className="p-3 rounded-xl bg-black/30 border border-blue-500/30 text-white mb-4" />
            <button onClick={addEntry} className="px-6 py-3 bg-blue-500 rounded-xl font-bold mb-4">ADD ENTRY</button>
            <div className="flex-1 overflow-auto">
               {[...inflows.map(i => ({...i, type: 'in'})), ...outflows.map(o => ({...o, type: 'out'}))].map((e, i) => (
                  <div key={i} className={`p-3 rounded-xl mb-2 ${e.type === 'in' ? 'bg-green-500/20' : 'bg-red-500/20'}`}>
                     <span className="font-bold">{e.name}</span>
                     <span className={`float-right ${e.type === 'in' ? 'text-green-400' : 'text-red-400'}`}>
                        {e.type === 'in' ? '+' : '-'}${e.amount}
                     </span>
                  </div>
               ))}
            </div>
            <button onClick={() => (inflows.length > 0 || outflows.length > 0) && setPhase('result')} className="px-6 py-3 bg-blue-700 rounded-xl font-bold mt-4">VIEW SUMMARY</button>
         </div>
      );
   };

   // 43. PROFIT & LOSS - P&L Statement Builder
   const ProfitLossRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [revenue, setRevenue] = useState(0);
      const [cogs, setCogs] = useState(0);
      const [expenses, setExpenses] = useState(0);
      const [step, setStep] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { key: 'revenue', icon: 'üí∞', label: 'Revenue', prompt: 'Enter your total sales/revenue' },
         { key: 'cogs', icon: 'üì¶', label: 'Cost of Goods Sold', prompt: 'Enter direct costs (materials, labor, etc.)' },
         { key: 'expenses', icon: 'üè¢', label: 'Operating Expenses', prompt: 'Enter overhead (rent, utilities, salaries, etc.)' }
      ];

      const grossProfit = revenue - cogs;
      const netProfit = grossProfit - expenses;
      const grossMargin = revenue > 0 ? ((grossProfit / revenue) * 100).toFixed(1) : '0';
      const netMargin = revenue > 0 ? ((netProfit / revenue) * 100).toFixed(1) : '0';

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Profit & Loss Statement</p>
                  <p>Revenue - COGS = Gross Profit. Gross Profit - Expenses = Net Profit. Shows if you're making or losing money.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üìä</p>
            <h2 className="text-3xl font-bold mb-4">Profit & Loss Statement</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Build your P&L to understand your profitability.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-amber-500 rounded-2xl font-bold text-xl hover:bg-amber-400 transition-all text-black">BUILD P&L ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üìä P&L Statement</h2>
            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <div className="flex justify-between mb-2"><span>Revenue</span><span className="font-bold">${revenue.toLocaleString()}</span></div>
               <div className="flex justify-between mb-2 text-red-300"><span>- COGS</span><span>-${cogs.toLocaleString()}</span></div>
               <div className="border-t border-white/20 pt-2 flex justify-between"><span className="font-bold">Gross Profit</span><span className="font-bold text-green-400">${grossProfit.toLocaleString()}</span></div>
               <p className="text-xs text-right opacity-70">Margin: {grossMargin}%</p>
            </div>
            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <div className="flex justify-between mb-2 text-red-300"><span>- Operating Expenses</span><span>-${expenses.toLocaleString()}</span></div>
               <div className="border-t border-white/20 pt-2 flex justify-between">
                  <span className="font-bold">Net Profit</span>
                  <span className={`font-bold ${netProfit >= 0 ? 'text-green-400' : 'text-red-400'}`}>${netProfit.toLocaleString()}</span>
               </div>
               <p className="text-xs text-right opacity-70">Net Margin: {netMargin}%</p>
            </div>
            <button onClick={() => { setPhase('intro'); setRevenue(0); setCogs(0); setExpenses(0); setStep(0); }} className="px-6 py-3 bg-amber-500 rounded-xl font-bold text-black mt-auto">CREATE NEW P&L</button>
         </div>
      );

      const submitStep = () => {
         const value = parseFloat(inputValue) || 0;
         if (step === 0) setRevenue(value);
         else if (step === 1) setCogs(value);
         else setExpenses(value);
         setInputValue('');
         if (step < 2) setStep(step + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-amber-900 via-yellow-900 to-orange-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {steps.map((_, i) => <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-amber-400' : 'bg-black/30'}`}></div>)}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{steps[step].icon}</p>
               <p className="text-xl font-bold">{steps[step].label}</p>
               <p className="text-sm opacity-75 mt-2">{steps[step].prompt}</p>
            </div>
            <input value={inputValue} onChange={(e) => setInputValue(e.target.value)} type="number"
               placeholder="$0" className="p-4 rounded-xl bg-black/30 border border-amber-500/30 text-white mb-4 text-center text-2xl" />
            <button onClick={submitStep} className="px-6 py-3 bg-amber-500 rounded-xl font-bold text-black">
               {step < 2 ? 'NEXT ‚Üí' : 'VIEW P&L'}
            </button>
         </div>
      );
   };

   // 44. BREAK EVEN - Break-Even Calculator
   const BreakEvenRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [fixedCosts, setFixedCosts] = useState(0);
      const [pricePerUnit, setPricePerUnit] = useState(0);
      const [costPerUnit, setCostPerUnit] = useState(0);
      const [step, setStep] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const contributionMargin = pricePerUnit - costPerUnit;
      const breakEvenUnits = contributionMargin > 0 ? Math.ceil(fixedCosts / contributionMargin) : 0;
      const breakEvenRevenue = breakEvenUnits * pricePerUnit;

      const steps = [
         { key: 'fixed', icon: 'üè¢', label: 'Fixed Costs', prompt: 'Total monthly fixed costs (rent, salaries, etc.)' },
         { key: 'price', icon: 'üè∑Ô∏è', label: 'Price Per Unit', prompt: 'How much do you sell each unit for?' },
         { key: 'cost', icon: 'üì¶', label: 'Cost Per Unit', prompt: 'How much does each unit cost to make?' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-cyan-900 via-teal-900 to-emerald-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Break-Even Analysis</p>
                  <p>Break-Even Point = Fixed Costs / (Price - Variable Cost). The point where revenue equals total costs.</p>
               </div>
            )}
            <p className="text-6xl mb-4">‚öñÔ∏è</p>
            <h2 className="text-3xl font-bold mb-4">Break-Even Calculator</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Find out how many units you need to sell to cover all your costs.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-cyan-500 rounded-2xl font-bold text-xl hover:bg-cyan-400 transition-all text-black">CALCULATE ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-teal-900 to-emerald-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">‚öñÔ∏è Break-Even Analysis</h2>
            <div className="bg-black/30 rounded-xl p-6 mb-4 text-center">
               <p className="text-sm opacity-70">Units to Break Even</p>
               <p className="text-5xl font-bold text-cyan-400">{breakEvenUnits.toLocaleString()}</p>
            </div>
            <div className="bg-black/30 rounded-xl p-6 mb-4 text-center">
               <p className="text-sm opacity-70">Revenue at Break-Even</p>
               <p className="text-3xl font-bold">${breakEvenRevenue.toLocaleString()}</p>
            </div>
            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <p className="text-sm opacity-70 mb-2">Contribution Margin per Unit</p>
               <p className="font-bold">${contributionMargin} (${pricePerUnit} - ${costPerUnit})</p>
            </div>
            <button onClick={() => { setPhase('intro'); setFixedCosts(0); setPricePerUnit(0); setCostPerUnit(0); setStep(0); }} className="px-6 py-3 bg-cyan-500 rounded-xl font-bold text-black mt-auto">RECALCULATE</button>
         </div>
      );

      const submitStep = () => {
         const value = parseFloat(inputValue) || 0;
         if (step === 0) setFixedCosts(value);
         else if (step === 1) setPricePerUnit(value);
         else setCostPerUnit(value);
         setInputValue('');
         if (step < 2) setStep(step + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-cyan-900 via-teal-900 to-emerald-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {steps.map((_, i) => <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-cyan-400' : 'bg-black/30'}`}></div>)}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{steps[step].icon}</p>
               <p className="text-xl font-bold">{steps[step].label}</p>
               <p className="text-sm opacity-75 mt-2">{steps[step].prompt}</p>
            </div>
            <input value={inputValue} onChange={(e) => setInputValue(e.target.value)} type="number"
               placeholder="$0" className="p-4 rounded-xl bg-black/30 border border-cyan-500/30 text-white mb-4 text-center text-2xl" />
            <button onClick={submitStep} className="px-6 py-3 bg-cyan-500 rounded-xl font-bold text-black">
               {step < 2 ? 'NEXT ‚Üí' : 'CALCULATE'}
            </button>
         </div>
      );
   };

   // 45. PRICING STRATEGIES - Pricing Game
   const PricingStrategiesRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const scenarios = [
         { scenario: 'New tech product entering crowded market', best: 'penetration', options: [
            { id: 'penetration', label: 'üìâ Penetration Pricing', desc: 'Low price to gain market share', score: 10 },
            { id: 'skimming', label: 'üìà Price Skimming', desc: 'High price for early adopters', score: 4 },
            { id: 'cost_plus', label: '‚ûï Cost-Plus Pricing', desc: 'Cost + fixed markup', score: 5 }
         ]},
         { scenario: 'Revolutionary medical device with no competition', best: 'skimming', options: [
            { id: 'penetration', label: 'üìâ Penetration Pricing', desc: 'Low price to gain market share', score: 3 },
            { id: 'skimming', label: 'üìà Price Skimming', desc: 'High price for early adopters', score: 10 },
            { id: 'competitive', label: 'üéØ Competitive Pricing', desc: 'Match competitor prices', score: 2 }
         ]},
         { scenario: 'Commodity product in price-sensitive market', best: 'competitive', options: [
            { id: 'value', label: 'üíé Value-Based Pricing', desc: 'Price based on perceived value', score: 5 },
            { id: 'competitive', label: 'üéØ Competitive Pricing', desc: 'Match or beat competitors', score: 10 },
            { id: 'premium', label: 'üëë Premium Pricing', desc: 'High price = high quality', score: 2 }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Pricing Strategies</p>
                  <p>Penetration (low entry), Skimming (high entry), Value-based, Competitive, Cost-plus, Premium. Match strategy to situation.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üí≤</p>
            <h2 className="text-3xl font-bold mb-4">Pricing Strategies</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Match the right pricing strategy to each business scenario.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-violet-500 rounded-2xl font-bold text-xl hover:bg-violet-400 transition-all">START ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 25 ? 'üèÜ' : score >= 15 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">Pricing Score</h2>
            <p className="text-5xl font-bold text-violet-400 mb-4">{score}/{scenarios.length * 10}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-violet-500 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (optScore: number) => {
         setScore(score + optScore);
         if (current < scenarios.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const s = scenarios[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-8">
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-sm opacity-70 mb-2">Scenario {current + 1}/{scenarios.length}</p>
               <p className="text-lg font-bold">{s.scenario}</p>
            </div>
            <div className="flex flex-col gap-3 flex-1">
               {s.options.map((opt) => (
                  <button key={opt.id} onClick={() => handleSelect(opt.score)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-violet-500/30 transition-all text-left">
                     <p className="font-bold">{opt.label}</p>
                     <p className="text-sm opacity-70">{opt.desc}</p>
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 46. EQUITY OWNERSHIP - Equity Split Calculator
   const EquityOwnershipRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [founders, setFounders] = useState<{name: string; equity: number}[]>([]);
      const [name, setName] = useState('');
      const [equity, setEquity] = useState('');

      const totalEquity = founders.reduce((sum, f) => sum + f.equity, 0);
      const remaining = 100 - totalEquity;

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-indigo-900 via-blue-900 to-cyan-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Equity Ownership</p>
                  <p>Divide company ownership fairly. Consider: time, money, skills, risk, and future contribution. Vesting protects everyone.</p>
               </div>
            )}
            <p className="text-6xl mb-4">ü•ß</p>
            <h2 className="text-3xl font-bold mb-4">Equity Split Calculator</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Divide ownership among founders and early team members.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-indigo-500 rounded-2xl font-bold text-xl hover:bg-indigo-400 transition-all">START SPLITTING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-blue-900 to-cyan-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">ü•ß Equity Distribution</h2>
            <div className="flex justify-center mb-6">
               <div className="relative w-48 h-48">
                  <svg viewBox="0 0 100 100" className="w-full h-full">
                     {founders.map((f, i) => {
                        const startAngle = founders.slice(0, i).reduce((sum, prev) => sum + prev.equity, 0) * 3.6;
                        const endAngle = startAngle + f.equity * 3.6;
                        const colors = ['#6366f1', '#8b5cf6', '#a855f7', '#d946ef', '#ec4899'];
                        const x1 = 50 + 45 * Math.cos((startAngle - 90) * Math.PI / 180);
                        const y1 = 50 + 45 * Math.sin((startAngle - 90) * Math.PI / 180);
                        const x2 = 50 + 45 * Math.cos((endAngle - 90) * Math.PI / 180);
                        const y2 = 50 + 45 * Math.sin((endAngle - 90) * Math.PI / 180);
                        const largeArc = f.equity > 50 ? 1 : 0;
                        return <path key={i} d={`M 50 50 L ${x1} ${y1} A 45 45 0 ${largeArc} 1 ${x2} ${y2} Z`} fill={colors[i % colors.length]} />;
                     })}
                  </svg>
               </div>
            </div>
            <div className="flex-1 overflow-auto">
               {founders.map((f, i) => (
                  <div key={i} className="flex justify-between p-3 bg-black/30 rounded-xl mb-2">
                     <span className="font-bold">{f.name}</span>
                     <span className="text-indigo-400">{f.equity}%</span>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setFounders([]); }} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold mt-4">START OVER</button>
         </div>
      );

      const addFounder = () => {
         if (name && equity && parseFloat(equity) <= remaining) {
            setFounders([...founders, { name, equity: parseFloat(equity) }]);
            setName('');
            setEquity('');
         }
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-indigo-900 via-blue-900 to-cyan-900 text-white p-8">
            <div className="bg-black/30 rounded-xl p-4 mb-4 text-center">
               <p className="text-sm opacity-70">Remaining Equity</p>
               <p className="text-3xl font-bold text-indigo-400">{remaining}%</p>
            </div>
            <input value={name} onChange={(e) => setName(e.target.value)} placeholder="Name..."
               className="p-3 rounded-xl bg-black/30 border border-indigo-500/30 text-white mb-2" />
            <input value={equity} onChange={(e) => setEquity(e.target.value)} placeholder="Equity %..." type="number"
               className="p-3 rounded-xl bg-black/30 border border-indigo-500/30 text-white mb-4" />
            <button onClick={addFounder} className="px-6 py-3 bg-indigo-500 rounded-xl font-bold mb-4">ADD STAKEHOLDER</button>
            <div className="flex-1 overflow-auto">
               {founders.map((f, i) => (
                  <div key={i} className="flex justify-between p-3 bg-black/30 rounded-xl mb-2">
                     <span>{f.name}</span><span className="text-indigo-400">{f.equity}%</span>
                  </div>
               ))}
            </div>
            <button onClick={() => founders.length > 0 && setPhase('result')} className="px-6 py-3 bg-indigo-700 rounded-xl font-bold mt-4">VIEW CHART</button>
         </div>
      );
   };

   // 47. ANGEL INVESTORS - Investor Pitch Match
   const AngelInvestorsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const questions = [
         { q: 'What do angel investors typically invest?', options: [
            { text: '$5K - $10K', score: 3 },
            { text: '$25K - $500K', score: 10 },
            { text: '$1M - $10M', score: 2 }
         ]},
         { q: 'What do angels primarily look for?', options: [
            { text: 'Proven profitability', score: 3 },
            { text: 'Team + market opportunity', score: 10 },
            { text: 'Lowest valuation', score: 2 }
         ]},
         { q: 'Typical angel equity stake?', options: [
            { text: '1-5%', score: 3 },
            { text: '10-25%', score: 10 },
            { text: '51%+ majority', score: 1 }
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Angel Investors</p>
                  <p>High-net-worth individuals who invest personal funds in early-stage startups, often providing mentorship alongside capital.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üëº</p>
            <h2 className="text-3xl font-bold mb-4">Angel Investors</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Test your knowledge of angel investing fundamentals.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-yellow-500 rounded-2xl font-bold text-xl hover:bg-yellow-400 transition-all text-black">START QUIZ ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 25 ? 'üèÜ' : score >= 15 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">Angel Knowledge</h2>
            <p className="text-5xl font-bold text-yellow-400 mb-4">{score}/{questions.length * 10}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-yellow-500 rounded-xl font-bold text-black">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (optScore: number) => {
         setScore(score + optScore);
         if (current < questions.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const q = questions[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-8">
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-sm opacity-70 mb-2">Question {current + 1}/{questions.length}</p>
               <p className="text-xl font-bold">{q.q}</p>
            </div>
            <div className="flex flex-col gap-3 flex-1">
               {q.options.map((opt, i) => (
                  <button key={i} onClick={() => handleSelect(opt.score)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-yellow-500/30 transition-all text-left font-medium">
                     {opt.text}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 48. VENTURE CAPITAL - VC Term Sheet Game
   const VentureCapitalRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [score, setScore] = useState(0);
      const [current, setCurrent] = useState(0);

      const terms = [
         { term: 'Pre-Money Valuation', correct: 'Company value BEFORE investment', options: [
            'Company value BEFORE investment',
            'Company value AFTER investment',
            'Total investment amount'
         ]},
         { term: 'Liquidation Preference', correct: 'VCs get paid first in exit', options: [
            'How profits are shared annually',
            'VCs get paid first in exit',
            'Order of founder payouts'
         ]},
         { term: 'Anti-Dilution', correct: 'Protection against down rounds', options: [
            'Prevents hiring more employees',
            'Protection against down rounds',
            'Limits company growth'
         ]}
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-slate-900 via-gray-900 to-zinc-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Venture Capital</p>
                  <p>Professional investors managing pooled funds. Invest $1M-$100M+ for high-growth potential. Expect 10x+ returns.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üèõÔ∏è</p>
            <h2 className="text-3xl font-bold mb-4">VC Term Sheet Game</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Learn key venture capital terms every founder should know.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-slate-600 rounded-2xl font-bold text-xl hover:bg-slate-500 transition-all">START LEARNING ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-slate-900 via-gray-900 to-zinc-900 text-white p-8 text-center">
            <p className="text-6xl mb-4">{score >= 25 ? 'üèÜ' : score >= 15 ? '‚≠ê' : 'üìö'}</p>
            <h2 className="text-3xl font-bold mb-4">VC Knowledge</h2>
            <p className="text-5xl font-bold text-slate-400 mb-4">{score}/{terms.length * 10}</p>
            <button onClick={() => { setPhase('intro'); setScore(0); setCurrent(0); }} className="px-6 py-3 bg-slate-600 rounded-xl font-bold">TRY AGAIN</button>
         </div>
      );

      const handleSelect = (answer: string) => {
         const isCorrect = answer === terms[current].correct;
         setScore(score + (isCorrect ? 10 : 3));
         if (current < terms.length - 1) setCurrent(current + 1);
         else setPhase('result');
      };

      const t = terms[current];
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-900 via-gray-900 to-zinc-900 text-white p-8">
            <div className="bg-black/30 rounded-2xl p-6 mb-6 text-center">
               <p className="text-sm opacity-70 mb-2">Term {current + 1}/{terms.length}</p>
               <p className="text-2xl font-bold">"{t.term}"</p>
               <p className="text-sm opacity-70 mt-2">What does this mean?</p>
            </div>
            <div className="flex flex-col gap-3 flex-1">
               {t.options.map((opt, i) => (
                  <button key={i} onClick={() => handleSelect(opt)}
                     className="p-4 bg-black/30 rounded-xl hover:bg-slate-500/30 transition-all text-left font-medium">
                     {opt}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // 49. CROWDFUNDING - Campaign Builder
   const CrowdfundingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [campaign, setCampaign] = useState({ title: '', goal: '', reward1: '', reward2: '' });
      const [step, setStep] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const steps = [
         { key: 'title', icon: 'üéØ', label: 'Campaign Title', prompt: 'Create a compelling campaign name' },
         { key: 'goal', icon: 'üí∞', label: 'Funding Goal', prompt: 'How much do you need to raise?' },
         { key: 'reward1', icon: 'üéÅ', label: 'Early Bird Reward', prompt: 'What do early backers get?' },
         { key: 'reward2', icon: '‚≠ê', label: 'Premium Reward', prompt: 'What\'s the top-tier reward?' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Crowdfunding</p>
                  <p>Raise money from many small backers. Platforms: Kickstarter, Indiegogo. Keys: compelling story, clear rewards, marketing.</p>
               </div>
            )}
            <p className="text-6xl mb-4">üöÄ</p>
            <h2 className="text-3xl font-bold mb-4">Crowdfunding Campaign</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Design a crowdfunding campaign with compelling rewards.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-pink-500 rounded-2xl font-bold text-xl hover:bg-pink-400 transition-all">CREATE CAMPAIGN ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üöÄ Campaign Preview</h2>
            <div className="bg-black/30 rounded-xl p-6 flex-1">
               <h3 className="text-2xl font-bold mb-2">{campaign.title}</h3>
               <p className="text-pink-400 text-lg mb-4">Goal: {campaign.goal}</p>
               <div className="border-t border-white/20 pt-4">
                  <p className="font-bold mb-2">Reward Tiers:</p>
                  <div className="bg-black/20 rounded-lg p-3 mb-2">
                     <p className="text-sm opacity-70">üéÅ Early Bird</p>
                     <p className="font-medium">{campaign.reward1}</p>
                  </div>
                  <div className="bg-black/20 rounded-lg p-3">
                     <p className="text-sm opacity-70">‚≠ê Premium</p>
                     <p className="font-medium">{campaign.reward2}</p>
                  </div>
               </div>
            </div>
            <button onClick={() => { setPhase('intro'); setCampaign({ title: '', goal: '', reward1: '', reward2: '' }); setStep(0); }} className="px-6 py-3 bg-pink-500 rounded-xl font-bold mt-4">CREATE NEW</button>
         </div>
      );

      const submitStep = () => {
         setCampaign({ ...campaign, [steps[step].key]: inputValue });
         setInputValue('');
         if (step < 3) setStep(step + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-pink-900 via-rose-900 to-red-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {steps.map((_, i) => <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-pink-400' : 'bg-black/30'}`}></div>)}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{steps[step].icon}</p>
               <p className="text-xl font-bold">{steps[step].label}</p>
               <p className="text-sm opacity-75 mt-2">{steps[step].prompt}</p>
            </div>
            <input value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your answer..." className="p-4 rounded-xl bg-black/30 border border-pink-500/30 text-white mb-4" />
            <button onClick={submitStep} className="px-6 py-3 bg-pink-500 rounded-xl font-bold">
               {step < 3 ? 'NEXT ‚Üí' : 'PREVIEW CAMPAIGN'}
            </button>
         </div>
      );
   };

   // 50. PITCH DECK - Pitch Deck Builder
   const PitchDeckRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [slides, setSlides] = useState({ problem: '', solution: '', market: '', ask: '' });
      const [step, setStep] = useState(0);
      const [inputValue, setInputValue] = useState('');

      const slideSteps = [
         { key: 'problem', icon: 'üò∞', label: 'The Problem', prompt: 'What pain point are you solving?' },
         { key: 'solution', icon: 'üí°', label: 'Your Solution', prompt: 'How do you solve it?' },
         { key: 'market', icon: 'üåç', label: 'Market Size', prompt: 'How big is the opportunity?' },
         { key: 'ask', icon: 'ü§ù', label: 'The Ask', prompt: 'How much are you raising and for what?' }
      ];

      if (phase === 'intro') return (
         <div className="flex flex-col items-center justify-center h-full bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 text-white p-8 text-center">
            <button onClick={() => setShowInfo(!showInfo)} className="absolute top-4 right-4 w-10 h-10 rounded-full bg-white/20 flex items-center justify-center text-xl">‚ÑπÔ∏è</button>
            {showInfo && (
               <div className="absolute top-16 right-4 bg-black/90 p-4 rounded-xl max-w-xs text-left text-sm">
                  <p className="font-bold mb-2">Pitch Deck Essentials</p>
                  <p>10-15 slides: Problem, Solution, Market, Product, Traction, Team, Financials, Competition, Ask. Tell a compelling story!</p>
               </div>
            )}
            <p className="text-6xl mb-4">üìë</p>
            <h2 className="text-3xl font-bold mb-4">Pitch Deck Builder</h2>
            <p className="text-lg opacity-80 max-w-md mb-8">Create the core slides every investor pitch needs.</p>
            <button onClick={() => setPhase('play')} className="px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-500 rounded-2xl font-bold text-xl hover:opacity-90 transition-all">BUILD DECK ‚Üí</button>
         </div>
      );

      if (phase === 'result') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 text-white p-8">
            <h2 className="text-2xl font-bold text-center mb-6">üìë Your Pitch Deck</h2>
            <div className="flex-1 overflow-auto">
               {slideSteps.map((s) => (
                  <div key={s.key} className="bg-black/30 rounded-xl p-4 mb-3">
                     <div className="flex items-center gap-2 mb-2">
                        <span className="text-xl">{s.icon}</span>
                        <span className="font-bold">{s.label}</span>
                     </div>
                     <p className="text-sm opacity-80 ml-8">{slides[s.key as keyof typeof slides]}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => { setPhase('intro'); setSlides({ problem: '', solution: '', market: '', ask: '' }); setStep(0); }} className="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl font-bold mt-4">CREATE NEW DECK</button>
         </div>
      );

      const submitStep = () => {
         setSlides({ ...slides, [slideSteps[step].key]: inputValue });
         setInputValue('');
         if (step < 3) setStep(step + 1);
         else setPhase('result');
      };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-purple-900 to-pink-900 text-white p-8">
            <div className="flex gap-2 mb-6">
               {slideSteps.map((_, i) => <div key={i} className={`flex-1 h-2 rounded-full ${i <= step ? 'bg-purple-400' : 'bg-black/30'}`}></div>)}
            </div>
            <div className="bg-black/30 rounded-2xl p-6 mb-4 text-center">
               <p className="text-4xl mb-2">{slideSteps[step].icon}</p>
               <p className="text-xl font-bold">{slideSteps[step].label}</p>
               <p className="text-sm opacity-75 mt-2">{slideSteps[step].prompt}</p>
            </div>
            <textarea value={inputValue} onChange={(e) => setInputValue(e.target.value)}
               placeholder="Your answer..." className="flex-1 p-4 rounded-xl bg-black/30 border border-purple-500/30 text-white mb-4 resize-none" />
            <button onClick={submitStep} className="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl font-bold">
               {step < 3 ? 'NEXT SLIDE ‚Üí' : 'VIEW DECK'}
            </button>
         </div>
      );
   };

   // ============================================================================
   // SECTION VI: OPERATIONS & MANAGEMENT - SUPPLY CHAIN MANAGEMENT
   // ============================================================================
   const SupplyChainRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [day, setDay] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      // Supply chain stages with inventory
      const [stages, setStages] = useState([
         { id: 'supplier', name: 'Supplier', icon: 'üåø', inventory: 100, capacity: 200, leadTime: 2 },
         { id: 'manufacturer', name: 'Manufacturer', icon: 'üè≠', inventory: 50, capacity: 100, leadTime: 1 },
         { id: 'warehouse', name: 'Warehouse', icon: 'üì¶', inventory: 30, capacity: 80, leadTime: 1 },
         { id: 'distributor', name: 'Distributor', icon: 'üöö', inventory: 20, capacity: 50, leadTime: 1 },
         { id: 'retailer', name: 'Retailer', icon: 'üè™', inventory: 15, capacity: 30, leadTime: 0 },
      ]);

      // Game metrics
      const [money, setMoney] = useState(10000);
      const [customerSatisfaction, setCustomerSatisfaction] = useState(100);
      const [ordersDelivered, setOrdersDelivered] = useState(0);
      const [ordersMissed, setOrdersMissed] = useState(0);
      const [totalCost, setTotalCost] = useState(0);

      // Current order settings
      const [orderQty, setOrderQty] = useState(20);
      const [selectedSupplier, setSelectedSupplier] = useState<'cheap' | 'reliable' | 'fast'>('reliable');

      // Events and disruptions
      const [currentEvent, setCurrentEvent] = useState<{ type: string; message: string; effect: string } | null>(null);
      const [pendingOrders, setPendingOrders] = useState<{ qty: number; arriveDay: number; stage: string }[]>([]);

      // Daily customer demand (varies)
      const [dailyDemand, setDailyDemand] = useState(10);

      const suppliers = {
         cheap: { name: 'Budget Supply Co', cost: 5, reliability: 60, leadTime: 4, icon: 'üí∞' },
         reliable: { name: 'Steady Partners', cost: 10, reliability: 95, leadTime: 2, icon: 'ü§ù' },
         fast: { name: 'Express Logistics', cost: 15, reliability: 80, leadTime: 1, icon: '‚ö°' },
      };

      const events = [
         { type: 'demand_spike', message: 'üìà Viral social media post! Demand doubled!', effect: 'Customer demand increased to 20 units' },
         { type: 'supplier_delay', message: '‚ö†Ô∏è Shipping container stuck at port!', effect: 'All incoming orders delayed by 2 days' },
         { type: 'quality_issue', message: 'üîç Quality inspection failed!', effect: 'Lost 10 units from manufacturer inventory' },
         { type: 'competitor_sale', message: 'üè∑Ô∏è Competitor launched big sale!', effect: 'Customer demand reduced to 5 units' },
         { type: 'fuel_costs', message: '‚õΩ Fuel prices surged!', effect: 'Shipping costs +$200 this round' },
         { type: 'good_news', message: 'üåü Supplier gave bulk discount!', effect: 'Next order costs 50% less' },
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         supplychain: {
            title: 'What is Supply Chain?',
            content: 'A supply chain is the network of all individuals, organizations, resources, activities, and technology involved in creating and selling a product. It spans from raw materials to delivering the final product to customers.'
         },
         leadtime: {
            title: 'Lead Time',
            content: 'Lead time is the delay between placing an order and receiving it. Longer lead times require more safety stock but often cost less. Shorter lead times are more expensive but reduce risk.'
         },
         bullwhip: {
            title: 'Bullwhip Effect',
            content: 'Small changes in customer demand can cause larger and larger fluctuations up the supply chain. A 10% increase at retail might become a 40% swing at the manufacturer level!'
         },
         inventory: {
            title: 'Inventory Management',
            content: 'Holding inventory costs money (storage, insurance, obsolescence) but protects against stockouts. The goal is finding the right balance - not too much, not too little.'
         },
         supplier: {
            title: 'Supplier Selection',
            content: 'Choosing suppliers involves tradeoffs: cheap suppliers may be unreliable, fast suppliers cost more. Diversifying suppliers reduces risk but increases complexity.'
         },
         satisfaction: {
            title: 'Customer Satisfaction',
            content: 'When you cannot fulfill customer demand (stockout), satisfaction drops. Unhappy customers may leave permanently. Maintaining adequate inventory prevents this.'
         }
      };

      const processDay = () => {
         let newLog: string[] = [];
         let costThisRound = 0;

         // Check for random event (30% chance)
         if (Math.random() < 0.3) {
            const event = events[Math.floor(Math.random() * events.length)];
            setCurrentEvent(event);
            newLog.push(`EVENT: ${event.message}`);

            // Apply event effects
            if (event.type === 'demand_spike') setDailyDemand(20);
            if (event.type === 'competitor_sale') setDailyDemand(5);
            if (event.type === 'quality_issue') {
               setStages(prev => prev.map(s => s.id === 'manufacturer' ? { ...s, inventory: Math.max(0, s.inventory - 10) } : s));
            }
            if (event.type === 'fuel_costs') costThisRound += 200;
            if (event.type === 'supplier_delay') {
               setPendingOrders(prev => prev.map(o => ({ ...o, arriveDay: o.arriveDay + 2 })));
            }
         } else {
            setCurrentEvent(null);
            setDailyDemand(10 + Math.floor(Math.random() * 6) - 3); // 7-13 base demand
         }

         // Process arriving orders
         const arrivingOrders = pendingOrders.filter(o => o.arriveDay <= day);
         arrivingOrders.forEach(order => {
            setStages(prev => prev.map(s =>
               s.id === order.stage ? { ...s, inventory: Math.min(s.capacity, s.inventory + order.qty) } : s
            ));
            newLog.push(`üì¶ ${order.qty} units arrived at ${order.stage}`);
         });
         setPendingOrders(prev => prev.filter(o => o.arriveDay > day));

         // Move inventory through the chain (simplified flow)
         setStages(prev => {
            const updated = [...prev];
            for (let i = updated.length - 2; i >= 0; i--) {
               const current = updated[i];
               const next = updated[i + 1];
               const transfer = Math.min(current.inventory, next.capacity - next.inventory, 15);
               if (transfer > 0) {
                  updated[i] = { ...current, inventory: current.inventory - transfer };
                  updated[i + 1] = { ...next, inventory: next.inventory + transfer };
               }
            }
            return updated;
         });

         // Fulfill customer demand from retailer
         const retailer = stages.find(s => s.id === 'retailer')!;
         const fulfilled = Math.min(retailer.inventory, dailyDemand);
         const missed = dailyDemand - fulfilled;

         if (fulfilled > 0) {
            setStages(prev => prev.map(s => s.id === 'retailer' ? { ...s, inventory: s.inventory - fulfilled } : s));
            setOrdersDelivered(prev => prev + fulfilled);
            newLog.push(`‚úÖ Delivered ${fulfilled} units to customers`);
         }

         if (missed > 0) {
            setOrdersMissed(prev => prev + missed);
            setCustomerSatisfaction(prev => Math.max(0, prev - missed * 5));
            newLog.push(`‚ùå Stockout! Missed ${missed} orders. Satisfaction -${missed * 5}%`);
         }

         // Calculate holding costs ($1 per unit per day)
         const holdingCost = stages.reduce((sum, s) => sum + s.inventory, 0);
         costThisRound += holdingCost;

         setTotalCost(prev => prev + costThisRound);
         setMoney(prev => prev - costThisRound + fulfilled * 25); // Revenue per unit
         newLog.push(`üíµ Revenue: +$${fulfilled * 25} | Costs: -$${costThisRound}`);

         setGameLog(prev => [...prev, `--- Day ${day} ---`, ...newLog]);

         if (day >= 10) {
            setPhase('result');
         } else {
            setDay(d => d + 1);
         }
      };

      const placeOrder = () => {
         const supplier = suppliers[selectedSupplier];
         const cost = orderQty * supplier.cost;

         // Check reliability (order might fail)
         const orderSucceeds = Math.random() * 100 < supplier.reliability;

         if (orderSucceeds) {
            setPendingOrders(prev => [...prev, {
               qty: orderQty,
               arriveDay: day + supplier.leadTime,
               stage: 'supplier'
            }]);
            setMoney(prev => prev - cost);
            setTotalCost(prev => prev + cost);
            setGameLog(prev => [...prev, `üìã Ordered ${orderQty} units from ${supplier.name} ($${cost}) - arrives Day ${day + supplier.leadTime}`]);
         } else {
            setGameLog(prev => [...prev, `‚ö†Ô∏è Order from ${supplier.name} FAILED! (Reliability: ${supplier.reliability}%)`]);
         }
      };

      const startGame = () => {
         setPhase('play');
         setDay(1);
         setMoney(10000);
         setCustomerSatisfaction(100);
         setOrdersDelivered(0);
         setOrdersMissed(0);
         setTotalCost(0);
         setGameLog([]);
         setPendingOrders([]);
         setStages([
            { id: 'supplier', name: 'Supplier', icon: 'üåø', inventory: 100, capacity: 200, leadTime: 2 },
            { id: 'manufacturer', name: 'Manufacturer', icon: 'üè≠', inventory: 50, capacity: 100, leadTime: 1 },
            { id: 'warehouse', name: 'Warehouse', icon: 'üì¶', inventory: 30, capacity: 80, leadTime: 1 },
            { id: 'distributor', name: 'Distributor', icon: 'üöö', inventory: 20, capacity: 50, leadTime: 1 },
            { id: 'retailer', name: 'Retailer', icon: 'üè™', inventory: 15, capacity: 30, leadTime: 0 },
         ]);
      };

      const getGameSummary = () => {
         const deliveryRate = ordersDelivered > 0 ? Math.round((ordersDelivered / (ordersDelivered + ordersMissed)) * 100) : 0;
         const profit = money - 10000;
         const score = Math.round((customerSatisfaction * 0.4) + (deliveryRate * 0.4) + (profit > 0 ? 20 : profit > -2000 ? 10 : 0));
         return { deliveryRate, profit, score };
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-800 via-slate-700 to-zinc-800 text-white p-6 overflow-auto">
            <div className="flex justify-between items-start mb-4">
               <div>
                  <h2 className="text-2xl font-black flex items-center gap-2">‚õìÔ∏è SUPPLY CHAIN MANAGEMENT</h2>
                  <p className="text-slate-300 text-sm mt-1">Master the flow from supplier to customer</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all">‚ÑπÔ∏è</button>
            </div>

            {showInfo && (
               <div className="bg-black/40 rounded-xl p-4 mb-4 text-sm border border-slate-500/30">
                  <p className="font-bold text-slate-200 mb-2">üìö What You'll Learn:</p>
                  <ul className="space-y-1 text-slate-300">
                     <li>‚Ä¢ How products flow from raw materials to customers</li>
                     <li>‚Ä¢ The tradeoffs between cost, speed, and reliability</li>
                     <li>‚Ä¢ Why inventory management matters</li>
                     <li>‚Ä¢ How disruptions ripple through a supply chain</li>
                  </ul>
               </div>
            )}

            <div className="flex-1 flex flex-col justify-center">
               {/* Visual supply chain diagram */}
               <div className="bg-black/30 rounded-2xl p-4 mb-6">
                  <p className="text-center text-slate-400 text-xs mb-4 font-bold uppercase tracking-wider">The 5 Stages of Supply Chain</p>
                  <div className="flex justify-between items-center overflow-x-auto pb-2">
                     {[
                        { icon: 'üåø', name: 'Supplier', desc: 'Raw materials' },
                        { icon: 'üè≠', name: 'Manufacturer', desc: 'Production' },
                        { icon: 'üì¶', name: 'Warehouse', desc: 'Storage' },
                        { icon: 'üöö', name: 'Distributor', desc: 'Transport' },
                        { icon: 'üè™', name: 'Retailer', desc: 'Sales' },
                     ].map((stage, i) => (
                        <React.Fragment key={stage.name}>
                           <div className="flex flex-col items-center min-w-[70px]">
                              <div className="w-14 h-14 rounded-xl bg-slate-600/50 flex items-center justify-center text-2xl mb-1">{stage.icon}</div>
                              <span className="text-xs font-bold">{stage.name}</span>
                              <span className="text-[10px] text-slate-400">{stage.desc}</span>
                           </div>
                           {i < 4 && <span className="text-slate-500 mx-1">‚Üí</span>}
                        </React.Fragment>
                     ))}
                  </div>
               </div>

               <div className="text-center mb-6">
                  <h3 className="text-xl font-bold mb-2">üéÆ Your Mission</h3>
                  <p className="text-slate-300 max-w-lg mx-auto">
                     Run a 10-day supply chain simulation. Order inventory, choose suppliers wisely,
                     and handle disruptions to maximize profits and customer satisfaction!
                  </p>
               </div>

               <div className="grid grid-cols-3 gap-3 mb-6 max-w-md mx-auto">
                  <div className="bg-green-900/40 rounded-xl p-3 text-center border border-green-500/30">
                     <span className="text-2xl">üí∞</span>
                     <p className="text-xs font-bold mt-1">Balance Budget</p>
                  </div>
                  <div className="bg-blue-900/40 rounded-xl p-3 text-center border border-blue-500/30">
                     <span className="text-2xl">üòä</span>
                     <p className="text-xs font-bold mt-1">Keep Customers Happy</p>
                  </div>
                  <div className="bg-purple-900/40 rounded-xl p-3 text-center border border-purple-500/30">
                     <span className="text-2xl">üì¶</span>
                     <p className="text-xs font-bold mt-1">Avoid Stockouts</p>
                  </div>
               </div>

               <button onClick={startGame} className="mx-auto px-8 py-4 bg-gradient-to-r from-slate-600 to-zinc-600 hover:from-slate-500 hover:to-zinc-500 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                  START SIMULATION ‚Üí
               </button>
            </div>

            <p className="text-xs text-slate-400/60 text-center mt-4">üí° Tip: Click the ‚ÑπÔ∏è buttons during gameplay for more information on supply chain concepts.</p>
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const { deliveryRate, profit, score } = getGameSummary();
         const grade = score >= 80 ? 'A' : score >= 60 ? 'B' : score >= 40 ? 'C' : 'D';
         const gradeColor = score >= 80 ? 'text-green-400' : score >= 60 ? 'text-blue-400' : score >= 40 ? 'text-yellow-400' : 'text-red-400';

         return (
            <div className="flex flex-col h-full bg-gradient-to-br from-slate-800 via-slate-700 to-zinc-800 text-white p-6 overflow-auto">
               <div className="text-center mb-6">
                  <div className="text-6xl mb-2">{score >= 80 ? 'üèÜ' : score >= 60 ? 'üåü' : score >= 40 ? 'üìä' : 'üìâ'}</div>
                  <h2 className="text-3xl font-black">Simulation Complete!</h2>
                  <p className={`text-5xl font-black mt-2 ${gradeColor}`}>Grade: {grade}</p>
               </div>

               <div className="grid grid-cols-2 gap-4 mb-6 max-w-md mx-auto">
                  <div className="bg-black/30 rounded-xl p-4 text-center">
                     <p className="text-2xl font-black text-green-400">${profit >= 0 ? '+' : ''}{profit}</p>
                     <p className="text-xs text-slate-400">Profit/Loss</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-4 text-center">
                     <p className="text-2xl font-black text-blue-400">{customerSatisfaction}%</p>
                     <p className="text-xs text-slate-400">Satisfaction</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-4 text-center">
                     <p className="text-2xl font-black text-purple-400">{deliveryRate}%</p>
                     <p className="text-xs text-slate-400">Delivery Rate</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-4 text-center">
                     <p className="text-2xl font-black text-amber-400">{ordersDelivered}</p>
                     <p className="text-xs text-slate-400">Orders Delivered</p>
                  </div>
               </div>

               <div className="bg-indigo-900/40 rounded-xl p-4 mb-6 border border-indigo-500/30">
                  <p className="font-bold text-indigo-300 mb-2 flex items-center gap-2">
                     <span className="w-6 h-6 rounded-full bg-indigo-500 flex items-center justify-center text-sm">üí°</span>
                     Key Takeaways
                  </p>
                  <ul className="text-sm text-indigo-200 space-y-1">
                     <li>‚Ä¢ <strong>Buffer stock</strong> protects against demand variability</li>
                     <li>‚Ä¢ <strong>Supplier choice</strong> involves cost-reliability-speed tradeoffs</li>
                     <li>‚Ä¢ <strong>Lead times</strong> mean you must plan orders ahead</li>
                     <li>‚Ä¢ <strong>Disruptions</strong> can cascade through the entire chain</li>
                  </ul>
               </div>

               <div className="bg-black/20 rounded-xl p-3 mb-6 max-h-32 overflow-auto">
                  <p className="text-xs font-bold text-slate-400 mb-2">üìã Session Log (for AI Coach review)</p>
                  <div className="text-xs text-slate-500 space-y-0.5">
                     {gameLog.slice(-10).map((log, i) => <p key={i}>{log}</p>)}
                  </div>
               </div>

               <button onClick={startGame} className="mx-auto px-6 py-3 bg-gradient-to-r from-slate-600 to-zinc-600 hover:from-slate-500 hover:to-zinc-500 rounded-xl font-bold transition-all">
                  üîÑ PLAY AGAIN
               </button>
            </div>
         );
      }

      // PLAY PHASE
      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-slate-800 via-slate-700 to-zinc-800 text-white overflow-hidden">
            {/* Header with metrics */}
            <div className="p-3 bg-black/30 border-b border-slate-600/50">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-lg font-black">üìÖ Day {day} / 10</span>
                  <div className="flex gap-2">
                     <span className="px-3 py-1 bg-green-900/50 rounded-full text-sm font-bold text-green-300">üí∞ ${money}</span>
                     <span className="px-3 py-1 bg-blue-900/50 rounded-full text-sm font-bold text-blue-300">üòä {customerSatisfaction}%</span>
                  </div>
               </div>
               <div className="flex gap-2 text-xs">
                  <span className="text-slate-400">Delivered: {ordersDelivered}</span>
                  <span className="text-slate-500">|</span>
                  <span className="text-slate-400">Missed: {ordersMissed}</span>
                  <span className="text-slate-500">|</span>
                  <span className="text-slate-400">Today's Demand: {dailyDemand}</span>
               </div>
            </div>

            {/* Info modal */}
            {infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={() => setInfoTopic(null)}>
                  <div className="bg-slate-800 rounded-2xl p-6 max-w-md border border-slate-600" onClick={e => e.stopPropagation()}>
                     <h3 className="text-xl font-black mb-2 flex items-center gap-2">
                        ‚ÑπÔ∏è {infoTopics[infoTopic].title}
                     </h3>
                     <p className="text-slate-300 text-sm leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => setInfoTopic(null)} className="mt-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm font-bold w-full">Got it!</button>
                  </div>
               </div>
            )}

            {/* Event notification */}
            {currentEvent && (
               <div className="mx-3 mt-3 p-3 bg-amber-900/50 border border-amber-500/50 rounded-xl animate-pulse">
                  <p className="font-bold text-amber-300">{currentEvent.message}</p>
                  <p className="text-xs text-amber-400/80 mt-1">{currentEvent.effect}</p>
               </div>
            )}

            {/* Supply chain visualization */}
            <div className="flex-1 p-3 overflow-auto">
               <div className="flex items-center gap-1 justify-between mb-4">
                  <p className="text-xs text-slate-400 font-bold uppercase tracking-wider">Supply Chain Inventory</p>
                  <button onClick={() => setInfoTopic('supplychain')} className="text-slate-400 hover:text-white text-sm">‚ÑπÔ∏è</button>
               </div>

               <div className="flex justify-between items-end gap-2 mb-4">
                  {stages.map((stage, i) => (
                     <div key={stage.id} className="flex-1 flex flex-col items-center">
                        <div className="w-full bg-slate-700/50 rounded-lg p-2 mb-1 relative">
                           <div className="text-center text-2xl mb-1">{stage.icon}</div>
                           <div className="h-16 bg-slate-800 rounded relative overflow-hidden">
                              <div
                                 className={`absolute bottom-0 left-0 right-0 transition-all duration-500 ${
                                    stage.inventory < stage.capacity * 0.2 ? 'bg-red-500' :
                                    stage.inventory < stage.capacity * 0.5 ? 'bg-amber-500' : 'bg-green-500'
                                 }`}
                                 style={{ height: `${(stage.inventory / stage.capacity) * 100}%` }}
                              />
                              <div className="absolute inset-0 flex items-center justify-center text-white font-bold text-sm">
                                 {stage.inventory}
                              </div>
                           </div>
                           <p className="text-[10px] text-slate-400 text-center mt-1">{stage.name}</p>
                        </div>
                        {i < stages.length - 1 && <span className="text-slate-600 text-xs">‚Üí</span>}
                     </div>
                  ))}
                  <div className="flex flex-col items-center">
                     <div className="w-12 h-12 rounded-full bg-blue-900/50 flex items-center justify-center text-xl border-2 border-blue-500">üë§</div>
                     <p className="text-[10px] text-slate-400 mt-1">Customer</p>
                  </div>
               </div>

               {/* Order controls */}
               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <div className="flex justify-between items-center mb-3">
                     <p className="font-bold text-sm">üìã Place Order</p>
                     <button onClick={() => setInfoTopic('supplier')} className="text-slate-400 hover:text-white text-sm">‚ÑπÔ∏è</button>
                  </div>

                  <div className="grid grid-cols-3 gap-2 mb-3">
                     {(Object.entries(suppliers) as [string, typeof suppliers.cheap][]).map(([key, sup]) => (
                        <button
                           key={key}
                           onClick={() => setSelectedSupplier(key as 'cheap' | 'reliable' | 'fast')}
                           className={`p-2 rounded-lg text-xs transition-all ${
                              selectedSupplier === key
                                 ? 'bg-slate-600 border-2 border-slate-400'
                                 : 'bg-slate-700/50 border-2 border-transparent hover:border-slate-500'
                           }`}
                        >
                           <div className="text-lg mb-1">{sup.icon}</div>
                           <div className="font-bold truncate">{sup.name}</div>
                           <div className="text-slate-400">
                              ${sup.cost}/u ‚Ä¢ {sup.reliability}% ‚Ä¢ {sup.leadTime}d
                           </div>
                        </button>
                     ))}
                  </div>

                  <div className="flex gap-2 items-center">
                     <div className="flex-1">
                        <label className="text-xs text-slate-400">Quantity: {orderQty}</label>
                        <input
                           type="range"
                           min="5"
                           max="50"
                           value={orderQty}
                           onChange={(e) => setOrderQty(Number(e.target.value))}
                           className="w-full h-2 bg-slate-600 rounded-full accent-slate-400"
                        />
                     </div>
                     <button
                        onClick={placeOrder}
                        disabled={money < orderQty * suppliers[selectedSupplier].cost}
                        className="px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-slate-600 disabled:opacity-50 rounded-lg font-bold text-sm transition-all"
                     >
                        Order (${orderQty * suppliers[selectedSupplier].cost})
                     </button>
                  </div>

                  {pendingOrders.length > 0 && (
                     <div className="mt-2 text-xs text-slate-400">
                        üì¶ Pending: {pendingOrders.map(o => `${o.qty}u (Day ${o.arriveDay})`).join(', ')}
                     </div>
                  )}
               </div>

               {/* Action button */}
               <button
                  onClick={processDay}
                  className="w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 rounded-xl font-bold text-lg transition-all shadow-lg"
               >
                  ‚ñ∂Ô∏è ADVANCE TO {day < 10 ? `DAY ${day + 1}` : 'RESULTS'}
               </button>
            </div>

            {/* Log panel */}
            <div className="h-24 bg-black/40 border-t border-slate-600/50 p-2 overflow-auto">
               <p className="text-[10px] font-bold text-slate-500 mb-1">Activity Log</p>
               <div className="text-xs text-slate-400 space-y-0.5">
                  {gameLog.slice(-5).map((log, i) => <p key={i}>{log}</p>)}
               </div>
            </div>
         </div>
      );
   };

   // ============================================================================
   // INVENTORY MANAGEMENT INTERACTIVE
   // ============================================================================
   const InventoryManagementRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [week, setWeek] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      // Inventory state
      const [inventory, setInventory] = useState(100);
      const [reorderPoint, setReorderPoint] = useState(30);
      const [orderQuantity, setOrderQuantity] = useState(50);
      const [pendingOrder, setPendingOrder] = useState<{ qty: number; arrivesWeek: number } | null>(null);

      // Costs and metrics
      const [totalHoldingCost, setTotalHoldingCost] = useState(0);
      const [totalOrderingCost, setTotalOrderingCost] = useState(0);
      const [totalStockoutCost, setTotalStockoutCost] = useState(0);
      const [totalRevenue, setTotalRevenue] = useState(0);
      const [salesMade, setSalesMade] = useState(0);
      const [salesLost, setSalesLost] = useState(0);

      // Settings
      const [demandVariability, setDemandVariability] = useState<'low' | 'medium' | 'high'>('medium');
      const holdingCostPerUnit = 2; // $ per unit per week
      const orderingCostFixed = 50; // $ per order
      const stockoutCostPerUnit = 15; // $ per lost sale
      const sellingPrice = 25; // $ per unit sold
      const leadTime = 2; // weeks

      const infoTopics: Record<string, { title: string; content: string }> = {
         inventory: {
            title: 'Inventory Management',
            content: 'Inventory management is balancing having enough stock to meet demand without holding too much (which costs money). Too little = lost sales. Too much = wasted storage costs.'
         },
         reorderPoint: {
            title: 'Reorder Point (ROP)',
            content: 'The inventory level at which you place a new order. ROP = (Average Daily Demand √ó Lead Time) + Safety Stock. Set it too low and you risk stockouts; too high and you order too often.'
         },
         eoq: {
            title: 'Economic Order Quantity',
            content: 'EOQ is the optimal order size that minimizes total inventory costs. EOQ = ‚àö(2√óD√óS/H) where D=annual demand, S=ordering cost, H=holding cost. Larger orders mean fewer orders but higher holding costs.'
         },
         holding: {
            title: 'Holding Costs',
            content: 'The cost of storing inventory: warehouse space, insurance, obsolescence, capital tied up. Typically 20-30% of item value per year. Holding too much inventory drains cash!'
         },
         stockout: {
            title: 'Stockout Costs',
            content: 'When you cannot fulfill demand: lost sales revenue, customer dissatisfaction, damaged reputation. Often the highest hidden cost in inventory management!'
         },
         safetyStock: {
            title: 'Safety Stock',
            content: 'Extra inventory held as a buffer against demand variability and supply delays. Higher variability = more safety stock needed. It\'s insurance against stockouts.'
         }
      };

      const getDemand = () => {
         const base = 40;
         const variance = demandVariability === 'low' ? 10 : demandVariability === 'medium' ? 25 : 40;
         return Math.max(5, Math.floor(base + (Math.random() * variance * 2) - variance));
      };

      const processWeek = () => {
         const demand = getDemand();
         let newLog: string[] = [`üìÖ Week ${week}: Demand = ${demand} units`];
         let weekHolding = 0;
         let weekStockout = 0;
         let weekRevenue = 0;

         // Check if order arrives
         if (pendingOrder && pendingOrder.arrivesWeek <= week) {
            setInventory(prev => prev + pendingOrder.qty);
            newLog.push(`üì¶ Order of ${pendingOrder.qty} units arrived!`);
            setPendingOrder(null);
         }

         // Fulfill demand
         const fulfilled = Math.min(inventory, demand);
         const unfulfilled = demand - fulfilled;

         if (fulfilled > 0) {
            setInventory(prev => prev - fulfilled);
            weekRevenue = fulfilled * sellingPrice;
            setTotalRevenue(prev => prev + weekRevenue);
            setSalesMade(prev => prev + fulfilled);
            newLog.push(`‚úÖ Sold ${fulfilled} units (+$${weekRevenue})`);
         }

         if (unfulfilled > 0) {
            weekStockout = unfulfilled * stockoutCostPerUnit;
            setTotalStockoutCost(prev => prev + weekStockout);
            setSalesLost(prev => prev + unfulfilled);
            newLog.push(`‚ùå STOCKOUT! Lost ${unfulfilled} sales (-$${weekStockout} opportunity cost)`);
         }

         // Calculate holding cost on remaining inventory
         const remainingInventory = inventory - fulfilled + (pendingOrder?.arrivesWeek === week ? pendingOrder.qty : 0);
         weekHolding = Math.max(0, remainingInventory) * holdingCostPerUnit;
         setTotalHoldingCost(prev => prev + weekHolding);
         if (weekHolding > 0) {
            newLog.push(`üè≠ Holding cost: -$${weekHolding} (${remainingInventory} units √ó $${holdingCostPerUnit})`);
         }

         // Auto-order if at or below reorder point and no pending order
         const currentInv = inventory - fulfilled;
         if (currentInv <= reorderPoint && !pendingOrder) {
            setPendingOrder({ qty: orderQuantity, arrivesWeek: week + leadTime });
            setTotalOrderingCost(prev => prev + orderingCostFixed);
            newLog.push(`üìã Auto-ordered ${orderQuantity} units (arrives Week ${week + leadTime}) - Order cost: $${orderingCostFixed}`);
         }

         setGameLog(prev => [...prev, ...newLog, '---']);

         if (week >= 12) {
            setPhase('result');
         } else {
            setWeek(w => w + 1);
         }
      };

      const startGame = () => {
         setPhase('play');
         setWeek(1);
         setInventory(100);
         setPendingOrder(null);
         setTotalHoldingCost(0);
         setTotalOrderingCost(0);
         setTotalStockoutCost(0);
         setTotalRevenue(0);
         setSalesMade(0);
         setSalesLost(0);
         setGameLog([]);
      };

      const getScore = () => {
         const totalCosts = totalHoldingCost + totalOrderingCost + totalStockoutCost;
         const profit = totalRevenue - totalCosts;
         const serviceLevel = salesMade > 0 ? Math.round((salesMade / (salesMade + salesLost)) * 100) : 0;
         const score = Math.min(100, Math.max(0, Math.round(serviceLevel * 0.5 + (profit > 0 ? 30 : 0) + (profit > 500 ? 20 : profit > 0 ? 10 : 0))));
         return { totalCosts, profit, serviceLevel, score };
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 text-white p-6 overflow-auto">
            <div className="flex justify-between items-start mb-4">
               <div>
                  <h2 className="text-2xl font-black flex items-center gap-2">üì¶ INVENTORY MANAGEMENT</h2>
                  <p className="text-blue-300 text-sm mt-1">Balance stock levels to maximize profit</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all">‚ÑπÔ∏è</button>
            </div>

            {showInfo && (
               <div className="bg-black/40 rounded-xl p-4 mb-4 text-sm border border-blue-500/30">
                  <p className="font-bold text-blue-200 mb-2">üìö What You'll Learn:</p>
                  <ul className="space-y-1 text-blue-300">
                     <li>‚Ä¢ How to set optimal reorder points</li>
                     <li>‚Ä¢ Balancing holding costs vs stockout costs</li>
                     <li>‚Ä¢ The impact of demand variability</li>
                     <li>‚Ä¢ Why order quantity matters (EOQ concept)</li>
                  </ul>
               </div>
            )}

            <div className="flex-1 flex flex-col justify-center">
               {/* Cost triangle visualization */}
               <div className="bg-black/30 rounded-2xl p-4 mb-6">
                  <p className="text-center text-blue-400 text-xs mb-4 font-bold uppercase tracking-wider">The Inventory Cost Triangle</p>
                  <div className="flex justify-around items-center">
                     <div className="text-center">
                        <div className="w-16 h-16 rounded-full bg-amber-500/30 flex items-center justify-center text-3xl mb-2 mx-auto border-2 border-amber-500">üè≠</div>
                        <p className="text-xs font-bold">Holding Costs</p>
                        <p className="text-[10px] text-blue-400">${holdingCostPerUnit}/unit/week</p>
                     </div>
                     <div className="text-center">
                        <div className="w-16 h-16 rounded-full bg-blue-500/30 flex items-center justify-center text-3xl mb-2 mx-auto border-2 border-blue-500">üìã</div>
                        <p className="text-xs font-bold">Ordering Costs</p>
                        <p className="text-[10px] text-blue-400">${orderingCostFixed}/order</p>
                     </div>
                     <div className="text-center">
                        <div className="w-16 h-16 rounded-full bg-red-500/30 flex items-center justify-center text-3xl mb-2 mx-auto border-2 border-red-500">‚ùå</div>
                        <p className="text-xs font-bold">Stockout Costs</p>
                        <p className="text-[10px] text-blue-400">${stockoutCostPerUnit}/lost sale</p>
                     </div>
                  </div>
               </div>

               <div className="text-center mb-6">
                  <h3 className="text-xl font-bold mb-2">üéÆ Your Mission</h3>
                  <p className="text-blue-300 max-w-lg mx-auto">
                     Run a 12-week inventory simulation. Set your reorder point and order quantity wisely
                     to minimize costs and maximize service level!
                  </p>
               </div>

               <div className="bg-black/20 rounded-xl p-4 mb-6 max-w-md mx-auto">
                  <p className="text-sm font-bold mb-3 text-center">Choose Demand Variability:</p>
                  <div className="grid grid-cols-3 gap-2">
                     {(['low', 'medium', 'high'] as const).map(level => (
                        <button
                           key={level}
                           onClick={() => setDemandVariability(level)}
                           className={`p-3 rounded-lg text-sm font-bold capitalize transition-all ${
                              demandVariability === level
                                 ? 'bg-blue-500 text-white'
                                 : 'bg-white/10 hover:bg-white/20'
                           }`}
                        >
                           {level === 'low' ? 'üìä Low' : level === 'medium' ? 'üìà Medium' : 'üé¢ High'}
                        </button>
                     ))}
                  </div>
                  <p className="text-xs text-blue-400 text-center mt-2">
                     {demandVariability === 'low' ? 'Demand: 30-50 units/week' :
                      demandVariability === 'medium' ? 'Demand: 15-65 units/week' :
                      'Demand: 0-80 units/week (risky!)'}
                  </p>
               </div>

               <button onClick={startGame} className="mx-auto px-8 py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                  START SIMULATION ‚Üí
               </button>
            </div>

            <p className="text-xs text-blue-400/60 text-center mt-4">üí° Tip: Higher variability needs higher safety stock (higher reorder point).</p>
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const { totalCosts, profit, serviceLevel, score } = getScore();
         const grade = score >= 80 ? 'A' : score >= 60 ? 'B' : score >= 40 ? 'C' : 'D';
         const gradeColor = score >= 80 ? 'text-green-400' : score >= 60 ? 'text-blue-400' : score >= 40 ? 'text-yellow-400' : 'text-red-400';

         return (
            <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 text-white p-6 overflow-auto">
               <div className="text-center mb-6">
                  <div className="text-6xl mb-2">{score >= 80 ? 'üèÜ' : score >= 60 ? 'üì¶' : score >= 40 ? 'üìä' : 'üìâ'}</div>
                  <h2 className="text-3xl font-black">Simulation Complete!</h2>
                  <p className={`text-5xl font-black mt-2 ${gradeColor}`}>Grade: {grade}</p>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4 max-w-md mx-auto">
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-green-400">${totalRevenue}</p>
                     <p className="text-xs text-blue-300">Revenue</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className={`text-xl font-black ${profit >= 0 ? 'text-green-400' : 'text-red-400'}`}>${profit >= 0 ? '+' : ''}{profit}</p>
                     <p className="text-xs text-blue-300">Net Profit</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-purple-400">{serviceLevel}%</p>
                     <p className="text-xs text-blue-300">Service Level</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-amber-400">${totalCosts}</p>
                     <p className="text-xs text-blue-300">Total Costs</p>
                  </div>
               </div>

               <div className="bg-black/20 rounded-xl p-3 mb-4 max-w-md mx-auto">
                  <p className="text-xs font-bold text-blue-400 mb-2">Cost Breakdown:</p>
                  <div className="grid grid-cols-3 gap-2 text-center text-xs">
                     <div><span className="text-amber-400">${totalHoldingCost}</span><br/>Holding</div>
                     <div><span className="text-blue-400">${totalOrderingCost}</span><br/>Ordering</div>
                     <div><span className="text-red-400">${totalStockoutCost}</span><br/>Stockouts</div>
                  </div>
               </div>

               <div className="bg-indigo-900/40 rounded-xl p-4 mb-4 border border-indigo-500/30">
                  <p className="font-bold text-indigo-300 mb-2 flex items-center gap-2">
                     <span className="w-6 h-6 rounded-full bg-indigo-500 flex items-center justify-center text-sm">üí°</span>
                     Key Takeaways
                  </p>
                  <ul className="text-sm text-indigo-200 space-y-1">
                     <li>‚Ä¢ <strong>Reorder Point</strong> should cover demand during lead time + safety buffer</li>
                     <li>‚Ä¢ <strong>Order Quantity</strong> balances ordering cost vs holding cost</li>
                     <li>‚Ä¢ <strong>Safety Stock</strong> protects against demand variability</li>
                     <li>‚Ä¢ <strong>Stockouts</strong> are often more costly than holding extra inventory</li>
                  </ul>
               </div>

               <div className="bg-black/20 rounded-xl p-3 mb-4 max-h-24 overflow-auto">
                  <p className="text-xs font-bold text-blue-400 mb-1">üìã Session Log</p>
                  <div className="text-xs text-blue-300/70 space-y-0.5">
                     {gameLog.slice(-8).map((log, i) => <p key={i}>{log}</p>)}
                  </div>
               </div>

               <button onClick={startGame} className="mx-auto px-6 py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 rounded-xl font-bold transition-all">
                  üîÑ PLAY AGAIN
               </button>
            </div>
         );
      }

      // PLAY PHASE
      const currentInventory = inventory + (pendingOrder?.arrivesWeek === week ? pendingOrder.qty : 0);
      const inventoryStatus = currentInventory < 20 ? 'critical' : currentInventory < 50 ? 'warning' : 'healthy';

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 text-white overflow-hidden">
            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-blue-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-lg font-black">üìÖ Week {week} / 12</span>
                  <div className="flex gap-2">
                     <span className="px-3 py-1 bg-green-900/50 rounded-full text-sm font-bold text-green-300">üí∞ ${totalRevenue - totalHoldingCost - totalOrderingCost - totalStockoutCost}</span>
                  </div>
               </div>
               <div className="flex gap-3 text-xs">
                  <span className="text-blue-300">Sales: {salesMade}</span>
                  <span className="text-blue-500">|</span>
                  <span className="text-red-300">Lost: {salesLost}</span>
                  <span className="text-blue-500">|</span>
                  <span className="text-amber-300">Holding: ${totalHoldingCost}</span>
               </div>
            </div>

            {/* Info modal */}
            {infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={() => setInfoTopic(null)}>
                  <div className="bg-indigo-900 rounded-2xl p-6 max-w-md border border-indigo-500" onClick={e => e.stopPropagation()}>
                     <h3 className="text-xl font-black mb-2 flex items-center gap-2">‚ÑπÔ∏è {infoTopics[infoTopic].title}</h3>
                     <p className="text-blue-200 text-sm leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => setInfoTopic(null)} className="mt-4 px-4 py-2 bg-indigo-700 hover:bg-indigo-600 rounded-lg text-sm font-bold w-full">Got it!</button>
                  </div>
               </div>
            )}

            <div className="flex-1 p-4 overflow-auto">
               {/* Inventory visualization */}
               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <div className="flex justify-between items-center mb-3">
                     <p className="font-bold text-sm">üì¶ Current Inventory</p>
                     <button onClick={() => setInfoTopic('inventory')} className="text-blue-400 hover:text-white text-sm">‚ÑπÔ∏è</button>
                  </div>

                  <div className="relative h-20 bg-black/40 rounded-lg overflow-hidden mb-2">
                     {/* Reorder point line */}
                     <div
                        className="absolute top-0 bottom-0 w-0.5 bg-yellow-500 z-10"
                        style={{ left: `${Math.min(100, (reorderPoint / 150) * 100)}%` }}
                     >
                        <span className="absolute -top-5 left-1 text-[10px] text-yellow-400 whitespace-nowrap">ROP: {reorderPoint}</span>
                     </div>

                     {/* Inventory bar */}
                     <div
                        className={`absolute bottom-0 left-0 h-full transition-all duration-500 ${
                           inventoryStatus === 'critical' ? 'bg-gradient-to-t from-red-600 to-red-400' :
                           inventoryStatus === 'warning' ? 'bg-gradient-to-t from-amber-600 to-amber-400' :
                           'bg-gradient-to-t from-green-600 to-green-400'
                        }`}
                        style={{ width: `${Math.min(100, (inventory / 150) * 100)}%` }}
                     />

                     {/* Inventory number */}
                     <div className="absolute inset-0 flex items-center justify-center text-3xl font-black text-white drop-shadow-lg">
                        {inventory}
                     </div>
                  </div>

                  <div className="flex justify-between text-xs text-blue-400">
                     <span>0</span>
                     <span>Max: 150</span>
                  </div>

                  {pendingOrder && (
                     <div className="mt-3 p-2 bg-blue-500/20 rounded-lg text-sm text-center border border-blue-500/30">
                        üöö Order of {pendingOrder.qty} units arriving Week {pendingOrder.arrivesWeek}
                     </div>
                  )}
               </div>

               {/* Controls */}
               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <div className="flex justify-between items-center mb-3">
                     <p className="font-bold text-sm">‚öôÔ∏è Inventory Settings</p>
                     <button onClick={() => setInfoTopic('reorderPoint')} className="text-blue-400 hover:text-white text-sm">‚ÑπÔ∏è</button>
                  </div>

                  <div className="space-y-4">
                     <div>
                        <div className="flex justify-between text-sm mb-1">
                           <span>Reorder Point (ROP)</span>
                           <span className="font-bold text-yellow-400">{reorderPoint} units</span>
                        </div>
                        <input
                           type="range"
                           min="10"
                           max="80"
                           value={reorderPoint}
                           onChange={(e) => setReorderPoint(Number(e.target.value))}
                           className="w-full h-2 bg-blue-900 rounded-full accent-yellow-500"
                        />
                        <p className="text-xs text-blue-400 mt-1">Auto-order triggers when inventory ‚â§ {reorderPoint}</p>
                     </div>

                     <div>
                        <div className="flex justify-between text-sm mb-1">
                           <span>Order Quantity (EOQ)</span>
                           <span className="font-bold text-blue-400">{orderQuantity} units</span>
                        </div>
                        <input
                           type="range"
                           min="20"
                           max="100"
                           value={orderQuantity}
                           onChange={(e) => setOrderQuantity(Number(e.target.value))}
                           className="w-full h-2 bg-blue-900 rounded-full accent-blue-500"
                        />
                        <p className="text-xs text-blue-400 mt-1">Order cost: ${orderingCostFixed} + holding at ${holdingCostPerUnit}/unit/week</p>
                     </div>
                  </div>
               </div>

               {/* Action button */}
               <button
                  onClick={processWeek}
                  className="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 rounded-xl font-bold text-lg transition-all shadow-lg"
               >
                  ‚ñ∂Ô∏è SIMULATE WEEK {week}
               </button>
            </div>

            {/* Log panel */}
            <div className="h-24 bg-black/40 border-t border-blue-500/30 p-2 overflow-auto">
               <p className="text-[10px] font-bold text-blue-500 mb-1">Activity Log</p>
               <div className="text-xs text-blue-300 space-y-0.5">
                  {gameLog.slice(-5).map((log, i) => <p key={i}>{log}</p>)}
               </div>
            </div>
         </div>
      );
   };

   // ============================================================================
   // OUTSOURCING DECISIONS INTERACTIVE
   // ============================================================================
   const OutsourcingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [currentTask, setCurrentTask] = useState(0);
      const [gameLog, setGameLog] = useState<string[]>([]);

      // Business metrics
      const [budget, setBudget] = useState(100000);
      const [qualityScore, setQualityScore] = useState(80);
      const [controlScore, setControlScore] = useState(100);
      const [velocity, setVelocity] = useState(50);

      // Decisions made
      const [decisions, setDecisions] = useState<{ task: string; choice: 'inhouse' | 'outsource'; cost: number; impact: string }[]>([]);

      const tasks = [
         {
            name: 'Software Development',
            icon: 'üíª',
            isCore: true,
            inhouse: { cost: 80000, quality: 90, control: 100, velocity: 40, time: '6 months' },
            outsource: { cost: 40000, quality: 75, control: 50, velocity: 80, time: '3 months' },
            insight: 'Core competency - outsourcing risks losing competitive advantage'
         },
         {
            name: 'Accounting & Bookkeeping',
            icon: 'üìä',
            isCore: false,
            inhouse: { cost: 50000, quality: 85, control: 100, velocity: 50, time: 'Ongoing' },
            outsource: { cost: 15000, quality: 90, control: 70, velocity: 90, time: 'Ongoing' },
            insight: 'Non-core - specialists often do it better and cheaper'
         },
         {
            name: 'Customer Support',
            icon: 'üéß',
            isCore: true,
            inhouse: { cost: 60000, quality: 95, control: 100, velocity: 60, time: 'Ongoing' },
            outsource: { cost: 25000, quality: 70, control: 40, velocity: 85, time: 'Ongoing' },
            insight: 'Customer-facing - quality matters more than cost'
         },
         {
            name: 'Logo & Brand Design',
            icon: 'üé®',
            isCore: false,
            inhouse: { cost: 30000, quality: 75, control: 100, velocity: 30, time: '2 months' },
            outsource: { cost: 5000, quality: 90, control: 60, velocity: 95, time: '2 weeks' },
            insight: 'One-time project - perfect for freelancers/agencies'
         },
         {
            name: 'Legal Services',
            icon: '‚öñÔ∏è',
            isCore: false,
            inhouse: { cost: 120000, quality: 85, control: 100, velocity: 50, time: 'Ongoing' },
            outsource: { cost: 20000, quality: 95, control: 80, velocity: 90, time: 'As needed' },
            insight: 'Specialized expertise - outsource unless you\'re a law firm'
         },
         {
            name: 'Marketing Campaigns',
            icon: 'üì¢',
            isCore: true,
            inhouse: { cost: 70000, quality: 80, control: 100, velocity: 50, time: 'Ongoing' },
            outsource: { cost: 35000, quality: 85, control: 60, velocity: 80, time: 'Ongoing' },
            insight: 'Mix works best - keep strategy in-house, outsource execution'
         },
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         outsourcing: {
            title: 'What is Outsourcing?',
            content: 'Outsourcing means hiring external companies or freelancers to handle business functions instead of doing them in-house. It can reduce costs and provide access to specialized skills.'
         },
         core: {
            title: 'Core vs Non-Core',
            content: 'Core activities are central to your competitive advantage (what makes you unique). Non-core activities are necessary but don\'t differentiate you. Generally, keep core in-house and consider outsourcing non-core.'
         },
         tradeoffs: {
            title: 'Outsourcing Tradeoffs',
            content: 'Outsourcing saves money and time but reduces control and may affect quality. You also become dependent on vendors. Consider: cost savings, expertise access, focus on core business, but also communication overhead and quality risks.'
         },
         control: {
            title: 'Control & Quality',
            content: 'In-house teams give you full control over quality, priorities, and processes. Outsourced work requires clear contracts, communication, and quality checks. The further from your core, the less control matters.'
         },
         velocity: {
            title: 'Speed to Market',
            content: 'Outsourcing can dramatically speed up delivery - agencies have ready teams and processes. But coordination takes time. For one-time projects, outsourcing is often faster. For ongoing work, in-house builds momentum.'
         },
         dependency: {
            title: 'Vendor Dependency',
            content: 'Over-relying on vendors creates risk: they might raise prices, reduce quality, or go out of business. Diversify vendors for critical functions and keep core competencies in-house.'
         }
      };

      const makeDecision = (choice: 'inhouse' | 'outsource') => {
         const task = tasks[currentTask];
         const option = choice === 'inhouse' ? task.inhouse : task.outsource;

         // Apply effects
         setBudget(prev => prev - option.cost);
         setQualityScore(prev => Math.round((prev + option.quality) / 2));
         setControlScore(prev => Math.round((prev + option.control) / 2));
         setVelocity(prev => Math.round((prev + option.velocity) / 2));

         // Log decision
         const impact = choice === 'inhouse'
            ? `Kept in-house: Full control, higher cost`
            : `Outsourced: Cost savings of $${task.inhouse.cost - task.outsource.cost}`;

         setDecisions(prev => [...prev, {
            task: task.name,
            choice,
            cost: option.cost,
            impact
         }]);

         setGameLog(prev => [...prev,
            `${task.icon} ${task.name}: ${choice === 'inhouse' ? 'IN-HOUSE' : 'OUTSOURCED'}`,
            `   Cost: $${option.cost.toLocaleString()} | Quality: ${option.quality}% | Control: ${option.control}%`,
            `   üí° ${task.insight}`
         ]);

         if (currentTask < tasks.length - 1) {
            setCurrentTask(prev => prev + 1);
         } else {
            setPhase('result');
         }
      };

      const startGame = () => {
         setPhase('play');
         setCurrentTask(0);
         setBudget(100000);
         setQualityScore(80);
         setControlScore(100);
         setVelocity(50);
         setDecisions([]);
         setGameLog([]);
      };

      const getScore = () => {
         const budgetRemaining = budget;
         const outsourcedCount = decisions.filter(d => d.choice === 'outsource').length;
         const coreOutsourced = decisions.filter(d => d.choice === 'outsource' && tasks.find(t => t.name === d.task)?.isCore).length;

         // Score based on balanced approach
         let score = 50;
         if (budgetRemaining > 0) score += 20;
         if (qualityScore >= 80) score += 15;
         if (controlScore >= 60) score += 10;
         if (coreOutsourced === 0) score += 15; // Bonus for keeping core in-house
         if (outsourcedCount >= 2 && outsourcedCount <= 4) score += 10; // Balanced approach

         return { score: Math.min(100, score), budgetRemaining, outsourcedCount, coreOutsourced };
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-teal-900 via-cyan-900 to-blue-900 text-white p-6 overflow-auto">
            <div className="flex justify-between items-start mb-4">
               <div>
                  <h2 className="text-2xl font-black flex items-center gap-2">ü§ù OUTSOURCING DECISIONS</h2>
                  <p className="text-teal-300 text-sm mt-1">Build vs Buy: Strategic resource allocation</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all">‚ÑπÔ∏è</button>
            </div>

            {showInfo && (
               <div className="bg-black/40 rounded-xl p-4 mb-4 text-sm border border-teal-500/30">
                  <p className="font-bold text-teal-200 mb-2">üìö What You'll Learn:</p>
                  <ul className="space-y-1 text-teal-300">
                     <li>‚Ä¢ When to outsource vs keep in-house</li>
                     <li>‚Ä¢ Core vs non-core business activities</li>
                     <li>‚Ä¢ Cost, quality, and control tradeoffs</li>
                     <li>‚Ä¢ Strategic resource allocation</li>
                  </ul>
               </div>
            )}

            <div className="flex-1 flex flex-col justify-center">
               {/* Decision framework visualization */}
               <div className="bg-black/30 rounded-2xl p-4 mb-6">
                  <p className="text-center text-teal-400 text-xs mb-4 font-bold uppercase tracking-wider">The Outsourcing Decision Matrix</p>
                  <div className="grid grid-cols-2 gap-3">
                     <div className="bg-green-900/40 rounded-xl p-3 border border-green-500/30">
                        <p className="font-bold text-green-400 text-sm mb-1">üè† Keep In-House</p>
                        <ul className="text-xs text-green-300 space-y-1">
                           <li>‚úì Core competencies</li>
                           <li>‚úì Competitive advantage</li>
                           <li>‚úì Need full control</li>
                        </ul>
                     </div>
                     <div className="bg-blue-900/40 rounded-xl p-3 border border-blue-500/30">
                        <p className="font-bold text-blue-400 text-sm mb-1">üåê Outsource</p>
                        <ul className="text-xs text-blue-300 space-y-1">
                           <li>‚úì Non-core activities</li>
                           <li>‚úì Need specialized skills</li>
                           <li>‚úì One-time projects</li>
                        </ul>
                     </div>
                  </div>
               </div>

               <div className="text-center mb-6">
                  <h3 className="text-xl font-bold mb-2">üéÆ Your Mission</h3>
                  <p className="text-teal-300 max-w-lg mx-auto">
                     You're a startup founder with $100,000. Decide which business functions
                     to outsource and which to keep in-house. Balance cost, quality, and control!
                  </p>
               </div>

               <div className="grid grid-cols-4 gap-2 mb-6 max-w-md mx-auto text-center">
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">üí∞</span>
                     <p className="text-[10px] text-teal-400">$100K Budget</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">‚≠ê</span>
                     <p className="text-[10px] text-teal-400">Quality</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">üéÆ</span>
                     <p className="text-[10px] text-teal-400">Control</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">‚ö°</span>
                     <p className="text-[10px] text-teal-400">Speed</p>
                  </div>
               </div>

               <button onClick={startGame} className="mx-auto px-8 py-4 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-500 hover:to-cyan-500 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                  START DECISIONS ‚Üí
               </button>
            </div>

            <p className="text-xs text-teal-400/60 text-center mt-4">üí° Tip: Focus on keeping core competencies in-house while outsourcing non-core activities.</p>
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const { score, budgetRemaining, outsourcedCount, coreOutsourced } = getScore();
         const grade = score >= 80 ? 'A' : score >= 60 ? 'B' : score >= 40 ? 'C' : 'D';
         const gradeColor = score >= 80 ? 'text-green-400' : score >= 60 ? 'text-blue-400' : score >= 40 ? 'text-yellow-400' : 'text-red-400';

         return (
            <div className="flex flex-col h-full bg-gradient-to-br from-teal-900 via-cyan-900 to-blue-900 text-white p-6 overflow-auto">
               <div className="text-center mb-6">
                  <div className="text-6xl mb-2">{score >= 80 ? 'üèÜ' : score >= 60 ? 'ü§ù' : score >= 40 ? 'üìä' : '‚ö†Ô∏è'}</div>
                  <h2 className="text-3xl font-black">Decisions Complete!</h2>
                  <p className={`text-5xl font-black mt-2 ${gradeColor}`}>Grade: {grade}</p>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4 max-w-md mx-auto">
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className={`text-xl font-black ${budgetRemaining >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                        ${budgetRemaining.toLocaleString()}
                     </p>
                     <p className="text-xs text-teal-300">Budget Remaining</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-purple-400">{qualityScore}%</p>
                     <p className="text-xs text-teal-300">Avg Quality</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-blue-400">{controlScore}%</p>
                     <p className="text-xs text-teal-300">Control Level</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-amber-400">{outsourcedCount}/{tasks.length}</p>
                     <p className="text-xs text-teal-300">Outsourced</p>
                  </div>
               </div>

               {coreOutsourced > 0 && (
                  <div className="bg-red-900/40 rounded-xl p-3 mb-4 border border-red-500/30 text-center">
                     <p className="text-red-300 text-sm">‚ö†Ô∏è You outsourced {coreOutsourced} core function(s) - this may hurt competitive advantage!</p>
                  </div>
               )}

               <div className="bg-teal-900/40 rounded-xl p-4 mb-4 border border-teal-500/30">
                  <p className="font-bold text-teal-300 mb-2 flex items-center gap-2">
                     <span className="w-6 h-6 rounded-full bg-teal-500 flex items-center justify-center text-sm">üí°</span>
                     Key Takeaways
                  </p>
                  <ul className="text-sm text-teal-200 space-y-1">
                     <li>‚Ä¢ <strong>Core activities</strong> should usually stay in-house</li>
                     <li>‚Ä¢ <strong>Non-core activities</strong> are great outsourcing candidates</li>
                     <li>‚Ä¢ <strong>One-time projects</strong> often benefit from outsourcing</li>
                     <li>‚Ä¢ Balance <strong>cost savings</strong> with <strong>quality and control</strong></li>
                  </ul>
               </div>

               <div className="bg-black/20 rounded-xl p-3 mb-4 max-h-28 overflow-auto">
                  <p className="text-xs font-bold text-teal-400 mb-1">üìã Decision Summary</p>
                  <div className="text-xs text-teal-300/70 space-y-0.5">
                     {decisions.map((d, i) => (
                        <p key={i}>{d.choice === 'inhouse' ? 'üè†' : 'üåê'} {d.task}: ${d.cost.toLocaleString()}</p>
                     ))}
                  </div>
               </div>

               <button onClick={startGame} className="mx-auto px-6 py-3 bg-gradient-to-r from-teal-600 to-cyan-600 hover:from-teal-500 hover:to-cyan-500 rounded-xl font-bold transition-all">
                  üîÑ PLAY AGAIN
               </button>
            </div>
         );
      }

      // PLAY PHASE
      const task = tasks[currentTask];

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-teal-900 via-cyan-900 to-blue-900 text-white overflow-hidden">
            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-teal-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-lg font-black">Decision {currentTask + 1} / {tasks.length}</span>
                  <span className={`px-3 py-1 rounded-full text-sm font-bold ${budget >= 0 ? 'bg-green-900/50 text-green-300' : 'bg-red-900/50 text-red-300'}`}>
                     üí∞ ${budget.toLocaleString()}
                  </span>
               </div>
               <div className="flex gap-3 text-xs">
                  <span className="text-purple-300">Quality: {qualityScore}%</span>
                  <span className="text-teal-500">|</span>
                  <span className="text-blue-300">Control: {controlScore}%</span>
                  <span className="text-teal-500">|</span>
                  <span className="text-amber-300">Speed: {velocity}%</span>
               </div>
            </div>

            {/* Info modal */}
            {infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={() => setInfoTopic(null)}>
                  <div className="bg-teal-900 rounded-2xl p-6 max-w-md border border-teal-500" onClick={e => e.stopPropagation()}>
                     <h3 className="text-xl font-black mb-2 flex items-center gap-2">‚ÑπÔ∏è {infoTopics[infoTopic].title}</h3>
                     <p className="text-teal-200 text-sm leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => setInfoTopic(null)} className="mt-4 px-4 py-2 bg-teal-700 hover:bg-teal-600 rounded-lg text-sm font-bold w-full">Got it!</button>
                  </div>
               </div>
            )}

            <div className="flex-1 p-4 overflow-auto">
               {/* Current task */}
               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <div className="flex justify-between items-start mb-3">
                     <div className="flex items-center gap-3">
                        <span className="text-4xl">{task.icon}</span>
                        <div>
                           <h3 className="text-xl font-black">{task.name}</h3>
                           <span className={`text-xs px-2 py-0.5 rounded-full ${task.isCore ? 'bg-amber-500/30 text-amber-300' : 'bg-teal-500/30 text-teal-300'}`}>
                              {task.isCore ? '‚≠ê Core Activity' : 'üì¶ Non-Core'}
                           </span>
                        </div>
                     </div>
                     <button onClick={() => setInfoTopic('core')} className="text-teal-400 hover:text-white">‚ÑπÔ∏è</button>
                  </div>
               </div>

               {/* Options comparison */}
               <div className="grid grid-cols-2 gap-3 mb-4">
                  {/* In-House Option */}
                  <button
                     onClick={() => makeDecision('inhouse')}
                     className="bg-green-900/30 hover:bg-green-900/50 border-2 border-green-500/30 hover:border-green-500 rounded-xl p-4 text-left transition-all"
                  >
                     <div className="flex items-center gap-2 mb-3">
                        <span className="text-2xl">üè†</span>
                        <span className="font-bold text-green-400">IN-HOUSE</span>
                     </div>
                     <div className="space-y-2 text-sm">
                        <div className="flex justify-between">
                           <span className="text-teal-400">Cost:</span>
                           <span className="font-bold text-red-400">${task.inhouse.cost.toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between">
                           <span className="text-teal-400">Quality:</span>
                           <span className="font-bold text-green-400">{task.inhouse.quality}%</span>
                        </div>
                        <div className="flex justify-between">
                           <span className="text-teal-400">Control:</span>
                           <span className="font-bold text-blue-400">{task.inhouse.control}%</span>
                        </div>
                        <div className="flex justify-between">
                           <span className="text-teal-400">Speed:</span>
                           <span className="font-bold text-amber-400">{task.inhouse.velocity}%</span>
                        </div>
                        <div className="text-xs text-teal-500 mt-2">‚è±Ô∏è {task.inhouse.time}</div>
                     </div>
                  </button>

                  {/* Outsource Option */}
                  <button
                     onClick={() => makeDecision('outsource')}
                     className="bg-blue-900/30 hover:bg-blue-900/50 border-2 border-blue-500/30 hover:border-blue-500 rounded-xl p-4 text-left transition-all"
                  >
                     <div className="flex items-center gap-2 mb-3">
                        <span className="text-2xl">üåê</span>
                        <span className="font-bold text-blue-400">OUTSOURCE</span>
                     </div>
                     <div className="space-y-2 text-sm">
                        <div className="flex justify-between">
                           <span className="text-teal-400">Cost:</span>
                           <span className="font-bold text-green-400">${task.outsource.cost.toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between">
                           <span className="text-teal-400">Quality:</span>
                           <span className="font-bold">{task.outsource.quality}%</span>
                        </div>
                        <div className="flex justify-between">
                           <span className="text-teal-400">Control:</span>
                           <span className="font-bold text-amber-400">{task.outsource.control}%</span>
                        </div>
                        <div className="flex justify-between">
                           <span className="text-teal-400">Speed:</span>
                           <span className="font-bold text-green-400">{task.outsource.velocity}%</span>
                        </div>
                        <div className="text-xs text-teal-500 mt-2">‚è±Ô∏è {task.outsource.time}</div>
                     </div>
                  </button>
               </div>

               {/* Savings indicator */}
               <div className="bg-black/20 rounded-lg p-3 text-center">
                  <p className="text-sm text-teal-400">
                     üí° Outsourcing saves <span className="font-bold text-green-400">${(task.inhouse.cost - task.outsource.cost).toLocaleString()}</span>
                     {task.isCore && <span className="text-amber-400"> (but this is a core activity!)</span>}
                  </p>
               </div>
            </div>

            {/* Previous decisions */}
            {decisions.length > 0 && (
               <div className="h-20 bg-black/40 border-t border-teal-500/30 p-2 overflow-auto">
                  <p className="text-[10px] font-bold text-teal-500 mb-1">Previous Decisions</p>
                  <div className="flex gap-2 flex-wrap">
                     {decisions.map((d, i) => (
                        <span key={i} className={`text-xs px-2 py-1 rounded ${d.choice === 'inhouse' ? 'bg-green-900/50 text-green-300' : 'bg-blue-900/50 text-blue-300'}`}>
                           {d.choice === 'inhouse' ? 'üè†' : 'üåê'} {d.task.split(' ')[0]}
                        </span>
                     ))}
                  </div>
               </div>
            )}
         </div>
      );
   };

   // ============================================================================
   // HIRING & TEAM CULTURE INTERACTIVE
   // ============================================================================
   const HiringRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'values' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [currentCandidate, setCurrentCandidate] = useState(0);
      const [gameLog, setGameLog] = useState<string[]>([]);

      // Company values (player selects 3)
      const [selectedValues, setSelectedValues] = useState<string[]>([]);
      const allValues = [
         { id: 'innovation', name: 'Innovation', icon: 'üí°', desc: 'Push boundaries, embrace new ideas' },
         { id: 'speed', name: 'Speed', icon: '‚ö°', desc: 'Move fast, iterate quickly' },
         { id: 'quality', name: 'Quality', icon: '‚ú®', desc: 'Excellence in everything we do' },
         { id: 'teamwork', name: 'Teamwork', icon: 'ü§ù', desc: 'Collaborate and support each other' },
         { id: 'transparency', name: 'Transparency', icon: 'üîç', desc: 'Open communication, no secrets' },
         { id: 'customer', name: 'Customer Focus', icon: '‚ù§Ô∏è', desc: 'Customer success is our success' },
      ];

      // Team and budget
      const [team, setTeam] = useState<{ name: string; role: string; skills: number; culture: number }[]>([]);
      const [budget, setBudget] = useState(300000);
      const [cultureScore, setCultureScore] = useState(100);
      const [productivityScore, setProductivityScore] = useState(50);

      // Candidates
      const candidates = [
         {
            name: 'Alex Chen',
            role: 'Lead Developer',
            avatar: 'üë®‚Äçüíª',
            salary: 120000,
            skills: 95,
            experience: 8,
            cultureFit: { innovation: 90, speed: 85, quality: 70, teamwork: 60, transparency: 75, customer: 65 },
            personality: 'Brilliant coder but prefers working alone. Strong opinions.',
            redFlag: 'May clash with collaborative culture',
            greenFlag: 'Technical excellence, can build anything'
         },
         {
            name: 'Sarah Miller',
            role: 'Product Manager',
            avatar: 'üë©‚Äçüíº',
            salary: 100000,
            skills: 80,
            experience: 5,
            cultureFit: { innovation: 85, speed: 90, quality: 80, teamwork: 95, transparency: 90, customer: 95 },
            personality: 'Great communicator, customer-obsessed. Still growing technically.',
            redFlag: 'Less experienced than other candidates',
            greenFlag: 'Culture carrier, team player'
         },
         {
            name: 'Marcus Johnson',
            role: 'Sales Lead',
            avatar: 'üë®‚Äçüíº',
            salary: 90000,
            skills: 85,
            experience: 10,
            cultureFit: { innovation: 50, speed: 95, quality: 60, teamwork: 70, transparency: 40, customer: 90 },
            personality: 'Hits targets consistently. Very competitive, sometimes cuts corners.',
            redFlag: 'May prioritize results over process',
            greenFlag: 'Revenue driver, closes deals'
         },
         {
            name: 'Emily Park',
            role: 'Designer',
            avatar: 'üë©‚Äçüé®',
            salary: 85000,
            skills: 90,
            experience: 4,
            cultureFit: { innovation: 95, speed: 70, quality: 95, teamwork: 85, transparency: 80, customer: 85 },
            personality: 'Creative visionary. Takes time to perfect designs.',
            redFlag: 'May slow down fast-paced sprints',
            greenFlag: 'Exceptional design quality'
         },
         {
            name: 'David Kim',
            role: 'Operations',
            avatar: 'üë®‚Äçüîß',
            salary: 75000,
            skills: 75,
            experience: 6,
            cultureFit: { innovation: 60, speed: 80, quality: 90, teamwork: 90, transparency: 95, customer: 80 },
            personality: 'Reliable, process-oriented. Keeps everything running smoothly.',
            redFlag: 'Less innovative, prefers proven methods',
            greenFlag: 'Stability, operational excellence'
         },
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         culture: {
            title: 'Company Culture',
            content: 'Culture is the shared values, beliefs, and behaviors that define how your team works together. Your first 10 hires define your culture forever. Culture fit doesn\'t mean hiring clones - it means shared values with diverse perspectives.'
         },
         skills: {
            title: 'Skills vs Culture Fit',
            content: 'A common debate: hire for skills or culture? Best practice: Set a skills threshold (must be competent), then optimize for culture fit. You can train skills, but changing someone\'s values is nearly impossible.'
         },
         early: {
            title: 'Early Hires Matter',
            content: 'Your first employees set the tone. They\'ll help hire the next batch, so their standards become your company\'s standards. One toxic early hire can poison the entire culture.'
         },
         slow: {
            title: 'Hire Slow, Fire Fast',
            content: 'Take time to evaluate candidates thoroughly - a bad hire costs 2-3x their salary in lost productivity and rehiring. But once you\'ve identified a poor fit, act quickly to protect the team.'
         },
         diverse: {
            title: 'Diverse Teams',
            content: 'Diversity of thought, background, and experience leads to better decisions and innovation. Culture fit ‚â† same background. Look for shared values with different perspectives.'
         },
         values: {
            title: 'Core Values',
            content: 'Values are your decision-making framework. When facing tough choices, values guide you. They should be specific enough to matter (not just "be good") and used in actual decisions.'
         }
      };

      const calculateCultureFit = (candidate: typeof candidates[0]) => {
         if (selectedValues.length === 0) return 50;
         const sum = selectedValues.reduce((acc, val) => acc + (candidate.cultureFit[val as keyof typeof candidate.cultureFit] || 50), 0);
         return Math.round(sum / selectedValues.length);
      };

      const hireCandidate = (hire: boolean) => {
         const candidate = candidates[currentCandidate];
         const cultureFit = calculateCultureFit(candidate);

         if (hire) {
            if (budget < candidate.salary) {
               setGameLog(prev => [...prev, `‚ùå Cannot afford ${candidate.name} ($${candidate.salary.toLocaleString()})`]);
               return;
            }

            setBudget(prev => prev - candidate.salary);
            setTeam(prev => [...prev, { name: candidate.name, role: candidate.role, skills: candidate.skills, culture: cultureFit }]);

            // Update scores
            const newCulture = Math.round((cultureScore + cultureFit) / 2);
            const newProductivity = Math.round((productivityScore + candidate.skills) / 2);
            setCultureScore(newCulture);
            setProductivityScore(newProductivity);

            setGameLog(prev => [...prev,
               `‚úÖ Hired ${candidate.name} as ${candidate.role}`,
               `   Skills: ${candidate.skills}% | Culture Fit: ${cultureFit}%`,
               `   üí∞ Salary: $${candidate.salary.toLocaleString()}`
            ]);
         } else {
            setGameLog(prev => [...prev, `‚è≠Ô∏è Passed on ${candidate.name}`]);
         }

         if (currentCandidate < candidates.length - 1) {
            setCurrentCandidate(prev => prev + 1);
         } else {
            setPhase('result');
         }
      };

      const startGame = () => {
         setPhase('values');
         setSelectedValues([]);
         setTeam([]);
         setBudget(300000);
         setCultureScore(100);
         setProductivityScore(50);
         setCurrentCandidate(0);
         setGameLog([]);
      };

      const toggleValue = (valueId: string) => {
         if (selectedValues.includes(valueId)) {
            setSelectedValues(prev => prev.filter(v => v !== valueId));
         } else if (selectedValues.length < 3) {
            setSelectedValues(prev => [...prev, valueId]);
         }
      };

      const getScore = () => {
         const teamSize = team.length;
         const avgSkills = team.length > 0 ? Math.round(team.reduce((sum, t) => sum + t.skills, 0) / team.length) : 0;
         const avgCulture = team.length > 0 ? Math.round(team.reduce((sum, t) => sum + t.culture, 0) / team.length) : 0;
         const budgetEfficiency = Math.round((budget / 300000) * 100);

         let score = 0;
         if (teamSize >= 3) score += 25;
         if (avgCulture >= 80) score += 30;
         if (avgSkills >= 80) score += 25;
         if (budgetEfficiency >= 20) score += 20;

         return { score: Math.min(100, score), teamSize, avgSkills, avgCulture, budgetEfficiency };
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6 overflow-auto">
            <div className="flex justify-between items-start mb-4">
               <div>
                  <h2 className="text-2xl font-black flex items-center gap-2">üë• HIRING & TEAM CULTURE</h2>
                  <p className="text-violet-300 text-sm mt-1">Build your dream team wisely</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all">‚ÑπÔ∏è</button>
            </div>

            {showInfo && (
               <div className="bg-black/40 rounded-xl p-4 mb-4 text-sm border border-violet-500/30">
                  <p className="font-bold text-violet-200 mb-2">üìö What You'll Learn:</p>
                  <ul className="space-y-1 text-violet-300">
                     <li>‚Ä¢ How company values guide hiring</li>
                     <li>‚Ä¢ Skills vs culture fit tradeoffs</li>
                     <li>‚Ä¢ Why early hires define culture</li>
                     <li>‚Ä¢ Building effective teams</li>
                  </ul>
               </div>
            )}

            <div className="flex-1 flex flex-col justify-center">
               <div className="bg-black/30 rounded-2xl p-4 mb-6">
                  <p className="text-center text-violet-400 text-xs mb-4 font-bold uppercase tracking-wider">The Hiring Triangle</p>
                  <div className="flex justify-around items-center">
                     <div className="text-center">
                        <div className="w-14 h-14 rounded-full bg-blue-500/30 flex items-center justify-center text-2xl mb-2 mx-auto border-2 border-blue-500">üéØ</div>
                        <p className="text-xs font-bold">Skills</p>
                        <p className="text-[10px] text-violet-400">Can they do the job?</p>
                     </div>
                     <div className="text-center">
                        <div className="w-14 h-14 rounded-full bg-purple-500/30 flex items-center justify-center text-2xl mb-2 mx-auto border-2 border-purple-500">üíú</div>
                        <p className="text-xs font-bold">Culture Fit</p>
                        <p className="text-[10px] text-violet-400">Shared values?</p>
                     </div>
                     <div className="text-center">
                        <div className="w-14 h-14 rounded-full bg-pink-500/30 flex items-center justify-center text-2xl mb-2 mx-auto border-2 border-pink-500">üìà</div>
                        <p className="text-xs font-bold">Growth</p>
                        <p className="text-[10px] text-violet-400">Can they grow?</p>
                     </div>
                  </div>
               </div>

               <div className="text-center mb-6">
                  <h3 className="text-xl font-bold mb-2">üéÆ Your Mission</h3>
                  <p className="text-violet-300 max-w-lg mx-auto">
                     You're a startup founder with $300K for salaries. First, define your company values.
                     Then evaluate candidates and build your founding team!
                  </p>
               </div>

               <div className="bg-black/20 rounded-xl p-4 mb-6 max-w-sm mx-auto">
                  <p className="text-sm text-center text-violet-300 italic">
                     "Your first 10 hires define your culture forever. Hire slow, fire fast."
                  </p>
               </div>

               <button onClick={startGame} className="mx-auto px-8 py-4 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                  START HIRING ‚Üí
               </button>
            </div>
         </div>
      );

      // VALUES PHASE
      if (phase === 'values') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6 overflow-auto">
            <div className="flex justify-between items-start mb-4">
               <div>
                  <h2 className="text-xl font-black">Step 1: Define Your Values</h2>
                  <p className="text-violet-300 text-sm">Choose 3 core values for your company</p>
               </div>
               <button onClick={() => setInfoTopic('values')} className="text-violet-400 hover:text-white">‚ÑπÔ∏è</button>
            </div>

            {infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={() => setInfoTopic(null)}>
                  <div className="bg-violet-900 rounded-2xl p-6 max-w-md border border-violet-500" onClick={e => e.stopPropagation()}>
                     <h3 className="text-xl font-black mb-2 flex items-center gap-2">‚ÑπÔ∏è {infoTopics[infoTopic].title}</h3>
                     <p className="text-violet-200 text-sm leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => setInfoTopic(null)} className="mt-4 px-4 py-2 bg-violet-700 hover:bg-violet-600 rounded-lg text-sm font-bold w-full">Got it!</button>
                  </div>
               </div>
            )}

            <div className="flex-1">
               <div className="grid grid-cols-2 gap-3 mb-6">
                  {allValues.map(value => (
                     <button
                        key={value.id}
                        onClick={() => toggleValue(value.id)}
                        className={`p-4 rounded-xl text-left transition-all ${
                           selectedValues.includes(value.id)
                              ? 'bg-violet-600 border-2 border-violet-400'
                              : 'bg-black/30 border-2 border-transparent hover:border-violet-500/50'
                        }`}
                     >
                        <div className="flex items-center gap-2 mb-1">
                           <span className="text-xl">{value.icon}</span>
                           <span className="font-bold">{value.name}</span>
                           {selectedValues.includes(value.id) && <span className="ml-auto text-green-400">‚úì</span>}
                        </div>
                        <p className="text-xs text-violet-300">{value.desc}</p>
                     </button>
                  ))}
               </div>

               <div className="text-center mb-4">
                  <p className="text-violet-400 text-sm">
                     Selected: <span className="font-bold text-white">{selectedValues.length}/3</span>
                  </p>
               </div>

               <button
                  onClick={() => setPhase('play')}
                  disabled={selectedValues.length !== 3}
                  className="w-full py-3 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl font-bold text-lg transition-all"
               >
                  {selectedValues.length === 3 ? 'START INTERVIEWING ‚Üí' : `Select ${3 - selectedValues.length} more value(s)`}
               </button>
            </div>
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const { score, teamSize, avgSkills, avgCulture, budgetEfficiency } = getScore();
         const grade = score >= 80 ? 'A' : score >= 60 ? 'B' : score >= 40 ? 'C' : 'D';
         const gradeColor = score >= 80 ? 'text-green-400' : score >= 60 ? 'text-blue-400' : score >= 40 ? 'text-yellow-400' : 'text-red-400';

         return (
            <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6 overflow-auto">
               <div className="text-center mb-6">
                  <div className="text-6xl mb-2">{score >= 80 ? 'üèÜ' : score >= 60 ? 'üë•' : score >= 40 ? 'üèóÔ∏è' : '‚ö†Ô∏è'}</div>
                  <h2 className="text-3xl font-black">Team Built!</h2>
                  <p className={`text-5xl font-black mt-2 ${gradeColor}`}>Grade: {grade}</p>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4 max-w-md mx-auto">
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-violet-400">{teamSize}</p>
                     <p className="text-xs text-violet-300">Team Size</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-green-400">${budget.toLocaleString()}</p>
                     <p className="text-xs text-violet-300">Budget Left</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-blue-400">{avgSkills}%</p>
                     <p className="text-xs text-violet-300">Avg Skills</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-purple-400">{avgCulture}%</p>
                     <p className="text-xs text-violet-300">Avg Culture Fit</p>
                  </div>
               </div>

               {team.length > 0 && (
                  <div className="bg-black/20 rounded-xl p-3 mb-4">
                     <p className="text-xs font-bold text-violet-400 mb-2">Your Team:</p>
                     <div className="flex gap-2 flex-wrap">
                        {team.map((member, i) => (
                           <span key={i} className="text-xs px-2 py-1 bg-violet-900/50 rounded-lg">
                              {member.name} ({member.role})
                           </span>
                        ))}
                     </div>
                  </div>
               )}

               <div className="bg-violet-900/40 rounded-xl p-4 mb-4 border border-violet-500/30">
                  <p className="font-bold text-violet-300 mb-2 flex items-center gap-2">
                     <span className="w-6 h-6 rounded-full bg-violet-500 flex items-center justify-center text-sm">üí°</span>
                     Key Takeaways
                  </p>
                  <ul className="text-sm text-violet-200 space-y-1">
                     <li>‚Ä¢ <strong>Values first</strong> - define culture before hiring</li>
                     <li>‚Ä¢ <strong>Skills + Culture</strong> - both matter, but culture is harder to change</li>
                     <li>‚Ä¢ <strong>Early hires</strong> set the standard for everyone after</li>
                     <li>‚Ä¢ <strong>Red flags</strong> rarely get better after hiring</li>
                  </ul>
               </div>

               <button onClick={startGame} className="mx-auto px-6 py-3 bg-gradient-to-r from-violet-600 to-purple-600 hover:from-violet-500 hover:to-purple-500 rounded-xl font-bold transition-all">
                  üîÑ HIRE AGAIN
               </button>
            </div>
         );
      }

      // PLAY PHASE
      const candidate = candidates[currentCandidate];
      const cultureFit = calculateCultureFit(candidate);

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white overflow-hidden">
            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-violet-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-lg font-black">Candidate {currentCandidate + 1} / {candidates.length}</span>
                  <span className="px-3 py-1 bg-green-900/50 rounded-full text-sm font-bold text-green-300">
                     üí∞ ${budget.toLocaleString()}
                  </span>
               </div>
               <div className="flex gap-3 text-xs">
                  <span className="text-violet-300">Team: {team.length}</span>
                  <span className="text-violet-500">|</span>
                  <span className="text-purple-300">Culture: {cultureScore}%</span>
                  <span className="text-violet-500">|</span>
                  <span className="text-blue-300">Productivity: {productivityScore}%</span>
               </div>
            </div>

            {/* Info modal */}
            {infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={() => setInfoTopic(null)}>
                  <div className="bg-violet-900 rounded-2xl p-6 max-w-md border border-violet-500" onClick={e => e.stopPropagation()}>
                     <h3 className="text-xl font-black mb-2 flex items-center gap-2">‚ÑπÔ∏è {infoTopics[infoTopic].title}</h3>
                     <p className="text-violet-200 text-sm leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => setInfoTopic(null)} className="mt-4 px-4 py-2 bg-violet-700 hover:bg-violet-600 rounded-lg text-sm font-bold w-full">Got it!</button>
                  </div>
               </div>
            )}

            <div className="flex-1 p-4 overflow-auto">
               {/* Candidate Card */}
               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <div className="flex items-start gap-4 mb-4">
                     <div className="text-5xl">{candidate.avatar}</div>
                     <div className="flex-1">
                        <h3 className="text-xl font-black">{candidate.name}</h3>
                        <p className="text-violet-400 text-sm">{candidate.role}</p>
                        <p className="text-violet-300 text-xs mt-1">{candidate.experience} years experience</p>
                     </div>
                     <div className="text-right">
                        <p className="text-lg font-black text-green-400">${candidate.salary.toLocaleString()}</p>
                        <p className="text-xs text-violet-400">annual salary</p>
                     </div>
                  </div>

                  <p className="text-sm text-violet-200 mb-4 italic">"{candidate.personality}"</p>

                  <div className="grid grid-cols-2 gap-3 mb-4">
                     <div className="bg-black/20 rounded-lg p-3">
                        <div className="flex justify-between items-center mb-1">
                           <span className="text-xs text-violet-400">Skills</span>
                           <button onClick={() => setInfoTopic('skills')} className="text-violet-500 hover:text-white text-xs">‚ÑπÔ∏è</button>
                        </div>
                        <div className="flex items-center gap-2">
                           <div className="flex-1 h-2 bg-black/40 rounded-full overflow-hidden">
                              <div className="h-full bg-blue-500" style={{ width: `${candidate.skills}%` }} />
                           </div>
                           <span className="text-sm font-bold text-blue-400">{candidate.skills}%</span>
                        </div>
                     </div>
                     <div className="bg-black/20 rounded-lg p-3">
                        <div className="flex justify-between items-center mb-1">
                           <span className="text-xs text-violet-400">Culture Fit</span>
                           <button onClick={() => setInfoTopic('culture')} className="text-violet-500 hover:text-white text-xs">‚ÑπÔ∏è</button>
                        </div>
                        <div className="flex items-center gap-2">
                           <div className="flex-1 h-2 bg-black/40 rounded-full overflow-hidden">
                              <div className={`h-full ${cultureFit >= 80 ? 'bg-green-500' : cultureFit >= 60 ? 'bg-yellow-500' : 'bg-red-500'}`} style={{ width: `${cultureFit}%` }} />
                           </div>
                           <span className={`text-sm font-bold ${cultureFit >= 80 ? 'text-green-400' : cultureFit >= 60 ? 'text-yellow-400' : 'text-red-400'}`}>{cultureFit}%</span>
                        </div>
                     </div>
                  </div>

                  <div className="grid grid-cols-2 gap-3">
                     <div className="bg-red-900/30 rounded-lg p-2 border border-red-500/30">
                        <p className="text-xs font-bold text-red-400 mb-1">üö© Red Flag</p>
                        <p className="text-xs text-red-300">{candidate.redFlag}</p>
                     </div>
                     <div className="bg-green-900/30 rounded-lg p-2 border border-green-500/30">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úÖ Green Flag</p>
                        <p className="text-xs text-green-300">{candidate.greenFlag}</p>
                     </div>
                  </div>
               </div>

               {/* Decision buttons */}
               <div className="grid grid-cols-2 gap-3">
                  <button
                     onClick={() => hireCandidate(false)}
                     className="py-4 bg-red-900/50 hover:bg-red-800/50 border-2 border-red-500/30 hover:border-red-500 rounded-xl font-bold transition-all"
                  >
                     ‚è≠Ô∏è PASS
                  </button>
                  <button
                     onClick={() => hireCandidate(true)}
                     disabled={budget < candidate.salary}
                     className="py-4 bg-green-900/50 hover:bg-green-800/50 border-2 border-green-500/30 hover:border-green-500 rounded-xl font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                     ‚úÖ HIRE (${candidate.salary.toLocaleString()})
                  </button>
               </div>
            </div>

            {/* Team panel */}
            {team.length > 0 && (
               <div className="h-16 bg-black/40 border-t border-violet-500/30 p-2 flex items-center gap-2 overflow-x-auto">
                  <span className="text-[10px] font-bold text-violet-500 mr-2">TEAM:</span>
                  {team.map((member, i) => (
                     <span key={i} className="text-xs px-2 py-1 bg-violet-900/50 rounded-lg whitespace-nowrap">
                        {member.name.split(' ')[0]}
                     </span>
                  ))}
               </div>
            )}
         </div>
      );
   };

   // ============================================================================
   // PROJECT MANAGEMENT INTERACTIVE
   // ============================================================================
   const ProjectManagementRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [day, setDay] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      // Project settings
      const deadline = 14; // days
      const teamCapacity = 3; // tasks per day

      // Tasks with Kanban states
      const [tasks, setTasks] = useState<{
         id: string;
         name: string;
         icon: string;
         status: 'backlog' | 'todo' | 'doing' | 'done';
         effort: number; // days to complete
         priority: 'high' | 'medium' | 'low';
         blockedBy?: string;
         daysWorked: number;
      }[]>([]);

      const initialTasks = [
         { id: 'design', name: 'UI Design', icon: 'üé®', effort: 2, priority: 'high' as const, blockedBy: undefined },
         { id: 'backend', name: 'Backend API', icon: '‚öôÔ∏è', effort: 3, priority: 'high' as const, blockedBy: undefined },
         { id: 'frontend', name: 'Frontend Dev', icon: 'üíª', effort: 3, priority: 'high' as const, blockedBy: 'design' },
         { id: 'database', name: 'Database Setup', icon: 'üóÑÔ∏è', effort: 1, priority: 'medium' as const, blockedBy: undefined },
         { id: 'testing', name: 'Testing', icon: 'üß™', effort: 2, priority: 'medium' as const, blockedBy: 'frontend' },
         { id: 'docs', name: 'Documentation', icon: 'üìù', effort: 1, priority: 'low' as const, blockedBy: undefined },
         { id: 'deploy', name: 'Deployment', icon: 'üöÄ', effort: 1, priority: 'high' as const, blockedBy: 'testing' },
      ];

      // Scope creep events
      const scopeCreepTasks = [
         { id: 'auth', name: 'Add Auth System', icon: 'üîê', effort: 2, priority: 'high' as const },
         { id: 'analytics', name: 'Analytics Dashboard', icon: 'üìä', effort: 2, priority: 'medium' as const },
         { id: 'mobile', name: 'Mobile Responsive', icon: 'üì±', effort: 1, priority: 'medium' as const },
      ];

      const [scopeCreepAdded, setScopeCreepAdded] = useState(0);
      const [completedOnTime, setCompletedOnTime] = useState(false);

      const infoTopics: Record<string, { title: string; content: string }> = {
         kanban: {
            title: 'Kanban Board',
            content: 'Kanban visualizes work as cards moving through columns (To Do ‚Üí Doing ‚Üí Done). It limits work-in-progress, reveals bottlenecks, and helps teams focus on finishing work rather than starting new tasks.'
         },
         priority: {
            title: 'Task Prioritization',
            content: 'Not all tasks are equal. High priority tasks are critical path items that block other work. Focus on high-priority items first, but don\'t neglect medium/low priority tasks that pile up.'
         },
         dependencies: {
            title: 'Task Dependencies',
            content: 'Some tasks can\'t start until others finish (e.g., can\'t test before building). Identifying dependencies helps plan the critical path - the longest chain that determines minimum project duration.'
         },
         scope: {
            title: 'Scope Creep',
            content: 'Scope creep is when new requirements keep getting added during a project. It\'s a major cause of delays and budget overruns. Learn to say "that\'s a great idea for v2" and protect your timeline.'
         },
         capacity: {
            title: 'Team Capacity',
            content: 'Your team can only work on a limited number of tasks simultaneously. Overloading leads to context switching and slower progress. Respect capacity limits and focus on throughput, not busyness.'
         },
         wip: {
            title: 'Work In Progress (WIP)',
            content: 'WIP limits are constraints on how many tasks can be "in progress" at once. Lower WIP = faster completion of individual tasks = better flow. Stop starting, start finishing!'
         }
      };

      const getBlockedTasks = () => {
         return tasks.filter(t => {
            if (!t.blockedBy) return false;
            const blocker = tasks.find(b => b.id === t.blockedBy);
            return blocker && blocker.status !== 'done';
         }).map(t => t.id);
      };

      const moveTask = (taskId: string, newStatus: 'todo' | 'doing' | 'done') => {
         const blockedTasks = getBlockedTasks();

         setTasks(prev => prev.map(t => {
            if (t.id === taskId) {
               // Can't move blocked tasks to doing
               if (newStatus === 'doing' && blockedTasks.includes(taskId)) {
                  setGameLog(prev => [...prev, `‚ö†Ô∏è ${t.name} is blocked by ${tasks.find(b => b.id === t.blockedBy)?.name}`]);
                  return t;
               }

               // Check capacity for doing
               if (newStatus === 'doing') {
                  const doingCount = prev.filter(p => p.status === 'doing').length;
                  if (doingCount >= teamCapacity) {
                     setGameLog(prev => [...prev, `‚ö†Ô∏è Team at capacity! Finish tasks before starting new ones.`]);
                     return t;
                  }
               }

               return { ...t, status: newStatus };
            }
            return t;
         }));
      };

      const processDay = () => {
         let newLog: string[] = [`üìÖ Day ${day}`];

         // Progress tasks in "doing"
         setTasks(prev => {
            const updated = prev.map(t => {
               if (t.status === 'doing') {
                  const newDaysWorked = t.daysWorked + 1;
                  if (newDaysWorked >= t.effort) {
                     newLog.push(`‚úÖ Completed: ${t.name}`);
                     return { ...t, status: 'done' as const, daysWorked: newDaysWorked };
                  }
                  return { ...t, daysWorked: newDaysWorked };
               }
               return t;
            });
            return updated;
         });

         // Scope creep chance (20% after day 3)
         if (day > 3 && scopeCreepAdded < scopeCreepTasks.length && Math.random() < 0.25) {
            const newTask = scopeCreepTasks[scopeCreepAdded];
            setTasks(prev => [...prev, { ...newTask, status: 'backlog', daysWorked: 0 }]);
            setScopeCreepAdded(prev => prev + 1);
            newLog.push(`üÜï SCOPE CREEP: "${newTask.name}" added to backlog!`);
         }

         setGameLog(prev => [...prev, ...newLog]);

         // Check win/lose
         const allDone = tasks.filter(t => t.status !== 'done').length === 0 && tasks.length > 0;
         if (allDone) {
            setCompletedOnTime(day <= deadline);
            setPhase('result');
            return;
         }

         if (day >= deadline) {
            setCompletedOnTime(false);
            setPhase('result');
            return;
         }

         setDay(d => d + 1);
      };

      const startGame = () => {
         setPhase('play');
         setDay(1);
         setTasks(initialTasks.map(t => ({ ...t, status: 'backlog' as const, daysWorked: 0 })));
         setScopeCreepAdded(0);
         setGameLog([]);
         setCompletedOnTime(false);
      };

      const getScore = () => {
         const completedTasks = tasks.filter(t => t.status === 'done').length;
         const totalTasks = tasks.length;
         const completionRate = Math.round((completedTasks / totalTasks) * 100);
         const daysUsed = day;
         const efficiency = deadline > 0 ? Math.round(((deadline - daysUsed + 1) / deadline) * 100) : 0;

         let score = 0;
         if (completedOnTime) score += 40;
         score += Math.round(completionRate * 0.4);
         if (efficiency > 0) score += Math.round(efficiency * 0.2);

         return { score: Math.min(100, Math.max(0, score)), completedTasks, totalTasks, completionRate, daysUsed };
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-6 overflow-auto">
            <div className="flex justify-between items-start mb-4">
               <div>
                  <h2 className="text-2xl font-black flex items-center gap-2">üìã PROJECT MANAGEMENT</h2>
                  <p className="text-orange-300 text-sm mt-1">Lead your team to ship on time</p>
               </div>
               <button onClick={() => setShowInfo(!showInfo)} className="w-10 h-10 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center text-xl transition-all">‚ÑπÔ∏è</button>
            </div>

            {showInfo && (
               <div className="bg-black/40 rounded-xl p-4 mb-4 text-sm border border-orange-500/30">
                  <p className="font-bold text-orange-200 mb-2">üìö What You'll Learn:</p>
                  <ul className="space-y-1 text-orange-300">
                     <li>‚Ä¢ How Kanban boards organize work</li>
                     <li>‚Ä¢ Task prioritization and dependencies</li>
                     <li>‚Ä¢ Managing team capacity</li>
                     <li>‚Ä¢ Dealing with scope creep</li>
                  </ul>
               </div>
            )}

            <div className="flex-1 flex flex-col justify-center">
               <div className="bg-black/30 rounded-2xl p-4 mb-6">
                  <p className="text-center text-orange-400 text-xs mb-4 font-bold uppercase tracking-wider">The Kanban Flow</p>
                  <div className="flex justify-around items-center">
                     {['üì• Backlog', 'üìã To Do', 'üîÑ Doing', '‚úÖ Done'].map((stage, i) => (
                        <div key={i} className="text-center">
                           <div className="w-14 h-14 rounded-xl bg-orange-500/20 flex items-center justify-center text-xl mb-1 border border-orange-500/30">
                              {stage.split(' ')[0]}
                           </div>
                           <p className="text-[10px] text-orange-400">{stage.split(' ')[1]}</p>
                        </div>
                     ))}
                  </div>
                  <div className="flex justify-around mt-2">
                     {['‚Üí', '‚Üí', '‚Üí'].map((arrow, i) => (
                        <span key={i} className="text-orange-500 text-lg">‚Üí</span>
                     ))}
                  </div>
               </div>

               <div className="text-center mb-6">
                  <h3 className="text-xl font-bold mb-2">üéÆ Your Mission</h3>
                  <p className="text-orange-300 max-w-lg mx-auto">
                     You have <span className="font-bold text-white">{deadline} days</span> to ship a product.
                     Move tasks through the Kanban board, respect dependencies, and watch out for scope creep!
                  </p>
               </div>

               <div className="grid grid-cols-3 gap-3 mb-6 max-w-md mx-auto text-center">
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">‚è±Ô∏è</span>
                     <p className="text-[10px] text-orange-400">{deadline} Day Deadline</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">üë•</span>
                     <p className="text-[10px] text-orange-400">{teamCapacity} Tasks/Day Max</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-xl">üîó</span>
                     <p className="text-[10px] text-orange-400">Dependencies</p>
                  </div>
               </div>

               <button onClick={startGame} className="mx-auto px-8 py-4 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 rounded-xl font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                  START PROJECT ‚Üí
               </button>
            </div>
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const { score, completedTasks, totalTasks, completionRate, daysUsed } = getScore();
         const grade = score >= 80 ? 'A' : score >= 60 ? 'B' : score >= 40 ? 'C' : 'D';
         const gradeColor = score >= 80 ? 'text-green-400' : score >= 60 ? 'text-blue-400' : score >= 40 ? 'text-yellow-400' : 'text-red-400';

         return (
            <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-6 overflow-auto">
               <div className="text-center mb-6">
                  <div className="text-6xl mb-2">{completedOnTime ? 'üöÄ' : '‚è∞'}</div>
                  <h2 className="text-3xl font-black">{completedOnTime ? 'Shipped On Time!' : 'Deadline Missed'}</h2>
                  <p className={`text-5xl font-black mt-2 ${gradeColor}`}>Grade: {grade}</p>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4 max-w-md mx-auto">
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-green-400">{completedTasks}/{totalTasks}</p>
                     <p className="text-xs text-orange-300">Tasks Done</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-blue-400">{completionRate}%</p>
                     <p className="text-xs text-orange-300">Completion</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-purple-400">{daysUsed}</p>
                     <p className="text-xs text-orange-300">Days Used</p>
                  </div>
                  <div className="bg-black/30 rounded-xl p-3 text-center">
                     <p className="text-xl font-black text-amber-400">{scopeCreepAdded}</p>
                     <p className="text-xs text-orange-300">Scope Creep Items</p>
                  </div>
               </div>

               <div className="bg-orange-900/40 rounded-xl p-4 mb-4 border border-orange-500/30">
                  <p className="font-bold text-orange-300 mb-2 flex items-center gap-2">
                     <span className="w-6 h-6 rounded-full bg-orange-500 flex items-center justify-center text-sm">üí°</span>
                     Key Takeaways
                  </p>
                  <ul className="text-sm text-orange-200 space-y-1">
                     <li>‚Ä¢ <strong>Dependencies</strong> define your critical path</li>
                     <li>‚Ä¢ <strong>WIP limits</strong> prevent overload and improve focus</li>
                     <li>‚Ä¢ <strong>Scope creep</strong> is the #1 project killer - learn to say no</li>
                     <li>‚Ä¢ <strong>Prioritize ruthlessly</strong> - not everything is urgent</li>
                  </ul>
               </div>

               <button onClick={startGame} className="mx-auto px-6 py-3 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 rounded-xl font-bold transition-all">
                  üîÑ TRY AGAIN
               </button>
            </div>
         );
      }

      // PLAY PHASE
      const blockedTasks = getBlockedTasks();
      const doingCount = tasks.filter(t => t.status === 'doing').length;
      const doneCount = tasks.filter(t => t.status === 'done').length;
      const columns: ('backlog' | 'todo' | 'doing' | 'done')[] = ['backlog', 'todo', 'doing', 'done'];
      const columnLabels = { backlog: 'üì• Backlog', todo: 'üìã To Do', doing: 'üîÑ Doing', done: '‚úÖ Done' };

      return (
         <div className="flex flex-col h-full bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white overflow-hidden">
            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-orange-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-lg font-black">üìÖ Day {day} / {deadline}</span>
                  <div className="flex gap-2">
                     <span className={`px-3 py-1 rounded-full text-sm font-bold ${day <= deadline - 3 ? 'bg-green-900/50 text-green-300' : 'bg-red-900/50 text-red-300'}`}>
                        {deadline - day} days left
                     </span>
                  </div>
               </div>
               <div className="w-full h-2 bg-black/40 rounded-full overflow-hidden">
                  <div className="h-full bg-gradient-to-r from-orange-500 to-amber-500 transition-all" style={{ width: `${(day / deadline) * 100}%` }} />
               </div>
            </div>

            {/* Info modal */}
            {infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={() => setInfoTopic(null)}>
                  <div className="bg-orange-900 rounded-2xl p-6 max-w-md border border-orange-500" onClick={e => e.stopPropagation()}>
                     <h3 className="text-xl font-black mb-2 flex items-center gap-2">‚ÑπÔ∏è {infoTopics[infoTopic].title}</h3>
                     <p className="text-orange-200 text-sm leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => setInfoTopic(null)} className="mt-4 px-4 py-2 bg-orange-700 hover:bg-orange-600 rounded-lg text-sm font-bold w-full">Got it!</button>
                  </div>
               </div>
            )}

            {/* Kanban Board */}
            <div className="flex-1 p-2 overflow-x-auto">
               <div className="flex gap-2 h-full min-w-[600px]">
                  {columns.map(col => (
                     <div key={col} className="flex-1 bg-black/20 rounded-xl p-2 flex flex-col min-w-[140px]">
                        <div className="flex justify-between items-center mb-2">
                           <span className="text-xs font-bold text-orange-400">{columnLabels[col]}</span>
                           {col === 'doing' && (
                              <span className={`text-[10px] px-1.5 py-0.5 rounded ${doingCount >= teamCapacity ? 'bg-red-500' : 'bg-green-500/50'}`}>
                                 {doingCount}/{teamCapacity}
                              </span>
                           )}
                           {col === 'kanban' && <button onClick={() => setInfoTopic('kanban')} className="text-orange-500 text-xs">‚ÑπÔ∏è</button>}
                        </div>
                        <div className="flex-1 space-y-2 overflow-y-auto">
                           {tasks.filter(t => t.status === col).map(task => {
                              const isBlocked = blockedTasks.includes(task.id);
                              const blocker = task.blockedBy ? tasks.find(b => b.id === task.blockedBy) : null;
                              const progress = task.status === 'doing' ? (task.daysWorked / task.effort) * 100 : 0;

                              return (
                                 <div
                                    key={task.id}
                                    className={`p-2 rounded-lg text-xs transition-all ${
                                       isBlocked ? 'bg-red-900/30 border border-red-500/30' :
                                       task.status === 'done' ? 'bg-green-900/30 border border-green-500/30' :
                                       'bg-black/30 border border-orange-500/20'
                                    }`}
                                 >
                                    <div className="flex items-center gap-1 mb-1">
                                       <span>{task.icon}</span>
                                       <span className="font-bold truncate flex-1">{task.name}</span>
                                       <span className={`w-2 h-2 rounded-full ${
                                          task.priority === 'high' ? 'bg-red-500' :
                                          task.priority === 'medium' ? 'bg-yellow-500' : 'bg-green-500'
                                       }`} />
                                    </div>

                                    {task.status === 'doing' && (
                                       <div className="h-1 bg-black/40 rounded-full overflow-hidden mb-1">
                                          <div className="h-full bg-blue-500 transition-all" style={{ width: `${progress}%` }} />
                                       </div>
                                    )}

                                    {isBlocked && blocker && (
                                       <p className="text-red-400 text-[10px]">üîí Blocked by {blocker.name}</p>
                                    )}

                                    <div className="text-[10px] text-orange-400 mb-1">
                                       ‚è±Ô∏è {task.effort}d effort
                                    </div>

                                    {/* Move buttons */}
                                    {task.status !== 'done' && (
                                       <div className="flex gap-1 mt-1">
                                          {task.status === 'backlog' && (
                                             <button onClick={() => moveTask(task.id, 'todo')} className="flex-1 py-1 bg-orange-700/50 hover:bg-orange-600/50 rounded text-[10px]">
                                                ‚Üí To Do
                                             </button>
                                          )}
                                          {task.status === 'todo' && (
                                             <button
                                                onClick={() => moveTask(task.id, 'doing')}
                                                disabled={isBlocked || doingCount >= teamCapacity}
                                                className="flex-1 py-1 bg-blue-700/50 hover:bg-blue-600/50 disabled:opacity-50 rounded text-[10px]"
                                             >
                                                ‚Üí Start
                                             </button>
                                          )}
                                       </div>
                                    )}
                                 </div>
                              );
                           })}
                        </div>
                     </div>
                  ))}
               </div>
            </div>

            {/* Action Bar */}
            <div className="p-3 bg-black/30 border-t border-orange-500/30">
               <div className="flex gap-2 items-center justify-between mb-2">
                  <div className="flex gap-2">
                     <button onClick={() => setInfoTopic('dependencies')} className="text-xs text-orange-400 hover:text-white">üîó Dependencies</button>
                     <button onClick={() => setInfoTopic('scope')} className="text-xs text-orange-400 hover:text-white">üÜï Scope Creep</button>
                     <button onClick={() => setInfoTopic('wip')} className="text-xs text-orange-400 hover:text-white">üìä WIP Limits</button>
                  </div>
                  <span className="text-xs text-orange-400">{doneCount}/{tasks.length} complete</span>
               </div>
               <button
                  onClick={processDay}
                  className="w-full py-3 bg-gradient-to-r from-orange-600 to-amber-600 hover:from-orange-500 hover:to-amber-500 rounded-xl font-bold transition-all"
               >
                  ‚ñ∂Ô∏è END DAY {day}
               </button>
            </div>
         </div>
      );
   };

   // --- QUALITY CONTROL RENDERER ---
   const QualityControlRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [batch, setBatch] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      const totalBatches = 10;
      const batchSize = 100; // units per batch

      const [inspectionRate, setInspectionRate] = useState(20); // % of units inspected
      const [qualityStandard, setQualityStandard] = useState<'loose' | 'standard' | 'strict'>('standard');

      const [stats, setStats] = useState({
         totalProduced: 0,
         totalInspected: 0,
         defectsFound: 0,
         defectsShipped: 0,
         customerReturns: 0,
         inspectionCost: 0,
         returnCost: 0,
         reputationScore: 100,
      });

      const [currentBatch, setCurrentBatch] = useState<{
         units: { id: number; hasDefect: boolean; inspected: boolean; shipped: boolean }[];
         baseDefectRate: number;
      } | null>(null);

      const [batchHistory, setBatchHistory] = useState<{
         batch: number;
         defectRate: number;
         defectsFound: number;
         defectsShipped: number;
         returns: number;
      }[]>([]);

      const infoTopics: Record<string, { title: string; content: string }> = {
         inspection: {
            title: "Inspection Rate",
            content: "The percentage of products you physically check for defects. 100% inspection catches all defects but is expensive. Sampling (checking 10-30%) reduces costs but lets some defects through. Statistical quality control helps find the optimal balance."
         },
         standards: {
            title: "Quality Standards",
            content: "How strict your acceptance criteria are. LOOSE: Accept minor flaws, fewer rejections but more customer complaints. STANDARD: Industry-normal tolerances. STRICT: Reject anything imperfect‚Äîhigher costs but better reputation. Six Sigma aims for 3.4 defects per million!"
         },
         cost_of_quality: {
            title: "Cost of Quality",
            content: "Quality costs include: PREVENTION (training, better equipment), APPRAISAL (inspection, testing), INTERNAL FAILURE (rework, scrap), EXTERNAL FAILURE (returns, warranty, reputation damage). It's often cheaper to prevent defects than find them later!"
         },
         six_sigma: {
            title: "Six Sigma",
            content: "A methodology targeting near-perfect quality: only 3.4 defects per million opportunities. Uses DMAIC: Define, Measure, Analyze, Improve, Control. Developed at Motorola, popularized by GE. A 'sigma level' measures process capability‚Äî6œÉ means 99.99966% defect-free."
         },
         continuous: {
            title: "Continuous Improvement",
            content: "Kaizen (Japanese for 'change for better') means constantly making small improvements. Track defects, find root causes, implement fixes, verify results. Quality isn't a destination‚Äîit's an ongoing journey. Every defect is a learning opportunity!"
         }
      };

      useEffect(() => {
         if (infoTopic && infoTopics[infoTopic]) {
            setShowInfo(true);
         }
      }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setBatch(1);
         setStats({
            totalProduced: 0,
            totalInspected: 0,
            defectsFound: 0,
            defectsShipped: 0,
            customerReturns: 0,
            inspectionCost: 0,
            returnCost: 0,
            reputationScore: 100,
         });
         setBatchHistory([]);
         setGameLog(["Quality Control simulation started"]);
         generateBatch(1);
      };

      const generateBatch = (batchNum: number) => {
         // Base defect rate varies by batch (simulating process variation)
         const baseRate = 0.05 + Math.random() * 0.15; // 5-20% defect rate

         const units = Array.from({ length: batchSize }, (_, i) => ({
            id: i,
            hasDefect: Math.random() < baseRate,
            inspected: false,
            shipped: false,
         }));

         setCurrentBatch({ units, baseDefectRate: baseRate });
         setGameLog(prev => [...prev, `Batch ${batchNum} produced with ${batchSize} units`]);
      };

      const processBatch = () => {
         if (!currentBatch) return;

         const unitsToInspect = Math.floor(batchSize * (inspectionRate / 100));
         const inspectionCostPerUnit = 2;
         const returnCostPerUnit = 50;

         // Randomly select units to inspect
         const shuffled = [...currentBatch.units].sort(() => Math.random() - 0.5);
         const inspected = shuffled.slice(0, unitsToInspect);
         const notInspected = shuffled.slice(unitsToInspect);

         // Find defects based on quality standard
         const defectThreshold = qualityStandard === 'loose' ? 0.7 : qualityStandard === 'strict' ? 0.3 : 0.5;

         let defectsFound = 0;
         inspected.forEach(unit => {
            if (unit.hasDefect && Math.random() > defectThreshold) {
               defectsFound++;
            }
         });

         // Defects that slip through (not inspected or missed during inspection)
         const actualDefects = currentBatch.units.filter(u => u.hasDefect).length;
         const defectsShipped = actualDefects - defectsFound;

         // Customer returns (some % of shipped defects get returned)
         const returnRate = qualityStandard === 'loose' ? 0.6 : qualityStandard === 'strict' ? 0.3 : 0.4;
         const returns = Math.floor(defectsShipped * returnRate);

         // Calculate costs
         const batchInspectionCost = unitsToInspect * inspectionCostPerUnit;
         const batchReturnCost = returns * returnCostPerUnit;

         // Reputation impact
         const reputationHit = returns * 2;

         const newStats = {
            totalProduced: stats.totalProduced + batchSize,
            totalInspected: stats.totalInspected + unitsToInspect,
            defectsFound: stats.defectsFound + defectsFound,
            defectsShipped: stats.defectsShipped + defectsShipped,
            customerReturns: stats.customerReturns + returns,
            inspectionCost: stats.inspectionCost + batchInspectionCost,
            returnCost: stats.returnCost + batchReturnCost,
            reputationScore: Math.max(0, stats.reputationScore - reputationHit),
         };
         setStats(newStats);

         setBatchHistory(prev => [...prev, {
            batch,
            defectRate: currentBatch.baseDefectRate * 100,
            defectsFound,
            defectsShipped,
            returns
         }]);

         setGameLog(prev => [...prev,
            `Batch ${batch}: Inspected ${unitsToInspect} units, found ${defectsFound} defects, ${defectsShipped} shipped with defects, ${returns} returns`
         ]);

         if (batch >= totalBatches) {
            setGameLog(prev => [...prev,
               `Simulation complete! Total cost: $${newStats.inspectionCost + newStats.returnCost}, Reputation: ${newStats.reputationScore}%`
            ]);
            setPhase('result');
         } else {
            setBatch(batch + 1);
            generateBatch(batch + 1);
         }
      };

      const getScore = () => {
         const totalCost = stats.inspectionCost + stats.returnCost;
         const costScore = Math.max(0, 100 - (totalCost / 50)); // Lower cost = higher score
         const reputationScore = stats.reputationScore;
         const defectRateScore = Math.max(0, 100 - (stats.defectsShipped / stats.totalProduced) * 500);

         return Math.round((costScore + reputationScore + defectRateScore) / 3);
      };

      const getGrade = () => {
         const score = getScore();
         if (score >= 85) return { letter: 'A', label: 'Quality Master', color: 'text-green-400' };
         if (score >= 70) return { letter: 'B', label: 'Quality Manager', color: 'text-blue-400' };
         if (score >= 55) return { letter: 'C', label: 'Quality Novice', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Needs Improvement', color: 'text-red-400' };
      };

      // Intro Phase
      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <h1 className="text-2xl font-bold mb-2">üîç Quality Control Simulator</h1>
                  <p className="text-cyan-300 text-sm">Master the art of balancing cost and quality</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <h2 className="text-lg font-bold mb-3 text-cyan-400">üìã How It Works</h2>
                  <div className="space-y-2 text-sm">
                     <p>‚Ä¢ You manage quality control for <span className="text-white font-bold">{totalBatches} production batches</span></p>
                     <p>‚Ä¢ Each batch contains <span className="text-white font-bold">{batchSize} units</span> with varying defect rates</p>
                     <p>‚Ä¢ Set your <span className="text-cyan-400">inspection rate</span> (% of units to check)</p>
                     <p>‚Ä¢ Choose your <span className="text-cyan-400">quality standard</span> (how strict)</p>
                     <p>‚Ä¢ Balance inspection costs vs customer returns!</p>
                  </div>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-black/30 rounded-lg p-3">
                     <h3 className="font-bold text-red-400 mb-2">üí∏ Costs</h3>
                     <p className="text-xs text-slate-300">Inspection: $2/unit</p>
                     <p className="text-xs text-slate-300">Return: $50/unit</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3">
                     <h3 className="font-bold text-green-400 mb-2">üéØ Goal</h3>
                     <p className="text-xs text-slate-300">Minimize total costs</p>
                     <p className="text-xs text-slate-300">Keep reputation high!</p>
                  </div>
               </div>

               <div className="flex flex-wrap gap-2 mb-4">
                  {Object.keys(infoTopics).map(key => (
                     <button
                        key={key}
                        onClick={() => setInfoTopic(key)}
                        className="text-xs bg-cyan-500/20 hover:bg-cyan-500/40 px-2 py-1 rounded-full text-cyan-300"
                     >
                        ‚ÑπÔ∏è {infoTopics[key].title}
                     </button>
                  ))}
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-cyan-600 to-teal-600 hover:from-cyan-500 hover:to-teal-500 rounded-xl font-bold text-lg transition-all"
               >
                  ‚ñ∂Ô∏è START PRODUCTION
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-cyan-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-cyan-600 rounded-lg">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // Result Phase
      if (phase === 'result') {
         const grade = getGrade();
         const totalCost = stats.inspectionCost + stats.returnCost;
         const defectRate = ((stats.defectsShipped / stats.totalProduced) * 100).toFixed(1);

         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-cyan-400">Score: {getScore()}/100</div>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-green-400">{stats.reputationScore}%</div>
                     <div className="text-xs text-slate-400">Reputation</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-red-400">${totalCost}</div>
                     <div className="text-xs text-slate-400">Total Cost</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-yellow-400">{defectRate}%</div>
                     <div className="text-xs text-slate-400">Shipped Defect Rate</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-orange-400">{stats.customerReturns}</div>
                     <div className="text-xs text-slate-400">Customer Returns</div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-cyan-400 mb-2">üìä Cost Breakdown</h3>
                  <div className="flex justify-between text-sm">
                     <span>Inspection Costs:</span>
                     <span className="text-cyan-300">${stats.inspectionCost}</span>
                  </div>
                  <div className="flex justify-between text-sm">
                     <span>Return Costs:</span>
                     <span className="text-red-300">${stats.returnCost}</span>
                  </div>
                  <div className="flex justify-between text-sm font-bold border-t border-slate-600 mt-2 pt-2">
                     <span>Total:</span>
                     <span>${totalCost}</span>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-cyan-400 mb-2">üí° Key Insight</h3>
                  <p className="text-sm text-slate-300">
                     {stats.returnCost > stats.inspectionCost
                        ? "Your return costs exceeded inspection costs! It's often cheaper to catch defects before shipping than to handle returns. Consider increasing your inspection rate."
                        : stats.reputationScore < 60
                        ? "Your reputation took a hit from too many defective products reaching customers. Quality builds trust‚Äîinvest in prevention!"
                        : "Good balance! You found the sweet spot between inspection costs and quality. Remember: prevention is cheaper than correction."
                     }
                  </p>
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-cyan-600 to-teal-600 hover:from-cyan-500 hover:to-teal-500 rounded-xl font-bold transition-all"
               >
                  üîÑ TRY AGAIN
               </button>
            </div>
         );
      }

      // Play Phase
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-teal-900 via-cyan-900 to-slate-900 text-white overflow-hidden">
            {/* Info Modal */}
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-cyan-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-cyan-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-cyan-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="font-bold">üîç Quality Control</span>
                  <span className="text-cyan-400">Batch {batch}/{totalBatches}</span>
               </div>
               <div className="grid grid-cols-4 gap-2 text-center text-xs">
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-green-400 font-bold">{stats.reputationScore}%</div>
                     <div className="text-slate-500">Reputation</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-cyan-400 font-bold">${stats.inspectionCost}</div>
                     <div className="text-slate-500">Inspect $</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-red-400 font-bold">${stats.returnCost}</div>
                     <div className="text-slate-500">Return $</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-yellow-400 font-bold">{stats.customerReturns}</div>
                     <div className="text-slate-500">Returns</div>
                  </div>
               </div>
            </div>

            {/* Control Panel */}
            <div className="p-3 space-y-3">
               {/* Inspection Rate Slider */}
               <div className="bg-black/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                     <span className="text-sm font-bold">Inspection Rate</span>
                     <button onClick={() => setInfoTopic('inspection')} className="text-cyan-400 text-xs">‚ÑπÔ∏è</button>
                  </div>
                  <input
                     type="range"
                     min="0"
                     max="100"
                     step="10"
                     value={inspectionRate}
                     onChange={(e) => setInspectionRate(Number(e.target.value))}
                     className="w-full accent-cyan-500"
                  />
                  <div className="flex justify-between text-xs text-slate-400 mt-1">
                     <span>0%</span>
                     <span className="text-cyan-400 font-bold">{inspectionRate}% ({Math.floor(batchSize * inspectionRate / 100)} units)</span>
                     <span>100%</span>
                  </div>
               </div>

               {/* Quality Standard Selector */}
               <div className="bg-black/30 rounded-lg p-3">
                  <div className="flex justify-between items-center mb-2">
                     <span className="text-sm font-bold">Quality Standard</span>
                     <button onClick={() => setInfoTopic('standards')} className="text-cyan-400 text-xs">‚ÑπÔ∏è</button>
                  </div>
                  <div className="grid grid-cols-3 gap-2">
                     {(['loose', 'standard', 'strict'] as const).map(std => (
                        <button
                           key={std}
                           onClick={() => setQualityStandard(std)}
                           className={`py-2 rounded-lg text-xs font-bold transition-all ${
                              qualityStandard === std
                                 ? 'bg-cyan-600 text-white'
                                 : 'bg-slate-700/50 text-slate-400 hover:bg-slate-600/50'
                           }`}
                        >
                           {std === 'loose' && 'üòå Loose'}
                           {std === 'standard' && '‚öñÔ∏è Standard'}
                           {std === 'strict' && 'üî¨ Strict'}
                        </button>
                     ))}
                  </div>
                  <div className="text-xs text-slate-400 mt-2 text-center">
                     {qualityStandard === 'loose' && 'Accept minor flaws ‚Ä¢ Lower cost ‚Ä¢ More returns'}
                     {qualityStandard === 'standard' && 'Industry normal ‚Ä¢ Balanced approach'}
                     {qualityStandard === 'strict' && 'Zero tolerance ‚Ä¢ Higher cost ‚Ä¢ Fewer returns'}
                  </div>
               </div>
            </div>

            {/* Batch Visualization */}
            {currentBatch && (
               <div className="flex-1 p-3 overflow-auto">
                  <div className="bg-black/30 rounded-lg p-3">
                     <div className="flex justify-between items-center mb-2">
                        <span className="text-sm font-bold">üì¶ Current Batch</span>
                        <span className="text-xs text-slate-400">{batchSize} units</span>
                     </div>
                     <div className="grid grid-cols-20 gap-[2px]">
                        {currentBatch.units.slice(0, 100).map((unit, i) => (
                           <div
                              key={i}
                              className={`w-2 h-2 rounded-sm ${
                                 unit.hasDefect
                                    ? 'bg-red-500/30'
                                    : 'bg-green-500/30'
                              }`}
                              title={unit.hasDefect ? 'May have defect' : 'Good unit'}
                           />
                        ))}
                     </div>
                     <p className="text-xs text-slate-500 mt-2 text-center">
                        (Defects hidden until shipped - just like real production!)
                     </p>
                  </div>

                  {/* History */}
                  {batchHistory.length > 0 && (
                     <div className="mt-3 bg-black/30 rounded-lg p-3">
                        <span className="text-xs font-bold text-slate-400">History</span>
                        <div className="mt-2 space-y-1 max-h-24 overflow-auto">
                           {batchHistory.slice(-5).map((h, i) => (
                              <div key={i} className="flex justify-between text-xs">
                                 <span>Batch {h.batch}</span>
                                 <span className="text-green-400">‚úì{h.defectsFound}</span>
                                 <span className="text-red-400">‚úó{h.defectsShipped}</span>
                                 <span className="text-yellow-400">‚Ü©{h.returns}</span>
                              </div>
                           ))}
                        </div>
                     </div>
                  )}
               </div>
            )}

            {/* Action Bar */}
            <div className="p-3 bg-black/30 border-t border-cyan-500/30">
               <div className="flex gap-2 items-center justify-between mb-2">
                  <div className="flex gap-2">
                     <button onClick={() => setInfoTopic('cost_of_quality')} className="text-xs text-cyan-400 hover:text-white">üí∞ Cost of Quality</button>
                     <button onClick={() => setInfoTopic('six_sigma')} className="text-xs text-cyan-400 hover:text-white">üìä Six Sigma</button>
                     <button onClick={() => setInfoTopic('continuous')} className="text-xs text-cyan-400 hover:text-white">üîÑ Kaizen</button>
                  </div>
               </div>
               <button
                  onClick={processBatch}
                  className="w-full py-3 bg-gradient-to-r from-cyan-600 to-teal-600 hover:from-cyan-500 hover:to-teal-500 rounded-xl font-bold transition-all"
               >
                  üì¶ SHIP BATCH {batch}
               </button>
            </div>
         </div>
      );
   };

   // --- CUSTOMER SUCCESS RENDERER ---
   const CustomerSuccessRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [month, setMonth] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      const totalMonths = 12;

      const [budget, setBudget] = useState(10000); // Monthly CS budget
      const [customers, setCustomers] = useState(100);
      const [satisfaction, setSatisfaction] = useState(70); // 0-100
      const [churnRate, setChurnRate] = useState(5); // % per month

      const [investments, setInvestments] = useState({
         support: 0,      // Customer support quality
         onboarding: 0,   // Onboarding experience
         engagement: 0,   // Proactive engagement
         loyalty: 0,      // Loyalty rewards
         feedback: 0,     // Feedback & improvements
      });

      const [stats, setStats] = useState({
         totalRevenue: 0,
         totalChurned: 0,
         totalAcquired: 0,
         totalSpent: 0,
         averageLTV: 0,
         nps: 0,
      });

      const [monthHistory, setMonthHistory] = useState<{
         month: number;
         customers: number;
         churned: number;
         acquired: number;
         satisfaction: number;
         revenue: number;
      }[]>([]);

      const infoTopics: Record<string, { title: string; content: string }> = {
         churn: {
            title: "Customer Churn",
            content: "The percentage of customers who stop using your product each period. A 5% monthly churn means losing half your customers in a year! Reducing churn by even 1% can dramatically increase lifetime value. It costs 5-25x more to acquire a new customer than retain an existing one."
         },
         ltv: {
            title: "Customer Lifetime Value (LTV)",
            content: "The total revenue expected from a customer over their entire relationship. LTV = Average Revenue √ó Customer Lifespan. If monthly revenue is $100 and average lifespan is 20 months, LTV = $2,000. Higher LTV justifies higher acquisition costs."
         },
         nps: {
            title: "Net Promoter Score (NPS)",
            content: "Measures customer loyalty: 'How likely are you to recommend us?' (0-10). Promoters (9-10) minus Detractors (0-6) = NPS. Score ranges from -100 to +100. Above 0 is good, above 50 is excellent. Promoters drive organic growth through referrals!"
         },
         onboarding: {
            title: "Customer Onboarding",
            content: "The process of helping new customers succeed with your product. Good onboarding reduces early churn dramatically‚Äîmost churn happens in the first 90 days! Include welcome sequences, tutorials, milestone celebrations, and check-ins."
         },
         retention: {
            title: "Retention Strategies",
            content: "Key tactics: 1) Proactive support (don't wait for complaints), 2) Regular engagement (newsletters, updates), 3) Loyalty rewards (discounts, perks), 4) Feedback loops (act on input), 5) Community building. The goal is to become indispensable!"
         }
      };

      useEffect(() => {
         if (infoTopic && infoTopics[infoTopic]) {
            setShowInfo(true);
         }
      }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setMonth(1);
         setBudget(10000);
         setCustomers(100);
         setSatisfaction(70);
         setChurnRate(5);
         setInvestments({ support: 0, onboarding: 0, engagement: 0, loyalty: 0, feedback: 0 });
         setStats({ totalRevenue: 0, totalChurned: 0, totalAcquired: 0, totalSpent: 0, averageLTV: 0, nps: 0 });
         setMonthHistory([]);
         setGameLog(["Customer Success simulation started with 100 customers"]);
      };

      const getTotalInvestment = () => {
         return Object.values(investments).reduce((a, b) => a + b, 0);
      };

      const processMonth = () => {
         const totalInvested = getTotalInvestment();

         // Calculate satisfaction change based on investments
         const supportImpact = investments.support * 0.02;
         const onboardingImpact = investments.onboarding * 0.015;
         const engagementImpact = investments.engagement * 0.018;
         const loyaltyImpact = investments.loyalty * 0.012;
         const feedbackImpact = investments.feedback * 0.015;

         const satisfactionChange = supportImpact + onboardingImpact + engagementImpact + loyaltyImpact + feedbackImpact - 3; // Natural decay of 3
         const newSatisfaction = Math.max(0, Math.min(100, satisfaction + satisfactionChange));

         // Churn rate based on satisfaction
         const baseChurn = 15 - (newSatisfaction / 10); // High satisfaction = low churn
         const newChurnRate = Math.max(1, Math.min(20, baseChurn));

         // Calculate churned customers
         const churned = Math.floor(customers * (newChurnRate / 100));

         // New customers (word of mouth based on satisfaction + small organic)
         const referralRate = newSatisfaction > 80 ? 0.08 : newSatisfaction > 60 ? 0.04 : 0.02;
         const acquired = Math.floor(customers * referralRate) + Math.floor(Math.random() * 5);

         // Revenue ($50 per customer per month)
         const revenuePerCustomer = 50;
         const monthlyRevenue = customers * revenuePerCustomer;

         // Update customers
         const newCustomers = customers - churned + acquired;

         // Calculate NPS based on satisfaction
         const nps = Math.round((newSatisfaction - 50) * 2);

         // Update state
         setSatisfaction(newSatisfaction);
         setChurnRate(newChurnRate);
         setCustomers(newCustomers);
         setBudget(prev => prev - totalInvested + 10000); // Replenish budget each month

         const newStats = {
            totalRevenue: stats.totalRevenue + monthlyRevenue,
            totalChurned: stats.totalChurned + churned,
            totalAcquired: stats.totalAcquired + acquired,
            totalSpent: stats.totalSpent + totalInvested,
            averageLTV: Math.round((stats.totalRevenue + monthlyRevenue) / (stats.totalChurned + churned + 1) * 12),
            nps: nps,
         };
         setStats(newStats);

         setMonthHistory(prev => [...prev, {
            month,
            customers,
            churned,
            acquired,
            satisfaction: Math.round(newSatisfaction),
            revenue: monthlyRevenue
         }]);

         setGameLog(prev => [...prev,
            `Month ${month}: ${churned} churned, ${acquired} acquired, satisfaction ${Math.round(newSatisfaction)}%, revenue $${monthlyRevenue}`
         ]);

         if (month >= totalMonths) {
            setGameLog(prev => [...prev,
               `Year complete! Final customers: ${newCustomers}, Total revenue: $${newStats.totalRevenue}`
            ]);
            setPhase('result');
         } else {
            setMonth(month + 1);
         }
      };

      const adjustInvestment = (category: keyof typeof investments, delta: number) => {
         const newValue = Math.max(0, Math.min(5000, investments[category] + delta));
         const newTotal = getTotalInvestment() - investments[category] + newValue;
         if (newTotal <= budget) {
            setInvestments(prev => ({ ...prev, [category]: newValue }));
         }
      };

      const getScore = () => {
         const revenueScore = Math.min(40, stats.totalRevenue / 2000);
         const retentionScore = Math.min(30, (1 - stats.totalChurned / 200) * 30);
         const satisfactionScore = satisfaction * 0.3;
         return Math.round(revenueScore + retentionScore + satisfactionScore);
      };

      const getGrade = () => {
         const score = getScore();
         if (score >= 85) return { letter: 'A', label: 'Customer Champion', color: 'text-green-400' };
         if (score >= 70) return { letter: 'B', label: 'Success Manager', color: 'text-blue-400' };
         if (score >= 55) return { letter: 'C', label: 'Learning the Ropes', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Needs Work', color: 'text-red-400' };
      };

      // Intro Phase
      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-emerald-900 via-green-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <h1 className="text-2xl font-bold mb-2">üíö Customer Success Simulator</h1>
                  <p className="text-emerald-300 text-sm">Master retention and grow your customer base</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <h2 className="text-lg font-bold mb-3 text-emerald-400">üìã How It Works</h2>
                  <div className="space-y-2 text-sm">
                     <p>‚Ä¢ You start with <span className="text-white font-bold">100 customers</span> and a <span className="text-white font-bold">$10K monthly budget</span></p>
                     <p>‚Ä¢ Each customer generates <span className="text-emerald-400">$50/month</span> in revenue</p>
                     <p>‚Ä¢ Invest in retention strategies to reduce churn</p>
                     <p>‚Ä¢ Happy customers refer new ones‚Äîsatisfaction drives growth!</p>
                     <p>‚Ä¢ Run your business for <span className="text-white font-bold">12 months</span></p>
                  </div>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-black/30 rounded-lg p-3">
                     <h3 className="font-bold text-red-400 mb-2">‚ö†Ô∏è The Challenge</h3>
                     <p className="text-xs text-slate-300">5% monthly churn = 46% annual loss!</p>
                     <p className="text-xs text-slate-300">Acquire costs 5x more than retain</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3">
                     <h3 className="font-bold text-green-400 mb-2">üéØ Goal</h3>
                     <p className="text-xs text-slate-300">Maximize customer base</p>
                     <p className="text-xs text-slate-300">Keep satisfaction high!</p>
                  </div>
               </div>

               <div className="flex flex-wrap gap-2 mb-4">
                  {Object.keys(infoTopics).map(key => (
                     <button
                        key={key}
                        onClick={() => setInfoTopic(key)}
                        className="text-xs bg-emerald-500/20 hover:bg-emerald-500/40 px-2 py-1 rounded-full text-emerald-300"
                     >
                        ‚ÑπÔ∏è {infoTopics[key].title}
                     </button>
                  ))}
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 rounded-xl font-bold text-lg transition-all"
               >
                  ‚ñ∂Ô∏è START YEAR 1
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-emerald-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-emerald-600 rounded-lg">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // Result Phase
      if (phase === 'result') {
         const grade = getGrade();
         const customerGrowth = customers - 100;
         const growthPercent = ((customers / 100 - 1) * 100).toFixed(0);

         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-emerald-900 via-green-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-emerald-400">Score: {getScore()}/100</div>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-green-400">{customers}</div>
                     <div className="text-xs text-slate-400">Final Customers</div>
                     <div className={`text-xs ${customerGrowth >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                        {customerGrowth >= 0 ? '+' : ''}{growthPercent}%
                     </div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-emerald-400">${stats.totalRevenue.toLocaleString()}</div>
                     <div className="text-xs text-slate-400">Total Revenue</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-red-400">{stats.totalChurned}</div>
                     <div className="text-xs text-slate-400">Total Churned</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-blue-400">{stats.totalAcquired}</div>
                     <div className="text-xs text-slate-400">Total Acquired</div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-emerald-400 mb-2">üìä Key Metrics</h3>
                  <div className="grid grid-cols-3 gap-2 text-center text-xs">
                     <div>
                        <div className="font-bold text-lg">{Math.round(satisfaction)}%</div>
                        <div className="text-slate-400">Satisfaction</div>
                     </div>
                     <div>
                        <div className="font-bold text-lg">{churnRate.toFixed(1)}%</div>
                        <div className="text-slate-400">Churn Rate</div>
                     </div>
                     <div>
                        <div className={`font-bold text-lg ${stats.nps >= 0 ? 'text-green-400' : 'text-red-400'}`}>{stats.nps > 0 ? '+' : ''}{stats.nps}</div>
                        <div className="text-slate-400">NPS</div>
                     </div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-emerald-400 mb-2">üí° Key Insight</h3>
                  <p className="text-sm text-slate-300">
                     {customers > 100
                        ? "Great job growing your customer base! High satisfaction leads to referrals, creating a virtuous cycle. Remember: happy customers are your best marketing."
                        : stats.totalChurned > 50
                        ? "High churn ate into your customer base. Investing more in retention (support, onboarding, engagement) reduces churn and increases lifetime value."
                        : "Retention is the key to sustainable growth. It costs 5x more to acquire a customer than retain one. Focus on making existing customers successful!"
                     }
                  </p>
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 rounded-xl font-bold transition-all"
               >
                  üîÑ TRY AGAIN
               </button>
            </div>
         );
      }

      // Play Phase
      const totalInvested = getTotalInvestment();
      const remaining = budget - totalInvested;

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-emerald-900 via-green-900 to-slate-900 text-white overflow-hidden">
            {/* Info Modal */}
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-emerald-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-emerald-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-emerald-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="font-bold">üíö Customer Success</span>
                  <span className="text-emerald-400">Month {month}/{totalMonths}</span>
               </div>
               <div className="grid grid-cols-4 gap-2 text-center text-xs">
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-green-400 font-bold">{customers}</div>
                     <div className="text-slate-500">Customers</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-emerald-400 font-bold">{Math.round(satisfaction)}%</div>
                     <div className="text-slate-500">Satisfaction</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-red-400 font-bold">{churnRate.toFixed(1)}%</div>
                     <div className="text-slate-500">Churn</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-yellow-400 font-bold">${remaining.toLocaleString()}</div>
                     <div className="text-slate-500">Budget Left</div>
                  </div>
               </div>
            </div>

            {/* Investment Sliders */}
            <div className="flex-1 p-3 overflow-auto space-y-2">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-bold">Monthly Investments</span>
                  <button onClick={() => setInfoTopic('retention')} className="text-emerald-400 text-xs">‚ÑπÔ∏è Strategies</button>
               </div>

               {[
                  { key: 'support', label: 'üéß Support Quality', desc: 'Fast, helpful customer service' },
                  { key: 'onboarding', label: 'üöÄ Onboarding', desc: 'Help new customers succeed' },
                  { key: 'engagement', label: 'üìß Engagement', desc: 'Proactive outreach & updates' },
                  { key: 'loyalty', label: 'üéÅ Loyalty Rewards', desc: 'Perks for long-term customers' },
                  { key: 'feedback', label: 'üìù Feedback Loop', desc: 'Listen and improve' },
               ].map(({ key, label, desc }) => (
                  <div key={key} className="bg-black/30 rounded-lg p-2">
                     <div className="flex justify-between items-center mb-1">
                        <span className="text-xs font-bold">{label}</span>
                        <span className="text-xs text-emerald-400">${investments[key as keyof typeof investments].toLocaleString()}</span>
                     </div>
                     <div className="flex items-center gap-2">
                        <button
                           onClick={() => adjustInvestment(key as keyof typeof investments, -500)}
                           className="px-2 py-1 bg-red-600/50 hover:bg-red-500/50 rounded text-xs"
                        >
                           -$500
                        </button>
                        <div className="flex-1 h-2 bg-slate-700 rounded-full overflow-hidden">
                           <div
                              className="h-full bg-emerald-500 transition-all"
                              style={{ width: `${(investments[key as keyof typeof investments] / 5000) * 100}%` }}
                           />
                        </div>
                        <button
                           onClick={() => adjustInvestment(key as keyof typeof investments, 500)}
                           disabled={remaining < 500}
                           className="px-2 py-1 bg-green-600/50 hover:bg-green-500/50 disabled:opacity-50 rounded text-xs"
                        >
                           +$500
                        </button>
                     </div>
                     <p className="text-[10px] text-slate-500 mt-1">{desc}</p>
                  </div>
               ))}

               {/* History */}
               {monthHistory.length > 0 && (
                  <div className="bg-black/30 rounded-lg p-2 mt-3">
                     <span className="text-xs font-bold text-slate-400">Recent History</span>
                     <div className="mt-1 space-y-1 max-h-20 overflow-auto">
                        {monthHistory.slice(-4).map((h, i) => (
                           <div key={i} className="flex justify-between text-xs">
                              <span>Month {h.month}</span>
                              <span className="text-red-400">-{h.churned}</span>
                              <span className="text-green-400">+{h.acquired}</span>
                              <span className="text-emerald-400">{h.satisfaction}%</span>
                           </div>
                        ))}
                     </div>
                  </div>
               )}
            </div>

            {/* Action Bar */}
            <div className="p-3 bg-black/30 border-t border-emerald-500/30">
               <div className="flex gap-2 items-center justify-between mb-2">
                  <div className="flex gap-2">
                     <button onClick={() => setInfoTopic('churn')} className="text-xs text-emerald-400 hover:text-white">üìâ Churn</button>
                     <button onClick={() => setInfoTopic('ltv')} className="text-xs text-emerald-400 hover:text-white">üí∞ LTV</button>
                     <button onClick={() => setInfoTopic('nps')} className="text-xs text-emerald-400 hover:text-white">üìä NPS</button>
                  </div>
                  <span className="text-xs text-emerald-400">Revenue: ${(customers * 50).toLocaleString()}/mo</span>
               </div>
               <button
                  onClick={processMonth}
                  className="w-full py-3 bg-gradient-to-r from-emerald-600 to-green-600 hover:from-emerald-500 hover:to-green-500 rounded-xl font-bold transition-all"
               >
                  ‚ñ∂Ô∏è END MONTH {month}
               </button>
            </div>
         </div>
      );
   };

   // --- AGILE METHODOLOGY RENDERER ---
   const AgileRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [sprint, setSprint] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      const totalSprints = 6;
      const sprintLength = 2; // weeks

      const [teamVelocity, setTeamVelocity] = useState(20); // story points per sprint
      const [teamMorale, setTeamMorale] = useState(80);

      const [backlog, setBacklog] = useState<{
         id: string;
         title: string;
         points: number;
         priority: 'critical' | 'high' | 'medium' | 'low';
         status: 'backlog' | 'sprint' | 'done';
         type: 'feature' | 'bug' | 'tech_debt';
      }[]>([]);

      const [sprintBacklog, setSprintBacklog] = useState<string[]>([]);

      const [stats, setStats] = useState({
         totalPointsDelivered: 0,
         totalSprints: 0,
         averageVelocity: 0,
         bugsFixed: 0,
         featuresShipped: 0,
         techDebtPaid: 0,
         scopeChanges: 0,
      });

      const [sprintHistory, setSprintHistory] = useState<{
         sprint: number;
         planned: number;
         delivered: number;
         velocity: number;
         morale: number;
      }[]>([]);

      const [sprintEvent, setSprintEvent] = useState<string | null>(null);

      const infoTopics: Record<string, { title: string; content: string }> = {
         scrum: {
            title: "Scrum Framework",
            content: "Scrum is an Agile framework with fixed-length sprints (usually 2 weeks). Key roles: Product Owner (what to build), Scrum Master (process), Dev Team (how to build). Key events: Sprint Planning, Daily Standup, Sprint Review, Retrospective."
         },
         velocity: {
            title: "Team Velocity",
            content: "Velocity is story points completed per sprint. It's a planning tool, not a performance metric! Use past velocity to forecast future sprints. Velocity stabilizes over time as the team finds its rhythm. Never compare velocities between teams."
         },
         stories: {
            title: "User Stories",
            content: "User stories describe features from the user's perspective: 'As a [user], I want [feature] so that [benefit].' Stories are estimated in story points (relative complexity), not hours. Common scale: 1, 2, 3, 5, 8, 13 (Fibonacci). If it's bigger than 13, break it down!"
         },
         retrospective: {
            title: "Retrospectives",
            content: "The 'retro' happens after each sprint to improve the process. Ask: What went well? What didn't? What will we change? This is where real improvement happens. Teams that skip retros stop improving. Psychological safety is crucial for honest feedback."
         },
         debt: {
            title: "Technical Debt",
            content: "Tech debt is the cost of shortcuts taken for speed. Like financial debt, it accumulates interest‚Äîmaking future work harder. Balance: Some debt is acceptable for speed-to-market, but pay it down regularly or velocity will slow. Budget 20% of each sprint for debt."
         }
      };

      useEffect(() => {
         if (infoTopic && infoTopics[infoTopic]) {
            setShowInfo(true);
         }
      }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setSprint(1);
         setTeamVelocity(20);
         setTeamMorale(80);
         setSprintBacklog([]);
         setSprintEvent(null);
         setStats({
            totalPointsDelivered: 0,
            totalSprints: 0,
            averageVelocity: 0,
            bugsFixed: 0,
            featuresShipped: 0,
            techDebtPaid: 0,
            scopeChanges: 0,
         });
         setSprintHistory([]);

         // Generate initial backlog
         const initialBacklog = [
            { id: 'f1', title: 'User Authentication', points: 8, priority: 'critical' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'f2', title: 'Dashboard UI', points: 5, priority: 'high' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'f3', title: 'Payment Integration', points: 13, priority: 'critical' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'f4', title: 'Email Notifications', points: 5, priority: 'medium' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'f5', title: 'Search Feature', points: 8, priority: 'high' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'b1', title: 'Login Bug Fix', points: 3, priority: 'critical' as const, status: 'backlog' as const, type: 'bug' as const },
            { id: 'b2', title: 'Mobile Layout Issues', points: 5, priority: 'high' as const, status: 'backlog' as const, type: 'bug' as const },
            { id: 't1', title: 'Refactor Database', points: 8, priority: 'medium' as const, status: 'backlog' as const, type: 'tech_debt' as const },
            { id: 't2', title: 'Update Dependencies', points: 3, priority: 'low' as const, status: 'backlog' as const, type: 'tech_debt' as const },
            { id: 'f6', title: 'User Profiles', points: 5, priority: 'medium' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'f7', title: 'Admin Panel', points: 8, priority: 'low' as const, status: 'backlog' as const, type: 'feature' as const },
            { id: 'f8', title: 'Analytics Dashboard', points: 13, priority: 'medium' as const, status: 'backlog' as const, type: 'feature' as const },
         ];
         setBacklog(initialBacklog);
         setGameLog(["Agile simulation started - Plan your first sprint!"]);
      };

      const addToSprint = (itemId: string) => {
         const item = backlog.find(b => b.id === itemId);
         if (!item) return;

         const currentPoints = sprintBacklog.reduce((sum, id) => {
            const i = backlog.find(b => b.id === id);
            return sum + (i?.points || 0);
         }, 0);

         if (currentPoints + item.points <= teamVelocity + 5) { // Allow slight over-commitment
            setSprintBacklog(prev => [...prev, itemId]);
            setBacklog(prev => prev.map(b => b.id === itemId ? { ...b, status: 'sprint' as const } : b));
         }
      };

      const removeFromSprint = (itemId: string) => {
         setSprintBacklog(prev => prev.filter(id => id !== itemId));
         setBacklog(prev => prev.map(b => b.id === itemId ? { ...b, status: 'backlog' as const } : b));
      };

      const runSprint = () => {
         const plannedPoints = sprintBacklog.reduce((sum, id) => {
            const item = backlog.find(b => b.id === id);
            return sum + (item?.points || 0);
         }, 0);

         // Random events that affect the sprint
         const events = [
            { text: "üéâ Team collaboration was excellent!", velocityMod: 1.1, moraleMod: 5 },
            { text: "üêõ Critical production bug diverted resources", velocityMod: 0.7, moraleMod: -10 },
            { text: "üìã Stakeholder added urgent requirements", velocityMod: 0.8, moraleMod: -5, scopeChange: true },
            { text: "üöÄ New team member ramped up quickly", velocityMod: 1.05, moraleMod: 5 },
            { text: "üò∑ Team member was sick for a week", velocityMod: 0.85, moraleMod: -5 },
            { text: "üí° Found a simpler solution!", velocityMod: 1.15, moraleMod: 10 },
            { text: "üìö Sprint went smoothly as planned", velocityMod: 1.0, moraleMod: 0 },
         ];

         const event = events[Math.floor(Math.random() * events.length)];
         setSprintEvent(event.text);

         // Calculate actual delivery
         const effectiveVelocity = Math.round(teamVelocity * event.velocityMod);
         let remainingCapacity = effectiveVelocity;
         let delivered = 0;
         let bugsFixed = 0;
         let featuresShipped = 0;
         let techDebtPaid = 0;

         const updatedBacklog = backlog.map(item => {
            if (item.status === 'sprint' && remainingCapacity >= item.points) {
               remainingCapacity -= item.points;
               delivered += item.points;
               if (item.type === 'bug') bugsFixed++;
               if (item.type === 'feature') featuresShipped++;
               if (item.type === 'tech_debt') techDebtPaid++;
               return { ...item, status: 'done' as const };
            } else if (item.status === 'sprint') {
               // Incomplete - back to backlog
               return { ...item, status: 'backlog' as const };
            }
            return item;
         });

         setBacklog(updatedBacklog);
         setSprintBacklog([]);

         // Update morale
         const newMorale = Math.max(20, Math.min(100, teamMorale + event.moraleMod + (delivered >= plannedPoints ? 5 : -5)));
         setTeamMorale(newMorale);

         // Update velocity based on morale
         const moraleEffect = (newMorale - 50) / 100; // -0.3 to +0.5
         const newVelocity = Math.round(20 * (1 + moraleEffect));
         setTeamVelocity(newVelocity);

         const newStats = {
            totalPointsDelivered: stats.totalPointsDelivered + delivered,
            totalSprints: stats.totalSprints + 1,
            averageVelocity: Math.round((stats.totalPointsDelivered + delivered) / (stats.totalSprints + 1)),
            bugsFixed: stats.bugsFixed + bugsFixed,
            featuresShipped: stats.featuresShipped + featuresShipped,
            techDebtPaid: stats.techDebtPaid + techDebtPaid,
            scopeChanges: stats.scopeChanges + (event.scopeChange ? 1 : 0),
         };
         setStats(newStats);

         setSprintHistory(prev => [...prev, {
            sprint,
            planned: plannedPoints,
            delivered,
            velocity: effectiveVelocity,
            morale: newMorale
         }]);

         setGameLog(prev => [...prev,
            `Sprint ${sprint}: Planned ${plannedPoints}pts, delivered ${delivered}pts. ${event.text}`
         ]);

         if (sprint >= totalSprints) {
            setGameLog(prev => [...prev,
               `Project complete! Total delivered: ${newStats.totalPointsDelivered} points`
            ]);
            setPhase('result');
         } else {
            setSprint(sprint + 1);
         }
      };

      const getSprintPoints = () => {
         return sprintBacklog.reduce((sum, id) => {
            const item = backlog.find(b => b.id === id);
            return sum + (item?.points || 0);
         }, 0);
      };

      const getScore = () => {
         const deliveryScore = Math.min(40, stats.totalPointsDelivered / 2);
         const moraleScore = teamMorale * 0.3;
         const balanceScore = Math.min(30, (stats.bugsFixed * 3 + stats.techDebtPaid * 5));
         return Math.round(deliveryScore + moraleScore + balanceScore);
      };

      const getGrade = () => {
         const score = getScore();
         if (score >= 85) return { letter: 'A', label: 'Agile Master', color: 'text-green-400' };
         if (score >= 70) return { letter: 'B', label: 'Sprint Champion', color: 'text-blue-400' };
         if (score >= 55) return { letter: 'C', label: 'Learning Scrum', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Waterfall Refugee', color: 'text-red-400' };
      };

      const getPriorityColor = (priority: string) => {
         switch (priority) {
            case 'critical': return 'text-red-400 bg-red-500/20';
            case 'high': return 'text-orange-400 bg-orange-500/20';
            case 'medium': return 'text-yellow-400 bg-yellow-500/20';
            case 'low': return 'text-slate-400 bg-slate-500/20';
            default: return 'text-slate-400';
         }
      };

      const getTypeIcon = (type: string) => {
         switch (type) {
            case 'feature': return '‚ú®';
            case 'bug': return 'üêõ';
            case 'tech_debt': return 'üîß';
            default: return 'üìã';
         }
      };

      // Intro Phase
      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <h1 className="text-2xl font-bold mb-2">üèÉ Agile Sprint Simulator</h1>
                  <p className="text-purple-300 text-sm">Master Scrum and deliver value iteratively</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <h2 className="text-lg font-bold mb-3 text-purple-400">üìã How It Works</h2>
                  <div className="space-y-2 text-sm">
                     <p>‚Ä¢ Run <span className="text-white font-bold">{totalSprints} sprints</span> ({sprintLength} weeks each)</p>
                     <p>‚Ä¢ Select items from the <span className="text-purple-400">Product Backlog</span> for each sprint</p>
                     <p>‚Ä¢ Balance features, bugs, and tech debt</p>
                     <p>‚Ä¢ Team velocity is ~<span className="text-white font-bold">20 points/sprint</span></p>
                     <p>‚Ä¢ Random events affect delivery‚Äîadapt and overcome!</p>
                  </div>
               </div>

               <div className="grid grid-cols-3 gap-2 mb-4 text-center">
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-lg">‚ú®</span>
                     <p className="text-xs text-slate-300">Features</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-lg">üêõ</span>
                     <p className="text-xs text-slate-300">Bugs</p>
                  </div>
                  <div className="bg-black/30 rounded-lg p-2">
                     <span className="text-lg">üîß</span>
                     <p className="text-xs text-slate-300">Tech Debt</p>
                  </div>
               </div>

               <div className="flex flex-wrap gap-2 mb-4">
                  {Object.keys(infoTopics).map(key => (
                     <button
                        key={key}
                        onClick={() => setInfoTopic(key)}
                        className="text-xs bg-purple-500/20 hover:bg-purple-500/40 px-2 py-1 rounded-full text-purple-300"
                     >
                        ‚ÑπÔ∏è {infoTopics[key].title}
                     </button>
                  ))}
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 rounded-xl font-bold text-lg transition-all"
               >
                  ‚ñ∂Ô∏è START SPRINT 1
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-purple-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-purple-600 rounded-lg">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // Result Phase
      if (phase === 'result') {
         const grade = getGrade();

         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-purple-400">Score: {getScore()}/100</div>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-purple-400">{stats.totalPointsDelivered}</div>
                     <div className="text-xs text-slate-400">Points Delivered</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-blue-400">{stats.averageVelocity}</div>
                     <div className="text-xs text-slate-400">Avg Velocity</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-green-400">{stats.featuresShipped}</div>
                     <div className="text-xs text-slate-400">Features Shipped</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-yellow-400">{teamMorale}%</div>
                     <div className="text-xs text-slate-400">Team Morale</div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-purple-400 mb-2">üìä Sprint Breakdown</h3>
                  <div className="grid grid-cols-3 gap-2 text-center text-xs">
                     <div>
                        <div className="font-bold text-lg text-green-400">{stats.featuresShipped}</div>
                        <div className="text-slate-400">‚ú® Features</div>
                     </div>
                     <div>
                        <div className="font-bold text-lg text-red-400">{stats.bugsFixed}</div>
                        <div className="text-slate-400">üêõ Bugs Fixed</div>
                     </div>
                     <div>
                        <div className="font-bold text-lg text-orange-400">{stats.techDebtPaid}</div>
                        <div className="text-slate-400">üîß Debt Paid</div>
                     </div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-purple-400 mb-2">üí° Key Insight</h3>
                  <p className="text-sm text-slate-300">
                     {stats.techDebtPaid === 0
                        ? "You shipped features but ignored tech debt! In real projects, this slows velocity over time. Budget ~20% of each sprint for maintenance."
                        : stats.bugsFixed < 2
                        ? "Bugs pile up when ignored. Fixing bugs early prevents bigger problems. Critical bugs should jump to the top of the backlog."
                        : teamMorale < 50
                        ? "Team morale affects velocity! Overcommitting and missing targets hurts morale. Sustainable pace > heroic sprints."
                        : "Great balance of features, bugs, and tech debt! Sustainable teams deliver more value over time than teams that burn out."
                     }
                  </p>
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 rounded-xl font-bold transition-all"
               >
                  üîÑ TRY AGAIN
               </button>
            </div>
         );
      }

      // Play Phase
      const sprintPoints = getSprintPoints();
      const availableBacklog = backlog.filter(b => b.status === 'backlog');
      const sprintItems = backlog.filter(b => b.status === 'sprint');

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900 text-white overflow-hidden">
            {/* Info Modal */}
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-purple-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-purple-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-purple-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="font-bold">üèÉ Sprint {sprint}/{totalSprints}</span>
                  <span className="text-purple-400">{sprintLength} weeks</span>
               </div>
               <div className="grid grid-cols-4 gap-2 text-center text-xs">
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-purple-400 font-bold">{sprintPoints}/{teamVelocity}</div>
                     <div className="text-slate-500">Points</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-blue-400 font-bold">{teamVelocity}</div>
                     <div className="text-slate-500">Velocity</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className={`font-bold ${teamMorale >= 60 ? 'text-green-400' : teamMorale >= 40 ? 'text-yellow-400' : 'text-red-400'}`}>{teamMorale}%</div>
                     <div className="text-slate-500">Morale</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-green-400 font-bold">{stats.totalPointsDelivered}</div>
                     <div className="text-slate-500">Delivered</div>
                  </div>
               </div>
               {sprintEvent && (
                  <div className="mt-2 text-xs text-center text-purple-300 bg-purple-500/20 rounded p-1">
                     {sprintEvent}
                  </div>
               )}
            </div>

            {/* Main Content */}
            <div className="flex-1 p-3 overflow-auto">
               {/* Sprint Backlog */}
               <div className="mb-3">
                  <div className="flex justify-between items-center mb-2">
                     <span className="text-sm font-bold">üìã Sprint Backlog</span>
                     <span className={`text-xs ${sprintPoints > teamVelocity ? 'text-red-400' : 'text-purple-400'}`}>
                        {sprintPoints} / {teamVelocity} pts
                     </span>
                  </div>
                  {sprintItems.length === 0 ? (
                     <div className="bg-black/20 rounded-lg p-3 text-center text-slate-500 text-sm">
                        Add items from the backlog below
                     </div>
                  ) : (
                     <div className="space-y-1">
                        {sprintItems.map(item => (
                           <div key={item.id} className="bg-purple-500/20 rounded-lg p-2 flex justify-between items-center">
                              <div className="flex items-center gap-2">
                                 <span>{getTypeIcon(item.type)}</span>
                                 <span className="text-xs">{item.title}</span>
                              </div>
                              <div className="flex items-center gap-2">
                                 <span className={`text-xs px-1 rounded ${getPriorityColor(item.priority)}`}>{item.points}pts</span>
                                 <button onClick={() => removeFromSprint(item.id)} className="text-red-400 text-xs">‚úï</button>
                              </div>
                           </div>
                        ))}
                     </div>
                  )}
               </div>

               {/* Product Backlog */}
               <div>
                  <div className="flex justify-between items-center mb-2">
                     <span className="text-sm font-bold">üì¶ Product Backlog</span>
                     <span className="text-xs text-slate-400">{availableBacklog.length} items</span>
                  </div>
                  <div className="space-y-1 max-h-40 overflow-auto">
                     {availableBacklog.map(item => (
                        <div key={item.id} className="bg-black/30 rounded-lg p-2 flex justify-between items-center">
                           <div className="flex items-center gap-2">
                              <span>{getTypeIcon(item.type)}</span>
                              <span className="text-xs">{item.title}</span>
                           </div>
                           <div className="flex items-center gap-2">
                              <span className={`text-xs px-1 rounded ${getPriorityColor(item.priority)}`}>{item.priority}</span>
                              <span className="text-xs text-slate-400">{item.points}pts</span>
                              <button
                                 onClick={() => addToSprint(item.id)}
                                 disabled={sprintPoints + item.points > teamVelocity + 5}
                                 className="text-green-400 text-xs disabled:opacity-50"
                              >
                                 +
                              </button>
                           </div>
                        </div>
                     ))}
                  </div>
               </div>

               {/* Sprint History */}
               {sprintHistory.length > 0 && (
                  <div className="mt-3 bg-black/30 rounded-lg p-2">
                     <span className="text-xs font-bold text-slate-400">Sprint History</span>
                     <div className="mt-1 space-y-1 max-h-16 overflow-auto">
                        {sprintHistory.slice(-3).map((h, i) => (
                           <div key={i} className="flex justify-between text-xs">
                              <span>Sprint {h.sprint}</span>
                              <span className="text-slate-400">{h.planned}‚Üí{h.delivered}pts</span>
                              <span className={h.delivered >= h.planned ? 'text-green-400' : 'text-red-400'}>
                                 {h.delivered >= h.planned ? '‚úì' : '‚úó'}
                              </span>
                           </div>
                        ))}
                     </div>
                  </div>
               )}
            </div>

            {/* Action Bar */}
            <div className="p-3 bg-black/30 border-t border-purple-500/30">
               <div className="flex gap-2 items-center justify-between mb-2">
                  <div className="flex gap-2">
                     <button onClick={() => setInfoTopic('velocity')} className="text-xs text-purple-400 hover:text-white">üìà Velocity</button>
                     <button onClick={() => setInfoTopic('stories')} className="text-xs text-purple-400 hover:text-white">üìù Stories</button>
                     <button onClick={() => setInfoTopic('debt')} className="text-xs text-purple-400 hover:text-white">üîß Tech Debt</button>
                  </div>
               </div>
               <button
                  onClick={runSprint}
                  disabled={sprintItems.length === 0}
                  className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 disabled:opacity-50 rounded-xl font-bold transition-all"
               >
                  üèÉ RUN SPRINT {sprint}
               </button>
            </div>
         </div>
      );
   };

   // --- TIME MANAGEMENT RENDERER ---
   const TimeManagementRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [day, setDay] = useState(1);
      const [gameLog, setGameLog] = useState<string[]>([]);

      const totalDays = 5; // Work week
      const hoursPerDay = 8;

      const [hoursRemaining, setHoursRemaining] = useState(hoursPerDay);
      const [energy, setEnergy] = useState(100);

      const [tasks, setTasks] = useState<{
         id: string;
         title: string;
         hours: number;
         urgent: boolean;
         important: boolean;
         completed: boolean;
         type: 'deep' | 'meeting' | 'admin' | 'interruption';
      }[]>([]);

      const [stats, setStats] = useState({
         tasksCompleted: 0,
         importantCompleted: 0,
         urgentCompleted: 0,
         deepWorkHours: 0,
         meetingHours: 0,
         adminHours: 0,
         interruptionHours: 0,
         energyWasted: 0,
      });

      const [dayHistory, setDayHistory] = useState<{
         day: number;
         completed: number;
         important: number;
         hoursWorked: number;
         endEnergy: number;
      }[]>([]);

      const [interruption, setInterruption] = useState<{ title: string; hours: number } | null>(null);

      const infoTopics: Record<string, { title: string; content: string }> = {
         eisenhower: {
            title: "Eisenhower Matrix",
            content: "Prioritize by URGENT vs IMPORTANT: Q1 (Urgent+Important): Do first‚Äîcrises, deadlines. Q2 (Important, Not Urgent): Schedule‚Äîplanning, growth, prevention. Q3 (Urgent, Not Important): Delegate‚Äîinterruptions, some meetings. Q4 (Neither): Eliminate‚Äîtime wasters. Spend most time in Q2!"
         },
         deep_work: {
            title: "Deep Work",
            content: "Cal Newport's concept: focused, uninterrupted work on cognitively demanding tasks. Deep work creates value and improves skills. Requires 90+ minute blocks without distractions. Most people can only do 4 hours of deep work per day. Protect this time ruthlessly!"
         },
         pomodoro: {
            title: "Pomodoro Technique",
            content: "Work in 25-minute focused bursts (pomodoros) with 5-minute breaks. After 4 pomodoros, take a 15-30 minute break. Helps maintain focus and prevents burnout. Track pomodoros to understand your capacity. One task per pomodoro‚Äîno multitasking!"
         },
         energy: {
            title: "Energy Management",
            content: "Energy matters more than time! Schedule hard tasks during peak energy (usually morning). Batch similar tasks together. Take breaks before you're exhausted. Meetings and context-switching drain energy fast. Protect your golden hours for important work."
         },
         timeblock: {
            title: "Time Blocking",
            content: "Schedule specific blocks for specific work types. Example: Deep work 9-12, meetings 2-4, email 4-5. Defend your calendar! Every minute should be assigned. Review and adjust weekly. Leave buffer time for unexpected tasks. Say no to protect your blocks."
         }
      };

      useEffect(() => {
         if (infoTopic && infoTopics[infoTopic]) {
            setShowInfo(true);
         }
      }, [infoTopic]);

      const generateDayTasks = () => {
         const taskPool = [
            { title: 'Strategic Planning', hours: 2, urgent: false, important: true, type: 'deep' as const },
            { title: 'Client Presentation', hours: 1.5, urgent: true, important: true, type: 'meeting' as const },
            { title: 'Team Meeting', hours: 1, urgent: true, important: false, type: 'meeting' as const },
            { title: 'Email Inbox', hours: 1, urgent: false, important: false, type: 'admin' as const },
            { title: 'Code Review', hours: 1.5, urgent: false, important: true, type: 'deep' as const },
            { title: 'Bug Fix (Critical)', hours: 2, urgent: true, important: true, type: 'deep' as const },
            { title: 'Status Report', hours: 0.5, urgent: true, important: false, type: 'admin' as const },
            { title: 'Learning/Training', hours: 1, urgent: false, important: true, type: 'deep' as const },
            { title: 'Social Media Check', hours: 0.5, urgent: false, important: false, type: 'admin' as const },
            { title: 'Process Documentation', hours: 1, urgent: false, important: true, type: 'deep' as const },
            { title: '1:1 with Manager', hours: 0.5, urgent: true, important: true, type: 'meeting' as const },
            { title: 'Expense Reports', hours: 0.5, urgent: true, important: false, type: 'admin' as const },
         ];

         // Select 6-8 random tasks for the day
         const shuffled = [...taskPool].sort(() => Math.random() - 0.5);
         const selected = shuffled.slice(0, 6 + Math.floor(Math.random() * 3));

         return selected.map((t, i) => ({
            ...t,
            id: `task-${day}-${i}`,
            completed: false,
         }));
      };

      const startGame = () => {
         setPhase('play');
         setDay(1);
         setHoursRemaining(hoursPerDay);
         setEnergy(100);
         setInterruption(null);
         setStats({
            tasksCompleted: 0,
            importantCompleted: 0,
            urgentCompleted: 0,
            deepWorkHours: 0,
            meetingHours: 0,
            adminHours: 0,
            interruptionHours: 0,
            energyWasted: 0,
         });
         setDayHistory([]);
         setTasks(generateDayTasks());
         setGameLog(["Time Management simulation started - Day 1"]);
      };

      const completeTask = (taskId: string) => {
         const task = tasks.find(t => t.id === taskId);
         if (!task || task.completed || hoursRemaining < task.hours) return;

         // Energy cost
         let energyCost = task.hours * 10;
         if (task.type === 'meeting') energyCost += 5; // Meetings drain more
         if (task.type === 'deep' && energy < 50) energyCost += 10; // Deep work when tired is harder

         // Check if we have energy
         if (energy - energyCost < 0) {
            setGameLog(prev => [...prev, `Too exhausted to complete ${task.title}!`]);
            return;
         }

         setTasks(prev => prev.map(t => t.id === taskId ? { ...t, completed: true } : t));
         setHoursRemaining(prev => prev - task.hours);
         setEnergy(prev => Math.max(0, prev - energyCost));

         // Update stats
         setStats(prev => ({
            ...prev,
            tasksCompleted: prev.tasksCompleted + 1,
            importantCompleted: prev.importantCompleted + (task.important ? 1 : 0),
            urgentCompleted: prev.urgentCompleted + (task.urgent ? 1 : 0),
            deepWorkHours: prev.deepWorkHours + (task.type === 'deep' ? task.hours : 0),
            meetingHours: prev.meetingHours + (task.type === 'meeting' ? task.hours : 0),
            adminHours: prev.adminHours + (task.type === 'admin' ? task.hours : 0),
         }));

         setGameLog(prev => [...prev, `Completed: ${task.title} (${task.hours}h)`]);

         // Random interruption chance
         if (Math.random() < 0.2) {
            triggerInterruption();
         }
      };

      const triggerInterruption = () => {
         const interruptions = [
            { title: 'üì± Urgent Slack message', hours: 0.5 },
            { title: 'üö® Production issue!', hours: 1 },
            { title: 'üìû Surprise call', hours: 0.5 },
            { title: 'üëã Coworker needs help', hours: 0.5 },
            { title: 'üìß Executive email needs reply', hours: 0.5 },
         ];
         setInterruption(interruptions[Math.floor(Math.random() * interruptions.length)]);
      };

      const handleInterruption = (accept: boolean) => {
         if (!interruption) return;

         if (accept) {
            if (hoursRemaining >= interruption.hours) {
               setHoursRemaining(prev => prev - interruption.hours);
               setEnergy(prev => Math.max(0, prev - 15)); // Interruptions are costly
               setStats(prev => ({
                  ...prev,
                  interruptionHours: prev.interruptionHours + interruption.hours,
               }));
               setGameLog(prev => [...prev, `Handled interruption: ${interruption.title}`]);
            }
         } else {
            setEnergy(prev => Math.max(0, prev - 5)); // Saying no has a small cost too
            setGameLog(prev => [...prev, `Declined: ${interruption.title}`]);
         }
         setInterruption(null);
      };

      const takeBreak = () => {
         if (hoursRemaining < 0.5) return;
         setHoursRemaining(prev => prev - 0.5);
         setEnergy(prev => Math.min(100, prev + 20));
         setGameLog(prev => [...prev, "Took a 30-minute break, recovered energy"]);
      };

      const endDay = () => {
         const dayCompleted = tasks.filter(t => t.completed).length;
         const dayImportant = tasks.filter(t => t.completed && t.important).length;

         setDayHistory(prev => [...prev, {
            day,
            completed: dayCompleted,
            important: dayImportant,
            hoursWorked: hoursPerDay - hoursRemaining,
            endEnergy: energy
         }]);

         if (day >= totalDays) {
            setGameLog(prev => [...prev, `Week complete! Tasks done: ${stats.tasksCompleted + dayCompleted}`]);
            setPhase('result');
         } else {
            setDay(day + 1);
            setHoursRemaining(hoursPerDay);
            setEnergy(Math.min(100, 70 + energy * 0.3)); // Partial recovery overnight
            setTasks(generateDayTasks());
            setGameLog(prev => [...prev, `Day ${day + 1} started`]);
         }
      };

      const getQuadrant = (task: typeof tasks[0]) => {
         if (task.urgent && task.important) return { label: 'Q1: DO', color: 'bg-red-500/30 border-red-500' };
         if (!task.urgent && task.important) return { label: 'Q2: SCHEDULE', color: 'bg-green-500/30 border-green-500' };
         if (task.urgent && !task.important) return { label: 'Q3: DELEGATE', color: 'bg-yellow-500/30 border-yellow-500' };
         return { label: 'Q4: ELIMINATE', color: 'bg-slate-500/30 border-slate-500' };
      };

      const getScore = () => {
         const importantScore = stats.importantCompleted * 10;
         const deepWorkScore = Math.min(30, stats.deepWorkHours * 5);
         const efficiencyScore = Math.min(30, (stats.tasksCompleted / (stats.tasksCompleted + 5)) * 30);
         const balanceScore = energy > 30 ? 10 : 0; // Ended with energy
         return Math.round(importantScore + deepWorkScore + efficiencyScore + balanceScore);
      };

      const getGrade = () => {
         const score = getScore();
         if (score >= 85) return { letter: 'A', label: 'Time Master', color: 'text-green-400' };
         if (score >= 70) return { letter: 'B', label: 'Productive Pro', color: 'text-blue-400' };
         if (score >= 55) return { letter: 'C', label: 'Getting There', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Time Challenged', color: 'text-red-400' };
      };

      // Intro Phase
      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-amber-900 via-orange-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <h1 className="text-2xl font-bold mb-2">‚è∞ Time Management Simulator</h1>
                  <p className="text-amber-300 text-sm">Master your day with the Eisenhower Matrix</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <h2 className="text-lg font-bold mb-3 text-amber-400">üìã How It Works</h2>
                  <div className="space-y-2 text-sm">
                     <p>‚Ä¢ Manage a <span className="text-white font-bold">5-day work week</span></p>
                     <p>‚Ä¢ Each day has <span className="text-white font-bold">8 hours</span> and limited energy</p>
                     <p>‚Ä¢ Prioritize tasks using the <span className="text-amber-400">Eisenhower Matrix</span></p>
                     <p>‚Ä¢ Handle interruptions and manage energy</p>
                     <p>‚Ä¢ Focus on <span className="text-green-400">Important</span> over Urgent!</p>
                  </div>
               </div>

               <div className="grid grid-cols-2 gap-2 mb-4 text-xs">
                  <div className="bg-red-500/20 border border-red-500/50 rounded-lg p-2 text-center">
                     <div className="font-bold">Q1: URGENT + IMPORTANT</div>
                     <div className="text-slate-300">Do First</div>
                  </div>
                  <div className="bg-green-500/20 border border-green-500/50 rounded-lg p-2 text-center">
                     <div className="font-bold">Q2: IMPORTANT</div>
                     <div className="text-slate-300">Schedule (Best ROI!)</div>
                  </div>
                  <div className="bg-yellow-500/20 border border-yellow-500/50 rounded-lg p-2 text-center">
                     <div className="font-bold">Q3: URGENT</div>
                     <div className="text-slate-300">Delegate</div>
                  </div>
                  <div className="bg-slate-500/20 border border-slate-500/50 rounded-lg p-2 text-center">
                     <div className="font-bold">Q4: NEITHER</div>
                     <div className="text-slate-300">Eliminate</div>
                  </div>
               </div>

               <div className="flex flex-wrap gap-2 mb-4">
                  {Object.keys(infoTopics).map(key => (
                     <button
                        key={key}
                        onClick={() => setInfoTopic(key)}
                        className="text-xs bg-amber-500/20 hover:bg-amber-500/40 px-2 py-1 rounded-full text-amber-300"
                     >
                        ‚ÑπÔ∏è {infoTopics[key].title}
                     </button>
                  ))}
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 rounded-xl font-bold text-lg transition-all"
               >
                  ‚ñ∂Ô∏è START WORK WEEK
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-amber-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-amber-600 rounded-lg">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // Result Phase
      if (phase === 'result') {
         const grade = getGrade();

         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-amber-900 via-orange-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-amber-400">Score: {getScore()}/100</div>
               </div>

               <div className="grid grid-cols-2 gap-3 mb-4">
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-amber-400">{stats.tasksCompleted}</div>
                     <div className="text-xs text-slate-400">Tasks Done</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-green-400">{stats.importantCompleted}</div>
                     <div className="text-xs text-slate-400">Important Done</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-blue-400">{stats.deepWorkHours.toFixed(1)}h</div>
                     <div className="text-xs text-slate-400">Deep Work</div>
                  </div>
                  <div className="bg-black/30 rounded-lg p-3 text-center">
                     <div className="text-2xl font-bold text-red-400">{stats.interruptionHours.toFixed(1)}h</div>
                     <div className="text-xs text-slate-400">Interruptions</div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-amber-400 mb-2">üìä Time Breakdown</h3>
                  <div className="space-y-1 text-sm">
                     <div className="flex justify-between">
                        <span>üß† Deep Work:</span>
                        <span className="text-blue-400">{stats.deepWorkHours.toFixed(1)}h</span>
                     </div>
                     <div className="flex justify-between">
                        <span>üë• Meetings:</span>
                        <span className="text-yellow-400">{stats.meetingHours.toFixed(1)}h</span>
                     </div>
                     <div className="flex justify-between">
                        <span>üìù Admin:</span>
                        <span className="text-slate-400">{stats.adminHours.toFixed(1)}h</span>
                     </div>
                     <div className="flex justify-between">
                        <span>üö® Interruptions:</span>
                        <span className="text-red-400">{stats.interruptionHours.toFixed(1)}h</span>
                     </div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-amber-400 mb-2">üí° Key Insight</h3>
                  <p className="text-sm text-slate-300">
                     {stats.deepWorkHours < 10
                        ? "Not enough deep work! Protect 2-4 hours daily for focused, important work. This is where real value is created."
                        : stats.interruptionHours > 5
                        ? "Interruptions consumed too much time. Learn to say no or batch interruption handling into specific time slots."
                        : stats.importantCompleted < stats.urgentCompleted
                        ? "You prioritized urgent over important. Q2 tasks (important but not urgent) build long-term success. Don't let urgency hijack your priorities!"
                        : "Great balance! You focused on important work while managing energy. This is the path to sustainable productivity."
                     }
                  </p>
               </div>

               <button
                  onClick={startGame}
                  className="w-full py-3 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 rounded-xl font-bold transition-all"
               >
                  üîÑ TRY AGAIN
               </button>
            </div>
         );
      }

      // Play Phase
      const incompleteTasks = tasks.filter(t => !t.completed);

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-amber-900 via-orange-900 to-slate-900 text-white overflow-hidden">
            {/* Interruption Modal */}
            {interruption && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
                  <div className="bg-slate-800 rounded-xl p-4 max-w-sm">
                     <h3 className="text-lg font-bold text-red-400 mb-2">üö® Interruption!</h3>
                     <p className="text-white mb-2">{interruption.title}</p>
                     <p className="text-sm text-slate-400 mb-4">This will take {interruption.hours}h. Handle it?</p>
                     <div className="flex gap-2">
                        <button onClick={() => handleInterruption(true)} className="flex-1 py-2 bg-red-600 rounded-lg">Handle It</button>
                        <button onClick={() => handleInterruption(false)} className="flex-1 py-2 bg-slate-600 rounded-lg">Say No</button>
                     </div>
                  </div>
               </div>
            )}

            {/* Info Modal */}
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-amber-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-amber-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-amber-500/30">
               <div className="flex justify-between items-center mb-2">
                  <span className="font-bold">‚è∞ Day {day}/{totalDays}</span>
                  <span className="text-amber-400">{hoursRemaining.toFixed(1)}h left</span>
               </div>
               <div className="grid grid-cols-3 gap-2 text-center text-xs">
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-amber-400 font-bold">{hoursRemaining.toFixed(1)}h</div>
                     <div className="text-slate-500">Time Left</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className={`font-bold ${energy >= 50 ? 'text-green-400' : energy >= 25 ? 'text-yellow-400' : 'text-red-400'}`}>{energy}%</div>
                     <div className="text-slate-500">Energy</div>
                  </div>
                  <div className="bg-black/30 rounded p-1">
                     <div className="text-green-400 font-bold">{stats.tasksCompleted}</div>
                     <div className="text-slate-500">Done</div>
                  </div>
               </div>
               {/* Energy bar */}
               <div className="mt-2 h-2 bg-slate-700 rounded-full overflow-hidden">
                  <div
                     className={`h-full transition-all ${energy >= 50 ? 'bg-green-500' : energy >= 25 ? 'bg-yellow-500' : 'bg-red-500'}`}
                     style={{ width: `${energy}%` }}
                  />
               </div>
            </div>

            {/* Tasks */}
            <div className="flex-1 p-3 overflow-auto">
               <div className="flex justify-between items-center mb-2">
                  <span className="text-sm font-bold">Today's Tasks</span>
                  <button onClick={() => setInfoTopic('eisenhower')} className="text-amber-400 text-xs">‚ÑπÔ∏è Matrix</button>
               </div>

               <div className="space-y-2">
                  {incompleteTasks.map(task => {
                     const quadrant = getQuadrant(task);
                     const canComplete = hoursRemaining >= task.hours && energy >= task.hours * 10;

                     return (
                        <div key={task.id} className={`rounded-lg p-2 border ${quadrant.color}`}>
                           <div className="flex justify-between items-start mb-1">
                              <span className="text-sm font-medium">{task.title}</span>
                              <span className="text-xs bg-black/30 px-1 rounded">{task.hours}h</span>
                           </div>
                           <div className="flex justify-between items-center">
                              <span className="text-[10px] text-slate-400">{quadrant.label}</span>
                              <button
                                 onClick={() => completeTask(task.id)}
                                 disabled={!canComplete}
                                 className="text-xs px-2 py-1 bg-amber-600/50 hover:bg-amber-500/50 disabled:opacity-50 rounded"
                              >
                                 Do It
                              </button>
                           </div>
                        </div>
                     );
                  })}

                  {incompleteTasks.length === 0 && (
                     <div className="text-center text-slate-400 py-4">
                        All tasks completed! üéâ
                     </div>
                  )}
               </div>

               {/* Day History */}
               {dayHistory.length > 0 && (
                  <div className="mt-3 bg-black/30 rounded-lg p-2">
                     <span className="text-xs font-bold text-slate-400">This Week</span>
                     <div className="mt-1 space-y-1 max-h-16 overflow-auto">
                        {dayHistory.map((h, i) => (
                           <div key={i} className="flex justify-between text-xs">
                              <span>Day {h.day}</span>
                              <span className="text-green-400">{h.completed} done</span>
                              <span className="text-amber-400">{h.important} important</span>
                           </div>
                        ))}
                     </div>
                  </div>
               )}
            </div>

            {/* Action Bar */}
            <div className="p-3 bg-black/30 border-t border-amber-500/30">
               <div className="flex gap-2 items-center justify-between mb-2">
                  <div className="flex gap-2">
                     <button onClick={() => setInfoTopic('deep_work')} className="text-xs text-amber-400 hover:text-white">üß† Deep Work</button>
                     <button onClick={() => setInfoTopic('energy')} className="text-xs text-amber-400 hover:text-white">‚ö° Energy</button>
                     <button
                        onClick={takeBreak}
                        disabled={hoursRemaining < 0.5}
                        className="text-xs text-green-400 hover:text-white disabled:opacity-50"
                     >
                        ‚òï Break
                     </button>
                  </div>
               </div>
               <button
                  onClick={endDay}
                  className="w-full py-3 bg-gradient-to-r from-amber-600 to-orange-600 hover:from-amber-500 hover:to-orange-500 rounded-xl font-bold transition-all"
               >
                  üåô END DAY {day}
               </button>
            </div>
         </div>
      );
   };

   // --- BUSINESS STRUCTURES RENDERER ---
   const BusinessStructuresRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [step, setStep] = useState(1);
      const [businessProfile, setBusinessProfile] = useState({ owners: 1, revenue: 'low', risk: 'low', investors: false, goingPublic: false });
      const [selectedStructure, setSelectedStructure] = useState<string | null>(null);

      const structures = [
         { id: 'sole_prop', name: 'Sole Proprietorship', icon: 'üë§', pros: ['Simple to start', 'Full control', 'Pass-through taxes'], cons: ['Unlimited liability', 'Hard to raise capital'], bestFor: 'Single owner, low risk', liability: 'unlimited' },
         { id: 'llc', name: 'LLC', icon: 'üõ°Ô∏è', pros: ['Limited liability', 'Flexible taxes', 'Less formality'], cons: ['Self-employment tax', 'Varying state rules'], bestFor: 'Small biz, protection needed', liability: 'limited' },
         { id: 's_corp', name: 'S Corporation', icon: 'üìã', pros: ['Limited liability', 'Avoid SE tax', 'Pass-through'], cons: ['Strict rules', 'Max 100 shareholders'], bestFor: 'Tax savings, employees', liability: 'limited' },
         { id: 'c_corp', name: 'C Corporation', icon: 'üè¢', pros: ['Limited liability', 'Unlimited investors', 'Stock options'], cons: ['Double taxation', 'Complex'], bestFor: 'Investors, going public', liability: 'limited' },
         { id: 'partnership', name: 'Partnership', icon: 'ü§ù', pros: ['Easy to form', 'Shared resources'], cons: ['Unlimited liability', 'Disputes'], bestFor: 'Multiple owners', liability: 'varies' },
      ];
      const infoTopics: Record<string, { title: string; content: string }> = {
         liability: { title: "Limited Liability", content: "Protects personal assets from business debts/lawsuits. Sole props have NO protection‚Äîcreditors can take everything! LLCs and corps create a legal shield." },
         taxes: { title: "Tax Structures", content: "Pass-through: income taxed once on personal return. C-Corps: double taxation (corp + dividends). S-Corps/LLCs avoid this!" },
         piercing: { title: "Piercing the Veil", content: "Courts can hold owners liable if you mix funds, skip formalities, or undercapitalize. Keep clean books!" },
      };
      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);
      const startGame = () => { setPhase('play'); setStep(1); setBusinessProfile({ owners: 1, revenue: 'low', risk: 'low', investors: false, goingPublic: false }); setSelectedStructure(null); };
      const getRecommendation = () => { if (businessProfile.goingPublic || businessProfile.investors) return 'c_corp'; if (businessProfile.owners > 1 && businessProfile.revenue === 'high') return 's_corp'; if (businessProfile.risk === 'high' || businessProfile.revenue !== 'low') return 'llc'; if (businessProfile.owners > 1) return 'partnership'; return 'sole_prop'; };
      const getMatchScore = (id: string) => { let score = 50; const s = structures.find(st => st.id === id); if (!s) return score; if (businessProfile.goingPublic && id === 'c_corp') score += 30; if (businessProfile.investors && id === 'c_corp') score += 20; if (businessProfile.risk === 'high' && s.liability === 'limited') score += 20; if (businessProfile.revenue === 'high' && id === 's_corp') score += 15; return Math.min(100, score); };
      const getScore = () => selectedStructure === getRecommendation() ? 100 : getMatchScore(selectedStructure || '');
      const getGrade = () => { const s = getScore(); if (s >= 90) return { letter: 'A', label: 'Legal Eagle', color: 'text-green-400' }; if (s >= 70) return { letter: 'B', label: 'Good Choice', color: 'text-blue-400' }; if (s >= 55) return { letter: 'C', label: 'Workable', color: 'text-yellow-400' }; return { letter: 'D', label: 'Reconsider', color: 'text-red-400' }; };

      if (phase === 'intro') return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-slate-800 via-slate-900 to-zinc-900 text-white p-4 overflow-auto"><div className="text-center mb-4"><h1 className="text-2xl font-bold mb-2">üèõÔ∏è Business Structure Advisor</h1><p className="text-slate-400 text-sm">Choose the right legal entity</p></div><div className="bg-black/30 rounded-xl p-4 mb-4"><h2 className="text-lg font-bold mb-3 text-blue-400">üìã How It Works</h2><div className="space-y-2 text-sm"><p>‚Ä¢ Answer questions about your business</p><p>‚Ä¢ Compare <span className="text-blue-400">5 legal structures</span></p><p>‚Ä¢ Get a personalized recommendation</p></div></div><div className="grid grid-cols-5 gap-1 mb-4 text-center text-xs">{structures.map(s => (<div key={s.id} className="bg-black/30 rounded-lg p-2"><span className="text-lg">{s.icon}</span></div>))}</div><div className="flex flex-wrap gap-2 mb-4">{Object.keys(infoTopics).map(key => (<button key={key} onClick={() => setInfoTopic(key)} className="text-xs bg-blue-500/20 px-2 py-1 rounded-full text-blue-300">‚ÑπÔ∏è {infoTopics[key].title}</button>))}</div><button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-bold">‚ñ∂Ô∏è START</button>{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg">Got it!</button></div></div>)}</div>);
      if (phase === 'result') { const grade = getGrade(); const selected = structures.find(s => s.id === selectedStructure); const recommended = structures.find(s => s.id === getRecommendation()); return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-slate-800 via-slate-900 to-zinc-900 text-white p-4 overflow-auto"><div className="text-center mb-4"><div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div><div className="text-xl font-bold">{grade.label}</div><div className="text-blue-400">Match: {getScore()}%</div></div>{selected && (<div className="bg-black/30 rounded-xl p-3 mb-3"><div className="flex items-center gap-2 mb-2"><span className="text-2xl">{selected.icon}</span><span className="font-bold">{selected.name}</span></div><div className="grid grid-cols-2 gap-2 text-xs"><div><span className="text-green-400">Pros:</span><ul className="text-slate-300">{selected.pros.map((p, i) => <li key={i}>‚Ä¢ {p}</li>)}</ul></div><div><span className="text-red-400">Cons:</span><ul className="text-slate-300">{selected.cons.map((c, i) => <li key={i}>‚Ä¢ {c}</li>)}</ul></div></div></div>)}{recommended && selectedStructure !== recommended.id && (<div className="bg-green-500/20 border border-green-500/50 rounded-xl p-3 mb-3"><p className="text-sm text-green-400 font-bold">üí° Better: {recommended.name}</p><p className="text-xs text-slate-300">{recommended.bestFor}</p></div>)}<div className="bg-black/30 rounded-xl p-3 mb-4"><h3 className="font-bold text-blue-400 mb-2">üí° Key Insight</h3><p className="text-sm text-slate-300">Your structure affects taxes, liability, and growth. Review as your business evolves!</p></div><button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl font-bold">üîÑ TRY AGAIN</button></div>); }
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-slate-800 via-slate-900 to-zinc-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-blue-500/30"><div className="flex justify-between items-center"><span className="font-bold">üèõÔ∏è Business Structure</span><span className="text-blue-400">Step {step}/2</span></div></div><div className="flex-1 p-4 overflow-auto">{step === 1 && (<div className="space-y-3"><h3 className="font-bold">About your business:</h3><div className="bg-black/30 rounded-lg p-3"><label className="text-sm font-bold mb-2 block">Owners</label><div className="flex gap-2">{[1, 2, 5].map(n => (<button key={n} onClick={() => setBusinessProfile(p => ({ ...p, owners: n }))} className={`flex-1 py-2 rounded text-sm ${businessProfile.owners === n ? 'bg-blue-600' : 'bg-slate-700'}`}>{n === 1 ? 'Just Me' : n === 2 ? '2-4' : '5+'}</button>))}</div></div><div className="bg-black/30 rounded-lg p-3"><label className="text-sm font-bold mb-2 block">Revenue</label><div className="flex gap-2">{['low', 'medium', 'high'].map(r => (<button key={r} onClick={() => setBusinessProfile(p => ({ ...p, revenue: r }))} className={`flex-1 py-2 rounded text-xs ${businessProfile.revenue === r ? 'bg-blue-600' : 'bg-slate-700'}`}>{r === 'low' ? '<$50K' : r === 'medium' ? '$50-500K' : '$500K+'}</button>))}</div></div><div className="bg-black/30 rounded-lg p-3"><label className="text-sm font-bold mb-2 block">Risk Level</label><div className="flex gap-2">{['low', 'medium', 'high'].map(r => (<button key={r} onClick={() => setBusinessProfile(p => ({ ...p, risk: r }))} className={`flex-1 py-2 rounded text-xs ${businessProfile.risk === r ? 'bg-blue-600' : 'bg-slate-700'}`}>{r.charAt(0).toUpperCase() + r.slice(1)}</button>))}</div></div><div className="bg-black/30 rounded-lg p-3 space-y-2"><label className="flex items-center gap-2"><input type="checkbox" checked={businessProfile.investors} onChange={e => setBusinessProfile(p => ({ ...p, investors: e.target.checked }))} className="w-4 h-4" /><span className="text-sm">Seeking investors</span></label><label className="flex items-center gap-2"><input type="checkbox" checked={businessProfile.goingPublic} onChange={e => setBusinessProfile(p => ({ ...p, goingPublic: e.target.checked }))} className="w-4 h-4" /><span className="text-sm">May go public</span></label></div><button onClick={() => setStep(2)} className="w-full py-3 bg-blue-600 rounded-xl font-bold">Next ‚Üí</button></div>)}{step === 2 && (<div className="space-y-2"><h3 className="font-bold">Choose Structure:</h3>{structures.map(s => { const match = getMatchScore(s.id); const isRec = s.id === getRecommendation(); return (<div key={s.id} onClick={() => { setSelectedStructure(s.id); setPhase('result'); }} className={`bg-black/30 rounded-lg p-3 cursor-pointer border-2 ${isRec ? 'border-green-500/50' : 'border-transparent hover:border-blue-500/50'}`}><div className="flex justify-between items-center"><div className="flex items-center gap-2"><span className="text-xl">{s.icon}</span><span className="font-bold text-sm">{s.name}</span>{isRec && <span className="text-xs text-green-400">‚òÖ</span>}</div><span className={`text-xs px-2 py-1 rounded ${match >= 70 ? 'bg-green-500/30 text-green-400' : 'bg-slate-500/30'}`}>{match}%</span></div><p className="text-xs text-slate-400 mt-1">{s.bestFor}</p></div>); })}</div>)}</div><div className="p-3 bg-black/30 border-t border-blue-500/30"><div className="flex gap-2"><button onClick={() => setInfoTopic('liability')} className="text-xs text-blue-400">‚ÑπÔ∏è Liability</button><button onClick={() => setInfoTopic('taxes')} className="text-xs text-blue-400">‚ÑπÔ∏è Taxes</button></div></div></div>);
   };

   // --- INTELLECTUAL PROPERTY RENDERER ---
   const IntellectualPropertyRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Complex scenarios with non-obvious answers and trap options
      const scenarios = [
         {
            title: "The Algorithm Dilemma",
            situation: "Your startup developed a revolutionary ML algorithm that gives you a major competitive edge. A VC is interested but wants to see a demo. Your lead developer might leave for a competitor next year.",
            question: "What's the BEST IP strategy for this algorithm?",
            opts: ['Patent it immediately', 'Keep as Trade Secret', 'Copyright the code', 'Publish openly for credibility'],
            correct: 1,
            wrongExplanations: [
               "Patents require PUBLIC DISCLOSURE. Once filed, your algorithm is public after 18 months‚Äîcompetitors can design around it. Also takes 2-3 years and $15K+. Meanwhile, your advantage is gone.",
               "", // Correct answer
               "Copyright only protects the specific code expression, NOT the underlying algorithm idea. Competitors can rewrite your algorithm in different code legally.",
               "Publishing destroys all IP rights. You can't patent it after. Competitors can freely copy. Only makes sense for research institutions seeking academic credit."
            ],
            realWorld: "Coca-Cola's formula has been a trade secret for 130+ years. If they had patented it, it would have expired in 1906 and anyone could make Coke.",
            concept: "patent_vs_secret",
            why: "Trade secrets protect INDEFINITELY but only if kept secret. Patents expire after 20 years. For algorithms that are hard to reverse-engineer, trade secrets often win."
         },
         {
            title: "The Contractor Trap",
            situation: "You hired a freelance developer to build your mobile app. The contract says 'work for hire' but doesn't specifically mention IP assignment. The freelancer used some of their pre-existing code libraries.",
            question: "Who owns the IP rights to the app?",
            opts: ['You own everything‚Äîyou paid for it', 'Split ownership based on contribution', 'Freelancer owns it unless explicitly assigned', 'Only you own the new code, they keep library rights'],
            correct: 3,
            wrongExplanations: [
               "WRONG! Payment doesn't equal ownership. Under copyright law, the creator owns their work by default. 'Work for hire' only applies to employees or specific contract categories.",
               "Copyright law doesn't do 'split ownership' automatically. This creates a legal nightmare where neither party can fully use the work.",
               "Close but incomplete. The freelancer owns new code by default without explicit assignment, BUT they always retain rights to their pre-existing libraries unless explicitly assigned.",
               "" // Correct answer
            ],
            realWorld: "In the famous Playboy v. Dumas case, Playboy lost rights to artwork they paid for because the artist was a contractor without proper IP assignment.",
            concept: "work_for_hire",
            why: "Pre-existing IP stays with creators unless EXPLICITLY assigned. Always get written IP assignment agreements that distinguish new work from pre-existing code/tools."
         },
         {
            title: "The Naming Nightmare",
            situation: "You're launching 'ByteForce' as your company name. Another company has 'ByteForce' registered for enterprise software (USPTO Class 9). You're in fitness wearables (also Class 9).",
            question: "Can you legally use 'ByteForce' for your fitness wearables?",
            opts: ['Yes‚Äîdifferent products, no conflict', 'Yes‚Äîfirst to use in fitness wins', 'No‚Äîsame trademark class means conflict', 'Maybe‚Äîdepends on likelihood of confusion'],
            correct: 2,
            wrongExplanations: [
               "Same trademark class IS the conflict. Class 9 covers all 'computer hardware and software'‚Äîboth enterprise software and fitness wearables fall under this class.",
               "Trademark law isn't 'first to use per product.' The other company has priority in the entire Class 9 and can block you from registration.",
               "", // Correct answer
               "This isn't a 'maybe'‚Äîsame class with identical name is almost certainly infringement. 'Likelihood of confusion' analysis matters more for similar (not identical) marks."
            ],
            realWorld: "Apple Corps (Beatles) sued Apple Computer repeatedly because both were in 'Class 9' even though music and computers seemed different.",
            concept: "trademark_classes",
            why: "Trademark protection is class-based. 'ByteForce' for hamburgers (Class 43) might be fine, but anything in Class 9 creates direct conflict. Always search USPTO BEFORE naming."
         },
         {
            title: "The Employee Exit",
            situation: "Your senior engineer is leaving for a competitor. She has deep knowledge of your proprietary systems, customer lists, and upcoming product roadmap. She signed an NDA but NOT a non-compete.",
            question: "What can you legally prevent her from doing?",
            opts: ['Working for any competitor for 2 years', 'Using or disclosing your trade secrets', 'Taking any clients she worked with', 'Nothing‚Äîwithout non-compete you have no rights'],
            correct: 1,
            wrongExplanations: [
               "Without a signed non-compete, you cannot restrict where she works. Non-competes are also unenforceable in California and increasingly restricted nationwide.",
               "", // Correct answer
               "Client relationships are complex. She can contact clients she has personal relationships with unless those relationships ARE trade secrets (like a secret client list).",
               "NDAs are powerful! Trade secret law (DTSA) protects confidential business information even without non-competes. She cannot use or disclose what she learned."
            ],
            realWorld: "Waymo vs Uber: Anthony Levandowski left Google and allegedly took trade secrets to Uber. Cost Uber $245M settlement despite no non-compete.",
            concept: "nda_vs_noncompete",
            why: "NDAs protect INFORMATION (trade secrets). Non-competes restrict WHERE someone works. NDAs are enforceable everywhere; non-competes are not. Build protection through NDAs + trade secret protocols."
         },
         {
            title: "The Design Dilemma",
            situation: "You designed a unique, innovative smartwatch case shape. A competitor just launched a very similar-looking product. You never filed any IP protection but have been selling for 8 months.",
            question: "What IP protection could you STILL potentially claim?",
            opts: ['Utility patent‚Äîyou invented it first', 'Design patent‚Äîyou can still file', 'Trade dress‚Äîdistinctive product appearance', 'None‚Äîyou missed the window completely'],
            correct: 2,
            wrongExplanations: [
               "Utility patents protect HOW something works (function), not how it looks (form). A case shape is ornamental, not functional.",
               "Design patents must be filed within 12 months of first public sale. However, the process takes 1-2 years and only lasts 15 years. But trade dress might be stronger here.",
               "", // Correct answer
               "Trade dress protection for distinctive product design doesn't require registration! If consumers associate your distinctive shape with your brand, you may have enforceable rights."
            ],
            realWorld: "Apple successfully sued Samsung for trade dress infringement on iPhone design elements, winning $539M for 'look and feel' even beyond their patents.",
            concept: "trade_dress",
            why: "Trade dress protects product appearance that consumers associate with a brand. No registration required (though it helps). Requires proving distinctiveness + consumer association."
         }
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         patent: {
            title: "Patents: The Trade-Off",
            content: "Patents give 20-year monopoly BUT require full public disclosure. Cost: $15K-30K+, Time: 2-4 years. Best for: innovations that are easy to reverse-engineer. Worst for: algorithms competitors can't see anyway."
         },
         trade_secret: {
            title: "Trade Secrets: Infinite but Fragile",
            content: "Last forever if kept secret. No registration needed. BUT: one disclosure = gone forever. Requires NDAs, access controls, exit interviews. Best for: formulas, algorithms, customer lists. Examples: Coca-Cola formula, Google's PageRank algorithm."
         },
         trademark: {
            title: "Trademarks: Brand Protection",
            content: "Protect brand identifiers in specific classes. ‚Ñ¢ (unregistered) vs ¬Æ (registered). Last forever if actively used. Classes matter‚Äîsame name in different class is usually OK. Search USPTO BEFORE naming your company!"
         },
         copyright: {
            title: "Copyright: Expression Not Ideas",
            content: "Automatic upon creation‚Äîno registration needed to own. BUT registration required to sue for damages. Protects specific expression (your code), NOT underlying ideas (algorithms). Lasts: life + 70 years."
         },
         work_for_hire: {
            title: "Work for Hire: The Contractor Trap",
            content: "Employees: employer owns work automatically. Contractors: CREATOR owns work unless written assignment. 'Work for hire' only applies to employees or 9 specific categories (not software!). Always get explicit IP assignment in contractor agreements."
         },
         trade_dress: {
            title: "Trade Dress: Look & Feel Protection",
            content: "Protects distinctive product appearance/packaging that consumers associate with a brand. No registration required (helps in court). Examples: Coca-Cola bottle shape, Apple store design, Tiffany blue box."
         }
      };

      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setScenario(0);
         setScore(0);
         setSelected(null);
         setAnswered(false);
         setGameLog([]);
         setConceptGaps([]);
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         const isCorrect = idx === s.correct;
         if (isCorrect) {
            setScore(prev => prev + 20);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Understood ${s.concept}`]);
         } else {
            setConceptGaps(prev => prev.includes(s.concept) ? prev : [...prev, s.concept]);
            setGameLog(prev => [...prev, `‚úó ${s.title}: Gap in ${s.concept}`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setSelected(null);
            setAnswered(false);
         }
      };

      const getGrade = () => {
         const pct = (score / (scenarios.length * 20)) * 100;
         if (pct >= 90) return { letter: 'A', label: 'IP Strategist', color: 'text-green-400' };
         if (pct >= 70) return { letter: 'B', label: 'Protected', color: 'text-blue-400' };
         if (pct >= 50) return { letter: 'C', label: 'Risky Gaps', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Exposed', color: 'text-red-400' };
      };

      const conceptLabels: Record<string, string> = {
         patent_vs_secret: "Patent vs Trade Secret Strategy",
         work_for_hire: "Contractor IP Ownership",
         trademark_classes: "Trademark Classification",
         nda_vs_noncompete: "NDA vs Non-Compete Protection",
         trade_dress: "Trade Dress & Design Rights"
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-violet-900 via-purple-900 to-slate-900 text-white p-4 overflow-auto">
            <div className="text-center mb-4">
               <h1 className="text-2xl font-bold mb-2">üîê IP Strategy Challenge</h1>
               <p className="text-violet-300 text-sm">Real decisions. Real consequences. Master IP protection.</p>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-violet-400">‚ö° Why This Matters</h2>
               <div className="space-y-2 text-sm text-slate-300">
                  <p>‚Ä¢ <span className="text-red-400 font-bold">$5.4 TRILLION</span> in IP theft annually worldwide</p>
                  <p>‚Ä¢ <span className="text-yellow-400 font-bold">67%</span> of startup value is in intangible IP assets</p>
                  <p>‚Ä¢ <span className="text-green-400 font-bold">Wrong IP strategy</span> can destroy your competitive advantage</p>
               </div>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-violet-400">üéØ How This Works</h2>
               <div className="space-y-2 text-sm">
                  <p>‚Ä¢ <span className="text-white font-bold">5 real-world scenarios</span> with trap answers</p>
                  <p>‚Ä¢ Understand <span className="text-yellow-400">WHY</span> each strategy works or fails</p>
                  <p>‚Ä¢ Learn from <span className="text-cyan-400">famous cases</span> and costly mistakes</p>
                  <p>‚Ä¢ Get <span className="text-green-400">personalized gaps</span> for further study</p>
               </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
               {Object.keys(infoTopics).map(key => (
                  <button
                     key={key}
                     onClick={() => setInfoTopic(key)}
                     className="text-xs bg-violet-500/20 px-2 py-1 rounded-full text-violet-300 hover:bg-violet-500/30"
                  >
                     ‚ÑπÔ∏è {infoTopics[key].title.split(':')[0]}
                  </button>
               ))}
            </div>

            <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-violet-600 to-purple-600 rounded-xl font-bold text-lg">
               ‚ñ∂Ô∏è BEGIN CHALLENGE
            </button>

            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-violet-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-violet-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const grade = getGrade();
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-violet-900 via-purple-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-violet-400">Score: {score}/{scenarios.length * 20}</div>
               </div>

               {conceptGaps.length > 0 && (
                  <div className="bg-red-900/30 border border-red-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-red-400 mb-2">üìö Knowledge Gaps to Study</h3>
                     <div className="space-y-1">
                        {conceptGaps.map((gap, i) => (
                           <div key={i} className="flex items-center gap-2 text-sm">
                              <span className="text-red-400">‚Üí</span>
                              <span className="text-slate-300">{conceptLabels[gap] || gap}</span>
                              <button
                                 onClick={() => {
                                    const topic = gap === 'patent_vs_secret' ? 'patent' :
                                                  gap === 'work_for_hire' ? 'work_for_hire' :
                                                  gap === 'trademark_classes' ? 'trademark' :
                                                  gap === 'nda_vs_noncompete' ? 'trade_secret' : 'trade_dress';
                                    setInfoTopic(topic);
                                 }}
                                 className="text-xs text-violet-400 underline"
                              >
                                 Learn
                              </button>
                           </div>
                        ))}
                     </div>
                  </div>
               )}

               {conceptGaps.length === 0 && (
                  <div className="bg-green-900/30 border border-green-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-green-400 mb-2">üéâ Perfect Understanding!</h3>
                     <p className="text-sm text-slate-300">You correctly identified the optimal IP strategy in every scenario. You understand the nuances of patent vs trade secret, contractor IP, trademark classes, and protection mechanisms.</p>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-3 mb-3 max-h-32 overflow-auto">
                  <h3 className="font-bold text-violet-400 mb-2">üìã Session Log</h3>
                  {gameLog.map((log, i) => (
                     <p key={i} className="text-xs text-slate-400">{log}</p>
                  ))}
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-violet-400 mb-2">üí° Key Strategic Insights</h3>
                  <ul className="text-sm text-slate-300 space-y-1">
                     <li>‚Ä¢ <span className="text-yellow-400">Trade secrets</span> often beat patents for algorithms</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Written IP assignment</span> is essential for contractors</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Trademark class</span> determines conflict, not product similarity</li>
                     <li>‚Ä¢ <span className="text-yellow-400">NDAs</span> protect information even without non-competes</li>
                  </ul>
               </div>

               <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-violet-600 to-purple-600 rounded-xl font-bold">
                  üîÑ TRY AGAIN
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-violet-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-violet-600 rounded-lg font-bold">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // PLAY PHASE
      const s = scenarios[scenario];
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-violet-900 via-purple-900 to-slate-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-violet-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-violet-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-violet-500/30">
               <div className="flex justify-between items-center">
                  <span className="font-bold text-sm">üîê {s.title}</span>
                  <span className="text-violet-400 text-sm">{scenario + 1}/{scenarios.length}</span>
               </div>
               <div className="flex gap-1 mt-2">
                  {scenarios.slice(0, scenario).map((_, i) => (
                     <div key={i} className={`w-3 h-3 rounded ${gameLog[i]?.startsWith('‚úì') ? 'bg-green-500' : 'bg-red-500'}`} />
                  ))}
                  <div className="w-3 h-3 rounded bg-violet-500 animate-pulse" />
                  {scenarios.slice(scenario + 1).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded bg-slate-600" />
                  ))}
               </div>
            </div>

            {/* Scenario */}
            <div className="flex-1 p-3 overflow-auto">
               <div className="bg-black/30 rounded-lg p-3 mb-3">
                  <p className="text-sm text-slate-200 leading-relaxed">{s.situation}</p>
               </div>

               <p className="text-sm font-bold text-violet-400 mb-2">{s.question}</p>

               <div className="space-y-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600 border-2 border-green-400'
                                 : i === selected
                                    ? 'bg-red-600 border-2 border-red-400'
                                    : 'bg-black/30 opacity-50'
                              : 'bg-black/30 hover:bg-violet-600/50 border-2 border-transparent'
                        }`}
                     >
                        <span className="flex items-start gap-2">
                           <span className="font-bold text-violet-400">{String.fromCharCode(65 + i)}.</span>
                           <span>{opt}</span>
                        </span>
                     </button>
                  ))}
               </div>

               {/* Explanation after answer */}
               {answered && (
                  <div className="mt-3 space-y-2">
                     {selected !== s.correct && (
                        <div className="p-3 bg-red-900/30 border border-red-500/50 rounded-lg">
                           <p className="text-xs font-bold text-red-400 mb-1">‚ùå Why {String.fromCharCode(65 + (selected || 0))} is Wrong:</p>
                           <p className="text-sm text-slate-300">{s.wrongExplanations[selected || 0]}</p>
                        </div>
                     )}

                     <div className="p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úì Why {String.fromCharCode(65 + s.correct)} is Best:</p>
                        <p className="text-sm text-slate-300">{s.why}</p>
                     </div>

                     <div className="p-3 bg-cyan-900/30 border border-cyan-500/50 rounded-lg">
                        <p className="text-xs font-bold text-cyan-400 mb-1">üì∞ Real-World Case:</p>
                        <p className="text-sm text-slate-300">{s.realWorld}</p>
                     </div>

                     <button onClick={next} className="w-full py-3 bg-gradient-to-r from-violet-600 to-purple-600 rounded-xl font-bold mt-2">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            {/* Info Buttons Footer */}
            <div className="p-3 bg-black/30 border-t border-violet-500/30 flex gap-2 justify-center flex-wrap">
               <button onClick={() => setInfoTopic('patent')} className="text-xs text-violet-400 hover:text-violet-300">‚ÑπÔ∏è Patents</button>
               <button onClick={() => setInfoTopic('trade_secret')} className="text-xs text-violet-400 hover:text-violet-300">‚ÑπÔ∏è Trade Secrets</button>
               <button onClick={() => setInfoTopic('trademark')} className="text-xs text-violet-400 hover:text-violet-300">‚ÑπÔ∏è Trademarks</button>
               <button onClick={() => setInfoTopic('copyright')} className="text-xs text-violet-400 hover:text-violet-300">‚ÑπÔ∏è Copyright</button>
            </div>
         </div>
      );
   };

   // --- CONTRACTS RENDERER ---
   const ContractsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Context-dependent scenarios - same clause can be OK or bad depending on situation
      const scenarios = [
         {
            title: "The Payment Trap",
            role: "Freelance Developer",
            context: "You're a solo freelancer. A Fortune 500 company wants to hire you for a $50K project. Their standard contract says:",
            clause: "Payment: NET 90 days after project acceptance, subject to internal approval process.",
            question: "What's the BEST response to this clause?",
            opts: [
               'Accept it - big company, they will pay eventually',
               'Reject the project - NET 90 is unacceptable',
               'Counter: 50% upfront, 50% NET 30 with late fees',
               'Counter: NET 30 only, no other changes'
            ],
            correct: 2,
            wrongExplanations: [
               "DANGEROUS! 'Subject to internal approval' + NET 90 means 4-6 months to payment. As a freelancer, you could go bankrupt waiting. Large companies know solo contractors can't sue them.",
               "Walking away loses a $50K opportunity. The clause IS bad, but big companies expect negotiation. Walking away should be your last resort, not first response.",
               "", // Correct
               "Better than accepting, but you're leaving money on the table. Big companies have cash‚Äîasking for upfront payment is standard and protects your cash flow risk."
            ],
            realWorld: "In 2019, Hertz filed bankruptcy owing contractors $16M+ in unpaid invoices. Contractors with 'NET 90 subject to approval' clauses got pennies on the dollar.",
            concept: "payment_terms",
            why: "Big company ‚â† safe payment. NET 90 + 'approval process' can mean 6+ months. Always get upfront payment for projects over 30 days, especially with large companies that have slow bureaucracies."
         },
         {
            title: "The Liability Landmine",
            role: "SaaS Startup Founder",
            context: "You're selling your $500/month software to an enterprise client. Their legal team sends back your contract with this added:",
            clause: "Vendor shall indemnify Client for any and all damages, losses, and liabilities arising from use of the software, including consequential and indirect damages, without limitation.",
            question: "How should you handle this indemnification clause?",
            opts: [
               'Accept - they are a big client, worth the risk',
               'Cap liability at 12 months of fees paid ($6,000)',
               'Cap liability at total contract value and exclude consequential damages',
               'Reject any indemnification - your software, your rules'
            ],
            correct: 2,
            wrongExplanations: [
               "NEVER accept unlimited liability! If their business loses $10M 'because of your software' (even if it's their fault), they can sue you for the full amount. This has bankrupted startups.",
               "12 months is reasonable for liability cap, BUT you forgot to exclude consequential damages. 'Consequential' means lost profits, lost business, reputation damage‚Äîcould be millions even with a $6K cap.",
               "", // Correct
               "Refusing any indemnification will kill the deal. Enterprise clients legitimately need some protection. The key is REASONABLE limits, not zero responsibility."
            ],
            realWorld: "A startup was sued for $4.2M when their client's employee misused the software causing a data breach. Unlimited indemnification meant the startup paid, not the employee who caused it.",
            concept: "liability_caps",
            why: "Indemnification without caps is a blank check. Always: (1) Cap at contract value or 12 months fees, (2) Exclude consequential/indirect damages, (3) Require client to mitigate damages."
         },
         {
            title: "The IP Ownership Puzzle",
            role: "Contract Developer",
            context: "A client wants you to build custom software. You'll use your own reusable framework (built over 5 years) as the foundation. Their contract states:",
            clause: "All work product, including all intellectual property, code, documentation, and materials created under this Agreement shall be the sole property of Client as work-for-hire.",
            question: "What's wrong with this clause, and how should you fix it?",
            opts: [
               'Nothing wrong - they are paying, they own it',
               'Add: "excluding Contractor pre-existing IP which is licensed to Client"',
               'Change to: "Client owns custom code; Contractor retains framework under perpetual license to Client"',
               'Reject - never assign IP to clients'
            ],
            correct: 2,
            wrongExplanations: [
               "WRONG! This would transfer your 5-year framework to them. You couldn't use YOUR OWN code for any other client. This destroys your business value.",
               "Better, but 'licensed' is vague. Does Client get exclusive rights? Can they sublicense? What happens if they stop paying? You need specific license terms.",
               "", // Correct
               "Too extreme. Clients legitimately need to own custom work they paid for. The issue is protecting YOUR pre-existing tools while giving them what they need."
            ],
            realWorld: "A developer lost rights to their component library (worth $200K+) because a client's 'all IP' clause was interpreted to include pre-existing code integrated into the project.",
            concept: "ip_assignment",
            why: "Separate custom deliverables (client owns) from your tools/frameworks (you retain, license to client). Specify: non-exclusive, perpetual, royalty-free license for your pre-existing IP."
         },
         {
            title: "The Termination Trap",
            role: "Marketing Agency Owner",
            context: "You've signed a 12-month retainer contract ($10K/month) with a client. Three months in, they want to cancel. Your contract says:",
            clause: "Either party may terminate with 30 days written notice. Upon termination, Client shall pay for all work completed to date.",
            question: "You've turned down other clients for this retainer. What's the problem?",
            opts: [
               'No problem - 30 days notice is fair and standard',
               'Problem: No early termination fee protects your lost opportunity',
               'Problem: Should require cause for termination (breach only)',
               'Problem: Need 90 days notice minimum for long-term contracts'
            ],
            correct: 1,
            wrongExplanations: [
               "30 days notice IS standard, but you're missing the bigger picture. You turned down 9 months of other work ($90K opportunity cost) based on this contract. 30 days notice doesn't compensate for that.",
               "", // Correct
               "Cause-only termination is too restrictive and unreasonable. Clients legitimately need exit options. The issue is compensation for early exit, not preventing exit.",
               "90 days is excessive and may not be enforceable. Courts prefer reasonable exit terms. The solution is financial compensation, not longer notice periods."
            ],
            realWorld: "An agency lost $400K in projected revenue when a client terminated a 2-year contract after 3 months. Their 'mutual termination' clause had no early exit penalty.",
            concept: "termination_clauses",
            why: "For long-term contracts, include graduated termination fees: e.g., 'Early termination requires payment of 50% of remaining contract value, decreasing 10% per quarter completed.'"
         },
         {
            title: "The Auto-Renewal Ambush",
            role: "Small Business Owner",
            context: "You're reviewing a software subscription renewal. The original contract you signed 11 months ago included:",
            clause: "This Agreement automatically renews for successive 12-month terms unless either party provides written notice of non-renewal at least 60 days before the current term expires.",
            question: "It's now 45 days before renewal. What's your situation?",
            opts: [
               'Send cancellation notice now - 45 days is reasonable',
               'You are legally locked in for another 12 months',
               'Call and negotiate - auto-renewal clauses are not enforceable',
               'Send notice now and dispute the charge if they bill you'
            ],
            correct: 1,
            wrongExplanations: [
               "You MISSED the 60-day window. 45 days notice does NOT satisfy the contract. Your notice is legally ineffective, and you will be auto-renewed.",
               "", // Correct
               "Auto-renewal clauses ARE generally enforceable when clearly disclosed (which this was). Some states require specific notice, but most don't void the clause entirely.",
               "Disputing the charge will fail. You signed the contract, the clause is valid, you missed the deadline. Chargeback disputes will side with the vendor."
            ],
            realWorld: "A company paid $180K for software they didn't want because they missed a 90-day cancellation window by 2 weeks. The vendor refused to negotiate.",
            concept: "auto_renewal",
            why: "Calendar ALL renewal deadlines immediately when signing. Auto-renewal benefits vendors‚Äîbuild systems to track and send notices 90 days early. Some states now require renewal reminders."
         }
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         payment: {
            title: "Payment Terms Strategy",
            content: "NET 30 is standard. For projects >$10K or >30 days, get 25-50% upfront. Add late fees (1.5%/month). Milestone payments for long projects. 'Subject to approval' = red flag. For large companies, shorter payment terms because their AP departments are slow."
         },
         liability: {
            title: "Liability & Indemnification",
            content: "Always cap liability (1-2x contract value). Exclude consequential, indirect, and punitive damages. Mutual indemnification is fair. Never accept unlimited liability‚Äîit's not worth any contract amount. Insurance can help but caps are essential."
         },
         ip_rights: {
            title: "IP Ownership Structures",
            content: "Custom work: client owns. Your tools/frameworks: you retain, license to client. License types: exclusive (only them), non-exclusive (you keep using). Always specify: scope, duration, territory, sublicense rights. Pre-existing IP must be carved out explicitly."
         },
         termination: {
            title: "Termination Provisions",
            content: "Convenience termination: either party can exit. For-cause termination: only for breach. Long-term contracts need early exit fees. Include cure periods (30 days to fix breach). Specify what happens to IP, payments, and confidentiality post-termination."
         },
         negotiation: {
            title: "Negotiation Tactics",
            content: "Everything is negotiable (especially with big companies). Start with your ideal terms. Know your walkaway point before negotiating. Bundle concessions ('I'll accept NET 60 if you add early termination fee'). Get changes in writing before signing."
         },
         red_flags: {
            title: "Immediate Red Flags",
            content: "Unlimited liability, auto-renewal without notice requirements, 'all IP' without carve-outs, payment 'subject to approval', non-compete over 1 year or outside your industry, unilateral amendment rights, jurisdiction in another country."
         }
      };

      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setScenario(0);
         setScore(0);
         setSelected(null);
         setAnswered(false);
         setGameLog([]);
         setConceptGaps([]);
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         const isCorrect = idx === s.correct;
         if (isCorrect) {
            setScore(prev => prev + 20);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Understood ${s.concept}`]);
         } else {
            setConceptGaps(prev => prev.includes(s.concept) ? prev : [...prev, s.concept]);
            setGameLog(prev => [...prev, `‚úó ${s.title}: Gap in ${s.concept}`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setSelected(null);
            setAnswered(false);
         }
      };

      const getGrade = () => {
         const pct = (score / (scenarios.length * 20)) * 100;
         if (pct >= 90) return { letter: 'A', label: 'Contract Strategist', color: 'text-green-400' };
         if (pct >= 70) return { letter: 'B', label: 'Protected', color: 'text-blue-400' };
         if (pct >= 50) return { letter: 'C', label: 'Vulnerable', color: 'text-yellow-400' };
         return { letter: 'D', label: 'High Risk', color: 'text-red-400' };
      };

      const conceptLabels: Record<string, string> = {
         payment_terms: "Payment Terms & Cash Flow Protection",
         liability_caps: "Liability Caps & Indemnification",
         ip_assignment: "IP Ownership & Licensing",
         termination_clauses: "Termination Fees & Exit Strategy",
         auto_renewal: "Auto-Renewal Traps & Calendar Management"
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-rose-900 via-pink-900 to-slate-900 text-white p-4 overflow-auto">
            <div className="text-center mb-4">
               <h1 className="text-2xl font-bold mb-2">üìú Contract Negotiation Lab</h1>
               <p className="text-rose-300 text-sm">Context matters. Strategy wins. Protect your business.</p>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-rose-400">‚ö†Ô∏è Why This Matters</h2>
               <div className="space-y-2 text-sm text-slate-300">
                  <p>‚Ä¢ <span className="text-red-400 font-bold">83%</span> of small businesses sign contracts without negotiating</p>
                  <p>‚Ä¢ <span className="text-yellow-400 font-bold">$50B+</span> lost annually to unfavorable contract terms</p>
                  <p>‚Ä¢ <span className="text-green-400 font-bold">Same clause</span> can be OK or devastating‚Äîcontext determines everything</p>
               </div>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-rose-400">üéØ How This Works</h2>
               <div className="space-y-2 text-sm">
                  <p>‚Ä¢ <span className="text-white font-bold">5 real contract scenarios</span> from different perspectives</p>
                  <p>‚Ä¢ Decide: <span className="text-yellow-400">What should you DO?</span> (not just flag)</p>
                  <p>‚Ä¢ Learn <span className="text-cyan-400">strategic responses</span> that protect your interests</p>
                  <p>‚Ä¢ See <span className="text-red-400">real consequences</span> of bad contract decisions</p>
               </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
               {Object.keys(infoTopics).map(key => (
                  <button
                     key={key}
                     onClick={() => setInfoTopic(key)}
                     className="text-xs bg-rose-500/20 px-2 py-1 rounded-full text-rose-300 hover:bg-rose-500/30"
                  >
                     ‚ÑπÔ∏è {infoTopics[key].title.split(' ').slice(0, 2).join(' ')}
                  </button>
               ))}
            </div>

            <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-rose-600 to-pink-600 rounded-xl font-bold text-lg">
               ‚ñ∂Ô∏è BEGIN NEGOTIATION
            </button>

            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-rose-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-rose-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const grade = getGrade();
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-rose-900 via-pink-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-rose-400">Score: {score}/{scenarios.length * 20}</div>
               </div>

               {conceptGaps.length > 0 && (
                  <div className="bg-red-900/30 border border-red-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-red-400 mb-2">üìö Contract Gaps to Study</h3>
                     <div className="space-y-1">
                        {conceptGaps.map((gap, i) => (
                           <div key={i} className="flex items-center gap-2 text-sm">
                              <span className="text-red-400">‚Üí</span>
                              <span className="text-slate-300">{conceptLabels[gap] || gap}</span>
                              <button
                                 onClick={() => {
                                    const topic = gap === 'payment_terms' ? 'payment' :
                                                  gap === 'liability_caps' ? 'liability' :
                                                  gap === 'ip_assignment' ? 'ip_rights' :
                                                  gap === 'termination_clauses' ? 'termination' : 'red_flags';
                                    setInfoTopic(topic);
                                 }}
                                 className="text-xs text-rose-400 underline"
                              >
                                 Learn
                              </button>
                           </div>
                        ))}
                     </div>
                  </div>
               )}

               {conceptGaps.length === 0 && (
                  <div className="bg-green-900/30 border border-green-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-green-400 mb-2">üéâ Contract Expert!</h3>
                     <p className="text-sm text-slate-300">You understand the strategic nuances of contract negotiation‚Äîpayment protection, liability caps, IP structures, and termination strategies.</p>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-3 mb-3 max-h-32 overflow-auto">
                  <h3 className="font-bold text-rose-400 mb-2">üìã Session Log</h3>
                  {gameLog.map((log, i) => (
                     <p key={i} className="text-xs text-slate-400">{log}</p>
                  ))}
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-rose-400 mb-2">üí° Key Strategic Principles</h3>
                  <ul className="text-sm text-slate-300 space-y-1">
                     <li>‚Ä¢ <span className="text-yellow-400">Context determines risk</span>‚Äîsame clause can be OK or dangerous</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Everything is negotiable</span>‚Äîespecially with large companies</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Protect cash flow</span>‚Äîupfront payments for long projects</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Calendar everything</span>‚Äîrenewal traps are real</li>
                  </ul>
               </div>

               <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-rose-600 to-pink-600 rounded-xl font-bold">
                  üîÑ TRY AGAIN
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-rose-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-rose-600 rounded-lg font-bold">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // PLAY PHASE
      const s = scenarios[scenario];
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-rose-900 via-pink-900 to-slate-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-rose-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-rose-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-rose-500/30">
               <div className="flex justify-between items-center">
                  <div>
                     <span className="font-bold text-sm">üìú {s.title}</span>
                     <span className="ml-2 text-xs text-rose-400 bg-rose-500/20 px-2 py-0.5 rounded">{s.role}</span>
                  </div>
                  <span className="text-rose-400 text-sm">{scenario + 1}/{scenarios.length}</span>
               </div>
               <div className="flex gap-1 mt-2">
                  {scenarios.slice(0, scenario).map((_, i) => (
                     <div key={i} className={`w-3 h-3 rounded ${gameLog[i]?.startsWith('‚úì') ? 'bg-green-500' : 'bg-red-500'}`} />
                  ))}
                  <div className="w-3 h-3 rounded bg-rose-500 animate-pulse" />
                  {scenarios.slice(scenario + 1).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded bg-slate-600" />
                  ))}
               </div>
            </div>

            {/* Scenario */}
            <div className="flex-1 p-3 overflow-auto">
               {/* Context */}
               <div className="bg-black/30 rounded-lg p-3 mb-2">
                  <p className="text-xs text-slate-400 mb-1">SITUATION:</p>
                  <p className="text-sm text-slate-200">{s.context}</p>
               </div>

               {/* Contract Clause */}
               <div className="bg-slate-800/50 border-l-4 border-rose-500 rounded-r-lg p-3 mb-3">
                  <p className="text-xs text-rose-400 mb-1">CONTRACT CLAUSE:</p>
                  <p className="text-sm font-mono text-slate-200 italic">"{s.clause}"</p>
               </div>

               <p className="text-sm font-bold text-rose-400 mb-2">{s.question}</p>

               <div className="space-y-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600 border-2 border-green-400'
                                 : i === selected
                                    ? 'bg-red-600 border-2 border-red-400'
                                    : 'bg-black/30 opacity-50'
                              : 'bg-black/30 hover:bg-rose-600/50 border-2 border-transparent'
                        }`}
                     >
                        <span className="flex items-start gap-2">
                           <span className="font-bold text-rose-400">{String.fromCharCode(65 + i)}.</span>
                           <span>{opt}</span>
                        </span>
                     </button>
                  ))}
               </div>

               {/* Explanation after answer */}
               {answered && (
                  <div className="mt-3 space-y-2">
                     {selected !== s.correct && (
                        <div className="p-3 bg-red-900/30 border border-red-500/50 rounded-lg">
                           <p className="text-xs font-bold text-red-400 mb-1">‚ùå Why {String.fromCharCode(65 + (selected || 0))} is Wrong:</p>
                           <p className="text-sm text-slate-300">{s.wrongExplanations[selected || 0]}</p>
                        </div>
                     )}

                     <div className="p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úì Strategic Response:</p>
                        <p className="text-sm text-slate-300">{s.why}</p>
                     </div>

                     <div className="p-3 bg-amber-900/30 border border-amber-500/50 rounded-lg">
                        <p className="text-xs font-bold text-amber-400 mb-1">‚ö†Ô∏è Real Case:</p>
                        <p className="text-sm text-slate-300">{s.realWorld}</p>
                     </div>

                     <button onClick={next} className="w-full py-3 bg-gradient-to-r from-rose-600 to-pink-600 rounded-xl font-bold mt-2">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            {/* Info Buttons Footer */}
            <div className="p-3 bg-black/30 border-t border-rose-500/30 flex gap-2 justify-center flex-wrap">
               <button onClick={() => setInfoTopic('payment')} className="text-xs text-rose-400 hover:text-rose-300">‚ÑπÔ∏è Payment</button>
               <button onClick={() => setInfoTopic('liability')} className="text-xs text-rose-400 hover:text-rose-300">‚ÑπÔ∏è Liability</button>
               <button onClick={() => setInfoTopic('ip_rights')} className="text-xs text-rose-400 hover:text-rose-300">‚ÑπÔ∏è IP Rights</button>
               <button onClick={() => setInfoTopic('termination')} className="text-xs text-rose-400 hover:text-rose-300">‚ÑπÔ∏è Termination</button>
            </div>
         </div>
      );
   };

   // --- PERMITS RENDERER ---
   const PermitsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Real compliance scenarios with consequences
      const scenarios = [
         {
            title: "The Food Truck Launch",
            situation: "You're launching a food truck selling tacos. You got your business license and food handler permits. Opening day arrives. The health inspector shows up.",
            question: "What permit are you MOST LIKELY missing that could shut you down immediately?",
            opts: [
               'Sales Tax Permit - need to collect taxes',
               'Mobile Food Vendor Permit - specific to food trucks',
               'Fire Extinguisher Certificate - safety requirement',
               'Music License - playing radio while serving'
            ],
            correct: 1,
            wrongExplanations: [
               "Sales tax permits are important but inspectors don't check for them on opening day. The state catches this later during tax audits, not health inspections.",
               "", // Correct
               "Fire extinguisher certs are part of the mobile vendor permit inspection, not a separate permit in most jurisdictions.",
               "Music licenses (ASCAP/BMI) are for businesses, but no inspector checks this on opening day. This becomes an issue if you're caught, but not from health inspectors."
            ],
            realWorld: "A LA food truck owner was fined $5,000 and shut down for 2 weeks for operating with a restaurant permit instead of a mobile food vendor permit‚Äîdifferent inspection requirements, different commissary rules.",
            concept: "industry_specific",
            why: "Food trucks need MOBILE-specific permits, not restaurant permits. Requirements include: commissary agreement (where you prep/clean), specific route permits (some cities), and mobile vendor inspections. Standard food permits don't cover mobile operations."
         },
         {
            title: "The Home Bakery Surprise",
            situation: "You're baking and selling cookies from home. You've been operating for 6 months with just a home occupation permit and business license. A neighbor complains about delivery trucks.",
            question: "What's the REAL compliance issue that could shut you down?",
            opts: [
               'The neighbor complaint about trucks - noise violation',
               'Missing cottage food license - home food production laws',
               'Zoning violation - residential zone restrictions',
               'No health inspection - food safety requirement'
            ],
            correct: 1,
            wrongExplanations: [
               "Truck noise is a nuisance complaint, not a permit issue. Code enforcement might give a warning, but it won't shut down your business.",
               "", // Correct
               "Zoning is secondary here. Most residential zones allow home occupations‚Äîthe issue is the TYPE of home business (food production has special rules).",
               "Cottage food operations are actually EXEMPT from health inspections in most states‚Äîthat's the whole point of cottage food laws. But you need the cottage food license first."
            ],
            realWorld: "A Texas home baker was fined $25,000 for selling without a cottage food license. She had a home occupation permit but didn't know cottage food was a separate requirement.",
            concept: "cottage_food",
            why: "Cottage food laws allow home food production but with strict limits: specific foods only (usually baked goods, jams, not meat/dairy), annual sales caps ($25K-$75K depending on state), labeling requirements, and registration. Regular business license doesn't cover this."
         },
         {
            title: "The Contractor Nightmare",
            situation: "You're a general contractor hired to remodel a kitchen ($40K job). You have your contractor's license and business license. Midway through, a city inspector arrives.",
            question: "What permit issue could result in the homeowner being forced to TEAR OUT your completed work?",
            opts: [
               'Missing workers comp insurance for your crew',
               'No building permit pulled for the project',
               'Expired contractor license - needs annual renewal',
               'Wrong contractor class - residential vs commercial'
            ],
            correct: 1,
            wrongExplanations: [
               "Workers comp is serious (you can be sued), but inspectors don't check this. It's an insurance/labor issue, not a building inspection issue.",
               "", // Correct
               "Expired license is bad, but work done under an expired license is usually grandfathered. The city won't tear out work for this‚Äîthey'll fine you and stop future work.",
               "Wrong class violations result in fines and license issues, not demolition of completed work."
            ],
            realWorld: "A $200K kitchen remodel in California was ordered demolished because no permits were pulled. The drywall hid unpermitted electrical work. Homeowner sued contractor for $350K including demolition costs.",
            concept: "building_permits",
            why: "Building permits aren't just paperwork‚Äîthey ensure code compliance through inspections at each stage. Unpermitted work: (1) must be exposed for inspection or torn out, (2) voids insurance claims, (3) kills home sales, (4) creates contractor liability for FULL reconstruction."
         },
         {
            title: "The Retail Pop-Up Trap",
            situation: "You're opening a 3-day pop-up shop in a vacant retail space. The landlord says 'just set up, it's temporary.' You bring inventory and start selling.",
            question: "What's the MOST LIKELY reason you'll get shut down on day one?",
            opts: [
               'No sales tax permit - can\'t legally collect tax',
               'Temporary Use Permit from the city - pop-ups need authorization',
               'Fire marshal approval - occupancy limits',
               'No ADA compliance - accessibility requirements'
            ],
            correct: 1,
            wrongExplanations: [
               "Sales tax permits are state-level and don't trigger immediate shutdown. You'll face penalties later, but enforcement is slow.",
               "", // Correct
               "Fire marshal checks are typically part of permanent occupancy permits, not pop-up enforcement. They might check after complaints.",
               "ADA compliance is a lawsuit risk, not a permit issue. No inspector shuts you down for ADA on day one‚Äîit's civil liability."
            ],
            realWorld: "A pop-up holiday market in Denver was shut down 2 hours after opening‚Äîvendors had business licenses but no temporary use permits. City lost $50K in fees they would have collected if vendors had applied.",
            concept: "temporary_permits",
            why: "Pop-ups/temporary events need: (1) Temporary Use Permit from city planning, (2) Special event permit if selling food/alcohol, (3) Landlord written permission (verbal isn't enough), (4) Liability insurance naming the city. 'Temporary' doesn't mean 'no permits.'"
         },
         {
            title: "The SaaS Startup Surprise",
            situation: "You're running a profitable SaaS company from home. You have a home occupation permit and business license. You've hired 3 remote employees. An auditor calls about 'business personal property tax.'",
            question: "What compliance issue do most tech startups miss that triggers this audit?",
            opts: [
               'Not paying self-employment tax on profits',
               'Business Personal Property Tax on computers/equipment',
               'Remote employee work permits in their states',
               'Software sales tax collection requirements'
            ],
            correct: 1,
            wrongExplanations: [
               "Self-employment tax is an IRS issue, not a local auditor issue. This wouldn't trigger a call from a 'business personal property' auditor.",
               "", // Correct
               "Remote employee work permits aren't typically a thing (employees work under your business license). Nexus/tax registration in their states is, but that's not 'personal property tax.'",
               "SaaS sales tax is complex but it's state-level, not what a 'business personal property tax' auditor is calling about."
            ],
            realWorld: "A tech startup in Texas was hit with $12,000 in back taxes plus penalties for never filing Business Personal Property Tax returns on their computers, servers, and office equipment.",
            concept: "property_tax",
            why: "Business Personal Property Tax applies to business equipment (computers, furniture, machinery) in most states. It's separate from real estate tax. Many home-based businesses miss this because they think 'home office' means residential tax treatment. Equipment used for business is taxed as business property."
         }
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         business_license: {
            title: "Business License Basics",
            content: "Required in almost every city/county. Costs $50-500. Annual renewal. Operating without = daily fines ($100-500/day in some cities). Usually tied to your physical address‚Äîmoving means new license."
         },
         zoning: {
            title: "Zoning & Land Use",
            content: "Controls WHAT businesses can operate WHERE. Home occupations have limits (no customers, no employees, no signage in some zones). Changing use (retail to restaurant) requires zoning approval. Check BEFORE signing a lease."
         },
         industry_permits: {
            title: "Industry-Specific Permits",
            content: "Food = Health permits + cottage food or commercial kitchen. Alcohol = Liquor license (can take 6+ months). Construction = Contractor license + building permits per project. Childcare = State licensing. Each industry has hidden requirements."
         },
         building_permits: {
            title: "Building & Construction Permits",
            content: "Required for: electrical, plumbing, structural changes, HVAC. NOT just for new construction‚Äîrenovations need them too. Unpermitted work = tear out + redo. Kills home sales. Voids insurance claims."
         },
         state_federal: {
            title: "State & Federal Requirements",
            content: "EIN (federal) = free, apply online. State tax registration = required to collect sales tax. Professional licenses (doctors, lawyers, contractors) = state-level. Industry regulations (FDA, EPA, OSHA) = federal. Layer of requirements varies by business."
         },
         compliance_timeline: {
            title: "Permit Timeline Reality",
            content: "Business license: 1-2 weeks. Health permits: 2-8 weeks. Liquor license: 3-12 months (!). Building permits: 2-12 weeks. Zoning changes: 3-6 months. Plan backwards from your launch date. Rush fees exist but are expensive."
         }
      };

      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setScenario(0);
         setScore(0);
         setSelected(null);
         setAnswered(false);
         setGameLog([]);
         setConceptGaps([]);
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         const isCorrect = idx === s.correct;
         if (isCorrect) {
            setScore(prev => prev + 20);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Understood ${s.concept}`]);
         } else {
            setConceptGaps(prev => prev.includes(s.concept) ? prev : [...prev, s.concept]);
            setGameLog(prev => [...prev, `‚úó ${s.title}: Gap in ${s.concept}`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setSelected(null);
            setAnswered(false);
         }
      };

      const getGrade = () => {
         const pct = (score / (scenarios.length * 20)) * 100;
         if (pct >= 90) return { letter: 'A', label: 'Compliance Expert', color: 'text-green-400' };
         if (pct >= 70) return { letter: 'B', label: 'Mostly Compliant', color: 'text-blue-400' };
         if (pct >= 50) return { letter: 'C', label: 'Risky Gaps', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Violation Risk', color: 'text-red-400' };
      };

      const conceptLabels: Record<string, string> = {
         industry_specific: "Industry-Specific Permit Requirements",
         cottage_food: "Cottage Food & Home Business Laws",
         building_permits: "Building Permits & Inspections",
         temporary_permits: "Temporary Use & Pop-Up Permits",
         property_tax: "Business Personal Property Tax"
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-sky-900 via-cyan-900 to-slate-900 text-white p-4 overflow-auto">
            <div className="text-center mb-4">
               <h1 className="text-2xl font-bold mb-2">üèõÔ∏è Compliance Crisis Simulator</h1>
               <p className="text-sky-300 text-sm">The permits you don't know about will shut you down.</p>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-sky-400">‚ö†Ô∏è Why This Matters</h2>
               <div className="space-y-2 text-sm text-slate-300">
                  <p>‚Ä¢ <span className="text-red-400 font-bold">30%</span> of small businesses face permit violations in year one</p>
                  <p>‚Ä¢ <span className="text-yellow-400 font-bold">$10,000+</span> average cost of compliance failures (fines + remediation)</p>
                  <p>‚Ä¢ <span className="text-green-400 font-bold">Hidden permits</span> vary by industry, location, and business type</p>
               </div>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-sky-400">üéØ How This Works</h2>
               <div className="space-y-2 text-sm">
                  <p>‚Ä¢ <span className="text-white font-bold">5 real compliance scenarios</span> entrepreneurs face</p>
                  <p>‚Ä¢ Identify <span className="text-yellow-400">hidden permit requirements</span> that cause shutdowns</p>
                  <p>‚Ä¢ Learn <span className="text-cyan-400">real consequences</span> and how to avoid them</p>
                  <p>‚Ä¢ Discover <span className="text-red-400">permits you didn't know existed</span></p>
               </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
               {Object.keys(infoTopics).map(key => (
                  <button
                     key={key}
                     onClick={() => setInfoTopic(key)}
                     className="text-xs bg-sky-500/20 px-2 py-1 rounded-full text-sky-300 hover:bg-sky-500/30"
                  >
                     ‚ÑπÔ∏è {infoTopics[key].title.split(' ').slice(0, 2).join(' ')}
                  </button>
               ))}
            </div>

            <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-sky-600 to-cyan-600 rounded-xl font-bold text-lg">
               ‚ñ∂Ô∏è BEGIN SIMULATION
            </button>

            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-sky-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-sky-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const grade = getGrade();
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-sky-900 via-cyan-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-sky-400">Score: {score}/{scenarios.length * 20}</div>
               </div>

               {conceptGaps.length > 0 && (
                  <div className="bg-red-900/30 border border-red-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-red-400 mb-2">üìö Compliance Gaps to Research</h3>
                     <div className="space-y-1">
                        {conceptGaps.map((gap, i) => (
                           <div key={i} className="flex items-center gap-2 text-sm">
                              <span className="text-red-400">‚Üí</span>
                              <span className="text-slate-300">{conceptLabels[gap] || gap}</span>
                              <button
                                 onClick={() => {
                                    const topic = gap === 'industry_specific' ? 'industry_permits' :
                                                  gap === 'cottage_food' ? 'zoning' :
                                                  gap === 'building_permits' ? 'building_permits' :
                                                  gap === 'temporary_permits' ? 'zoning' : 'state_federal';
                                    setInfoTopic(topic);
                                 }}
                                 className="text-xs text-sky-400 underline"
                              >
                                 Learn
                              </button>
                           </div>
                        ))}
                     </div>
                  </div>
               )}

               {conceptGaps.length === 0 && (
                  <div className="bg-green-900/30 border border-green-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-green-400 mb-2">üéâ Compliance Expert!</h3>
                     <p className="text-sm text-slate-300">You understand the hidden permit requirements that catch most entrepreneurs. You know to look beyond basic business licenses.</p>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-3 mb-3 max-h-32 overflow-auto">
                  <h3 className="font-bold text-sky-400 mb-2">üìã Session Log</h3>
                  {gameLog.map((log, i) => (
                     <p key={i} className="text-xs text-slate-400">{log}</p>
                  ))}
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-sky-400 mb-2">üí° Compliance Strategy</h3>
                  <ul className="text-sm text-slate-300 space-y-1">
                     <li>‚Ä¢ <span className="text-yellow-400">Research industry-specific</span> permits beyond business license</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Check city AND county AND state</span> requirements separately</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Timeline matters</span>‚Äîsome permits take months</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Ask your city clerk</span>‚Äîthey know what you need</li>
                  </ul>
               </div>

               <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-sky-600 to-cyan-600 rounded-xl font-bold">
                  üîÑ TRY AGAIN
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-sky-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-sky-600 rounded-lg font-bold">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // PLAY PHASE
      const s = scenarios[scenario];
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-sky-900 via-cyan-900 to-slate-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-sky-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-sky-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-sky-500/30">
               <div className="flex justify-between items-center">
                  <span className="font-bold text-sm">üèõÔ∏è {s.title}</span>
                  <span className="text-sky-400 text-sm">{scenario + 1}/{scenarios.length}</span>
               </div>
               <div className="flex gap-1 mt-2">
                  {scenarios.slice(0, scenario).map((_, i) => (
                     <div key={i} className={`w-3 h-3 rounded ${gameLog[i]?.startsWith('‚úì') ? 'bg-green-500' : 'bg-red-500'}`} />
                  ))}
                  <div className="w-3 h-3 rounded bg-sky-500 animate-pulse" />
                  {scenarios.slice(scenario + 1).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded bg-slate-600" />
                  ))}
               </div>
            </div>

            {/* Scenario */}
            <div className="flex-1 p-3 overflow-auto">
               <div className="bg-black/30 rounded-lg p-3 mb-3">
                  <p className="text-sm text-slate-200 leading-relaxed">{s.situation}</p>
               </div>

               <p className="text-sm font-bold text-sky-400 mb-2">{s.question}</p>

               <div className="space-y-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600 border-2 border-green-400'
                                 : i === selected
                                    ? 'bg-red-600 border-2 border-red-400'
                                    : 'bg-black/30 opacity-50'
                              : 'bg-black/30 hover:bg-sky-600/50 border-2 border-transparent'
                        }`}
                     >
                        <span className="flex items-start gap-2">
                           <span className="font-bold text-sky-400">{String.fromCharCode(65 + i)}.</span>
                           <span>{opt}</span>
                        </span>
                     </button>
                  ))}
               </div>

               {/* Explanation after answer */}
               {answered && (
                  <div className="mt-3 space-y-2">
                     {selected !== s.correct && (
                        <div className="p-3 bg-red-900/30 border border-red-500/50 rounded-lg">
                           <p className="text-xs font-bold text-red-400 mb-1">‚ùå Why {String.fromCharCode(65 + (selected || 0))} is Wrong:</p>
                           <p className="text-sm text-slate-300">{s.wrongExplanations[selected || 0]}</p>
                        </div>
                     )}

                     <div className="p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úì The Hidden Requirement:</p>
                        <p className="text-sm text-slate-300">{s.why}</p>
                     </div>

                     <div className="p-3 bg-amber-900/30 border border-amber-500/50 rounded-lg">
                        <p className="text-xs font-bold text-amber-400 mb-1">‚ö†Ô∏è Real Case:</p>
                        <p className="text-sm text-slate-300">{s.realWorld}</p>
                     </div>

                     <button onClick={next} className="w-full py-3 bg-gradient-to-r from-sky-600 to-cyan-600 rounded-xl font-bold mt-2">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            {/* Info Buttons Footer */}
            <div className="p-3 bg-black/30 border-t border-sky-500/30 flex gap-2 justify-center flex-wrap">
               <button onClick={() => setInfoTopic('business_license')} className="text-xs text-sky-400 hover:text-sky-300">‚ÑπÔ∏è Licenses</button>
               <button onClick={() => setInfoTopic('zoning')} className="text-xs text-sky-400 hover:text-sky-300">‚ÑπÔ∏è Zoning</button>
               <button onClick={() => setInfoTopic('industry_permits')} className="text-xs text-sky-400 hover:text-sky-300">‚ÑπÔ∏è Industry</button>
               <button onClick={() => setInfoTopic('compliance_timeline')} className="text-xs text-sky-400 hover:text-sky-300">‚ÑπÔ∏è Timeline</button>
            </div>
         </div>
      );
   };

   // --- EMPLOYMENT LAW RENDERER ---
   const EmploymentLawRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Nuanced scenarios where "it depends" - context matters
      const scenarios = [
         {
            title: "The Overtime Exemption Trap",
            context: "You're a startup founder. Your 'Senior Marketing Manager' earns $45,000/year salary, has no direct reports, and spends 80% of time executing campaigns you assign. She worked 55 hours last week.",
            question: "Do you owe her overtime pay?",
            opts: [
               'No - she has a manager title and salary',
               'No - she agreed to salary means no overtime',
               'Yes - she fails the duties test for exemption',
               'Yes - but only if she asks for it'
            ],
            correct: 2,
            wrongExplanations: [
               "Title doesn't determine exemption! The FLSA 'duties test' looks at ACTUAL job duties. 'Manager' in title means nothing if she doesn't manage anyone or make independent decisions.",
               "Agreeing to salary doesn't waive overtime rights. You can't contract away FLSA protections. Many employers lose lawsuits because they thought salary = exempt.",
               "", // Correct
               "Overtime is owed regardless of whether she asks. The obligation is on the employer. Not paying is wage theft, and she can claim back pay for 2-3 years plus penalties."
            ],
            realWorld: "A class action against a tech company resulted in $8.5M in back overtime pay for 'Account Managers' who were misclassified as exempt despite having no management duties.",
            concept: "exempt_nonexempt",
            why: "Exemption requires ALL of: (1) Salary basis, (2) Minimum $684/week ($35,568/year), (3) Primary duty is management/professional/administrative with independent judgment. Executing assigned tasks ‚â† exempt, regardless of title or salary."
         },
         {
            title: "The Contractor Classification Gamble",
            context: "You hire a 'freelance developer' who works 40 hrs/week exclusively for you, uses your computer, attends your meetings, and has worked this way for 18 months. You pay them via 1099.",
            question: "What's your legal exposure here?",
            opts: [
               'None - they signed a contractor agreement',
               'Minor - just reclassify them going forward',
               'Major - back taxes, benefits, and penalties for 18 months',
               'None - the IRS only audits big companies'
            ],
            correct: 2,
            wrongExplanations: [
               "Contracts don't override reality. Courts use 'economic reality' and 'right to control' tests. If they walk like an employee and quack like an employee, they're an employee‚Äîregardless of what paper says.",
               "You can't just 'reclassify going forward.' The IRS and state agencies can audit past years. You owe: back employment taxes (employer share), unpaid benefits, overtime if applicable, and penalties.",
               "", // Correct
               "The IRS absolutely audits small companies, especially after worker complaints. California alone collected $6.8B in misclassification penalties in 5 years. One complaint triggers a full audit."
            ],
            realWorld: "Uber and Lyft paid $413M in settlements over driver misclassification. A small business owner in California was personally liable for $340K in back wages, taxes, and penalties for 3 misclassified workers.",
            concept: "worker_classification",
            why: "Classification is based on reality, not paperwork. Key factors: (1) Control over how work is done, (2) Exclusivity, (3) Integration into business, (4) Duration, (5) Tools provided. This worker is clearly an employee. Exposure: 18 months of employment taxes (~15%), benefits, potential overtime, plus penalties."
         },
         {
            title: "The FMLA Surprise",
            context: "Your company has 45 employees. A worker who's been with you 10 months requests 12 weeks unpaid leave for a new baby. You're already short-staffed and can't afford to hold the position.",
            question: "Are you legally required to grant this leave?",
            opts: [
               'Yes - FMLA requires 12 weeks for new parents',
               'No - FMLA only applies to 50+ employee companies',
               'No - employee hasn\'t worked 12 months yet',
               'Yes - but only 6 weeks, not 12'
            ],
            correct: 1,
            wrongExplanations: [
               "FMLA has TWO thresholds most people miss: (1) 50+ employees within 75 miles, AND (2) employee worked 12+ months with 1,250+ hours. You have 45 employees, so FMLA doesn't apply to you at all.",
               "", // Correct
               "This is partially right‚Äîthe employee tenure matters‚Äîbut it's moot here because your company is too small for FMLA anyway. However, STATE laws may still apply (CA, NY, NJ, WA have their own family leave laws).",
               "There's no '6 weeks only' rule in FMLA. It's 12 weeks or nothing. Some states have additional paid leave requirements."
            ],
            realWorld: "A 35-employee company owner thought she was 'safe' from FMLA, then got sued under California's CFRA (which applies to 5+ employees). The employee won $125K in damages.",
            concept: "fmla_thresholds",
            why: "FMLA (federal) = 50+ employees. BUT: Many states have LOWER thresholds. California CFRA = 5+ employees. NY PFL = 1+ employees. Always check STATE law too‚Äîit often provides MORE protection than federal. Even without legal requirement, consider retention‚Äîreplacing employees costs 50-200% of salary."
         },
         {
            title: "The At-Will Exception",
            context: "You fire a sales rep in an at-will state for 'not being a culture fit.' The day before, he had emailed HR complaining that his manager was pressuring the team to falsify sales reports to hit quarterly targets.",
            question: "What's the legal risk of this termination?",
            opts: [
               'None - at-will means fire for any reason',
               'Low - just document the culture fit issues',
               'High - this looks like whistleblower retaliation',
               'Medium - depends on if the complaint was formal'
            ],
            correct: 2,
            wrongExplanations: [
               "At-will has MAJOR exceptions: (1) Discrimination, (2) Retaliation, (3) Public policy violations, (4) Implied contracts. 'Any reason' doesn't mean 'any reason including illegal ones.'",
               "Documenting 'culture fit' after a complaint looks like pretext. Courts look at timing. Termination within 24-48 hours of a complaint is textbook retaliation, regardless of documentation.",
               "", // Correct
               "Formal vs informal complaint doesn't matter for retaliation protection. Reporting illegal activity (fraud) is protected whether it's verbal, email, or formal HR complaint. The email creates a paper trail AGAINST you."
            ],
            realWorld: "A pharma company paid $105M to a sales rep fired 2 weeks after reporting off-label marketing. The 'poor performance' documentation was created AFTER the complaint. Timing was the killer evidence.",
            concept: "retaliation",
            why: "Retaliation claims are the #1 growing category of employment lawsuits. Key factors: (1) Protected activity (reporting illegal conduct, discrimination, safety issues), (2) Adverse action (termination, demotion, bad assignments), (3) Timing. Firing within days of a complaint = presumption of retaliation. The burden shifts to YOU to prove legitimate reason."
         },
         {
            title: "The Salary Discussion Shutdown",
            context: "You overhear two employees comparing salaries in the break room. Your employee handbook prohibits 'discussing compensation with coworkers.' You give them both written warnings for policy violation.",
            question: "What's the legal issue with this action?",
            opts: [
               'None - your handbook, your rules',
               'Minor - just remove the policy going forward',
               'Major - you violated federal labor law (NLRA)',
               'Depends - only illegal if they\'re in a union'
            ],
            correct: 2,
            wrongExplanations: [
               "Handbooks can't override federal law. Policies prohibiting salary discussions violate the National Labor Relations Act‚Äîeven for non-union, private sector employees.",
               "Removing the policy doesn't fix it‚Äîyou already disciplined employees for exercising protected rights. The warnings themselves are 'unfair labor practices' and must be rescinded. Employees can file NLRB complaints.",
               "", // Correct
               "The NLRA Section 7 protects 'concerted activity' for ALL private sector employees, not just union members. This includes discussing wages, benefits, and working conditions. The law applies regardless of union status."
            ],
            realWorld: "The NLRB has issued hundreds of rulings against companies with pay secrecy policies. A restaurant chain had to rescind all discipline, post notices admitting the violation, and pay back wages to affected employees.",
            concept: "nlra_rights",
            why: "NLRA Section 7 protects employees' right to discuss wages and working conditions. Pay secrecy policies are per se illegal for most private employers. Exceptions: Supervisors (true managers), HR with access to payroll data. You cannot discipline employees for salary discussions, even if they signed a policy agreeing not to."
         }
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         flsa: {
            title: "FLSA: Wages & Hours",
            content: "Federal minimum wage, overtime (1.5x after 40 hrs), exempt vs non-exempt classification. Exemption requires: salary basis ($684+/week), AND exempt duties (executive/admin/professional). Title doesn't matter‚Äîduties do. Violations = 2-3 years back pay + liquidated damages (2x)."
         },
         classification: {
            title: "Worker Classification",
            content: "Employee vs Contractor based on: control, exclusivity, tools provided, duration, integration. IRS uses 20-factor test. States (especially CA) use stricter 'ABC test.' Misclassification = back taxes + penalties + benefits. Can't contract away employee status."
         },
         fmla: {
            title: "FMLA & State Leave Laws",
            content: "Federal FMLA: 50+ employees, 12 months tenure, 1,250 hours. Provides 12 weeks UNPAID leave. BUT: Many states have lower thresholds and PAID leave. CA/NY/WA/NJ have paid family leave. Always check state law‚Äîit often exceeds federal."
         },
         retaliation: {
            title: "Retaliation Claims",
            content: "Protected activities: discrimination complaints, safety reports, wage claims, whistleblowing. Adverse actions: termination, demotion, schedule changes, bad reviews. Timing is key evidence. Document BEFORE complaints arise. Most expensive employment claims are retaliation."
         },
         nlra: {
            title: "NLRA: Concerted Activity",
            content: "Section 7 protects discussions about wages, benefits, working conditions‚Äîfor ALL private employees, not just unions. Pay secrecy policies are illegal. Can't discipline for salary discussions. Social media complaints about work may also be protected."
         },
         atwill: {
            title: "At-Will Exceptions",
            content: "At-will means no contract for duration. BUT exceptions: (1) Discrimination (protected classes), (2) Retaliation (protected activities), (3) Public policy (refusing illegal acts), (4) Implied contract (handbook promises). 'Any reason' ‚â† 'illegal reasons.'"
         }
      };

      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setScenario(0);
         setScore(0);
         setSelected(null);
         setAnswered(false);
         setGameLog([]);
         setConceptGaps([]);
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         const isCorrect = idx === s.correct;
         if (isCorrect) {
            setScore(prev => prev + 20);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Understood ${s.concept}`]);
         } else {
            setConceptGaps(prev => prev.includes(s.concept) ? prev : [...prev, s.concept]);
            setGameLog(prev => [...prev, `‚úó ${s.title}: Gap in ${s.concept}`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setSelected(null);
            setAnswered(false);
         }
      };

      const getGrade = () => {
         const pct = (score / (scenarios.length * 20)) * 100;
         if (pct >= 90) return { letter: 'A', label: 'HR Law Expert', color: 'text-green-400' };
         if (pct >= 70) return { letter: 'B', label: 'Mostly Compliant', color: 'text-blue-400' };
         if (pct >= 50) return { letter: 'C', label: 'Lawsuit Risk', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Major Liability', color: 'text-red-400' };
      };

      const conceptLabels: Record<string, string> = {
         exempt_nonexempt: "Overtime Exemption & Duties Test",
         worker_classification: "Employee vs Contractor Classification",
         fmla_thresholds: "FMLA Thresholds & State Leave Laws",
         retaliation: "Retaliation & Protected Activities",
         nlra_rights: "NLRA & Salary Discussion Rights"
      };

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-lime-900 via-green-900 to-slate-900 text-white p-4 overflow-auto">
            <div className="text-center mb-4">
               <h1 className="text-2xl font-bold mb-2">‚öñÔ∏è Employment Law Minefield</h1>
               <p className="text-lime-300 text-sm">The nuances that trigger lawsuits. Context is everything.</p>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-lime-400">‚ö†Ô∏è Why This Matters</h2>
               <div className="space-y-2 text-sm text-slate-300">
                  <p>‚Ä¢ <span className="text-red-400 font-bold">$450B+</span> paid annually in employment lawsuits</p>
                  <p>‚Ä¢ <span className="text-yellow-400 font-bold">65%</span> of employment lawsuits are won by employees</p>
                  <p>‚Ä¢ <span className="text-green-400 font-bold">"It depends"</span> is the answer to most employment law questions</p>
               </div>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-lime-400">üéØ How This Works</h2>
               <div className="space-y-2 text-sm">
                  <p>‚Ä¢ <span className="text-white font-bold">5 nuanced scenarios</span> where context matters</p>
                  <p>‚Ä¢ Not just <span className="text-yellow-400">"legal vs illegal"</span>‚Äîunderstand WHY</p>
                  <p>‚Ä¢ Learn <span className="text-cyan-400">thresholds and exceptions</span> most employers miss</p>
                  <p>‚Ä¢ See <span className="text-red-400">real lawsuit amounts</span> and outcomes</p>
               </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
               {Object.keys(infoTopics).map(key => (
                  <button
                     key={key}
                     onClick={() => setInfoTopic(key)}
                     className="text-xs bg-lime-500/20 px-2 py-1 rounded-full text-lime-300 hover:bg-lime-500/30"
                  >
                     ‚ÑπÔ∏è {infoTopics[key].title.split(':')[0]}
                  </button>
               ))}
            </div>

            <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-lime-600 to-green-600 rounded-xl font-bold text-lg">
               ‚ñ∂Ô∏è BEGIN CHALLENGE
            </button>

            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-lime-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-lime-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') {
         const grade = getGrade();
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-lime-900 via-green-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-lime-400">Score: {score}/{scenarios.length * 20}</div>
               </div>

               {conceptGaps.length > 0 && (
                  <div className="bg-red-900/30 border border-red-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-red-400 mb-2">üìö Legal Gaps to Study</h3>
                     <div className="space-y-1">
                        {conceptGaps.map((gap, i) => (
                           <div key={i} className="flex items-center gap-2 text-sm">
                              <span className="text-red-400">‚Üí</span>
                              <span className="text-slate-300">{conceptLabels[gap] || gap}</span>
                              <button
                                 onClick={() => {
                                    const topic = gap === 'exempt_nonexempt' ? 'flsa' :
                                                  gap === 'worker_classification' ? 'classification' :
                                                  gap === 'fmla_thresholds' ? 'fmla' :
                                                  gap === 'retaliation' ? 'retaliation' : 'nlra';
                                    setInfoTopic(topic);
                                 }}
                                 className="text-xs text-lime-400 underline"
                              >
                                 Learn
                              </button>
                           </div>
                        ))}
                     </div>
                  </div>
               )}

               {conceptGaps.length === 0 && (
                  <div className="bg-green-900/30 border border-green-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-green-400 mb-2">üéâ Employment Law Expert!</h3>
                     <p className="text-sm text-slate-300">You understand the nuances that catch most employers‚Äîexemption tests, classification rules, FMLA thresholds, and retaliation traps.</p>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-3 mb-3 max-h-32 overflow-auto">
                  <h3 className="font-bold text-lime-400 mb-2">üìã Session Log</h3>
                  {gameLog.map((log, i) => (
                     <p key={i} className="text-xs text-slate-400">{log}</p>
                  ))}
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-lime-400 mb-2">üí° Key Legal Principles</h3>
                  <ul className="text-sm text-slate-300 space-y-1">
                     <li>‚Ä¢ <span className="text-yellow-400">Titles don't determine exemption</span>‚Äîduties do</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Contracts can't override</span> employee status</li>
                     <li>‚Ä¢ <span className="text-yellow-400">State laws often exceed</span> federal protections</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Timing is key evidence</span> in retaliation claims</li>
                  </ul>
               </div>

               <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-lime-600 to-green-600 rounded-xl font-bold">
                  üîÑ TRY AGAIN
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-lime-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-lime-600 rounded-lg font-bold">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      // PLAY PHASE
      const s = scenarios[scenario];
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-lime-900 via-green-900 to-slate-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-lime-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-lime-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-lime-500/30">
               <div className="flex justify-between items-center">
                  <span className="font-bold text-sm">‚öñÔ∏è {s.title}</span>
                  <span className="text-lime-400 text-sm">{scenario + 1}/{scenarios.length}</span>
               </div>
               <div className="flex gap-1 mt-2">
                  {scenarios.slice(0, scenario).map((_, i) => (
                     <div key={i} className={`w-3 h-3 rounded ${gameLog[i]?.startsWith('‚úì') ? 'bg-green-500' : 'bg-red-500'}`} />
                  ))}
                  <div className="w-3 h-3 rounded bg-lime-500 animate-pulse" />
                  {scenarios.slice(scenario + 1).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded bg-slate-600" />
                  ))}
               </div>
            </div>

            {/* Scenario */}
            <div className="flex-1 p-3 overflow-auto">
               <div className="bg-black/30 rounded-lg p-3 mb-3">
                  <p className="text-sm text-slate-200 leading-relaxed">{s.context}</p>
               </div>

               <p className="text-sm font-bold text-lime-400 mb-2">{s.question}</p>

               <div className="space-y-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600 border-2 border-green-400'
                                 : i === selected
                                    ? 'bg-red-600 border-2 border-red-400'
                                    : 'bg-black/30 opacity-50'
                              : 'bg-black/30 hover:bg-lime-600/50 border-2 border-transparent'
                        }`}
                     >
                        <span className="flex items-start gap-2">
                           <span className="font-bold text-lime-400">{String.fromCharCode(65 + i)}.</span>
                           <span>{opt}</span>
                        </span>
                     </button>
                  ))}
               </div>

               {/* Explanation after answer */}
               {answered && (
                  <div className="mt-3 space-y-2">
                     {selected !== s.correct && (
                        <div className="p-3 bg-red-900/30 border border-red-500/50 rounded-lg">
                           <p className="text-xs font-bold text-red-400 mb-1">‚ùå Why {String.fromCharCode(65 + (selected || 0))} is Wrong:</p>
                           <p className="text-sm text-slate-300">{s.wrongExplanations[selected || 0]}</p>
                        </div>
                     )}

                     <div className="p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úì The Legal Reality:</p>
                        <p className="text-sm text-slate-300">{s.why}</p>
                     </div>

                     <div className="p-3 bg-amber-900/30 border border-amber-500/50 rounded-lg">
                        <p className="text-xs font-bold text-amber-400 mb-1">‚ö†Ô∏è Real Case:</p>
                        <p className="text-sm text-slate-300">{s.realWorld}</p>
                     </div>

                     <button onClick={next} className="w-full py-3 bg-gradient-to-r from-lime-600 to-green-600 rounded-xl font-bold mt-2">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            {/* Info Buttons Footer */}
            <div className="p-3 bg-black/30 border-t border-lime-500/30 flex gap-2 justify-center flex-wrap">
               <button onClick={() => setInfoTopic('flsa')} className="text-xs text-lime-400 hover:text-lime-300">‚ÑπÔ∏è FLSA</button>
               <button onClick={() => setInfoTopic('classification')} className="text-xs text-lime-400 hover:text-lime-300">‚ÑπÔ∏è Classification</button>
               <button onClick={() => setInfoTopic('fmla')} className="text-xs text-lime-400 hover:text-lime-300">‚ÑπÔ∏è FMLA</button>
               <button onClick={() => setInfoTopic('retaliation')} className="text-xs text-lime-400 hover:text-lime-300">‚ÑπÔ∏è Retaliation</button>
            </div>
         </div>
      );
   };

   // --- DIGITAL & TECHNOLOGY RENDERERS ---
   const EcommerceRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [day, setDay] = useState(1);
      const [cash, setCash] = useState(500);
      const [inventory, setInventory] = useState<{[k:string]:number}>({tshirt:10,mug:15,sticker:30});
      const [prices, setPrices] = useState<{[k:string]:number}>({tshirt:25,mug:15,sticker:5});
      const [sales, setSales] = useState<{item:string,qty:number,price:number}[]>([]);
      const [log, setLog] = useState<string[]>([]);
      const products = [{id:'tshirt',name:'T-Shirt',cost:12,icon:'üëï'},{id:'mug',name:'Mug',cost:6,icon:'‚òï'},{id:'sticker',name:'Sticker',cost:1,icon:'üè∑Ô∏è'}];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         pricing:{title:'Pricing Strategy',content:'Set prices based on costs, competition, and perceived value. Too high loses customers, too low loses profit.'},
         inventory:{title:'Inventory Management',content:'Balance stock levels - too much ties up cash, too little means lost sales and unhappy customers.'},
         margins:{title:'Profit Margins',content:'Margin = (Price - Cost) / Price. Higher margins mean more profit per sale but may reduce volume.'},
         conversion:{title:'Conversion Rate',content:'The percentage of visitors who make a purchase. Improve with better UX, pricing, and product presentation.'}
      };
      const simulateDay = () => {
         let daySales:{item:string,qty:number,price:number}[] = [];
         let newInv = {...inventory};
         let revenue = 0;
         products.forEach(p => {
            const demand = Math.max(0, Math.floor((30 - prices[p.id]) / 3) + Math.floor(Math.random() * 3));
            const sold = Math.min(demand, newInv[p.id]);
            if(sold > 0) {
               daySales.push({item:p.id,qty:sold,price:prices[p.id]});
               revenue += sold * prices[p.id];
               newInv[p.id] -= sold;
            }
         });
         setInventory(newInv);
         setCash(c => c + revenue);
         setSales(s => [...s, ...daySales]);
         setLog(l => [...l, `Day ${day}: Earned $${revenue}`]);
         if(day >= 7) setPhase('result');
         else setDay(d => d + 1);
      };
      const restock = (id:string) => {
         const p = products.find(x=>x.id===id)!;
         const qty = 10;
         const cost = qty * p.cost;
         if(cash >= cost) {
            setCash(c => c - cost);
            setInventory(inv => ({...inv, [id]: inv[id] + qty}));
            setLog(l => [...l, `Restocked ${qty} ${p.name}s for $${cost}`]);
         }
      };
      const totalRevenue = sales.reduce((a,s) => a + s.qty * s.price, 0);
      const grade = cash >= 1000 ? 'A' : cash >= 750 ? 'B' : cash >= 500 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 text-white p-6"><div className="text-6xl mb-4">üõí</div><h2 className="text-2xl font-bold mb-2">E-Commerce Simulator</h2><p className="text-slate-300 text-center mb-6 max-w-md">Run your online store for 7 days! Set prices, manage inventory, and maximize profits.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl font-bold">Open Store</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? '‚≠ê' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">Week Complete!</h2><div className="text-4xl font-bold text-green-400 mb-2">${cash}</div><p className="text-slate-300 mb-2">Final Cash (Started: $500)</p><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">Revenue: ${totalRevenue} | {sales.reduce((a,s)=>a+s.qty,0)} items sold</p><button onClick={() => {setPhase('intro');setDay(1);setCash(500);setInventory({tshirt:10,mug:15,sticker:30});setSales([]);setLog([]);}} className="px-6 py-2 bg-blue-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-blue-900 via-indigo-900 to-purple-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-blue-500/30 flex justify-between items-center"><span className="font-bold">üõí E-Commerce</span><span className="text-blue-400">Day {day}/7</span><span className="text-green-400 font-bold">${cash}</span></div><div className="flex-1 p-3 overflow-auto"><div className="grid gap-2">{products.map(p => (<div key={p.id} className="bg-black/30 rounded-lg p-3"><div className="flex justify-between items-center mb-2"><span className="text-xl">{p.icon} {p.name}</span><span className="text-sm text-slate-400">Stock: {inventory[p.id]}</span></div><div className="flex items-center gap-2"><span className="text-xs text-slate-400">Price: $</span><input type="number" value={prices[p.id]} onChange={e => setPrices(pr => ({...pr, [p.id]: Number(e.target.value)}))} className="w-16 bg-slate-700 rounded px-2 py-1 text-sm" min={1} /><button onClick={() => restock(p.id)} className="ml-auto text-xs bg-blue-600/50 px-2 py-1 rounded">+10 (${p.cost * 10})</button></div></div>))}</div></div><div className="p-3 bg-black/30 border-t border-blue-500/30"><button onClick={simulateDay} className="w-full py-3 bg-gradient-to-r from-blue-500 to-purple-500 rounded-xl font-bold">End Day {day}</button><div className="flex gap-2 mt-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-blue-400">‚ÑπÔ∏è {infoTopics[k].title.split(' ')[0]}</button>)}</div></div></div>);
   };

   const SocialMediaRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [followers, setFollowers] = useState(100);
      const [engagement, setEngagement] = useState(5);
      const [week, setWeek] = useState(1);
      const [budget, setBudget] = useState(200);
      const [log, setLog] = useState<string[]>([]);
      const platforms = [{id:'instagram',name:'Instagram',icon:'üì∏',reach:1.2},{id:'twitter',name:'Twitter/X',icon:'üê¶',reach:0.8},{id:'tiktok',name:'TikTok',icon:'üéµ',reach:1.5},{id:'linkedin',name:'LinkedIn',icon:'üíº',reach:0.6}];
      const contentTypes = [{id:'educational',name:'Educational',cost:20,engBoost:2,followBoost:15},{id:'entertaining',name:'Entertaining',cost:15,engBoost:3,followBoost:25},{id:'promotional',name:'Promotional',cost:10,engBoost:-1,followBoost:5},{id:'behindscenes',name:'Behind Scenes',cost:5,engBoost:1,followBoost:10}];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         algorithm:{title:'Algorithm',content:'Social platforms prioritize content with high engagement. More likes, comments, and shares = more visibility.'},
         consistency:{title:'Consistency',content:'Regular posting builds audience expectations and algorithmic favor. Quality over quantity, but maintain presence.'},
         engagement:{title:'Engagement Rate',content:'(Likes + Comments + Shares) / Followers √ó 100. A rate above 3% is considered good.'},
         reach:{title:'Organic Reach',content:'The number of people who see your content without paid promotion. Varies by platform and content type.'}
      };
      const [selectedPlatform, setSelectedPlatform] = useState<string|null>(null);
      const [selectedContent, setSelectedContent] = useState<string|null>(null);
      const postContent = () => {
         if(!selectedPlatform || !selectedContent) return;
         const plat = platforms.find(p => p.id === selectedPlatform)!;
         const cont = contentTypes.find(c => c.id === selectedContent)!;
         if(budget < cont.cost) return;
         setBudget(b => b - cont.cost);
         const newFollowers = Math.floor(cont.followBoost * plat.reach * (1 + Math.random() * 0.5));
         const newEng = Math.max(1, engagement + cont.engBoost + Math.floor(Math.random() * 2 - 1));
         setFollowers(f => f + newFollowers);
         setEngagement(newEng);
         setLog(l => [...l, `Week ${week}: +${newFollowers} followers on ${plat.name}`]);
         setSelectedPlatform(null);
         setSelectedContent(null);
         if(week >= 8) setPhase('result');
         else setWeek(w => w + 1);
      };
      const grade = followers >= 500 ? 'A' : followers >= 300 ? 'B' : followers >= 200 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-900 text-white p-6"><div className="text-6xl mb-4">üì±</div><h2 className="text-2xl font-bold mb-2">Social Media Strategy</h2><p className="text-slate-300 text-center mb-6 max-w-md">Grow your brand's social presence over 8 weeks! Choose platforms and content types wisely.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl font-bold">Start Campaign</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üåü' : grade === 'B' ? 'üìà' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">Campaign Complete!</h2><div className="text-4xl font-bold text-pink-400 mb-2">{followers} Followers</div><p className="text-slate-300 mb-2">Started: 100 | Engagement: {engagement}%</p><div className="text-6xl mb-4">{grade}</div><button onClick={() => {setPhase('intro');setFollowers(100);setEngagement(5);setWeek(1);setBudget(200);setLog([]);}} className="px-6 py-2 bg-pink-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-pink-900 via-purple-900 to-indigo-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-pink-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-pink-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-pink-500/30 flex justify-between items-center"><span className="font-bold">üì± Social Media</span><span className="text-pink-400">Week {week}/8</span><span className="text-green-400">${budget}</span></div><div className="flex-1 p-3 overflow-auto"><div className="bg-black/30 rounded-lg p-3 mb-3 flex justify-around"><div className="text-center"><div className="text-2xl font-bold text-pink-400">{followers}</div><div className="text-xs text-slate-400">Followers</div></div><div className="text-center"><div className="text-2xl font-bold text-purple-400">{engagement}%</div><div className="text-xs text-slate-400">Engagement</div></div></div><p className="text-xs text-slate-400 mb-2">Choose Platform:</p><div className="grid grid-cols-2 gap-2 mb-3">{platforms.map(p => (<button key={p.id} onClick={() => setSelectedPlatform(p.id)} className={`p-2 rounded-lg text-sm ${selectedPlatform === p.id ? 'bg-pink-600' : 'bg-black/30'}`}>{p.icon} {p.name}</button>))}</div><p className="text-xs text-slate-400 mb-2">Choose Content:</p><div className="grid grid-cols-2 gap-2">{contentTypes.map(c => (<button key={c.id} onClick={() => setSelectedContent(c.id)} className={`p-2 rounded-lg text-sm ${selectedContent === c.id ? 'bg-purple-600' : 'bg-black/30'}`}>{c.name} (${c.cost})</button>))}</div></div><div className="p-3 bg-black/30 border-t border-pink-500/30"><button onClick={postContent} disabled={!selectedPlatform || !selectedContent} className="w-full py-3 bg-gradient-to-r from-pink-500 to-purple-500 rounded-xl font-bold disabled:opacity-50">Post Content</button><div className="flex gap-2 mt-2 justify-center">{Object.keys(infoTopics).slice(0,3).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-pink-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div></div>);
   };

   const SEORenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [question, setQuestion] = useState(0);
      const [score, setScore] = useState(0);
      const [answered, setAnswered] = useState(false);
      const [selected, setSelected] = useState<number|null>(null);
      const [log, setLog] = useState<string[]>([]);
      const questions = [
         {q:'Which is the most important on-page SEO element?',opts:['Meta keywords','Title tag','Footer links','Sidebar widgets'],correct:1,explain:'Title tags are the most important on-page element, appearing in search results and browser tabs.'},
         {q:'What is "keyword stuffing"?',opts:['Using one keyword','Overusing keywords unnaturally','Researching keywords','Hiding keywords'],correct:1,explain:'Keyword stuffing is overusing keywords, which search engines penalize as spam.'},
         {q:'Which improves page load speed?',opts:['More images','Larger fonts','Image compression','More scripts'],correct:2,explain:'Compressing images reduces file size and improves load speed, a ranking factor.'},
         {q:'What does a 301 redirect do?',opts:['Blocks page','Permanent redirect','Temporary redirect','Deletes page'],correct:1,explain:'A 301 is a permanent redirect, passing link equity to the new URL.'},
         {q:'Which backlink is most valuable?',opts:['From unrelated site','From new blog','From authority site in your niche','From social media'],correct:2,explain:'Backlinks from authoritative, relevant sites carry the most SEO weight.'},
         {q:'What is "alt text" used for?',opts:['Styling images','Describing images for SEO/accessibility','Link building','Keywords only'],correct:1,explain:'Alt text describes images for screen readers and helps search engines understand image content.'},
         {q:'Which URL structure is best for SEO?',opts:['example.com/p=123','example.com/blog/seo-tips','example.com/page1','example.com/üî•'],correct:1,explain:'Descriptive, readable URLs with keywords are best for SEO and user experience.'},
         {q:'What is "bounce rate"?',opts:['Email returns','Single-page visits','Crawl errors','Loading time'],correct:1,explain:'Bounce rate is the percentage of visitors who leave after viewing only one page.'}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         keywords:{title:'Keywords',content:'Words and phrases people search for. Use them naturally in titles, headings, content, and URLs.'},
         backlinks:{title:'Backlinks',content:'Links from other sites to yours. Quality matters more than quantity - one link from NYTimes beats 100 from spam sites.'},
         technical:{title:'Technical SEO',content:'Site speed, mobile-friendliness, crawlability, and structured data all affect rankings.'},
         content:{title:'Content Quality',content:'Create valuable, original content that answers user questions. Length matters less than depth and usefulness.'}
      };
      const answer = (idx:number) => {
         if(answered) return;
         setSelected(idx);
         setAnswered(true);
         if(idx === questions[question].correct) {
            setScore(s => s + 1);
            setLog(l => [...l, `Q${question+1}: Correct!`]);
         } else {
            setLog(l => [...l, `Q${question+1}: Wrong`]);
         }
      };
      const next = () => {
         if(question >= questions.length - 1) setPhase('result');
         else { setQuestion(q => q + 1); setAnswered(false); setSelected(null); }
      };
      const grade = score >= 7 ? 'A' : score >= 5 ? 'B' : score >= 3 ? 'C' : 'D';
      const q = questions[question];
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-green-900 via-teal-900 to-cyan-900 text-white p-6"><div className="text-6xl mb-4">üîç</div><h2 className="text-2xl font-bold mb-2">SEO Mastery Quiz</h2><p className="text-slate-300 text-center mb-6 max-w-md">Test your Search Engine Optimization knowledge! Learn what makes websites rank higher.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-green-500 to-teal-500 rounded-xl font-bold">Start Quiz</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-green-900 via-teal-900 to-cyan-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? '‚≠ê' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">Quiz Complete!</h2><div className="text-4xl font-bold text-green-400 mb-2">{score}/{questions.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'SEO Expert!' : grade === 'B' ? 'Good understanding!' : 'Keep learning!'}</p><button onClick={() => {setPhase('intro');setQuestion(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-green-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-green-900 via-teal-900 to-cyan-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-green-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-green-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-green-500/30 flex justify-between items-center"><span className="font-bold">üîç SEO Quiz</span><span className="text-green-400">{question + 1}/{questions.length}</span><span className="text-cyan-400">Score: {score}</span></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-lg font-medium">{q.q}</p></div><div className="grid gap-2">{q.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left ${answered ? i === q.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-black/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-4 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{q.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-green-600 rounded-lg">{question >= questions.length - 1 ? 'See Results' : 'Next Question'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-green-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-green-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const AnalyticsRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [answered, setAnswered] = useState(false);
      const [selected, setSelected] = useState<number|null>(null);
      const [log, setLog] = useState<string[]>([]);
      const scenarios = [
         {data:{visitors:5000,conversions:50,bounceRate:65,avgTime:'1:30'},q:'What is the conversion rate?',opts:['0.1%','1%','5%','10%'],correct:1,explain:'Conversion rate = 50/5000 = 1%. This measures how many visitors take desired action.'},
         {data:{visitors:10000,pageViews:35000,sessions:12000,newUsers:8000},q:'What is the pages per session?',opts:['2.9','3.5','1.2','0.8'],correct:0,explain:'Pages/session = 35000/12000 ‚âà 2.9. Shows how engaged users are with your content.'},
         {data:{revenue:50000,adSpend:10000,customers:500,returns:25},q:'What is the ROAS (Return on Ad Spend)?',opts:['2x','5x','10x','50x'],correct:1,explain:'ROAS = $50,000/$10,000 = 5x. For every $1 spent on ads, you got $5 in revenue.'},
         {data:{emailsSent:10000,opened:2500,clicked:500,unsubscribed:100},q:'What is the click-through rate (CTR)?',opts:['2%','5%','20%','25%'],correct:1,explain:'CTR = 500/10000 = 5%. Measures how many recipients clicked a link in the email.'},
         {data:{monthlyUsers:100000,dailyUsers:15000,weeklyUsers:45000,churned:5000},q:'What is the DAU/MAU ratio (stickiness)?',opts:['5%','10%','15%','45%'],correct:2,explain:'DAU/MAU = 15000/100000 = 15%. Higher ratio means users return more frequently.'},
         {data:{cac:50,ltv:200,paybackMonths:6,margin:'40%'},q:'What is the LTV:CAC ratio?',opts:['1:1','2:1','4:1','6:1'],correct:2,explain:'LTV:CAC = $200:$50 = 4:1. Generally, 3:1 or higher indicates healthy unit economics.'}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         metrics:{title:'Key Metrics',content:'Focus on metrics that drive decisions: conversion rate, CAC, LTV, churn, engagement. Vanity metrics look good but do not inform action.'},
         funnels:{title:'Funnels',content:'Track user journey stages: Awareness ‚Üí Interest ‚Üí Decision ‚Üí Action. Find where users drop off and optimize.'},
         cohorts:{title:'Cohort Analysis',content:'Group users by sign-up date to compare behavior over time. Shows if product improvements actually help retention.'},
         ab:{title:'A/B Testing',content:'Compare two versions to see which performs better. Need statistical significance before drawing conclusions.'}
      };
      const answer = (idx:number) => {
         if(answered) return;
         setSelected(idx);
         setAnswered(true);
         if(idx === scenarios[scenario].correct) {
            setScore(s => s + 1);
            setLog(l => [...l, `Q${scenario+1}: Correct!`]);
         } else {
            setLog(l => [...l, `Q${scenario+1}: Wrong`]);
         }
      };
      const next = () => {
         if(scenario >= scenarios.length - 1) setPhase('result');
         else { setScenario(s => s + 1); setAnswered(false); setSelected(null); }
      };
      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 2 ? 'C' : 'D';
      const s = scenarios[scenario];
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-6"><div className="text-6xl mb-4">üìä</div><h2 className="text-2xl font-bold mb-2">Analytics Dashboard</h2><p className="text-slate-300 text-center mb-6 max-w-md">Interpret real business data! Calculate key metrics and make data-driven decisions.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-orange-500 to-amber-500 rounded-xl font-bold">Start Analysis</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üìà' : grade === 'B' ? '‚≠ê' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">Analysis Complete!</h2><div className="text-4xl font-bold text-orange-400 mb-2">{score}/{scenarios.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Data Analyst!' : grade === 'B' ? 'Good insights!' : 'Keep practicing!'}</p><button onClick={() => {setPhase('intro');setScenario(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-orange-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-orange-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-orange-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-orange-500/30 flex justify-between items-center"><span className="font-bold">üìä Analytics</span><span className="text-orange-400">{scenario + 1}/{scenarios.length}</span><span className="text-amber-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="bg-black/30 rounded-xl p-3 mb-3"><p className="text-xs text-slate-400 mb-2">Dashboard Data:</p><div className="grid grid-cols-2 gap-2">{Object.entries(s.data).map(([k,v]) => (<div key={k} className="bg-black/30 rounded p-2 text-center"><div className="text-lg font-bold text-orange-400">{v}</div><div className="text-xs text-slate-400 capitalize">{k.replace(/([A-Z])/g, ' $1')}</div></div>))}</div></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{s.q}</p></div><div className="grid grid-cols-2 gap-2">{s.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg ${answered ? i === s.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-black/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{s.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-orange-600 rounded-lg">{scenario >= scenarios.length - 1 ? 'See Results' : 'Next'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-orange-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-orange-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const CybersecurityRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [answered, setAnswered] = useState(false);
      const [selected, setSelected] = useState<string|null>(null);
      const [log, setLog] = useState<string[]>([]);
      const scenarios = [
         {situation:'Email from "IT Support" asking you to click a link to verify your password immediately or your account will be deleted.',threat:'phishing',safe:false,explain:'Classic phishing - urgency, impersonation, and suspicious links. Real IT never asks for passwords via email.'},
         {situation:'A pop-up saying "Your computer is infected! Call this number immediately for Microsoft Support."',threat:'scam',safe:false,explain:'Tech support scam. Microsoft never shows pop-ups with phone numbers. Close the browser and run your own antivirus.'},
         {situation:'Your password manager suggests using "j8#kL9$mN2@pQ" as a password.',threat:'none',safe:true,explain:'Strong password! Long, random, with mixed characters. Password managers generate and store secure passwords.'},
         {situation:'A USB drive labeled "Employee Salaries 2024" is found in the parking lot.',threat:'baiting',safe:false,explain:'Baiting attack. Never plug unknown USB drives into your computer - they may contain malware.'},
         {situation:'Website URL shows "https://yourbank.com" with a green padlock.',threat:'none',safe:true,explain:'HTTPS with correct domain is good. But still verify you navigated there yourself, not from a suspicious link.'},
         {situation:'Coworker asks for your login to "quickly check something" while you are on vacation.',threat:'social_engineering',safe:false,explain:'Social engineering. Never share credentials, even with coworkers. They should request their own access.'},
         {situation:'Email attachment named "Invoice.pdf.exe" from unknown sender.',threat:'malware',safe:false,explain:'Malware! The .exe extension is hidden. Never open executable files from unknown sources.'},
         {situation:'Your company requires 2FA (two-factor authentication) for all accounts.',threat:'none',safe:true,explain:'2FA adds crucial security. Even if password is stolen, attacker cannot access without second factor.'}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         phishing:{title:'Phishing',content:'Fraudulent emails/sites impersonating trusted entities. Check sender, hover over links, never give passwords.'},
         malware:{title:'Malware',content:'Malicious software including viruses, ransomware, spyware. Keep software updated, use antivirus, avoid suspicious downloads.'},
         social:{title:'Social Engineering',content:'Manipulating people into giving up confidential info. Attackers exploit trust, authority, and urgency.'},
         passwords:{title:'Password Security',content:'Use unique, long passwords for each account. Enable 2FA. Use a password manager. Never share credentials.'}
      };
      const answer = (safe:boolean) => {
         if(answered) return;
         setSelected(safe ? 'safe' : 'threat');
         setAnswered(true);
         if(safe === scenarios[scenario].safe) {
            setScore(s => s + 1);
            setLog(l => [...l, `Scenario ${scenario+1}: Correct!`]);
         } else {
            setLog(l => [...l, `Scenario ${scenario+1}: Wrong`]);
         }
      };
      const next = () => {
         if(scenario >= scenarios.length - 1) setPhase('result');
         else { setScenario(s => s + 1); setAnswered(false); setSelected(null); }
      };
      const grade = score >= 7 ? 'A' : score >= 5 ? 'B' : score >= 3 ? 'C' : 'D';
      const s = scenarios[scenario];
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-red-900 to-slate-900 text-white p-6"><div className="text-6xl mb-4">üîí</div><h2 className="text-2xl font-bold mb-2">Cybersecurity Training</h2><p className="text-slate-300 text-center mb-6 max-w-md">Identify security threats! Learn to spot phishing, malware, and social engineering attacks.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl font-bold">Start Training</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-slate-900 via-red-900 to-slate-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üõ°Ô∏è' : grade === 'B' ? 'üîê' : '‚ö†Ô∏è'}</div><h2 className="text-2xl font-bold mb-2">Training Complete!</h2><div className="text-4xl font-bold text-red-400 mb-2">{score}/{scenarios.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Security Expert!' : grade === 'B' ? 'Good awareness!' : 'Stay vigilant!'}</p><button onClick={() => {setPhase('intro');setScenario(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-red-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-slate-900 via-red-900 to-slate-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-red-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-red-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-red-500/30 flex justify-between items-center"><span className="font-bold">üîí Cybersecurity</span><span className="text-red-400">{scenario + 1}/{scenarios.length}</span><span className="text-orange-400">Score: {score}</span></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-200">{s.situation}</p></div><p className="text-center text-sm text-slate-400 mb-4">Is this safe or a threat?</p><div className="grid grid-cols-2 gap-3"><button onClick={() => answer(true)} disabled={answered} className={`py-4 rounded-xl font-bold ${answered ? (s.safe ? 'bg-green-600' : selected === 'safe' ? 'bg-red-600' : 'bg-black/30') : 'bg-green-600/50 hover:bg-green-500/50'}`}>‚úì Safe</button><button onClick={() => answer(false)} disabled={answered} className={`py-4 rounded-xl font-bold ${answered ? (!s.safe ? 'bg-green-600' : selected === 'threat' ? 'bg-red-600' : 'bg-black/30') : 'bg-red-600/50 hover:bg-red-500/50'}`}>‚ö†Ô∏è Threat</button></div>{answered && (<div className="mt-4 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{s.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-red-600 rounded-lg">{scenario >= scenarios.length - 1 ? 'See Results' : 'Next'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-red-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-red-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- COMMUNICATION & MARKETING RENDERERS ---
   const ElevatorPitchRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [step, setStep] = useState(0);
      const [choices, setChoices] = useState<number[]>([]);
      const [log, setLog] = useState<string[]>([]);
      const steps = [
         {prompt:'How do you open your pitch?',opts:[{text:'Hi, I sell software...',score:1},{text:'What if you could save 10 hours a week?',score:3},{text:'Our company was founded in 2020...',score:1},{text:'Have you ever struggled with X?',score:2}],tip:'Hook'},
         {prompt:'How do you describe your solution?',opts:[{text:'We use AI and blockchain...',score:1},{text:'We help [target] achieve [result] by [method]',score:3},{text:'Our platform has many features...',score:1},{text:'We are the Uber of X',score:2}],tip:'Value'},
         {prompt:'What makes you different?',opts:[{text:'We are the best in the market',score:1},{text:'Unlike X, we do Y which means Z for you',score:3},{text:'We have great customer service',score:1},{text:'Our team is very experienced',score:2}],tip:'Differentiator'},
         {prompt:'How do you prove credibility?',opts:[{text:'Trust me, it works',score:1},{text:'We have 500 customers saving $1M total',score:3},{text:'We have been in business for years',score:1},{text:'Top investors back us',score:2}],tip:'Proof'},
         {prompt:'What is your call to action?',opts:[{text:'Let me know if interested',score:1},{text:'Can we schedule 15 min this week?',score:3},{text:'Check out our website',score:1},{text:'Here is my card',score:2}],tip:'CTA'}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         hook:{title:'The Hook',content:'Start with a question or surprising fact that grabs attention. You have 5 seconds to capture interest.'},
         value:{title:'Value Proposition',content:'Clearly state who you help, what result you deliver, and how. Avoid jargon and buzzwords.'},
         structure:{title:'Pitch Structure',content:'Hook ‚Üí Problem ‚Üí Solution ‚Üí Differentiator ‚Üí Proof ‚Üí Call to Action. Keep it under 60 seconds.'},
         practice:{title:'Practice Tips',content:'Record yourself, time it, get feedback. Great pitches sound natural but are carefully crafted.'}
      };
      const choose = (idx:number) => {
         const newChoices = [...choices, idx];
         setChoices(newChoices);
         setLog(l => [...l, `Step ${step+1}: Option ${idx+1}`]);
         if(step >= steps.length - 1) setPhase('result');
         else setStep(s => s + 1);
      };
      const totalScore = choices.reduce((a, c, i) => a + steps[i].opts[c].score, 0);
      const maxScore = steps.length * 3;
      const grade = totalScore >= 13 ? 'A' : totalScore >= 10 ? 'B' : totalScore >= 7 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6"><div className="text-6xl mb-4">üé§</div><h2 className="text-2xl font-bold mb-2">Elevator Pitch Builder</h2><p className="text-slate-300 text-center mb-6 max-w-md">Craft a compelling 60-second pitch! Choose the best option for each part of your pitch.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-violet-500 to-fuchsia-500 rounded-xl font-bold">Build Pitch</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üåü' : grade === 'B' ? 'üëè' : 'üìù'}</div><h2 className="text-2xl font-bold mb-2">Pitch Complete!</h2><div className="text-4xl font-bold text-violet-400 mb-2">{totalScore}/{maxScore}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Investor-ready pitch!' : grade === 'B' ? 'Strong pitch!' : 'Keep refining!'}</p><button onClick={() => {setPhase('intro');setStep(0);setChoices([]);setLog([]);}} className="px-6 py-2 bg-violet-600 rounded-lg">Try Again</button></div>);
      const s = steps[step];
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-violet-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-violet-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-violet-500/30 flex justify-between items-center"><span className="font-bold">üé§ Elevator Pitch</span><span className="text-violet-400">{step + 1}/{steps.length}</span><span className="text-fuchsia-400">{s.tip}</span></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-lg font-medium">{s.prompt}</p></div><div className="grid gap-2">{s.opts.map((opt, i) => (<button key={i} onClick={() => choose(i)} className="p-3 bg-black/30 hover:bg-violet-600/50 rounded-lg text-left text-sm">{opt.text}</button>))}</div></div><div className="p-3 bg-black/30 border-t border-violet-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-violet-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const NetworkingRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [event, setEvent] = useState(0);
      const [connections, setConnections] = useState(0);
      const [quality, setQuality] = useState(0);
      const [energy, setEnergy] = useState(100);
      const [log, setLog] = useState<string[]>([]);
      const events = [
         {person:'Startup Founder',options:[{action:'Ask about their business',conn:1,qual:2,nrg:-10},{action:'Pitch your idea immediately',conn:0,qual:-1,nrg:-15},{action:'Exchange cards silently',conn:1,qual:0,nrg:-5},{action:'Find common interests first',conn:1,qual:3,nrg:-10}]},
         {person:'Potential Investor',options:[{action:'Ask for money right away',conn:0,qual:-2,nrg:-20},{action:'Share your vision briefly',conn:1,qual:2,nrg:-15},{action:'Ask about their portfolio',conn:1,qual:3,nrg:-10},{action:'Ignore, too intimidating',conn:0,qual:0,nrg:-5}]},
         {person:'Industry Expert',options:[{action:'Ask for free advice',conn:1,qual:0,nrg:-10},{action:'Compliment their work genuinely',conn:1,qual:2,nrg:-10},{action:'Offer to help with something',conn:1,qual:3,nrg:-15},{action:'Monologue about yourself',conn:0,qual:-1,nrg:-20}]},
         {person:'Potential Partner',options:[{action:'Propose partnership immediately',conn:0,qual:0,nrg:-15},{action:'Explore synergies casually',conn:1,qual:3,nrg:-10},{action:'Get their contact for later',conn:1,qual:1,nrg:-5},{action:'Compare businesses competitively',conn:0,qual:-1,nrg:-10}]},
         {person:'Fellow Entrepreneur',options:[{action:'Share war stories',conn:1,qual:2,nrg:-10},{action:'One-up their achievements',conn:0,qual:-2,nrg:-15},{action:'Offer genuine support',conn:1,qual:3,nrg:-10},{action:'Keep it surface level',conn:1,qual:0,nrg:-5}]}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         quality:{title:'Quality vs Quantity',content:'10 meaningful connections beat 100 business cards. Focus on building real relationships, not collecting contacts.'},
         followup:{title:'Follow Up',content:'80% of networking value is in the follow-up. Send a personalized message within 24-48 hours.'},
         give:{title:'Give First',content:'Lead with value. Ask "How can I help?" before "What can you do for me?" Build reciprocity.'},
         listen:{title:'Active Listening',content:'Ask open questions, listen more than you talk. People remember how you made them feel.'}
      };
      const choose = (idx:number) => {
         const opt = events[event].options[idx];
         setConnections(c => c + opt.conn);
         setQuality(q => q + opt.qual);
         setEnergy(e => Math.max(0, e + opt.nrg));
         setLog(l => [...l, `${events[event].person}: ${opt.action}`]);
         if(event >= events.length - 1 || energy + opt.nrg <= 0) setPhase('result');
         else setEvent(e => e + 1);
      };
      const score = connections * 10 + quality * 5;
      const grade = score >= 35 ? 'A' : score >= 25 ? 'B' : score >= 15 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-cyan-900 via-teal-900 to-emerald-900 text-white p-6"><div className="text-6xl mb-4">ü§ù</div><h2 className="text-2xl font-bold mb-2">Networking Event</h2><p className="text-slate-300 text-center mb-6 max-w-md">Work the room at a startup mixer! Build quality connections before your energy runs out.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-cyan-500 to-emerald-500 rounded-xl font-bold">Enter Event</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-cyan-900 via-teal-900 to-emerald-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üåü' : grade === 'B' ? 'ü§ù' : 'üìá'}</div><h2 className="text-2xl font-bold mb-2">Event Over!</h2><div className="text-2xl font-bold text-cyan-400 mb-2">{connections} Connections | {quality > 0 ? '+' : ''}{quality} Quality</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Master networker!' : grade === 'B' ? 'Good connections!' : 'Keep practicing!'}</p><button onClick={() => {setPhase('intro');setEvent(0);setConnections(0);setQuality(0);setEnergy(100);setLog([]);}} className="px-6 py-2 bg-cyan-600 rounded-lg">Try Again</button></div>);
      const e = events[event];
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-cyan-900 via-teal-900 to-emerald-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-cyan-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-cyan-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-cyan-500/30"><div className="flex justify-between items-center mb-2"><span className="font-bold">ü§ù Networking</span><span className="text-cyan-400">{event + 1}/{events.length}</span></div><div className="flex gap-4 text-sm"><span>üë• {connections}</span><span>‚≠ê {quality > 0 ? '+' : ''}{quality}</span><span>‚ö° {energy}%</span></div></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4 text-center"><p className="text-2xl mb-2">üë§</p><p className="text-lg font-medium">{e.person}</p></div><div className="grid gap-2">{e.options.map((opt, i) => (<button key={i} onClick={() => choose(i)} className="p-3 bg-black/30 hover:bg-cyan-600/50 rounded-lg text-left text-sm">{opt.action}</button>))}</div></div><div className="p-3 bg-black/30 border-t border-cyan-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-cyan-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const BrandingRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [step, setStep] = useState(0);
      const [brand, setBrand] = useState<{[k:string]:number}>({});
      const [log, setLog] = useState<string[]>([]);
      const steps = [
         {element:'Brand Personality',options:[{text:'Professional & Trustworthy',traits:{trust:3,energy:1}},{text:'Fun & Playful',traits:{trust:1,energy:3}},{text:'Innovative & Bold',traits:{trust:2,energy:2}},{text:'Warm & Caring',traits:{trust:2,energy:2}}]},
         {element:'Color Palette',options:[{text:'Blue & White (Trust)',traits:{trust:3,energy:1}},{text:'Orange & Yellow (Energy)',traits:{trust:1,energy:3}},{text:'Green & Earth (Growth)',traits:{trust:2,energy:2}},{text:'Purple & Gold (Premium)',traits:{trust:2,energy:2}}]},
         {element:'Typography',options:[{text:'Serif (Traditional)',traits:{trust:3,energy:1}},{text:'Sans-serif (Modern)',traits:{trust:2,energy:2}},{text:'Display (Bold)',traits:{trust:1,energy:3}},{text:'Handwritten (Personal)',traits:{trust:1,energy:2}}]},
         {element:'Voice & Tone',options:[{text:'Formal & Authoritative',traits:{trust:3,energy:1}},{text:'Casual & Friendly',traits:{trust:1,energy:3}},{text:'Inspirational & Motivating',traits:{trust:2,energy:3}},{text:'Simple & Clear',traits:{trust:2,energy:2}}]},
         {element:'Visual Style',options:[{text:'Minimalist & Clean',traits:{trust:2,energy:2}},{text:'Vibrant & Colorful',traits:{trust:1,energy:3}},{text:'Classic & Elegant',traits:{trust:3,energy:1}},{text:'Tech & Futuristic',traits:{trust:2,energy:2}}]}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         consistency:{title:'Brand Consistency',content:'Use the same colors, fonts, voice across all touchpoints. Consistency builds recognition and trust.'},
         personality:{title:'Brand Personality',content:'Your brand should feel like a person. Define 3-5 traits that guide all communications.'},
         positioning:{title:'Positioning',content:'Own a unique space in customers minds. What one word should they associate with you?'},
         story:{title:'Brand Story',content:'People connect with stories, not features. Share your why, origin, and mission.'}
      };
      const choose = (idx:number) => {
         const opt = steps[step].options[idx];
         setBrand(b => ({...b, [steps[step].element]: idx, trust: (b.trust || 0) + opt.traits.trust, energy: (b.energy || 0) + opt.traits.energy}));
         setLog(l => [...l, `${steps[step].element}: ${opt.text}`]);
         if(step >= steps.length - 1) setPhase('result');
         else setStep(s => s + 1);
      };
      const trust = brand.trust || 0;
      const energy = brand.energy || 0;
      const archetype = trust > energy ? 'Sage/Caregiver' : energy > trust ? 'Creator/Explorer' : 'Hero/Magician';
      const score = trust + energy;
      const grade = score >= 12 ? 'A' : score >= 9 ? 'B' : score >= 6 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-rose-900 via-pink-900 to-fuchsia-900 text-white p-6"><div className="text-6xl mb-4">üé®</div><h2 className="text-2xl font-bold mb-2">Brand Builder</h2><p className="text-slate-300 text-center mb-6 max-w-md">Create your brand identity! Make choices that define your brand personality and visual style.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-rose-500 to-fuchsia-500 rounded-xl font-bold">Start Building</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-rose-900 via-pink-900 to-fuchsia-900 text-white p-6"><div className="text-6xl mb-4">üé®</div><h2 className="text-2xl font-bold mb-2">Brand Complete!</h2><div className="text-xl font-bold text-rose-400 mb-2">{archetype} Brand</div><div className="flex gap-4 mb-4"><span className="text-cyan-400">Trust: {trust}</span><span className="text-orange-400">Energy: {energy}</span></div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Cohesive brand!' : grade === 'B' ? 'Strong identity!' : 'Refine your choices!'}</p><button onClick={() => {setPhase('intro');setStep(0);setBrand({});setLog([]);}} className="px-6 py-2 bg-rose-600 rounded-lg">Try Again</button></div>);
      const s = steps[step];
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-rose-900 via-pink-900 to-fuchsia-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-rose-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-rose-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-rose-500/30 flex justify-between items-center"><span className="font-bold">üé® Brand Builder</span><span className="text-rose-400">{step + 1}/{steps.length}</span></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-lg font-medium text-center">{s.element}</p></div><div className="grid gap-2">{s.options.map((opt, i) => (<button key={i} onClick={() => choose(i)} className="p-3 bg-black/30 hover:bg-rose-600/50 rounded-lg text-left text-sm">{opt.text}</button>))}</div></div><div className="p-3 bg-black/30 border-t border-rose-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-rose-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const NegotiationRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      const scenarios = [
         {
            title: "The Anchor Battle",
            context: "You're selling your SaaS company. Your target is $5M. A strategic buyer opens with: 'We're thinking around $2M given market conditions.'",
            question: "What's the best response to this low anchor?",
            opts: [
               'Counter at $8M to split the difference at $5M',
               'Explain why $2M undervalues the company and reanchor at $6.5M with comps',
               'Walk away - the gap is too large',
               'Accept $3M as a compromise to close quickly'
            ],
            correct: 1,
            wrongExplanations: [
               "Anchoring at $8M looks unserious and damages credibility. They'll think you're not negotiating in good faith. Counter-anchors should be aggressive but defensible.",
               "", // Correct
               "Walking away too early loses the deal. The opening offer is just an anchor - it's not their final position. Most acquisitions close 40-60% above opening offers.",
               "Never accept a quick compromise on price. Their $2M anchor worked on you psychologically. You just gave up $2M+ because you felt pressure to 'meet in the middle.'"
            ],
            realWorld: "Instagram was initially offered $500M by Facebook. Systrom countered with specific metrics justifying $1B and got it. The key: data-backed counter-anchors, not arbitrary numbers.",
            concept: "anchoring",
            why: "Counter-anchoring requires: (1) Acknowledge their number without accepting it, (2) Reframe with data/comps that justify your position, (3) Anchor slightly above your target. The first number that gets accepted as 'reasonable' sets the negotiation range."
         },
         {
            title: "The BATNA Bluff",
            context: "A key supplier is raising prices 25%. You've researched alternatives but switching would take 6 months and cost $50K. They know you're their biggest customer (30% of their revenue).",
            question: "How do you leverage your BATNA here?",
            opts: [
               'Bluff that you can switch immediately',
               'Accept the increase - your BATNA is weak',
               'Explain you\'re evaluating alternatives and need 12 months at current prices to transition',
               'Threaten to switch publicly and damage their reputation'
            ],
            correct: 2,
            wrongExplanations: [
               "Bluffing a strong BATNA you don't have is dangerous. If they call your bluff, you lose credibility AND leverage. They may know your switching costs better than you think.",
               "Your BATNA isn't weak - THEIRS is! You're 30% of their revenue. Losing you is catastrophic for them. Don't negotiate against yourself.",
               "", // Correct
               "Threats and reputation damage destroy relationships. You may need this supplier long-term. Even if you win this battle, you'll lose the war."
            ],
            realWorld: "Apple negotiated with Samsung for phone components while simultaneously building in-house alternatives. They never bluffed - they actually created BATNAs, which gave them real leverage.",
            concept: "batna",
            why: "Your BATNA matters, but so does THEIRS. Calculate: What happens to them if you leave? 30% revenue loss is devastating. Frame it as: 'I need time to evaluate, let's phase any increases over 18 months' - you get time, they keep you."
         },
         {
            title: "The Equity Split",
            context: "Your technical cofounder built the MVP (6 months work). You've been doing sales/biz dev (3 months) but have industry connections and brought the initial customer. Time to formalize equity.",
            question: "What's the fairest negotiation approach?",
            opts: [
               '50/50 - cofounders should be equal partners',
               '70/30 favoring technical - they did more work',
               'Dynamic split based on future milestones and vesting',
               '60/40 favoring technical with your equity front-loaded'
            ],
            correct: 2,
            wrongExplanations: [
               "50/50 sounds fair but creates deadlock on decisions. Also ignores that contributions WILL diverge over time. What happens when one person works 80 hours and the other works 20?",
               "Past work matters less than future value. The MVP is done - what drives growth? If your sales/connections are critical for the next 5 years, this split may be backward.",
               "", // Correct
               "Front-loading your equity protects you but signals distrust. Also, 60/40 doesn't account for the startup's evolution. What if technical work becomes less important as you scale?"
            ],
            realWorld: "Many YC startups use vesting + milestone-based adjustments. One founder got additional 5% when they closed Series A, another when product hit 10K users. Aligned incentives to future value creation.",
            concept: "equity_negotiation",
            why: "The best equity negotiations focus on future value, not past work. Use: (1) 4-year vesting with 1-year cliff (everyone), (2) Milestone bonuses for key achievements, (3) Clear role definitions with adjustment mechanisms. Past contributions matter less than who'll drive the next 10 years."
         },
         {
            title: "The Silence Trap",
            context: "You're negotiating a $200K enterprise deal. You've presented your proposal at $180K. The buyer says: 'That's higher than we expected.' Then goes silent, staring at you.",
            question: "What should you do?",
            opts: [
               'Fill the silence: "I can probably do $160K"',
               'Stay silent and maintain eye contact',
               'Explain the value to justify the price',
               'Ask: "What budget did you have in mind?"'
            ],
            correct: 1,
            wrongExplanations: [
               "You just negotiated against yourself! They said nothing about price being a dealbreaker. That silence cost you $20K. Never fill silence with concessions.",
               "", // Correct
               "Explaining value after silence looks defensive. You're justifying a price you already quoted. This signals you expected pushback and had weak conviction in your pricing.",
               "Asking their budget gives away your power. You anchor first, they counter. If you ask their budget now, you've surrendered the anchor and look uncertain."
            ],
            realWorld: "A study found that negotiators who waited just 3 extra seconds before responding got 10-15% better outcomes. The discomfort of silence causes the other party to make concessions.",
            concept: "silence_power",
            why: "Silence is uncomfortable - your brain wants to fill it. But whoever speaks first after an offer typically concedes. After stating your position: STOP TALKING. Count to 10 in your head. Let them break the silence with their response or counter."
         },
         {
            title: "The Win-Win Expansion",
            context: "You're negotiating office lease renewal. Landlord wants 20% rent increase ($4K/month more). Your budget can't handle it, but you need this location.",
            question: "How do you create a win-win?",
            opts: [
               'Negotiate hard on price - it\'s a zero-sum game',
               'Offer a longer lease term in exchange for current rates',
               'Accept the increase but ask for 3 months free rent',
               'Offer to prepay 6 months rent for 10% increase instead of 20%'
            ],
            correct: 3,
            wrongExplanations: [
               "Zero-sum thinking limits outcomes. Landlords have needs beyond just rent: cash flow certainty, avoiding vacancy costs, reducing turnover. Find those interests.",
               "Longer term helps them but still leaves the price gap. You're giving something (flexibility) without solving the core budget issue.",
               "Free rent just delays the problem. In 3 months you still can't afford the increase. You've kicked the can down the road.",
               "" // Correct
            ],
            realWorld: "Airbnb negotiated their early office lease by offering to feature the building in their marketing materials. Cost them nothing, gave landlord valuable exposure. Creative value exchange.",
            concept: "expanding_pie",
            why: "Win-win requires finding what they value that costs you less than what you'd pay otherwise. Prepaying: You pay $36K now vs $48K increase over the year. They get guaranteed cash flow and lower vacancy risk. Both sides gain value their way."
         }
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         anchoring: {
            title: "Anchoring Psychology",
            content: "First numbers create cognitive reference points. Studies show anchors influence outcomes even when obviously arbitrary. To counter: (1) Ignore their number verbally, (2) Introduce your own anchor with supporting data, (3) Never 'split the difference' from their anchor."
         },
         batna: {
            title: "BATNA Strategy",
            content: "Best Alternative To Negotiated Agreement determines your walkaway point. Key insight: Their BATNA matters too! A strong BATNA comes from real alternatives, not bluffs. Invest in creating alternatives before negotiating."
         },
         silence: {
            title: "The Power of Silence",
            content: "Silence creates psychological pressure. After making an offer, STOP TALKING. The urge to fill silence leads to unnecessary concessions. Practice: State your position, then count to 10 silently. Let them respond first."
         },
         expanding: {
            title: "Expanding the Pie",
            content: "Most negotiations aren't zero-sum. Before haggling on price, find what they value that costs you less: terms, timing, payment structure, bundled services, case study rights, referrals. Create value before claiming it."
         },
         interests: {
            title: "Interests vs Positions",
            content: "Positions are WHAT people ask for. Interests are WHY they want it. 'I need $100K' is a position. 'I need security and market rate' are interests. Uncover interests to find creative solutions that satisfy both sides."
         },
         preparation: {
            title: "Negotiation Prep",
            content: "Research: their constraints, alternatives, timeline, decision-makers. Know: your BATNA, walkaway point, ideal outcome, first offer. Prepare: opening statement, responses to objections, concession strategy. Never negotiate unprepared."
         }
      };

      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setScenario(0);
         setScore(0);
         setSelected(null);
         setAnswered(false);
         setGameLog([]);
         setConceptGaps([]);
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         const isCorrect = idx === s.correct;
         if (isCorrect) {
            setScore(prev => prev + 20);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Mastered ${s.concept}`]);
         } else {
            setConceptGaps(prev => prev.includes(s.concept) ? prev : [...prev, s.concept]);
            setGameLog(prev => [...prev, `‚úó ${s.title}: Gap in ${s.concept}`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setSelected(null);
            setAnswered(false);
         }
      };

      const getGrade = () => {
         const pct = (score / (scenarios.length * 20)) * 100;
         if (pct >= 90) return { letter: 'A', label: 'Master Negotiator', color: 'text-green-400' };
         if (pct >= 70) return { letter: 'B', label: 'Skilled Negotiator', color: 'text-blue-400' };
         if (pct >= 50) return { letter: 'C', label: 'Developing', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Needs Practice', color: 'text-red-400' };
      };

      const conceptLabels: Record<string, string> = {
         anchoring: "Counter-Anchoring Techniques",
         batna: "BATNA & Alternative Leverage",
         equity_negotiation: "Equity & Partnership Splits",
         silence_power: "Silence as a Tactic",
         expanding_pie: "Win-Win Value Creation"
      };

      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-blue-900 to-slate-900 text-white p-4 overflow-auto">
            <div className="text-center mb-4">
               <h1 className="text-2xl font-bold mb-2">ü§ù Negotiation Tactics Lab</h1>
               <p className="text-indigo-300 text-sm">Psychology. Strategy. Leverage. Master the art of the deal.</p>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-indigo-400">‚ö†Ô∏è Why This Matters</h2>
               <div className="space-y-2 text-sm text-slate-300">
                  <p>‚Ä¢ <span className="text-red-400 font-bold">$1M+</span> left on the table by average entrepreneur over career</p>
                  <p>‚Ä¢ <span className="text-yellow-400 font-bold">80%</span> of negotiation outcome determined before you speak</p>
                  <p>‚Ä¢ <span className="text-green-400 font-bold">Best negotiators</span> create value, not just claim it</p>
               </div>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-indigo-400">üéØ How This Works</h2>
               <div className="space-y-2 text-sm">
                  <p>‚Ä¢ <span className="text-white font-bold">5 realistic negotiations</span> with psychological depth</p>
                  <p>‚Ä¢ Learn <span className="text-yellow-400">specific tactics</span> that change outcomes</p>
                  <p>‚Ä¢ Avoid <span className="text-red-400">common traps</span> that cost you money</p>
                  <p>‚Ä¢ Understand <span className="text-cyan-400">why</span> each approach works or fails</p>
               </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
               {Object.keys(infoTopics).map(key => (
                  <button
                     key={key}
                     onClick={() => setInfoTopic(key)}
                     className="text-xs bg-indigo-500/20 px-2 py-1 rounded-full text-indigo-300 hover:bg-indigo-500/30"
                  >
                     ‚ÑπÔ∏è {infoTopics[key].title.split(' ')[0]}
                  </button>
               ))}
            </div>

            <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-xl font-bold text-lg">
               ‚ñ∂Ô∏è BEGIN NEGOTIATIONS
            </button>

            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-indigo-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-indigo-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}
         </div>
      );

      if (phase === 'result') {
         const grade = getGrade();
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-blue-900 to-slate-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-indigo-400">Score: {score}/{scenarios.length * 20}</div>
               </div>

               {conceptGaps.length > 0 && (
                  <div className="bg-red-900/30 border border-red-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-red-400 mb-2">üìö Tactics to Study</h3>
                     <div className="space-y-1">
                        {conceptGaps.map((gap, i) => (
                           <div key={i} className="flex items-center gap-2 text-sm">
                              <span className="text-red-400">‚Üí</span>
                              <span className="text-slate-300">{conceptLabels[gap] || gap}</span>
                              <button
                                 onClick={() => {
                                    const topic = gap === 'anchoring' ? 'anchoring' :
                                                  gap === 'batna' ? 'batna' :
                                                  gap === 'silence_power' ? 'silence' :
                                                  gap === 'expanding_pie' ? 'expanding' : 'interests';
                                    setInfoTopic(topic);
                                 }}
                                 className="text-xs text-indigo-400 underline"
                              >
                                 Learn
                              </button>
                           </div>
                        ))}
                     </div>
                  </div>
               )}

               {conceptGaps.length === 0 && (
                  <div className="bg-green-900/30 border border-green-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-green-400 mb-2">üéâ Master Negotiator!</h3>
                     <p className="text-sm text-slate-300">You understand the psychology of negotiation‚Äîanchoring, BATNA leverage, silence, and value creation.</p>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-3 mb-3 max-h-32 overflow-auto">
                  <h3 className="font-bold text-indigo-400 mb-2">üìã Session Log</h3>
                  {gameLog.map((log, i) => (
                     <p key={i} className="text-xs text-slate-400">{log}</p>
                  ))}
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-indigo-400 mb-2">üí° Key Tactics</h3>
                  <ul className="text-sm text-slate-300 space-y-1">
                     <li>‚Ä¢ <span className="text-yellow-400">Counter-anchor with data</span>, not arbitrary numbers</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Their BATNA matters</span> as much as yours</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Silence is power</span>‚Äînever fill it with concessions</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Expand the pie</span> before dividing it</li>
                  </ul>
               </div>

               <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-xl font-bold">
                  üîÑ TRY AGAIN
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-indigo-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-indigo-600 rounded-lg font-bold">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      const s = scenarios[scenario];
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-blue-900 to-slate-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-indigo-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-indigo-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-indigo-500/30">
               <div className="flex justify-between items-center">
                  <span className="font-bold text-sm">ü§ù {s.title}</span>
                  <span className="text-indigo-400 text-sm">{scenario + 1}/{scenarios.length}</span>
               </div>
               <div className="flex gap-1 mt-2">
                  {scenarios.slice(0, scenario).map((_, i) => (
                     <div key={i} className={`w-3 h-3 rounded ${gameLog[i]?.startsWith('‚úì') ? 'bg-green-500' : 'bg-red-500'}`} />
                  ))}
                  <div className="w-3 h-3 rounded bg-indigo-500 animate-pulse" />
                  {scenarios.slice(scenario + 1).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded bg-slate-600" />
                  ))}
               </div>
            </div>

            <div className="flex-1 p-3 overflow-auto">
               <div className="bg-black/30 rounded-lg p-3 mb-3">
                  <p className="text-sm text-slate-200 leading-relaxed">{s.context}</p>
               </div>

               <p className="text-sm font-bold text-indigo-400 mb-2">{s.question}</p>

               <div className="space-y-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600 border-2 border-green-400'
                                 : i === selected
                                    ? 'bg-red-600 border-2 border-red-400'
                                    : 'bg-black/30 opacity-50'
                              : 'bg-black/30 hover:bg-indigo-600/50 border-2 border-transparent'
                        }`}
                     >
                        <span className="flex items-start gap-2">
                           <span className="font-bold text-indigo-400">{String.fromCharCode(65 + i)}.</span>
                           <span>{opt}</span>
                        </span>
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-2">
                     {selected !== s.correct && (
                        <div className="p-3 bg-red-900/30 border border-red-500/50 rounded-lg">
                           <p className="text-xs font-bold text-red-400 mb-1">‚ùå Why {String.fromCharCode(65 + (selected || 0))} Fails:</p>
                           <p className="text-sm text-slate-300">{s.wrongExplanations[selected || 0]}</p>
                        </div>
                     )}

                     <div className="p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úì The Winning Move:</p>
                        <p className="text-sm text-slate-300">{s.why}</p>
                     </div>

                     <div className="p-3 bg-cyan-900/30 border border-cyan-500/50 rounded-lg">
                        <p className="text-xs font-bold text-cyan-400 mb-1">üì∞ Real World:</p>
                        <p className="text-sm text-slate-300">{s.realWorld}</p>
                     </div>

                     <button onClick={next} className="w-full py-3 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-xl font-bold mt-2">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-indigo-500/30 flex gap-2 justify-center flex-wrap">
               <button onClick={() => setInfoTopic('anchoring')} className="text-xs text-indigo-400 hover:text-indigo-300">‚ÑπÔ∏è Anchoring</button>
               <button onClick={() => setInfoTopic('batna')} className="text-xs text-indigo-400 hover:text-indigo-300">‚ÑπÔ∏è BATNA</button>
               <button onClick={() => setInfoTopic('silence')} className="text-xs text-indigo-400 hover:text-indigo-300">‚ÑπÔ∏è Silence</button>
               <button onClick={() => setInfoTopic('expanding')} className="text-xs text-indigo-400 hover:text-indigo-300">‚ÑπÔ∏è Win-Win</button>
            </div>
         </div>
      );
   };

   // --- FINANCE & FUNDING RENDERERS ---
   const FundraisingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Fundraising Psychology Lab - Understanding investor thinking, term sheet traps, and founder mistakes
      const scenarios = [
         {
            title: "The Valuation Trap",
            context: "You're raising your seed round. Two VCs make offers: VC A offers $1.5M at $15M valuation (10% dilution). VC B offers $2M at $8M valuation (25% dilution). VC B has better network, more experience with your space, and offers hands-on help.",
            question: "Which offer is actually BETTER for your startup's success?",
            opts: [
               'VC A - higher valuation protects your ownership',
               'VC B - more money and better support despite higher dilution',
               'Neither - both valuations are bad, keep negotiating',
               'VC A - take the money and find advisors separately'
            ],
            correct: 1,
            wrongExplanations: [
               "Higher valuation at seed creates a 'valuation trap.' You need to grow into it or take a down round later. Many unicorn founders took LOW seed valuations from the RIGHT investors. Ownership matters less than company success.",
               "", // Correct
               "At seed stage, these are reasonable offers. Endless negotiation burns relationships and time. Investors talk to each other - being difficult early can hurt your reputation.",
               "Advisors aren't the same as investors. VC B is invested in your success with capital AND time. Separate advisors have divided attention and no skin in the game."
            ],
            realWorld: "Airbnb's seed round was at ~$2.5M valuation - tiny! But Sequoia's involvement helped them become a $100B company. Brian Chesky owns less than 15% but that stake is worth billions. Would he trade Sequoia for higher seed valuation? Never.",
            concept: "valuation_psychology",
            why: "Ownership percentage is vanity; absolute value is sanity. 10% of a $100M company > 25% of a $10M company. Great investors add 10x+ value through intros, advice, follow-on funding, and credibility. The 'best' valuation often comes from investors who add the least value."
         },
         {
            title: "The Hot Market Mistake",
            context: "The market is hot. Three VCs are competing for your deal. You're tempted to run a full auction process - playing them against each other, using FOMO, and maximizing valuation. Your advisor says 'strike while the iron is hot.'",
            question: "What's the HIDDEN RISK of running an aggressive auction?",
            opts: [
               'VCs will band together and refuse to invest',
               'You might get a high valuation you can\'t grow into',
               'The process takes too long and the market cools',
               'All of the above - but reputation damage is worst'
            ],
            correct: 3,
            wrongExplanations: [
               "VCs rarely 'band together' - they're too competitive. But they DO share notes and remember founders who acted badly. One fund passing doesn't stop others from investing.",
               "Valuation is ONE risk. But it's predictable and manageable. The reputation damage from aggressive tactics follows you for decades.",
               "Timing is ONE risk. But good companies can still raise when markets cool. What you can't recover is trust.",
               "" // Correct
            ],
            realWorld: "WeWork's Adam Neumann maximized valuations through aggressive tactics. When he needed support, VCs felt burned and let him fall. Compare to Patrick Collison (Stripe) who deliberately took lower valuations from investors who added value. When Stripe needed help, investors went to bat for them.",
            concept: "investor_relationships",
            why: "Fundraising isn't a one-time transaction - it's the start of a 10+ year relationship. You'll need these investors for follow-on rounds, bridge loans, introductions, and support during crises. A founder known for playing games will find doors closed when they need them most. Reputation > Valuation."
         },
         {
            title: "The Term Sheet Trap",
            context: "A VC offers $3M at $12M pre-money valuation. Sounds great! But buried in the term sheet: 2x participating preferred, full ratchet anti-dilution, 3 board seats (you have 2), and blocking rights on all major decisions. Your lawyer flags these as 'aggressive but not unusual.'",
            question: "What's the REAL impact of these terms?",
            opts: [
               'Minor details - valuation is what matters',
               'You\'ll likely get fired from your own company',
               'In an exit, investors get paid before you, possibly leaving you with nothing',
               'Both B and C - these terms transfer control and economics'
            ],
            correct: 3,
            wrongExplanations: [
               "These are NOT minor details. 2x participating preferred means in a $30M exit, investors take $6M first AND their pro-rata share. You might get pennies. Valuation is just the headline; terms are the substance.",
               "Getting fired is ONE risk. Board control enables this. But even if you stay, the economic terms can wipe out your stake.",
               "Getting nothing in exit is ONE risk. But losing control of decision-making means they can FORCE a bad exit or block a good one.",
               "" // Correct
            ],
            realWorld: "Plenty of founders had 'unicorn exits' and made nothing because of liquidation preferences. In the dot-com bust, founders with 2x+ preferences often got $0 while investors recovered their money. Groupon's founders made less than early employees due to term sheet structures.",
            concept: "term_sheet_mechanics",
            why: "Liquidation preferences determine who gets paid first. Participating preferred means they get their preference AND their share. Full ratchet anti-dilution can crush you in a down round. Board control means they can replace you. Together, these terms mean you're an employee with stock options, not an owner. Always negotiate terms, not just price."
         },
         {
            title: "The Timing Paradox",
            context: "Your SaaS startup has $50K MRR, growing 15% month-over-month. You have 18 months of runway. Your co-founder says 'Let's raise now while we're growing!' Your advisor says 'Wait until you hit $100K MRR - better valuation.' You're seeing other startups raise in your space.",
            question: "What's the STRATEGICALLY CORRECT timing decision?",
            opts: [
               'Raise now - 18 months isn\'t much runway',
               'Wait for $100K MRR milestone',
               'Start fundraising process now, close in 3-4 months when metrics are stronger',
               'Wait and see if market conditions stay favorable'
            ],
            correct: 2,
            wrongExplanations: [
               "18 months is actually good runway. Raising now means fundraising from a weaker position. You'd be optimizing for speed over outcome quality.",
               "Waiting for a specific milestone is rigid thinking. What if growth slows? What if a competitor raises? What if the market turns? Milestones don't guarantee anything.",
               "", // Correct
               "Waiting passively is never strategic. Markets change, competitors move, and opportunities close. Proactive > Reactive."
            ],
            realWorld: "Instagram started fundraising conversations with Sequoia months before they were 'ready.' By the time they hit inflection, the relationship was warm and they raised in days. Cold outreach at $100K MRR takes months. Warm outreach at $50K MRR with relationship building often closes faster and better.",
            concept: "fundraising_timing",
            why: "Fundraising takes 3-6 months. Start when you have 12+ months runway so you're not desperate. Begin relationship-building BEFORE you need money. The best time to raise is when you don't need to - that's when you have leverage. Starting now and closing later gives you optionality without desperation."
         },
         {
            title: "The Investor Pass Psychology",
            context: "You've pitched 20 VCs. 15 passed. 3 want 'to see more progress.' 2 are interested but moving slowly. You're frustrated and questioning everything. A friend says 'If no one's investing, maybe your idea is bad.'",
            question: "How should you INTERPRET these results?",
            opts: [
               'The market is telling you something - pivot or quit',
               'This is normal - most successful companies got many rejections first',
               'Your pitch needs work - hire a pitch coach',
               'VCs are pattern-matching wrong - you need different investors'
            ],
            correct: 1,
            wrongExplanations: [
               "20 meetings with 2 interested is actually not bad for early-stage. Many legendary companies were rejected 50+ times. VC passes tell you about VC patterns, not about your company's potential.",
               "", // Correct
               "Pitch mechanics are rarely the issue. Most rejections are about pattern matching, thesis fit, or timing. A slightly better pitch won't change a VC's thesis.",
               "Blaming VCs is a coping mechanism, not a strategy. The real insight is understanding WHY they're passing and whether it's addressable or thesis-driven."
            ],
            realWorld: "Airbnb was rejected by 7 prominent VCs who are now embarrassed about it. WhatsApp was rejected by Facebook (who later bought them for $19B). Zoom was passed on by many VCs who invested in competitors. VC rejection ‚â† Startup quality. 2/20 interested is a fundable conversion rate.",
            concept: "rejection_interpretation",
            why: "VCs pass for many reasons: wrong thesis, portfolio conflict, partner dynamics, or simply missing the vision. ~5-10% conversion rate (meetings to term sheets) is normal for good companies. The key is finding the 1-2 investors who GET IT, not convincing the masses. 2 interested investors out of 20 meetings means you're on track."
         }
      ];

      const conceptLabels: { [key: string]: string } = {
         valuation_psychology: "Valuation vs Value-Add Trade-offs",
         investor_relationships: "Long-term Investor Relationship Management",
         term_sheet_mechanics: "Term Sheet Structure & Economics",
         fundraising_timing: "Strategic Fundraising Timing",
         rejection_interpretation: "Understanding VC Decision-Making"
      };

      const infoTopics: { [k: string]: { title: string; content: string } } = {
         stages: {
            title: "Funding Stages",
            content: "Pre-seed ($100K-$500K): Idea/prototype. Seed ($500K-$3M): Early traction. Series A ($5M-$15M): Product-market fit, repeatable sales. Series B ($15M-$50M): Scaling proven model. Series C+ ($50M+): Market expansion. Each stage has different investors, metrics, and expectations. Don't raise the wrong stage."
         },
         dilution: {
            title: "Dilution Math",
            content: "Each round typically dilutes 15-25%. After 3 rounds: Founders often own 30-40%. After 5 rounds + options pool: Founders might own 15-25%. This is NORMAL for venture-scale companies. The goal isn't maximizing ownership - it's maximizing absolute value. 10% of $10B > 80% of $10M."
         },
         terms: {
            title: "Critical Term Sheet Terms",
            content: "1) Liquidation preference: 1x non-participating is founder-friendly. 2) Anti-dilution: Weighted average is standard, full ratchet is predatory. 3) Board composition: Keep founder control through Series A at minimum. 4) Protective provisions: Limit what requires investor approval. 5) Pro-rata rights: Standard, helps good investors follow on."
         },
         psychology: {
            title: "Investor Psychology",
            content: "VCs invest in patterns: Right team, right market, right timing. They're optimizing for home runs, not singles. A 'no' often means 'not pattern match' not 'bad company.' VCs have thesis constraints, partner dynamics, and portfolio considerations you can't see. Don't take rejection personally - find investors whose thesis matches your company."
         }
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         if (idx === s.correct) {
            setScore(prev => prev + 1);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Correct! Understood ${conceptLabels[s.concept]}`]);
         } else {
            setGameLog(prev => [...prev, `‚úó ${s.title}: Missed. The trap was "${s.opts[idx]}"`]);
            if (!conceptGaps.includes(s.concept)) {
               setConceptGaps(prev => [...prev, s.concept]);
            }
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setAnswered(false);
            setSelected(null);
         }
      };

      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 3 ? 'C' : 'D';
      const s = scenarios[scenario];

      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-emerald-900 via-green-900 to-teal-900 text-white p-6">
               <div className="text-6xl mb-4">üí∞</div>
               <h2 className="text-2xl font-bold mb-2">Investor Psychology Lab</h2>
               <p className="text-slate-300 text-center mb-4 max-w-md">
                  Master the psychology of fundraising - what investors really think and the traps founders fall into.
               </p>
               <div className="bg-black/30 rounded-xl p-4 mb-6 max-w-md text-sm">
                  <p className="text-emerald-400 font-bold mb-2">‚ö†Ô∏è Common Founder Mistakes:</p>
                  <ul className="text-slate-300 space-y-1 text-xs">
                     <li>‚Ä¢ Optimizing for valuation over value-add</li>
                     <li>‚Ä¢ Ignoring term sheet details that cost millions</li>
                     <li>‚Ä¢ Misreading investor signals and timing</li>
                     <li>‚Ä¢ Taking rejection personally instead of strategically</li>
                  </ul>
               </div>
               <button
                  onClick={() => setPhase('play')}
                  className="px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl font-bold hover:from-emerald-400 hover:to-teal-400 transition-all"
               >
                  Enter the Fundraising Arena
               </button>
            </div>
         );
      }

      if (phase === 'result') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-emerald-900 via-green-900 to-teal-900 text-white p-6 overflow-auto">
               <div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? 'üí∞' : grade === 'C' ? 'üìä' : 'üìö'}</div>
               <h2 className="text-2xl font-bold mb-2">Fundraising Assessment Complete</h2>
               <div className="text-4xl font-bold text-emerald-400 mb-2">{score}/{scenarios.length}</div>
               <div className="text-5xl mb-4">{grade}</div>
               <p className="text-slate-400 mb-4 text-center">
                  {grade === 'A' ? 'Fundraising sophisticate! You think like a seasoned founder.' :
                   grade === 'B' ? 'Good fundraising instincts. Some blind spots to address.' :
                   grade === 'C' ? 'Common founder mistakes detected. Study before raising.' :
                   'Many costly misconceptions. Essential to study before fundraising.'}
               </p>

               {conceptGaps.length > 0 && (
                  <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4">
                     <p className="text-emerald-400 font-bold text-sm mb-2">üìö Concepts to Study:</p>
                     <ul className="text-slate-300 text-xs space-y-1">
                        {conceptGaps.map(gap => (
                           <li key={gap}>‚Ä¢ {conceptLabels[gap]}</li>
                        ))}
                     </ul>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4 max-h-32 overflow-y-auto">
                  <p className="text-emerald-400 font-bold text-sm mb-2">Session Log:</p>
                  {gameLog.map((entry, i) => (
                     <p key={i} className="text-xs text-slate-300">{entry}</p>
                  ))}
               </div>

               <button
                  onClick={() => {
                     setPhase('intro');
                     setScenario(0);
                     setScore(0);
                     setAnswered(false);
                     setSelected(null);
                     setGameLog([]);
                     setConceptGaps([]);
                  }}
                  className="px-6 py-2 bg-emerald-600 rounded-lg hover:bg-emerald-500"
               >
                  Try Again
               </button>
            </div>
         );
      }

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-emerald-900 via-green-900 to-teal-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-emerald-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-emerald-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-emerald-500/30 flex justify-between items-center">
               <span className="font-bold">üí∞ Investor Psychology</span>
               <span className="text-emerald-400">{scenario + 1}/{scenarios.length}</span>
               <span className="text-teal-400">Score: {score}</span>
            </div>

            <div className="flex-1 p-4 overflow-auto">
               <div className="bg-black/30 rounded-xl p-3 mb-3">
                  <p className="font-bold text-emerald-400 mb-2">{s.title}</p>
                  <p className="text-sm text-slate-300">{s.context}</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-3">
                  <p className="font-medium text-white">{s.question}</p>
               </div>

               <div className="grid gap-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600'
                                 : i === selected
                                    ? 'bg-red-600'
                                    : 'bg-black/30'
                              : 'bg-black/30 hover:bg-emerald-600/50'
                        }`}
                     >
                        {opt}
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-3">
                     {selected !== s.correct && s.wrongExplanations[selected!] && (
                        <div className="p-3 bg-red-900/50 rounded-lg border border-red-500/30">
                           <p className="text-xs text-red-300 font-bold mb-1">‚ùå Why This Was Wrong:</p>
                           <p className="text-sm text-red-100">{s.wrongExplanations[selected!]}</p>
                        </div>
                     )}
                     <div className="p-3 bg-green-900/50 rounded-lg border border-green-500/30">
                        <p className="text-xs text-green-300 font-bold mb-1">‚úì Strategic Insight:</p>
                        <p className="text-sm text-green-100">{s.why}</p>
                     </div>
                     <div className="p-3 bg-blue-900/50 rounded-lg border border-blue-500/30">
                        <p className="text-xs text-blue-300 font-bold mb-1">üìñ Real World:</p>
                        <p className="text-sm text-blue-100">{s.realWorld}</p>
                     </div>
                     <button
                        onClick={next}
                        className="w-full py-2 bg-emerald-600 rounded-lg hover:bg-emerald-500"
                     >
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-emerald-500/30 flex gap-2 justify-center flex-wrap">
               {Object.keys(infoTopics).map(k => (
                  <button
                     key={k}
                     onClick={() => { setInfoTopic(k); setShowInfo(true); }}
                     className="text-xs text-emerald-400 hover:text-emerald-300"
                  >
                     ‚ÑπÔ∏è {infoTopics[k].title}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   const FinancialStatementsRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      const scenarios = [
         {
            title: "The Profitable Bankruptcy",
            context: "A SaaS startup shows: Revenue $2M, Net Income $400K (20% margin). But they're asking for emergency funding. Their balance sheet shows: Cash $50K, AR $800K (90-day terms), AP $600K (due in 30 days).",
            question: "Why is this profitable company in financial trouble?",
            opts: [
               'The profit margin is too low',
               'Cash flow crisis - AR collection too slow vs AP due dates',
               'They have too much debt',
               'Revenue is declining'
            ],
            correct: 1,
            wrongExplanations: [
               "20% net margin is excellent for SaaS. Margin isn't the problem here. Look at the timing mismatch between assets and liabilities.",
               "", // Correct
               "There's no mention of debt. The issue is working capital timing - they're owed money that won't arrive before bills are due.",
               "Nothing indicates declining revenue. This is a TIMING problem, not a revenue problem. Profitable companies can run out of cash."
            ],
            realWorld: "Toys 'R' Us was profitable in many years before bankruptcy. They couldn't manage working capital during seasonal inventory buildups. Profit ‚â† Cash.",
            concept: "cash_vs_profit",
            why: "Profit is accounting. Cash is survival. They have $800K coming but only $50K in hand, with $600K due NOW. They'll be profitable on paper while bouncing checks. This is why the Cash Flow Statement matters more than the Income Statement for survival."
         },
         {
            title: "The Margin Mystery",
            context: "Two competitors: Company A has 70% gross margin but 5% net margin. Company B has 40% gross margin but 15% net margin. Same revenue ($10M each).",
            question: "What does this tell you about their business models?",
            opts: [
               'Company A is more efficient',
               'Company B has better products',
               'Company A overspends on sales/marketing/overhead',
               'Company B has lower quality products'
            ],
            correct: 2,
            wrongExplanations: [
               "Company A is LESS efficient. They make more per sale (70% vs 40%) but keep less (5% vs 15%). Something is eating their profits between gross and net.",
               "", // Close but wrong framing
               "", // Correct
               "Lower gross margin doesn't mean lower quality. It often means different business models - physical vs digital, commoditized vs differentiated."
            ],
            realWorld: "WeWork had 80%+ gross margins on desks but burned billions on sales, marketing, and Adam Neumann's expenses. High gross margin means nothing if operating costs eat it all.",
            concept: "margin_analysis",
            why: "The GAP between gross and net margin reveals operating efficiency. Company A: 70% - 5% = 65% goes to OpEx. Company B: 40% - 15% = 25% to OpEx. Company A spends 2.6x more on operations per dollar of gross profit. That's a red flag."
         },
         {
            title: "The Growth Trap",
            context: "A startup's 3-year trend: Year 1: Revenue $1M, Burn $500K. Year 2: Revenue $3M, Burn $2M. Year 3: Revenue $8M, Burn $6M. They're raising Series B.",
            question: "What's the critical question investors will ask?",
            opts: [
               'Why is revenue growing so fast?',
               'When will burn rate decrease?',
               'What is the path to unit economics profitability?',
               'Why don\'t you have more customers?'
            ],
            correct: 2,
            wrongExplanations: [
               "Fast revenue growth is GOOD - investors want that. The question is whether that growth is sustainable and eventually profitable.",
               "Burn rate might never decrease if you're scaling. The question is whether each dollar of burn generates profitable returns eventually.",
               "", // Correct
               "Revenue is 8x in 3 years - customer acquisition isn't the problem here. The question is whether those customers are profitable."
            ],
            realWorld: "Uber scaled to $10B+ revenue while losing billions. Investors finally asked: 'Will a ride EVER be profitable?' Unit economics matter more than total growth.",
            concept: "unit_economics",
            why: "Unit economics = profit per customer/transaction. If you lose money on each sale, more sales = more losses. Investors want to see: 'We lose money overall because of fixed costs, but each new customer is profitable. At X scale, we'll be profitable.'"
         },
         {
            title: "The Debt Dilemma",
            context: "Company has $5M revenue, $1M net income. Balance sheet shows: $2M cash, $3M debt at 8% interest ($240K/year). They're considering taking $5M more debt to expand.",
            question: "What financial metric should guide this decision?",
            opts: [
               'Current ratio - can they pay short-term bills?',
               'Interest coverage ratio - can they service the debt?',
               'Gross margin - are products profitable?',
               'Revenue growth rate - is business growing?'
            ],
            correct: 1,
            wrongExplanations: [
               "Current ratio measures short-term liquidity, not debt capacity. They have $2M cash which is fine for short-term. The question is long-term debt service.",
               "", // Correct
               "Gross margin matters for product profitability, not debt decisions. They're already net profitable - the question is debt capacity.",
               "Growth rate is important but doesn't answer: 'Can we afford this debt?' Fast-growing companies have gone bankrupt from over-leveraging."
            ],
            realWorld: "Hertz had strong revenue but took on too much debt. When COVID hit, they couldn't make interest payments and filed bankruptcy despite having a real business.",
            concept: "leverage_ratios",
            why: "Interest Coverage = EBIT / Interest Expense. Current: ~$1.2M / $240K = 5x (healthy). With $5M more at 8%: $640K total interest. New ratio: ~1.9x (danger zone). Banks want 3x+ coverage. This expansion could make them fragile."
         },
         {
            title: "The AR Alarm",
            context: "Your SaaS dashboard shows: MRR grew 50% this year ($100K‚Üí$150K). But AR also grew 200% ($50K‚Üí$150K). Days Sales Outstanding went from 30 to 90 days.",
            question: "What's the hidden problem these numbers reveal?",
            opts: [
               'Growth is too fast to manage',
               'Customers are churning',
               'Revenue recognition is aggressive or customers aren\'t paying',
               'Pricing is too low'
            ],
            correct: 2,
            wrongExplanations: [
               "Fast growth is manageable - the problem is specifically in collections/AR. Growth itself isn't the issue.",
               "If customers churned, revenue would drop, not grow. This is a payment issue, not a retention issue.",
               "", // Correct
               "Pricing doesn't explain why AR grew 4x while revenue grew 1.5x. The issue is cash collection, not pricing."
            ],
            realWorld: "Luckin Coffee (China Starbucks competitor) showed massive revenue growth, but AR grew faster. Investigation revealed fabricated sales that never collected payment. $300M fraud.",
            concept: "ar_analysis",
            why: "Red flags: (1) AR growing faster than revenue = customers not paying, (2) DSO tripling = it takes 3x longer to collect, (3) Either sales are 'recognized' before payment is certain (aggressive accounting) OR customers are slow/unable to pay. Both are serious. Investigate immediately."
         }
      ];

      const infoTopics: Record<string, { title: string; content: string }> = {
         income: {
            title: "Income Statement Deep Dive",
            content: "Revenue - COGS = Gross Profit. Gross - OpEx = Operating Income. Operating - Interest - Taxes = Net Income. Watch the GAPS between margins - they reveal where money goes. High gross but low net = operational inefficiency."
         },
         balance: {
            title: "Balance Sheet Analysis",
            content: "Assets = Liabilities + Equity. Current assets/liabilities = due within 1 year. Working Capital = Current Assets - Current Liabilities. Negative working capital = potential cash crisis. Watch AR trends - growing faster than revenue is a red flag."
         },
         cashflow: {
            title: "Cash Flow Statement",
            content: "Operating: cash from business. Investing: buying/selling assets. Financing: debt/equity changes. Profitable companies can have negative operating cash flow (growing AR/inventory). Cash is survival - profit is accounting."
         },
         ratios: {
            title: "Critical Financial Ratios",
            content: "Current Ratio = Current Assets / Current Liabilities (liquidity). Interest Coverage = EBIT / Interest (debt safety). DSO = AR / (Revenue/365) (collection speed). Gross Margin trends reveal pricing power. Compare ratios to industry benchmarks."
         },
         redflags: {
            title: "Financial Red Flags",
            content: "AR growing faster than revenue. Inventory building up. Decreasing margins over time. Debt increasing while profits fall. Revenue up but cash flow down. These patterns often precede major problems or fraud."
         },
         uniteconomics: {
            title: "Unit Economics",
            content: "LTV (Customer Lifetime Value) vs CAC (Customer Acquisition Cost). LTV/CAC should be 3x+. Payback period = months to recover CAC. Contribution margin per unit. If unit economics don't work, scale just accelerates losses."
         }
      };

      useEffect(() => { if (infoTopic && infoTopics[infoTopic]) setShowInfo(true); }, [infoTopic]);

      const startGame = () => {
         setPhase('play');
         setScenario(0);
         setScore(0);
         setSelected(null);
         setAnswered(false);
         setGameLog([]);
         setConceptGaps([]);
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         const isCorrect = idx === s.correct;
         if (isCorrect) {
            setScore(prev => prev + 20);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Understood ${s.concept}`]);
         } else {
            setConceptGaps(prev => prev.includes(s.concept) ? prev : [...prev, s.concept]);
            setGameLog(prev => [...prev, `‚úó ${s.title}: Gap in ${s.concept}`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setSelected(null);
            setAnswered(false);
         }
      };

      const getGrade = () => {
         const pct = (score / (scenarios.length * 20)) * 100;
         if (pct >= 90) return { letter: 'A', label: 'Financial Analyst', color: 'text-green-400' };
         if (pct >= 70) return { letter: 'B', label: 'Financially Literate', color: 'text-blue-400' };
         if (pct >= 50) return { letter: 'C', label: 'Developing', color: 'text-yellow-400' };
         return { letter: 'D', label: 'Study Needed', color: 'text-red-400' };
      };

      const conceptLabels: Record<string, string> = {
         cash_vs_profit: "Cash Flow vs Profit",
         margin_analysis: "Margin Analysis & Efficiency",
         unit_economics: "Unit Economics & Scalability",
         leverage_ratios: "Debt & Leverage Ratios",
         ar_analysis: "Accounts Receivable Red Flags"
      };

      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-blue-900 via-slate-900 to-gray-900 text-white p-4 overflow-auto">
            <div className="text-center mb-4">
               <h1 className="text-2xl font-bold mb-2">üìä Financial Detective</h1>
               <p className="text-blue-300 text-sm">Read between the lines. Numbers tell stories‚Äîif you know what to look for.</p>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-blue-400">‚ö†Ô∏è Why This Matters</h2>
               <div className="space-y-2 text-sm text-slate-300">
                  <p>‚Ä¢ <span className="text-red-400 font-bold">Profitable companies</span> go bankrupt every year</p>
                  <p>‚Ä¢ <span className="text-yellow-400 font-bold">Financial fraud</span> often hides in plain sight</p>
                  <p>‚Ä¢ <span className="text-green-400 font-bold">The real story</span> is in the trends, not the headlines</p>
               </div>
            </div>

            <div className="bg-black/30 rounded-xl p-4 mb-4">
               <h2 className="text-lg font-bold mb-3 text-blue-400">üéØ How This Works</h2>
               <div className="space-y-2 text-sm">
                  <p>‚Ä¢ <span className="text-white font-bold">5 real financial scenarios</span> with hidden problems</p>
                  <p>‚Ä¢ Analyze <span className="text-yellow-400">income statements, balance sheets, cash flow</span></p>
                  <p>‚Ä¢ Spot <span className="text-red-400">red flags</span> that indicate trouble ahead</p>
                  <p>‚Ä¢ Learn what <span className="text-cyan-400">investors and lenders</span> actually look for</p>
               </div>
            </div>

            <div className="flex flex-wrap gap-2 mb-4">
               {Object.keys(infoTopics).map(key => (
                  <button
                     key={key}
                     onClick={() => setInfoTopic(key)}
                     className="text-xs bg-blue-500/20 px-2 py-1 rounded-full text-blue-300 hover:bg-blue-500/30"
                  >
                     ‚ÑπÔ∏è {infoTopics[key].title.split(' ')[0]}
                  </button>
               ))}
            </div>

            <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-blue-600 to-slate-600 rounded-xl font-bold text-lg">
               ‚ñ∂Ô∏è BEGIN ANALYSIS
            </button>

            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}
         </div>
      );

      if (phase === 'result') {
         const grade = getGrade();
         return (
            <div className="w-full h-full flex flex-col bg-gradient-to-br from-blue-900 via-slate-900 to-gray-900 text-white p-4 overflow-auto">
               <div className="text-center mb-4">
                  <div className={`text-6xl font-bold ${grade.color}`}>{grade.letter}</div>
                  <div className="text-xl font-bold">{grade.label}</div>
                  <div className="text-blue-400">Score: {score}/{scenarios.length * 20}</div>
               </div>

               {conceptGaps.length > 0 && (
                  <div className="bg-red-900/30 border border-red-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-red-400 mb-2">üìö Concepts to Study</h3>
                     <div className="space-y-1">
                        {conceptGaps.map((gap, i) => (
                           <div key={i} className="flex items-center gap-2 text-sm">
                              <span className="text-red-400">‚Üí</span>
                              <span className="text-slate-300">{conceptLabels[gap] || gap}</span>
                              <button
                                 onClick={() => {
                                    const topic = gap === 'cash_vs_profit' ? 'cashflow' :
                                                  gap === 'margin_analysis' ? 'income' :
                                                  gap === 'unit_economics' ? 'uniteconomics' :
                                                  gap === 'leverage_ratios' ? 'ratios' : 'redflags';
                                    setInfoTopic(topic);
                                 }}
                                 className="text-xs text-blue-400 underline"
                              >
                                 Learn
                              </button>
                           </div>
                        ))}
                     </div>
                  </div>
               )}

               {conceptGaps.length === 0 && (
                  <div className="bg-green-900/30 border border-green-500/50 rounded-xl p-3 mb-3">
                     <h3 className="font-bold text-green-400 mb-2">üéâ Financial Expert!</h3>
                     <p className="text-sm text-slate-300">You can read between the financial lines‚Äîspotting cash crises, margin problems, and red flags before they become disasters.</p>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-3 mb-3 max-h-32 overflow-auto">
                  <h3 className="font-bold text-blue-400 mb-2">üìã Session Log</h3>
                  {gameLog.map((log, i) => (
                     <p key={i} className="text-xs text-slate-400">{log}</p>
                  ))}
               </div>

               <div className="bg-black/30 rounded-xl p-3 mb-4">
                  <h3 className="font-bold text-blue-400 mb-2">üí° Key Insights</h3>
                  <ul className="text-sm text-slate-300 space-y-1">
                     <li>‚Ä¢ <span className="text-yellow-400">Profit ‚â† Cash</span>‚Äîtiming kills profitable companies</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Margin gaps</span> reveal operational efficiency</li>
                     <li>‚Ä¢ <span className="text-yellow-400">AR growing faster than revenue</span> is a red flag</li>
                     <li>‚Ä¢ <span className="text-yellow-400">Unit economics</span> matter more than total growth</li>
                  </ul>
               </div>

               <button onClick={startGame} className="w-full py-3 bg-gradient-to-r from-blue-600 to-slate-600 rounded-xl font-bold">
                  üîÑ TRY AGAIN
               </button>

               {showInfo && infoTopic && infoTopics[infoTopic] && (
                  <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                     <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3>
                        <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                        <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg font-bold">Got it!</button>
                     </div>
                  </div>
               )}
            </div>
         );
      }

      const s = scenarios[scenario];
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-blue-900 via-slate-900 to-gray-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-blue-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300 leading-relaxed">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-blue-600 rounded-lg font-bold">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-blue-500/30">
               <div className="flex justify-between items-center">
                  <span className="font-bold text-sm">üìä {s.title}</span>
                  <span className="text-blue-400 text-sm">{scenario + 1}/{scenarios.length}</span>
               </div>
               <div className="flex gap-1 mt-2">
                  {scenarios.slice(0, scenario).map((_, i) => (
                     <div key={i} className={`w-3 h-3 rounded ${gameLog[i]?.startsWith('‚úì') ? 'bg-green-500' : 'bg-red-500'}`} />
                  ))}
                  <div className="w-3 h-3 rounded bg-blue-500 animate-pulse" />
                  {scenarios.slice(scenario + 1).map((_, i) => (
                     <div key={i} className="w-3 h-3 rounded bg-slate-600" />
                  ))}
               </div>
            </div>

            <div className="flex-1 p-3 overflow-auto">
               <div className="bg-black/30 rounded-lg p-3 mb-3">
                  <p className="text-sm text-slate-200 leading-relaxed">{s.context}</p>
               </div>

               <p className="text-sm font-bold text-blue-400 mb-2">{s.question}</p>

               <div className="space-y-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`w-full p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600 border-2 border-green-400'
                                 : i === selected
                                    ? 'bg-red-600 border-2 border-red-400'
                                    : 'bg-black/30 opacity-50'
                              : 'bg-black/30 hover:bg-blue-600/50 border-2 border-transparent'
                        }`}
                     >
                        <span className="flex items-start gap-2">
                           <span className="font-bold text-blue-400">{String.fromCharCode(65 + i)}.</span>
                           <span>{opt}</span>
                        </span>
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-2">
                     {selected !== s.correct && (
                        <div className="p-3 bg-red-900/30 border border-red-500/50 rounded-lg">
                           <p className="text-xs font-bold text-red-400 mb-1">‚ùå Why {String.fromCharCode(65 + (selected || 0))} is Wrong:</p>
                           <p className="text-sm text-slate-300">{s.wrongExplanations[selected || 0]}</p>
                        </div>
                     )}

                     <div className="p-3 bg-green-900/30 border border-green-500/50 rounded-lg">
                        <p className="text-xs font-bold text-green-400 mb-1">‚úì The Real Issue:</p>
                        <p className="text-sm text-slate-300">{s.why}</p>
                     </div>

                     <div className="p-3 bg-amber-900/30 border border-amber-500/50 rounded-lg">
                        <p className="text-xs font-bold text-amber-400 mb-1">üì∞ Real Case:</p>
                        <p className="text-sm text-slate-300">{s.realWorld}</p>
                     </div>

                     <button onClick={next} className="w-full py-3 bg-gradient-to-r from-blue-600 to-slate-600 rounded-xl font-bold mt-2">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Case ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-blue-500/30 flex gap-2 justify-center flex-wrap">
               <button onClick={() => setInfoTopic('income')} className="text-xs text-blue-400 hover:text-blue-300">‚ÑπÔ∏è Income</button>
               <button onClick={() => setInfoTopic('balance')} className="text-xs text-blue-400 hover:text-blue-300">‚ÑπÔ∏è Balance</button>
               <button onClick={() => setInfoTopic('cashflow')} className="text-xs text-blue-400 hover:text-blue-300">‚ÑπÔ∏è Cash Flow</button>
               <button onClick={() => setInfoTopic('redflags')} className="text-xs text-blue-400 hover:text-blue-300">‚ÑπÔ∏è Red Flags</button>
            </div>
         </div>
      );
   };

   const PricingStrategyRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [round, setRound] = useState(0);
      const [revenue, setRevenue] = useState(0);
      const [customers, setCustomers] = useState(0);
      const [log, setLog] = useState<string[]>([]);
      const rounds = [
         {product:'SaaS Tool',cost:20,competitors:[49,79,99],options:[{price:29,demand:100},{price:49,demand:70},{price:79,demand:40},{price:99,demand:20}]},
         {product:'Online Course',cost:50,competitors:[197,297,497],options:[{price:97,demand:80},{price:197,demand:50},{price:297,demand:30},{price:497,demand:15}]},
         {product:'Consulting Hour',cost:0,competitors:[150,250,400],options:[{price:100,demand:90},{price:200,demand:50},{price:350,demand:25},{price:500,demand:10}]},
         {product:'Physical Product',cost:15,competitors:[29,39,49],options:[{price:24,demand:100},{price:34,demand:70},{price:44,demand:45},{price:54,demand:25}]},
         {product:'Mobile App',cost:5,competitors:[0,4.99,9.99],options:[{price:0,demand:1000},{price:2.99,demand:200},{price:6.99,demand:80},{price:12.99,demand:30}]}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         costplus:{title:'Cost-Plus Pricing',content:'Price = Cost + Markup. Simple but ignores what customers will pay and competitor prices.'},
         value:{title:'Value-Based Pricing',content:'Price based on value delivered to customer. Can charge premium if you solve expensive problems.'},
         competition:{title:'Competitive Pricing',content:'Price relative to competitors. Can undercut, match, or premium price based on differentiation.'},
         psychology:{title:'Price Psychology',content:'$99 vs $100 matters. Anchoring, decoy pricing, bundling all influence perceived value.'}
      };
      const choose = (idx:number) => {
         const r = rounds[round];
         const opt = r.options[idx];
         const profit = (opt.price - r.cost) * opt.demand;
         setRevenue(rev => rev + profit);
         setCustomers(c => c + opt.demand);
         setLog(l => [...l, `${r.product}: $${opt.price} x ${opt.demand} = $${profit} profit`]);
         if(round >= rounds.length - 1) setPhase('result');
         else setRound(rnd => rnd + 1);
      };
      const grade = revenue >= 50000 ? 'A' : revenue >= 35000 ? 'B' : revenue >= 20000 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-6"><div className="text-6xl mb-4">üè∑Ô∏è</div><h2 className="text-2xl font-bold mb-2">Pricing Strategy</h2><p className="text-slate-300 text-center mb-6 max-w-md">Set prices for 5 products! Balance profit margins with customer demand.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl font-bold">Start Pricing</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üí∞' : grade === 'B' ? 'üìà' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">Pricing Complete!</h2><div className="text-2xl font-bold text-yellow-400 mb-2">${revenue.toLocaleString()} Profit</div><div className="text-sm text-slate-400 mb-4">{customers} total customers</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Pricing genius!' : grade === 'B' ? 'Good margins!' : 'Left money on table!'}</p><button onClick={() => {setPhase('intro');setRound(0);setRevenue(0);setCustomers(0);setLog([]);}} className="px-6 py-2 bg-yellow-600 rounded-lg">Try Again</button></div>);
      const r = rounds[round];
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-yellow-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-yellow-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-yellow-500/30"><div className="flex justify-between items-center mb-2"><span className="font-bold">üè∑Ô∏è Pricing</span><span className="text-yellow-400">{round + 1}/{rounds.length}</span></div><div className="flex gap-4 text-sm"><span>üí∞ ${revenue.toLocaleString()}</span><span>üë• {customers}</span></div></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-bold text-lg">{r.product}</p><p className="text-sm text-slate-400">Your cost: ${r.cost} | Competitors: ${r.competitors.join(', $')}</p></div><div className="grid gap-2">{r.options.map((opt, i) => (<button key={i} onClick={() => choose(i)} className="p-3 bg-black/30 hover:bg-yellow-600/50 rounded-lg text-left"><div className="flex justify-between"><span className="font-bold">${opt.price}</span><span className="text-sm text-slate-400">~{opt.demand} customers</span></div><div className="text-xs text-slate-500">Profit: ${(opt.price - r.cost) * opt.demand}</div></button>))}</div></div><div className="p-3 bg-black/30 border-t border-yellow-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-yellow-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const BudgetingRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [month, setMonth] = useState(1);
      const [cash, setCash] = useState(50000);
      const [revenue] = useState(20000);
      const [allocations, setAllocations] = useState<{[k:string]:number}>({});
      const [log, setLog] = useState<string[]>([]);
      const categories = [
         {id:'payroll',name:'Payroll',icon:'üë•',min:8000,max:15000,impact:'team'},
         {id:'marketing',name:'Marketing',icon:'üì¢',min:0,max:8000,impact:'growth'},
         {id:'operations',name:'Operations',icon:'‚öôÔ∏è',min:2000,max:5000,impact:'stability'},
         {id:'rnd',name:'R&D',icon:'üî¨',min:0,max:6000,impact:'product'},
         {id:'emergency',name:'Emergency Fund',icon:'üõ°Ô∏è',min:0,max:5000,impact:'safety'}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         runway:{title:'Cash Runway',content:'Months of operation before running out of cash. Runway = Cash / Monthly Burn. Always know your runway.'},
         burn:{title:'Burn Rate',content:'How much cash you spend per month. Gross burn = total spending. Net burn = spending - revenue.'},
         zero:{title:'Zero-Based Budgeting',content:'Start from zero each period, justify every expense. Prevents bloat but takes more time.'},
         forecast:{title:'Forecasting',content:'Project future revenue and expenses. Be conservative on revenue, generous on expenses.'}
      };
      const [budgetSet, setBudgetSet] = useState(false);
      const setBudget = (id:string, val:number) => {
         setAllocations(a => ({...a, [id]: val}));
      };
      const totalAllocated = Object.values(allocations).reduce((a,b) => a + b, 0);
      const confirmBudget = () => {
         if(totalAllocated > revenue) return;
         setBudgetSet(true);
         const saved = revenue - totalAllocated;
         setCash(c => c + saved);
         setLog(l => [...l, `Month ${month}: Allocated $${totalAllocated}, Saved $${saved}`]);
      };
      const nextMonth = () => {
         if(month >= 6) setPhase('result');
         else { setMonth(m => m + 1); setAllocations({}); setBudgetSet(false); }
      };
      const grade = cash >= 80000 ? 'A' : cash >= 60000 ? 'B' : cash >= 40000 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-violet-900 via-purple-900 to-indigo-900 text-white p-6"><div className="text-6xl mb-4">üìã</div><h2 className="text-2xl font-bold mb-2">Startup Budgeting</h2><p className="text-slate-300 text-center mb-6 max-w-md">Manage your startup budget for 6 months! Allocate $20k monthly revenue across categories.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-violet-500 to-indigo-500 rounded-xl font-bold">Start Budgeting</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-violet-900 via-purple-900 to-indigo-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? 'üìà' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">6 Months Complete!</h2><div className="text-2xl font-bold text-violet-400 mb-2">${cash.toLocaleString()} Cash</div><div className="text-sm text-slate-400 mb-4">Started: $50,000</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Financial wizard!' : grade === 'B' ? 'Good management!' : 'Watch the burn!'}</p><button onClick={() => {setPhase('intro');setMonth(1);setCash(50000);setAllocations({});setBudgetSet(false);setLog([]);}} className="px-6 py-2 bg-violet-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-violet-900 via-purple-900 to-indigo-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-violet-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-violet-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-violet-500/30"><div className="flex justify-between items-center mb-2"><span className="font-bold">üìã Budget</span><span className="text-violet-400">Month {month}/6</span></div><div className="flex gap-4 text-sm"><span>üíµ Cash: ${cash.toLocaleString()}</span><span>üìà Revenue: ${revenue.toLocaleString()}</span></div></div><div className="flex-1 p-3 overflow-auto">{!budgetSet ? (<div className="space-y-3">{categories.map(cat => (<div key={cat.id} className="bg-black/30 rounded-lg p-3"><div className="flex justify-between mb-2"><span>{cat.icon} {cat.name}</span><span className="text-violet-400">${allocations[cat.id] || 0}</span></div><input type="range" min={cat.min} max={cat.max} step={500} value={allocations[cat.id] || cat.min} onChange={e => setBudget(cat.id, Number(e.target.value))} className="w-full" /></div>))}<div className={`text-center p-2 rounded ${totalAllocated > revenue ? 'bg-red-600/50' : 'bg-green-600/50'}`}>{totalAllocated > revenue ? `Over budget by $${totalAllocated - revenue}` : `$${revenue - totalAllocated} unallocated (savings)`}</div></div>) : (<div className="text-center p-4"><p className="text-xl mb-4">Budget set for Month {month}</p><p className="text-slate-400">Allocated: ${totalAllocated}</p><p className="text-green-400">Saved: ${revenue - totalAllocated}</p></div>)}</div><div className="p-3 bg-black/30 border-t border-violet-500/30">{!budgetSet ? (<button onClick={confirmBudget} disabled={totalAllocated > revenue} className="w-full py-3 bg-violet-600 rounded-xl font-bold disabled:opacity-50">Confirm Budget</button>) : (<button onClick={nextMonth} className="w-full py-3 bg-violet-600 rounded-xl font-bold">{month >= 6 ? 'See Results' : 'Next Month'}</button>)}<div className="flex gap-2 mt-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-violet-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div></div>);
   };

   // --- STRATEGY & GROWTH RENDERERS ---
   const MarketResearchRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [question, setQuestion] = useState(0);
      const [score, setScore] = useState(0);
      const [answered, setAnswered] = useState(false);
      const [selected, setSelected] = useState<number|null>(null);
      const [log, setLog] = useState<string[]>([]);
      const questions = [
         {q:'TAM is $10B, SAM is $1B, SOM is $100M. What does SOM represent?',opts:['Total market globally','Market you can serve','Market you can realistically capture','Your current revenue'],correct:2,explain:'SOM (Serviceable Obtainable Market) is the realistic portion you can capture given resources and competition.'},
         {q:'Which research method gives qualitative insights but is hard to scale?',opts:['Surveys','Customer interviews','A/B testing','Analytics'],correct:1,explain:'Interviews provide deep insights into motivations and pain points but are time-intensive to conduct.'},
         {q:'Your survey has 1000 responses with 60% saying they would buy. How many will actually buy?',opts:['600','300','60','Unknown without more data'],correct:2,explain:'Rule of thumb: divide stated intent by 10. People overstate purchase intent. 60% stated = ~6% actual.'},
         {q:'What is a "Jobs to be Done" framework used for?',opts:['HR hiring','Understanding why customers buy','Task management','Market sizing'],correct:1,explain:'JTBD focuses on the underlying job/goal customers are trying to accomplish, not product features.'},
         {q:'Which metric best validates product-market fit?',opts:['Website traffic','Social media followers','40%+ would be very disappointed without product','Investor interest'],correct:2,explain:'Sean Ellis test: if 40%+ of users would be "very disappointed" without your product, you have PMF.'},
         {q:'Primary research is data you collect yourself. What is secondary research?',opts:['Less important research','Research using existing data/reports','Research done second','Backup research'],correct:1,explain:'Secondary research uses existing sources: industry reports, census data, competitor filings, etc.'}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         tam:{title:'TAM/SAM/SOM',content:'TAM = Total market. SAM = Serviceable (you could reach). SOM = Obtainable (you can realistically get). Investors want big TAM, realistic SOM.'},
         methods:{title:'Research Methods',content:'Surveys (quantitative), Interviews (qualitative), Focus groups, Observation, Analytics. Mix methods for best insights.'},
         validation:{title:'Validation',content:'Talk to 50+ potential customers before building. Ask about problems, not solutions. "Would you buy?" means little.'},
         pmf:{title:'Product-Market Fit',content:'When customers desperately want your product. Signs: organic growth, low churn, word of mouth, pull not push.'}
      };
      const answer = (idx:number) => {
         if(answered) return;
         setSelected(idx);
         setAnswered(true);
         if(idx === questions[question].correct) {
            setScore(s => s + 1);
            setLog(l => [...l, `Q${question+1}: Correct!`]);
         } else {
            setLog(l => [...l, `Q${question+1}: Wrong`]);
         }
      };
      const next = () => {
         if(question >= questions.length - 1) setPhase('result');
         else { setQuestion(q => q + 1); setAnswered(false); setSelected(null); }
      };
      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 2 ? 'C' : 'D';
      const q = questions[question];
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-teal-900 via-emerald-900 to-green-900 text-white p-6"><div className="text-6xl mb-4">üî¨</div><h2 className="text-2xl font-bold mb-2">Market Research</h2><p className="text-slate-300 text-center mb-6 max-w-md">Master market research! Learn TAM/SAM/SOM, validation methods, and product-market fit.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-teal-500 to-emerald-500 rounded-xl font-bold">Start Learning</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-teal-900 via-emerald-900 to-green-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üî¨' : grade === 'B' ? 'üìä' : 'üìã'}</div><h2 className="text-2xl font-bold mb-2">Research Complete!</h2><div className="text-4xl font-bold text-teal-400 mb-2">{score}/{questions.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Research expert!' : grade === 'B' ? 'Good foundation!' : 'Keep learning!'}</p><button onClick={() => {setPhase('intro');setQuestion(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-teal-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-teal-900 via-emerald-900 to-green-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-teal-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-teal-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-teal-500/30 flex justify-between items-center"><span className="font-bold">üî¨ Market Research</span><span className="text-teal-400">{question + 1}/{questions.length}</span><span className="text-emerald-400">Score: {score}</span></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm">{q.q}</p></div><div className="grid gap-2">{q.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === q.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-teal-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{q.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-teal-600 rounded-lg">{question >= questions.length - 1 ? 'See Results' : 'Next'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-teal-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-teal-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const CompetitiveAnalysisRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Strategic Competitive Analysis - Deep understanding of when to attack, when to defend, when to flee
      const scenarios = [
         {
            title: "The Incumbent's Dilemma",
            context: "You're a streaming startup in 2010. Netflix dominates DVD-by-mail with 20M subscribers, massive distribution infrastructure, and first-mover advantage. But they're starting to experiment with streaming. You have better streaming tech.",
            question: "What's the WORST strategic move you could make?",
            opts: [
               'Wait for Netflix to fully commit to streaming, then attack DVD market',
               'Race Netflix to streaming, trying to beat them on technology',
               'Target a niche Netflix ignores (anime, international films)',
               'Partner with studios Netflix has alienated'
            ],
            correct: 0,
            wrongExplanations: [
               "", // Correct - this is the worst move
               "Racing on tech is risky but not the worst. At least you're moving toward the future. Netflix's tech advantage was beatable - Hulu and Amazon proved that.",
               "Niche targeting is actually smart strategy. Crunchyroll built a billion-dollar business in anime that Netflix ignored for years.",
               "Studio partnerships are viable. Netflix burned bridges early. Amazon and Apple leveraged this to get exclusive deals."
            ],
            realWorld: "Blockbuster made this exact mistake - waiting for Netflix to commit to streaming while clinging to physical stores. By the time they reacted, Netflix had insurmountable scale. The DVD market died faster than anyone predicted.",
            concept: "disruption_timing",
            why: "Clayton Christensen's Innovator's Dilemma: Incumbents are trapped serving current customers with current business models. Attacking their LEGACY business gives them time to transition. Instead, attack where they're GOING - that forces them to fight on two fronts. Netflix was vulnerable during transition, not after."
         },
         {
            title: "The Moat Mirage",
            context: "You're analyzing a competitor with: 50% market share, strong brand recognition, patents expiring in 2 years, and enterprise customers locked into 5-year contracts. Investors call them 'unassailable.'",
            question: "Which 'moat' is actually weakest?",
            opts: [
               'Market share - 50% means half the market is available',
               'Brand recognition - brands can be displaced by category change',
               'Patents - 2 years is enough time to prepare your attack',
               'Customer contracts - switching costs protect them'
            ],
            correct: 1,
            wrongExplanations: [
               "50% market share is genuinely concerning - network effects may apply, and the other 50% may be fragmented low-value segments. Market share CAN be a real moat.",
               "", // Correct
               "Patents expiring in 2 years is actually actionable - you can plan product launches around that timeline. This is more predictable than you'd think.",
               "5-year contracts are real protection. Enterprises hate switching. This gives them time to respond to any threat."
            ],
            realWorld: "BlackBerry had dominant brand recognition in smartphones. But Apple didn't compete on 'business phones' - they created 'personal computers in your pocket.' Brand moats collapse when category definitions change. Nokia, Kodak, and Yahoo all had 'strong brands.'",
            concept: "moat_analysis",
            why: "Brands feel permanent but they're tied to CATEGORIES. When Tesla entered cars, BMW's brand didn't help because Tesla redefined the category as 'technology' not 'German engineering.' Always ask: 'What category does their brand own, and can I create a new category?'"
         },
         {
            title: "The Copycat Paradox",
            context: "You've built a successful SaaS product. A well-funded competitor launches a near-perfect copy at 50% of your price. They're burning cash to grab share. Your customers are nervous. Your board wants you to respond.",
            question: "What's the strategically CORRECT response?",
            opts: [
               'Match their price - you can\'t lose customers',
               'Sue for IP infringement',
               'Double-down on innovation and customer success',
               'Raise prices on your most valuable features'
            ],
            correct: 3,
            wrongExplanations: [
               "Price matching is what they WANT you to do. It validates their strategy and destroys your margins. You're playing their game on their terms. This is a trap.",
               "Lawsuits take years and rarely work. Meanwhile they're eating your market. Even if you win, you've distracted your team and spent millions. Patents rarely cover business models.",
               "Doubling down on innovation sounds right but is a slow response. While you're 'innovating,' price-sensitive customers are leaving. You need to segment NOW.",
               "" // Correct
            ],
            realWorld: "When low-cost airlines attacked legacy carriers, successful airlines like Emirates RAISED prices and improved first-class. They ceded price-sensitive segments and doubled down on premium. Trying to serve everyone serves no one.",
            concept: "price_response",
            why: "Price wars destroy industries - everyone loses. Instead, SEGMENT: Let them take price-sensitive customers (often your worst customers anyway). Raise prices for premium buyers who value your differentiation. Slack did this when Microsoft Teams launched free - they went upmarket to enterprise."
         },
         {
            title: "The Partnership Trap",
            context: "A larger competitor offers to 'partner' with you. They'll give you access to their sales channel (10x your reach) and distribution network. In return, they want API access to your core technology and co-branding rights. Your board is excited.",
            question: "What's the hidden danger in this partnership?",
            opts: [
               'They\'ll steal your technology through the API',
               'They\'re learning your playbook to build a competitor',
               'Co-branding will dilute your brand value',
               'All of the above - this is a classic acquisition play'
            ],
            correct: 3,
            wrongExplanations: [
               "API access is ONE risk, but it's not the only one. Even with contractual protections, they gain strategic intelligence.",
               "Learning your playbook is ONE risk. But the pattern is bigger - they're gathering intel for build vs buy decisions.",
               "Brand dilution is ONE risk. But when customers associate you with them, you become a feature, not a product.",
               "" // Correct
            ],
            realWorld: "Microsoft's 1997 'partnership' with Apple included a $150M investment. But it also meant Microsoft got Apple to drop IE lawsuit and make Office for Mac, learning Apple's direction. Amazon 'partnered' with many marketplace sellers before launching Amazon Basics versions of their best products.",
            concept: "partnership_dynamics",
            why: "Large companies don't partner with small ones out of kindness. They're either: 1) Evaluating you for acquisition (due diligence disguised as partnership), 2) Keeping you close while they build competitive features, or 3) Preventing you from partnering with their real competitors. 'Keep your friends close and enemies closer' is their strategy."
         },
         {
            title: "The Data Advantage",
            context: "You're competing against Google in a new market. They have 10 years of user data, AI/ML expertise, and infinite resources. Your product is better designed but you have 1/1000th of their data. VCs ask how you'll win.",
            question: "What's the MOST credible competitive strategy?",
            opts: [
               'Build better AI/ML algorithms that need less data',
               'Focus on privacy as a differentiator against their data practices',
               'Create a proprietary data source they cannot access or replicate',
               'Partner with other companies who also fear Google'
            ],
            correct: 2,
            wrongExplanations: [
               "Better algorithms rarely overcome massive data disadvantages. Google has the best AI researchers in the world. You won't out-algorithm them - they'll copy any innovation in months.",
               "Privacy as a differentiator worked for Apple (bundled with hardware) and DuckDuckGo (search is simple). But for complex products, most users still choose features over privacy. This is niche, not winning.",
               "", // Correct
               "Anti-Google coalitions look good on paper but rarely execute. Each partner has different priorities. Microsoft, Apple, and others have tried this - coordination is nearly impossible."
            ],
            realWorld: "LinkedIn's data moat wasn't AI - it was the professional graph no one else had. Waze beat Google Maps initially by crowdsourcing real-time traffic data Google couldn't access. Spotify's advantage isn't algorithm - it's 600M+ user-generated playlists creating unique data.",
            concept: "data_moats",
            why: "Data advantages come from UNIQUE sources, not more of the same. Google has more web data, but they don't have: your customer's proprietary data, community-generated content, real-time IoT feeds from your devices, or domain-specific signals from your vertical. Find data THEY CAN'T GET."
         }
      ];

      const conceptLabels: { [key: string]: string } = {
         disruption_timing: "Disruption & Timing Strategy",
         moat_analysis: "Competitive Moat Evaluation",
         price_response: "Pricing Strategy & Segmentation",
         partnership_dynamics: "Strategic Partnerships",
         data_moats: "Data Competitive Advantage"
      };

      const infoTopics: { [k: string]: { title: string; content: string } } = {
         porter: {
            title: "Porter's 5 Forces",
            content: "Michael Porter's framework: 1) Supplier Power - can they raise prices? 2) Buyer Power - can customers demand discounts? 3) Competitive Rivalry - how intense is competition? 4) Threat of Substitution - can customers use alternatives? 5) Threat of New Entry - how easy to enter your market? High forces = low profitability. Analyze all 5 before entering any market."
         },
         moats: {
            title: "Competitive Moats",
            content: "Warren Buffett's concept: sustainable advantages that protect profits. 7 types: 1) Network effects (Facebook, Uber) 2) Switching costs (Salesforce, SAP) 3) Brand (Apple, Coca-Cola) 4) Scale economics (Walmart, Amazon) 5) Counter-positioning (Southwest vs legacy airlines) 6) Patents/IP (Pharma, Qualcomm) 7) Process power (Toyota Production System). Most moats are WEAKER than founders think."
         },
         disruption: {
            title: "Disruptive Innovation",
            content: "Clayton Christensen's theory: Startups win by targeting overlooked segments with 'worse' products that improve over time. Incumbents can't respond because serving their best customers is more profitable than fighting for marginal ones. Classic examples: Steel mini-mills vs integrated mills, PCs vs mainframes, Netflix vs Blockbuster. Disruption happens from BELOW."
         },
         asymmetry: {
            title: "Asymmetric Competition",
            content: "When you're small, fight asymmetrically: 1) Speed - decide in days what takes them months, 2) Focus - do one thing better vs their 100 things, 3) Risk tolerance - bet on unproven approaches, 4) Customer intimacy - know 100 customers deeply vs 1M superficially, 5) Talent density - your 10 people are better than their 10,000's average. Don't fight symmetric wars you can't win."
         }
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         if (idx === s.correct) {
            setScore(prev => prev + 1);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Correct! Demonstrated ${conceptLabels[s.concept]}`]);
         } else {
            setGameLog(prev => [...prev, `‚úó ${s.title}: Missed. The trap was "${s.opts[idx]}"`]);
            if (!conceptGaps.includes(s.concept)) {
               setConceptGaps(prev => [...prev, s.concept]);
            }
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setAnswered(false);
            setSelected(null);
         }
      };

      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 3 ? 'C' : 'D';
      const s = scenarios[scenario];

      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-900 via-rose-900 to-pink-900 text-white p-6">
               <div className="text-6xl mb-4">‚öîÔ∏è</div>
               <h2 className="text-2xl font-bold mb-2">Competitive Strategy Lab</h2>
               <p className="text-slate-300 text-center mb-4 max-w-md">
                  Master the strategic thinking that separates winning startups from failed ones.
               </p>
               <div className="bg-black/30 rounded-xl p-4 mb-6 max-w-md text-sm">
                  <p className="text-red-400 font-bold mb-2">‚ö†Ô∏è Warning: These aren't simple answers</p>
                  <ul className="text-slate-300 space-y-1 text-xs">
                     <li>‚Ä¢ Real competitive strategy requires nuanced thinking</li>
                     <li>‚Ä¢ Every option will seem reasonable - only one is correct</li>
                     <li>‚Ä¢ You'll learn from real case studies: Netflix, Apple, Google</li>
                     <li>‚Ä¢ Wrong answers reveal common strategic mistakes</li>
                  </ul>
               </div>
               <button
                  onClick={() => setPhase('play')}
                  className="px-8 py-3 bg-gradient-to-r from-red-500 to-rose-500 rounded-xl font-bold hover:from-red-400 hover:to-rose-400 transition-all"
               >
                  Begin Strategy Analysis
               </button>
            </div>
         );
      }

      if (phase === 'result') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-900 via-rose-900 to-pink-900 text-white p-6 overflow-auto">
               <div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? '‚öîÔ∏è' : grade === 'C' ? 'üìä' : 'üìö'}</div>
               <h2 className="text-2xl font-bold mb-2">Strategy Assessment Complete</h2>
               <div className="text-4xl font-bold text-red-400 mb-2">{score}/{scenarios.length}</div>
               <div className="text-5xl mb-4">{grade}</div>
               <p className="text-slate-400 mb-4 text-center">
                  {grade === 'A' ? 'Strategic mastermind! You think like a seasoned strategist.' :
                   grade === 'B' ? 'Strong strategic intuition. Minor blind spots to address.' :
                   grade === 'C' ? 'Good foundation, but falling for common strategic traps.' :
                   'Competitive strategy requires study. Many dangerous misconceptions.'}
               </p>

               {conceptGaps.length > 0 && (
                  <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4">
                     <p className="text-red-400 font-bold text-sm mb-2">üìö Concepts to Study:</p>
                     <ul className="text-slate-300 text-xs space-y-1">
                        {conceptGaps.map(gap => (
                           <li key={gap}>‚Ä¢ {conceptLabels[gap]}</li>
                        ))}
                     </ul>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4 max-h-32 overflow-y-auto">
                  <p className="text-red-400 font-bold text-sm mb-2">Session Log:</p>
                  {gameLog.map((entry, i) => (
                     <p key={i} className="text-xs text-slate-300">{entry}</p>
                  ))}
               </div>

               <button
                  onClick={() => {
                     setPhase('intro');
                     setScenario(0);
                     setScore(0);
                     setAnswered(false);
                     setSelected(null);
                     setGameLog([]);
                     setConceptGaps([]);
                  }}
                  className="px-6 py-2 bg-red-600 rounded-lg hover:bg-red-500"
               >
                  Try Again
               </button>
            </div>
         );
      }

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-red-900 via-rose-900 to-pink-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-red-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-red-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-red-500/30 flex justify-between items-center">
               <span className="font-bold">‚öîÔ∏è Strategy Lab</span>
               <span className="text-red-400">{scenario + 1}/{scenarios.length}</span>
               <span className="text-rose-400">Score: {score}</span>
            </div>

            <div className="flex-1 p-4 overflow-auto">
               <div className="bg-black/30 rounded-xl p-3 mb-3">
                  <p className="font-bold text-red-400 mb-2">{s.title}</p>
                  <p className="text-sm text-slate-300">{s.context}</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-3">
                  <p className="font-medium text-white">{s.question}</p>
               </div>

               <div className="grid gap-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600'
                                 : i === selected
                                    ? 'bg-red-600'
                                    : 'bg-black/30'
                              : 'bg-black/30 hover:bg-red-600/50'
                        }`}
                     >
                        {opt}
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-3">
                     {selected !== s.correct && s.wrongExplanations[selected!] && (
                        <div className="p-3 bg-red-900/50 rounded-lg border border-red-500/30">
                           <p className="text-xs text-red-300 font-bold mb-1">‚ùå Why This Was Wrong:</p>
                           <p className="text-sm text-red-100">{s.wrongExplanations[selected!]}</p>
                        </div>
                     )}
                     <div className="p-3 bg-green-900/50 rounded-lg border border-green-500/30">
                        <p className="text-xs text-green-300 font-bold mb-1">‚úì Strategic Insight:</p>
                        <p className="text-sm text-green-100">{s.why}</p>
                     </div>
                     <div className="p-3 bg-blue-900/50 rounded-lg border border-blue-500/30">
                        <p className="text-xs text-blue-300 font-bold mb-1">üìñ Real World:</p>
                        <p className="text-sm text-blue-100">{s.realWorld}</p>
                     </div>
                     <button
                        onClick={next}
                        className="w-full py-2 bg-red-600 rounded-lg hover:bg-red-500"
                     >
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-red-500/30 flex gap-2 justify-center flex-wrap">
               {Object.keys(infoTopics).map(k => (
                  <button
                     key={k}
                     onClick={() => { setInfoTopic(k); setShowInfo(true); }}
                     className="text-xs text-red-400 hover:text-red-300"
                  >
                     ‚ÑπÔ∏è {infoTopics[k].title}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   const BusinessModelRenderer = () => {
      const [phase, setPhase] = useState<'intro'|'play'|'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string|null>(null);
      const [step, setStep] = useState(0);
      const [model, setModel] = useState<{[k:string]:string}>({});
      const [log, setLog] = useState<string[]>([]);
      const steps = [
         {element:'Customer Segments',question:'Who are your customers?',options:['Mass market (everyone)','Niche market (specific segment)','Multi-sided platform (2+ groups)','Diversified (unrelated segments)']},
         {element:'Value Proposition',question:'What value do you deliver?',options:['Newness (innovation)','Performance (better/faster)','Convenience (easier access)','Price (cheaper alternative)']},
         {element:'Revenue Streams',question:'How do you make money?',options:['One-time sales','Subscription recurring','Freemium + premium','Transaction fees/commission']},
         {element:'Channels',question:'How do you reach customers?',options:['Direct sales team','Online/digital only','Partner distribution','Retail/physical stores']},
         {element:'Key Resources',question:'What is your key asset?',options:['Technology/IP','Human expertise','Brand/community','Physical assets']}
      ];
      const infoTopics:{[k:string]:{title:string,content:string}} = {
         canvas:{title:'Business Model Canvas',content:'9 blocks: Customer Segments, Value Prop, Channels, Customer Relationships, Revenue, Key Resources, Activities, Partners, Costs.'},
         revenue:{title:'Revenue Models',content:'Subscription, Freemium, Marketplace, Advertising, Licensing, Transaction fees. Match model to value delivery.'},
         lean:{title:'Lean Canvas',content:'Startup-focused version: Problem, Solution, Key Metrics, Unique Value Prop, Unfair Advantage, Channels, Segments, Costs, Revenue.'},
         fit:{title:'Model-Market Fit',content:'Your business model must match how customers want to buy. B2B enterprise ‚â† B2C consumer.'}
      };
      const choose = (idx:number) => {
         setModel(m => ({...m, [steps[step].element]: steps[step].options[idx]}));
         setLog(l => [...l, `${steps[step].element}: ${steps[step].options[idx]}`]);
         if(step >= steps.length - 1) setPhase('result');
         else setStep(s => s + 1);
      };
      const modelType = model['Revenue Streams']?.includes('Subscription') ? 'SaaS' : model['Revenue Streams']?.includes('commission') ? 'Marketplace' : model['Revenue Streams']?.includes('Freemium') ? 'Freemium' : 'Traditional';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-6"><div className="text-6xl mb-4">üèóÔ∏è</div><h2 className="text-2xl font-bold mb-2">Business Model Builder</h2><p className="text-slate-300 text-center mb-6 max-w-md">Design your business model! Choose elements that define how you create and capture value.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-purple-500 to-indigo-500 rounded-xl font-bold">Start Building</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white p-6"><div className="text-6xl mb-4">üèóÔ∏è</div><h2 className="text-2xl font-bold mb-2">Model Complete!</h2><div className="text-xl font-bold text-purple-400 mb-4">{modelType} Business Model</div><div className="bg-black/30 rounded-xl p-4 mb-4 text-left max-w-sm w-full">{Object.entries(model).map(([k,v]) => (<div key={k} className="mb-2"><span className="text-purple-400 text-xs">{k}:</span><p className="text-sm">{v}</p></div>))}</div><button onClick={() => {setPhase('intro');setStep(0);setModel({});setLog([]);}} className="px-6 py-2 bg-purple-600 rounded-lg">Build Another</button></div>);
      const s = steps[step];
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-purple-900 via-violet-900 to-indigo-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-purple-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-purple-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-purple-500/30 flex justify-between items-center"><span className="font-bold">üèóÔ∏è Business Model</span><span className="text-purple-400">{step + 1}/{steps.length}</span></div><div className="flex-1 p-4 flex flex-col justify-center"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-purple-400 text-sm mb-1">{s.element}</p><p className="text-lg font-medium">{s.question}</p></div><div className="grid gap-2">{s.options.map((opt, i) => (<button key={i} onClick={() => choose(i)} className="p-3 bg-black/30 hover:bg-purple-600/50 rounded-lg text-left text-sm">{opt}</button>))}</div></div><div className="p-3 bg-black/30 border-t border-purple-500/30 flex gap-2 justify-center">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-purple-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   const GrowthStrategyRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Growth Channel Mastery - Understanding which channels work for which businesses and why
      const scenarios = [
         {
            title: "The Viral Illusion",
            context: "You're building a B2B project management tool. Your team is excited about adding viral features: 'Invite teammates to earn premium features!' and social sharing. A competitor without viral features is growing faster through content marketing.",
            question: "Why is viral growth WRONG for this product?",
            opts: [
               'Viral features are never effective for B2B',
               'The buying decision isn\'t made by individual users who benefit from inviting',
               'Project management is too boring to go viral',
               'Content marketing is always better than viral'
            ],
            correct: 1,
            wrongExplanations: [
               "Viral CAN work for B2B - Slack, Notion, and Figma all grew virally. But the incentive structure must match the buyer's motivation.",
               "", // Correct
               "Boring doesn't prevent virality. Dropbox (file storage) and Zoom (video calls) grew virally with 'boring' products. The key is incentive alignment.",
               "Content marketing isn't universally better. It depends on the product and audience. The issue here is incentive mismatch."
            ],
            realWorld: "Slack grew virally because individual team members WANTED to use it and could convince their team. Compare to enterprise software where procurement decides - viral incentives for end-users don't influence purchasing. Know your buyer.",
            concept: "viral_incentive_alignment",
            why: "Viral growth requires: 1) Users personally benefit from inviting others, 2) Users have autonomy to invite, 3) The product improves with more users. B2B project management fails #2 - the person who would invite doesn't make the buying decision. Their CTO/procurement does. Incentives are misaligned."
         },
         {
            title: "The Paid Acquisition Trap",
            context: "Your e-commerce startup has $100 LTV. You're spending on Facebook ads with $50 CAC (2x LTV:CAC ratio). Your CFO says 'We're profitable! Let's 10x ad spend.' But when you scale from $10K to $100K monthly, CAC rises to $80 and LTV drops to $90.",
            question: "What caused this performance collapse?",
            opts: [
               'Facebook ads just don\'t work at scale',
               'You exhausted your best audience and now reach lower-intent users',
               'Your competitors started outbidding you',
               'The algorithm broke'
            ],
            correct: 1,
            wrongExplanations: [
               "Facebook ads work at massive scale for many companies. The issue isn't the platform - it's the audience targeting strategy.",
               "", // Correct
               "Competition affects costs, but a 60% CAC increase while spending 10x more suggests audience quality decline, not just competition.",
               "Algorithms don't 'break.' Performance changes reflect real dynamics in targeting, audience saturation, and ad fatigue."
            ],
            realWorld: "Every paid channel has a 'best audience' - the 1% who are perfect fits. As you scale, you reach the 5%, then 20%, then 50%. Each tier converts worse. Uber solved this by launching city-by-city, dominating the best audience before expanding.",
            concept: "audience_saturation",
            why: "Paid channels have natural limits. Your first $10K finds ideal customers actively searching. Your next $100K reaches people who might want your product. Your next $1M reaches everyone. Each layer converts worse and churns faster. Scale by adding NEW high-intent channels, not by forcing more through saturated ones."
         },
         {
            title: "The Content Paradox",
            context: "You publish 10 blog posts/month. Traffic is growing 20% quarterly. But despite 50K monthly visitors, only 50 become customers (0.1% conversion). Your competitor publishes 2 posts/month but converts 2% of visitors.",
            question: "What's the strategic difference between you and your competitor?",
            opts: [
               'They have better SEO and rank higher',
               'They\'re writing for buyers while you\'re writing for browsers',
               'They just have a better product',
               'Conversion rate is less important than total traffic'
            ],
            correct: 1,
            wrongExplanations: [
               "Ranking doesn't determine conversion rate. You could rank #1 for the wrong keywords and still convert poorly.",
               "", // Correct
               "Product quality affects conversion, but a 20x difference (0.1% vs 2%) is too large to be product alone. Content strategy matters.",
               "Conversion rate is critical. 50K √ó 0.1% = 50 customers. 5K √ó 2% = 100 customers. They get 2x customers with 10% of your traffic."
            ],
            realWorld: "HubSpot's early content targeted 'inbound marketing' - a term they invented. Every reader was a potential buyer. Compare to companies blogging about industry news - high traffic, low intent. Shopify blogs about 'how to start a business' - readers who need their product.",
            concept: "content_intent_matching",
            why: "Traffic is vanity, conversions are sanity. High-volume, low-intent content (industry news, entertainment) attracts browsers. High-intent content (how to solve the problem your product solves) attracts buyers. 2 posts targeting buyers beat 10 posts targeting browsers."
         },
         {
            title: "The Sales Scaling Myth",
            context: "Your enterprise SaaS closes $200K deals with a 6-month sales cycle. One rep closes 10 deals/year ($2M). You hire 5 more reps expecting $10M additional revenue. After 12 months, the 5 new reps combined closed only 8 deals ($1.6M).",
            question: "What's the MOST LIKELY cause of this failure?",
            opts: [
               'The new reps were less talented',
               'The market became more competitive',
               'You didn\'t have enough pipeline/leads for 6 reps',
               'Enterprise sales can\'t scale'
            ],
            correct: 2,
            wrongExplanations: [
               "Rep talent varies, but 5 average reps should still close more than 8 deals combined. The failure is too systematic to be talent alone.",
               "Competition affects everyone, including your star rep. If competition was the cause, your original rep would have declined too.",
               "", // Correct
               "Enterprise sales scales very well - Salesforce, Oracle, and SAP prove this. The constraint is usually pipeline, not the model."
            ],
            realWorld: "Salesforce learned this early: before adding sales reps, they invested heavily in marketing/SDR teams to generate pipeline. The rule of thumb: each enterprise rep needs 3-4x their quota in qualified pipeline. You hired reps without the leads to feed them.",
            concept: "sales_pipeline_math",
            why: "Sales scaling fails when you hire closers without leads. Pipeline math: if each rep needs $800K pipeline to close $200K (25% close rate), 6 reps need $4.8M pipeline. If you only generated $2M in pipeline, reps fight over the same deals. Solution: scale marketing/SDR BEFORE hiring more closers."
         },
         {
            title: "The Community Confusion",
            context: "You're building a developer tool. Everyone says 'build community!' You launch a Discord with 2,000 members. Activity is high - lots of memes, off-topic chat, and support questions. But few are buying your product.",
            question: "What's wrong with this community strategy?",
            opts: [
               'Discord is the wrong platform for developers',
               'Communities take years to generate revenue',
               'The community attracts users, not buyers - wrong incentive structure',
               '2,000 members isn\'t big enough to drive sales'
            ],
            correct: 2,
            wrongExplanations: [
               "Discord works well for developers - Midjourney, Vercel, and many dev tools use it successfully. Platform isn't the issue.",
               "Well-designed communities can drive revenue quickly. Figma's community drove adoption within months. The issue is strategy, not time.",
               "", // Correct
               "Size doesn't determine revenue. 100 highly-engaged potential buyers beat 10,000 people looking for free support."
            ],
            realWorld: "Figma built a community of DESIGNERS who shared templates. Each template showcase was implicit product marketing. Compare to dev tools with 'support communities' - members come for free help, not to buy. Notion built a community of POWER USERS who became evangelists.",
            concept: "community_purpose",
            why: "Communities fail when they attract free-seekers instead of potential buyers. The fix: build community around OUTCOMES your product enables, not around the product itself. A 'design inspiration' community attracts designers who might buy Figma. A 'Figma support' community attracts people avoiding payment."
         }
      ];

      const conceptLabels: { [key: string]: string } = {
         viral_incentive_alignment: "Viral Growth Incentive Structures",
         audience_saturation: "Paid Acquisition & Audience Saturation",
         content_intent_matching: "Content Strategy & Buyer Intent",
         sales_pipeline_math: "Sales Scaling & Pipeline Mathematics",
         community_purpose: "Community Building for Growth"
      };

      const infoTopics: { [k: string]: { title: string; content: string } } = {
         channels: {
            title: "Growth Channel Framework",
            content: "19 traction channels (Bullseye Framework): Viral, PR, Content, SEO, Social, Email, Partnerships, Biz Dev, Sales, Trade Shows, Speaking, Community, Ads, Affiliate, Existing Platforms, Offline, Engineering as Marketing, Guerrilla, Trade Publications. Test 3, focus on 1."
         },
         loops: {
            title: "Growth Loops",
            content: "Sustainable growth comes from LOOPS, not funnels. Viral loop: User invites ‚Üí new users invite. Content loop: Content ranks ‚Üí users create content. Paid loop: Revenue ‚Üí reinvest in ads ‚Üí more revenue. Sales loop: Customer success ‚Üí referrals ‚Üí new sales. Identify which loop fits your model."
         },
         metrics: {
            title: "Growth Metrics That Matter",
            content: "CAC (Customer Acquisition Cost), LTV (Lifetime Value), LTV:CAC ratio (aim for 3:1+), Payback period (months to recover CAC), Viral coefficient (users acquired per user), Magic number (net new ARR / prior quarter S&M spend). Track the metric that matters for YOUR stage."
         },
         stages: {
            title: "Growth Stage Matching",
            content: "Pre-PMF: Do things that don't scale, find channels that work. Early growth: Double down on 1-2 channels. Scaling: Add channels while maintaining efficiency. Each stage has different optimal strategies. Premature scaling is the #1 startup killer."
         }
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         if (idx === s.correct) {
            setScore(prev => prev + 1);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Correct! Understood ${conceptLabels[s.concept]}`]);
         } else {
            setGameLog(prev => [...prev, `‚úó ${s.title}: Missed. Fell for "${s.opts[idx].substring(0, 35)}..."`]);
            if (!conceptGaps.includes(s.concept)) {
               setConceptGaps(prev => [...prev, s.concept]);
            }
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setAnswered(false);
            setSelected(null);
         }
      };

      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 3 ? 'C' : 'D';
      const s = scenarios[scenario];

      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-green-900 via-lime-900 to-emerald-900 text-white p-6">
               <div className="text-6xl mb-4">üöÄ</div>
               <h2 className="text-2xl font-bold mb-2">Growth Channel Mastery</h2>
               <p className="text-slate-300 text-center mb-4 max-w-md">
                  Learn why growth strategies fail and how to match channels to your business model.
               </p>
               <div className="bg-black/30 rounded-xl p-4 mb-6 max-w-md text-sm">
                  <p className="text-green-400 font-bold mb-2">üéØ Common Growth Mistakes:</p>
                  <ul className="text-slate-300 space-y-1 text-xs">
                     <li>‚Ä¢ Copying strategies that worked for different business models</li>
                     <li>‚Ä¢ Scaling paid acquisition before understanding audience limits</li>
                     <li>‚Ä¢ Building community for the wrong audience</li>
                     <li>‚Ä¢ Hiring sales reps without pipeline to support them</li>
                  </ul>
               </div>
               <button
                  onClick={() => setPhase('play')}
                  className="px-8 py-3 bg-gradient-to-r from-green-500 to-lime-500 rounded-xl font-bold hover:from-green-400 hover:to-lime-400 transition-all"
               >
                  Start Growing
               </button>
            </div>
         );
      }

      if (phase === 'result') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-green-900 via-lime-900 to-emerald-900 text-white p-6 overflow-auto">
               <div className="text-6xl mb-4">{grade === 'A' ? 'üöÄ' : grade === 'B' ? 'üìà' : grade === 'C' ? 'üìä' : 'üìö'}</div>
               <h2 className="text-2xl font-bold mb-2">Growth Assessment Complete</h2>
               <div className="text-4xl font-bold text-green-400 mb-2">{score}/{scenarios.length}</div>
               <div className="text-5xl mb-4">{grade}</div>
               <p className="text-slate-400 mb-4 text-center">
                  {grade === 'A' ? 'Growth expert! You understand channel-product fit.' :
                   grade === 'B' ? 'Strong growth intuition. Some channel blindspots.' :
                   grade === 'C' ? 'Decent foundation, but falling for common growth myths.' :
                   'Growth strategy needs work. Study channel-product matching.'}
               </p>

               {conceptGaps.length > 0 && (
                  <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4">
                     <p className="text-green-400 font-bold text-sm mb-2">üìö Concepts to Study:</p>
                     <ul className="text-slate-300 text-xs space-y-1">
                        {conceptGaps.map(gap => (
                           <li key={gap}>‚Ä¢ {conceptLabels[gap]}</li>
                        ))}
                     </ul>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4 max-h-32 overflow-y-auto">
                  <p className="text-green-400 font-bold text-sm mb-2">Session Log:</p>
                  {gameLog.map((entry, i) => (
                     <p key={i} className="text-xs text-slate-300">{entry}</p>
                  ))}
               </div>

               <button
                  onClick={() => {
                     setPhase('intro');
                     setScenario(0);
                     setScore(0);
                     setAnswered(false);
                     setSelected(null);
                     setGameLog([]);
                     setConceptGaps([]);
                  }}
                  className="px-6 py-2 bg-green-600 rounded-lg hover:bg-green-500"
               >
                  Try Again
               </button>
            </div>
         );
      }

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-green-900 via-lime-900 to-emerald-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-green-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-green-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-green-500/30 flex justify-between items-center">
               <span className="font-bold">üöÄ Growth Strategy</span>
               <span className="text-green-400">{scenario + 1}/{scenarios.length}</span>
               <span className="text-lime-400">Score: {score}</span>
            </div>

            <div className="flex-1 p-4 overflow-auto">
               <div className="bg-black/30 rounded-xl p-3 mb-3">
                  <p className="font-bold text-green-400 mb-2">{s.title}</p>
                  <p className="text-sm text-slate-300">{s.context}</p>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-3">
                  <p className="font-medium text-white">{s.question}</p>
               </div>

               <div className="grid gap-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600'
                                 : i === selected
                                    ? 'bg-red-600'
                                    : 'bg-black/30'
                              : 'bg-black/30 hover:bg-green-600/50'
                        }`}
                     >
                        {opt}
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-3">
                     {selected !== s.correct && s.wrongExplanations[selected!] && (
                        <div className="p-3 bg-red-900/50 rounded-lg border border-red-500/30">
                           <p className="text-xs text-red-300 font-bold mb-1">‚ùå Why This Was Wrong:</p>
                           <p className="text-sm text-red-100">{s.wrongExplanations[selected!]}</p>
                        </div>
                     )}
                     <div className="p-3 bg-green-900/50 rounded-lg border border-green-500/30">
                        <p className="text-xs text-green-300 font-bold mb-1">‚úì Growth Insight:</p>
                        <p className="text-sm text-green-100">{s.why}</p>
                     </div>
                     <div className="p-3 bg-blue-900/50 rounded-lg border border-blue-500/30">
                        <p className="text-xs text-blue-300 font-bold mb-1">üìñ Real World:</p>
                        <p className="text-sm text-blue-100">{s.realWorld}</p>
                     </div>
                     <button
                        onClick={next}
                        className="w-full py-2 bg-green-600 rounded-lg hover:bg-green-500"
                     >
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-green-500/30 flex gap-2 justify-center flex-wrap">
               {Object.keys(infoTopics).map(k => (
                  <button
                     key={k}
                     onClick={() => { setInfoTopic(k); setShowInfo(true); }}
                     className="text-xs text-green-400 hover:text-green-300"
                  >
                     ‚ÑπÔ∏è {infoTopics[k].title}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   const PivotDecisionRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [gameLog, setGameLog] = useState<string[]>([]);
      const [conceptGaps, setConceptGaps] = useState<string[]>([]);

      // Startup Survival Simulator - Learning from real failure patterns
      const scenarios = [
         {
            title: "The Traction Trap",
            context: "18 months in. You've built a beautifully designed productivity app. 5,000 signups, but only 50 active weekly users (1%). You've iterated on features 12 times based on 'user feedback.' Your runway is 8 months. The team is demoralized.",
            signals: { bad: ['1% active rate', '12 iterations without improvement', 'Team demoralized'], good: ['5,000 signups', '8 months runway', 'Beautiful product'] },
            question: "What's the CORE problem you need to solve?",
            opts: [
               'Keep iterating - you haven\'t found the right feature yet',
               'You\'re solving a problem users don\'t actually have',
               'Marketing is the issue - get more signups',
               'The product needs to be rebuilt from scratch'
            ],
            correct: 1,
            wrongExplanations: [
               "12 iterations with no retention improvement is a signal: features aren't the problem. More features on a product nobody needs won't help.",
               "", // Correct
               "5,000 signups proves marketing works. 50 active users proves the product doesn't. Pouring water into a leaky bucket doesn't fill it.",
               "The product being 'beautiful' isn't the issue. The problem is product-MARKET fit, not product quality. A rebuild solves the wrong problem."
            ],
            realWorld: "Color Labs raised $41M, built beautiful photo-sharing tech, got downloads... but nobody used it. The problem they solved (photo sharing with nearby strangers) wasn't a real problem. They pivoted twice before shutting down. Lesson: validate the PROBLEM before building the solution.",
            concept: "problem_validation",
            why: "Low activation despite signups = problem-solution mismatch. Users are curious enough to try, but the product doesn't solve a real problem they have. The fix isn't more features or more marketing - it's going back to customer discovery to find a problem worth solving."
         },
         {
            title: "The Zombie Company",
            context: "Your SaaS has $30K MRR, 200 customers, 2% monthly churn, and you're profitable. But growth has flatlined for 18 months. Revenue: $30K‚Üí$31K‚Üí$30K‚Üí$32K. You've tried new features, new marketing channels, and price changes. Nothing moves the needle.",
            signals: { bad: ['18 months flat', 'No growth despite efforts', 'Market might be saturated'], good: ['Profitable', 'Low churn', 'Real customers'] },
            question: "What should you do with this business?",
            opts: [
               'Keep trying new growth tactics - something will work',
               'Raise funding to accelerate growth',
               'Accept it as a lifestyle business or seek acquisition',
               'Pivot to a completely different product'
            ],
            correct: 2,
            wrongExplanations: [
               "18 months of trying suggests you've tested most reasonable tactics. Doing the same thing expecting different results is the definition of insanity.",
               "VCs don't fund flat-growth companies. Even if you got funding, more money in a stagnant market won't create growth. You'd be diluting for nothing.",
               "", // Correct
               "You have a profitable business with happy customers. Pivoting abandons proven revenue for uncertain new ventures. That's irrational."
            ],
            realWorld: "Basecamp (37signals) deliberately stayed small and profitable rather than chasing hockey-stick growth. Many 'zombie' companies are acquired by larger players who value the customer base. Mailchimp grew slowly for years before exploding. Not every company needs to be a unicorn.",
            concept: "growth_ceiling",
            why: "Some markets have natural ceilings. You've validated the business (profitability + low churn) but may have captured most of your addressable market. Options: 1) Run as lifestyle business, 2) Sell to strategic acquirer, 3) Expand to adjacent market. Forcing growth in a saturated market wastes resources."
         },
         {
            title: "The Pivot Paradox",
            context: "You started as a B2C social app. After 2 years: 100K users, no revenue model that works. You pivot to B2B, selling analytics to brands. 6 months in: 5 paying customers ($50K ARR), strong retention, but long sales cycles. Board wants you to pivot again to 'something scalable.'",
            signals: { bad: ['B2C failed', 'Long B2B sales cycle', 'Board pressure'], good: ['$50K ARR in 6 months', 'Strong retention', 'Real revenue'] },
            question: "Should you pivot again as the board suggests?",
            opts: [
               'Yes - B2B enterprise is too slow for venture returns',
               'No - you finally have product-market fit, double down',
               'Yes - listen to your board, they have more experience',
               'No - but negotiate a smaller market to go after'
            ],
            correct: 1,
            wrongExplanations: [
               "Slow doesn't mean bad. Salesforce, Workday, and many successful companies have long sales cycles. $50K ARR in 6 months is a strong signal.",
               "", // Correct
               "Boards can be wrong. They're optimizing for fund returns, not necessarily your company. 5 paying customers with retention is rare - most startups never get here.",
               "You're not negotiating the market size, you're validating product-market fit. Focus on the signal: customers are paying and staying."
            ],
            realWorld: "Slack pivoted from a gaming company to B2B chat. Early enterprise sales were slow. If they had pivoted again instead of doubling down, we wouldn't have Slack. Instagram pivoted from Burbn and stuck with their new direction despite early doubts. One successful pivot is enough.",
            concept: "pivot_commitment",
            why: "The most dangerous time is right after a successful pivot, when you're tempted to pivot again before the new direction has time to mature. 5 customers + strong retention = signal. Give it time. Most successful startups did ONE major pivot, not many."
         },
         {
            title: "The Runway Reckoning",
            context: "You have 4 months of runway. Revenue is $15K MRR, growing 8% month-over-month. At current burn ($40K/mo), you'll die before reaching profitability. VCs are passing because you're 'too early.' You can cut to 2-person team and extend runway to 12 months.",
            signals: { bad: ['4 months runway', 'VCs passing', '$25K monthly burn'], good: ['8% MoM growth', '$15K MRR', 'Clear path visible'] },
            question: "What's the RIGHT decision for this startup?",
            opts: [
               'Keep the team and die trying - cutting kills momentum',
               'Cut aggressively, extend runway, and keep growing',
               'Pivot to something that raises easier',
               'Shut down now while you can return money to investors'
            ],
            correct: 1,
            wrongExplanations: [
               "Dead startups don't have momentum. Pride in team size over survival is a common founder mistake. Survival > team size.",
               "", // Correct
               "You have 8% MoM growth and paying customers. Pivoting away from traction to chase 'easier fundraising' abandons real validation.",
               "Shutting down a growing business with 12 months of possible runway (after cuts) is premature. Many great companies survived near-death moments."
            ],
            realWorld: "Airbnb cut to core team and survived on credit cards before Y Combinator. Tesla was days from bankruptcy multiple times. Companies that survive and win are often the ones willing to cut deep to extend runway during tough times. Survival is the only metric that matters.",
            concept: "runway_survival",
            why: "8% MoM growth means you double every 9 months. With 12 months runway (post-cuts), you could reach $30K+ MRR - much more fundable. The math: survive long enough for growth to compound. Cut everything that isn't directly driving growth or survival."
         },
         {
            title: "The Signal vs Noise",
            context: "Your dev tool has 3 customer types: Enterprises (slow to close, high ACV), SMBs (medium speed, medium ACV), and Developers (fast to close, low ACV but high volume). Last quarter: 2 enterprise deals ($50K), 10 SMB ($30K), 200 developer signups ($10K). Everyone says 'go enterprise.'",
            signals: { bad: ['Scattered focus', 'Different sales motions needed', 'Resource constraints'], good: ['Revenue from all segments', 'Developer volume', 'Enterprise interest'] },
            question: "Which segment should you focus on?",
            opts: [
               'Enterprise - highest revenue per customer',
               'SMB - balanced between volume and value',
               'Developer - highest volume, fastest feedback loops',
               'All three - diversification reduces risk'
            ],
            correct: 2,
            wrongExplanations: [
               "Enterprise has highest ACV but slowest velocity. With limited resources, 2 deals/quarter means you can't iterate fast enough to find product-market fit.",
               "SMB is a reasonable choice but 10 deals/quarter still limits learning velocity. You need faster feedback loops at this stage.",
               "", // Correct
               "Diversification at early stage = diluted focus. You can't build three different sales motions, support systems, and product experiences with a small team."
            ],
            realWorld: "Stripe focused on developers first, ignoring enterprise for years. Developers became their distribution channel - when devs joined big companies, they brought Stripe. Twilio did the same. Developer-first created pull demand that made enterprise sales easier later.",
            concept: "segment_focus",
            why: "At early stage, velocity of learning > revenue per customer. 200 developers = 200 feedback loops. 2 enterprises = 2 feedback loops. Developers compound: they become advocates, build on your platform, and pull enterprises toward you. Focus creates momentum."
         }
      ];

      const conceptLabels: { [key: string]: string } = {
         problem_validation: "Problem-Solution Fit Validation",
         growth_ceiling: "Market Size & Growth Ceilings",
         pivot_commitment: "Pivot Timing & Commitment",
         runway_survival: "Runway Management & Survival",
         segment_focus: "Customer Segment Focus"
      };

      const infoTopics: { [k: string]: { title: string; content: string } } = {
         when: {
            title: "When to Pivot",
            content: "Pivot when: 1) Consistent low retention despite iterations, 2) Unable to find sustainable acquisition channel, 3) Market too small for your ambitions, 4) Core thesis proven wrong by data. DON'T pivot when: you have paying customers with retention, you're just impatient, or because others are doing something 'hotter.'"
         },
         types: {
            title: "Types of Pivots",
            content: "Customer segment pivot (same product, different buyer), Problem pivot (same customer, different pain), Solution pivot (same problem, different approach), Channel pivot (same product, different distribution), Revenue model pivot (same product, different monetization), Technology pivot (same outcome, different tech). Change ONE thing, not everything."
         },
         signs: {
            title: "Warning Signs to Watch",
            content: "Danger signs: Flat growth despite efforts, High churn regardless of features, Long sales cycles eating runway, Customer apathy ('nice to have' not 'must have'), Founder burnout and loss of conviction, Every growth channel fails. The absence of pull demand is the clearest signal."
         },
         persistence: {
            title: "When to Persist",
            content: "Persist when: Strong retention (users who try it, keep it), Clear word-of-mouth (users recommend without prompts), Improving metrics over time, Passionate user segment (even if small), External tailwinds coming. Many legendary companies took 3-5 years to find PMF. Patience ‚â† complacency."
         }
      };

      const answer = (idx: number) => {
         if (answered) return;
         setSelected(idx);
         setAnswered(true);
         const s = scenarios[scenario];
         if (idx === s.correct) {
            setScore(prev => prev + 1);
            setGameLog(prev => [...prev, `‚úì ${s.title}: Correct decision! Understood ${conceptLabels[s.concept]}`]);
         } else {
            setGameLog(prev => [...prev, `‚úó ${s.title}: Wrong call. Fell for "${s.opts[idx].substring(0, 30)}..."`]);
            if (!conceptGaps.includes(s.concept)) {
               setConceptGaps(prev => [...prev, s.concept]);
            }
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(prev => prev + 1);
            setAnswered(false);
            setSelected(null);
         }
      };

      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 3 ? 'C' : 'D';
      const s = scenarios[scenario];

      if (phase === 'intro') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-6">
               <div className="text-6xl mb-4">üîÑ</div>
               <h2 className="text-2xl font-bold mb-2">Startup Survival Simulator</h2>
               <p className="text-slate-300 text-center mb-4 max-w-md">
                  Navigate the hardest decisions founders face: pivot, persist, or shut down.
               </p>
               <div className="bg-black/30 rounded-xl p-4 mb-6 max-w-md text-sm">
                  <p className="text-orange-400 font-bold mb-2">üíÄ Why Most Startups Fail:</p>
                  <ul className="text-slate-300 space-y-1 text-xs">
                     <li>‚Ä¢ 42% - No market need (building what nobody wants)</li>
                     <li>‚Ä¢ 29% - Ran out of cash (bad runway management)</li>
                     <li>‚Ä¢ 23% - Wrong team (co-founder issues)</li>
                     <li>‚Ä¢ 19% - Got outcompeted (wrong strategy)</li>
                  </ul>
               </div>
               <button
                  onClick={() => setPhase('play')}
                  className="px-8 py-3 bg-gradient-to-r from-orange-500 to-amber-500 rounded-xl font-bold hover:from-orange-400 hover:to-amber-400 transition-all"
               >
                  Start Making Decisions
               </button>
            </div>
         );
      }

      if (phase === 'result') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white p-6 overflow-auto">
               <div className="text-6xl mb-4">{grade === 'A' ? 'üéØ' : grade === 'B' ? 'üîÑ' : grade === 'C' ? '‚ö†Ô∏è' : 'üíÄ'}</div>
               <h2 className="text-2xl font-bold mb-2">Survival Assessment Complete</h2>
               <div className="text-4xl font-bold text-orange-400 mb-2">{score}/{scenarios.length}</div>
               <div className="text-5xl mb-4">{grade}</div>
               <p className="text-slate-400 mb-4 text-center">
                  {grade === 'A' ? 'Survival instincts! You make tough calls correctly.' :
                   grade === 'B' ? 'Good judgment. Some dangerous blind spots remain.' :
                   grade === 'C' ? 'Mixed results. Study the failure patterns.' :
                   'Dangerous misconceptions. Learn before betting your company.'}
               </p>

               {conceptGaps.length > 0 && (
                  <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4">
                     <p className="text-orange-400 font-bold text-sm mb-2">üìö Concepts to Study:</p>
                     <ul className="text-slate-300 text-xs space-y-1">
                        {conceptGaps.map(gap => (
                           <li key={gap}>‚Ä¢ {conceptLabels[gap]}</li>
                        ))}
                     </ul>
                  </div>
               )}

               <div className="bg-black/30 rounded-xl p-4 max-w-md w-full mb-4 max-h-32 overflow-y-auto">
                  <p className="text-orange-400 font-bold text-sm mb-2">Decision Log:</p>
                  {gameLog.map((entry, i) => (
                     <p key={i} className="text-xs text-slate-300">{entry}</p>
                  ))}
               </div>

               <button
                  onClick={() => {
                     setPhase('intro');
                     setScenario(0);
                     setScore(0);
                     setAnswered(false);
                     setSelected(null);
                     setGameLog([]);
                     setConceptGaps([]);
                  }}
                  className="px-6 py-2 bg-orange-600 rounded-lg hover:bg-orange-500"
               >
                  Try Again
               </button>
            </div>
         );
      }

      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-orange-900 via-amber-900 to-yellow-900 text-white overflow-hidden">
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-orange-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-orange-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            <div className="p-3 bg-black/30 border-b border-orange-500/30 flex justify-between items-center">
               <span className="font-bold">üîÑ Survival Sim</span>
               <span className="text-orange-400">{scenario + 1}/{scenarios.length}</span>
               <span className="text-amber-400">Score: {score}</span>
            </div>

            <div className="flex-1 p-4 overflow-auto">
               <div className="bg-black/30 rounded-xl p-3 mb-3">
                  <p className="font-bold text-orange-400 mb-2">{s.title}</p>
                  <p className="text-sm text-slate-300 mb-3">{s.context}</p>
                  <div className="grid grid-cols-2 gap-2 text-xs">
                     <div>
                        <p className="text-red-400 mb-1">üö© Warning Signs:</p>
                        {s.signals.bad.map((sig, i) => <p key={i} className="text-slate-300">‚Ä¢ {sig}</p>)}
                     </div>
                     <div>
                        <p className="text-green-400 mb-1">‚úì Positive Signs:</p>
                        {s.signals.good.map((sig, i) => <p key={i} className="text-slate-300">‚Ä¢ {sig}</p>)}
                     </div>
                  </div>
               </div>

               <div className="bg-black/30 rounded-xl p-4 mb-3">
                  <p className="font-medium text-white">{s.question}</p>
               </div>

               <div className="grid gap-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`p-3 rounded-lg text-left text-sm transition-all ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600'
                                 : i === selected
                                    ? 'bg-red-600'
                                    : 'bg-black/30'
                              : 'bg-black/30 hover:bg-orange-600/50'
                        }`}
                     >
                        {opt}
                     </button>
                  ))}
               </div>

               {answered && (
                  <div className="mt-3 space-y-3">
                     {selected !== s.correct && s.wrongExplanations[selected!] && (
                        <div className="p-3 bg-red-900/50 rounded-lg border border-red-500/30">
                           <p className="text-xs text-red-300 font-bold mb-1">‚ùå Why This Kills Companies:</p>
                           <p className="text-sm text-red-100">{s.wrongExplanations[selected!]}</p>
                        </div>
                     )}
                     <div className="p-3 bg-green-900/50 rounded-lg border border-green-500/30">
                        <p className="text-xs text-green-300 font-bold mb-1">‚úì Survival Insight:</p>
                        <p className="text-sm text-green-100">{s.why}</p>
                     </div>
                     <div className="p-3 bg-blue-900/50 rounded-lg border border-blue-500/30">
                        <p className="text-xs text-blue-300 font-bold mb-1">üìñ Real Example:</p>
                        <p className="text-sm text-blue-100">{s.realWorld}</p>
                     </div>
                     <button
                        onClick={next}
                        className="w-full py-2 bg-orange-600 rounded-lg hover:bg-orange-500"
                     >
                        {scenario >= scenarios.length - 1 ? 'See Assessment' : 'Next Decision'}
                     </button>
                  </div>
               )}
            </div>

            <div className="p-3 bg-black/30 border-t border-orange-500/30 flex gap-2 justify-center flex-wrap">
               {Object.keys(infoTopics).map(k => (
                  <button
                     key={k}
                     onClick={() => { setInfoTopic(k); setShowInfo(true); }}
                     className="text-xs text-orange-400 hover:text-orange-300"
                  >
                     ‚ÑπÔ∏è {infoTopics[k].title}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // --- TEAM BUILDING RENDERER ---
   const TeamBuildingRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const scenarios = [
         { situation: "You're building your founding team. A brilliant engineer wants 40% equity but can only work part-time.", q: "What's the best approach?", opts: ["Give them what they ask", "Counter with 10% and full vesting", "Propose milestone-based equity", "Walk away entirely"], correct: 2, explain: "Milestone-based equity aligns incentives with commitment. They earn more as they contribute more, protecting both parties." },
         { situation: "Your co-founder has a different vision for the product direction. The disagreement is affecting team morale.", q: "How should you handle this?", opts: ["Assert your authority as CEO", "Have a structured discussion with clear decision criteria", "Let the team vote", "Avoid the conflict and work around it"], correct: 1, explain: "Structured discussions with clear criteria lead to better decisions and model healthy conflict resolution for the team." },
         { situation: "You need a CTO but can't afford market-rate salary. A talented candidate is interested but hesitant.", q: "What's your best offer strategy?", opts: ["Stretch your runway for full salary", "Offer below-market with significant equity", "Promise future raises when funded", "Hire a cheaper, less experienced option"], correct: 1, explain: "Below-market salary plus meaningful equity is the classic startup trade-off. It aligns incentives and preserves runway." },
         { situation: "Your team is growing and you're seeing silos forming between engineering and product.", q: "What's the most effective intervention?", opts: ["Hire a project manager", "Create cross-functional squads", "Add more meetings", "Let it resolve naturally"], correct: 1, explain: "Cross-functional squads break down silos by embedding different disciplines together with shared goals." },
         { situation: "A key team member is burning out but your startup can't afford to lose them.", q: "What should you prioritize?", opts: ["Offer a raise to keep them motivated", "Redistribute work and check in regularly", "Hire their replacement just in case", "Push through‚Äîstartups are hard"], correct: 1, explain: "Redistributing work and showing genuine care prevents burnout from becoming departure. People remember how you treated them." }
      ];
      const s = scenarios[scenario];
      const infoTopics: Record<string, {title: string; content: string}> = {
         equity: { title: "Equity Distribution", content: "Founder equity should vest over 4 years with a 1-year cliff. This protects the company if someone leaves early. Early employees typically get 0.5-2% with similar vesting." },
         roles: { title: "Defining Roles", content: "Clear role definition prevents conflict. Use RACI matrices (Responsible, Accountable, Consulted, Informed) for key decisions. Revisit roles every 6 months as the company grows." },
         culture: { title: "Culture Building", content: "Culture is how your team behaves when you're not watching. Define core values early, hire for culture fit, and recognize behaviors that reinforce your values." },
         hiring: { title: "Early Hiring", content: "First 10 hires set your culture. Prioritize: 1) Mission alignment, 2) Skill-culture balance, 3) Flexibility to wear multiple hats, 4) Self-motivation." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === s.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì Scenario ${scenario + 1}: Correct!`]); } else { setLog(l => [...l, `‚úó Scenario ${scenario + 1}: Better answer was "${s.opts[s.correct]}"`]); } };
      const next = () => { if(scenario >= scenarios.length - 1) { setPhase('result'); } else { setScenario(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white p-6"><div className="text-6xl mb-4">üë•</div><h2 className="text-2xl font-bold mb-2">Team Building Simulator</h2><p className="text-slate-300 text-center mb-6 max-w-md">Build your dream team! Navigate hiring, equity, and team dynamics challenges.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-xl font-bold">Build Team</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? 'üë•' : 'üîß'}</div><h2 className="text-2xl font-bold mb-2">Team Built!</h2><div className="text-4xl font-bold text-indigo-400 mb-2">{score}/{scenarios.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Natural leader!' : grade === 'B' ? 'Good team builder!' : 'Keep learning!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setScenario(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-indigo-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-indigo-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-indigo-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-indigo-500/30 flex justify-between items-center"><span className="font-bold">üë• Team Building</span><span className="text-indigo-400">{scenario + 1}/{scenarios.length}</span><span className="text-purple-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{s.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{s.q}</p></div><div className="grid gap-2">{s.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === s.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-indigo-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{s.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-indigo-600 rounded-lg">{scenario >= scenarios.length - 1 ? 'See Results' : 'Next'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-indigo-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-indigo-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- LEADERSHIP RENDERER ---
   const LeadershipRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const scenarios = [
         { context: "Crisis Management", situation: "Your startup's main product has a critical bug affecting 50% of users. Your team is panicking.", q: "What's your first action as a leader?", opts: ["Take over and fix it yourself", "Stay calm, assign clear roles, and communicate transparently", "Find someone to blame", "Wait for more information"], correct: 1, explain: "Leaders set the emotional tone. Calm, clear direction with transparent communication builds trust and enables effective crisis response." },
         { context: "Difficult Feedback", situation: "A team member you like personally is consistently underperforming and affecting team morale.", q: "How do you handle this?", opts: ["Ignore it hoping they improve", "Have direct, specific feedback conversation with clear expectations", "Complain to other team members", "Immediately let them go"], correct: 1, explain: "Direct, kind feedback with specific examples and clear expectations gives people the chance to improve while maintaining team standards." },
         { context: "Delegation", situation: "You have an important investor presentation next week and a product launch to manage simultaneously.", q: "What approach demonstrates best leadership?", opts: ["Work 20-hour days to do both", "Delegate the launch to your capable team", "Postpone the investor meeting", "Do both poorly"], correct: 1, explain: "Great leaders delegate to develop their team. Trusting capable people with important work shows confidence and builds organizational capacity." },
         { context: "Vision Alignment", situation: "Half your team wants to focus on feature A, half on feature B. Both have merit but resources are limited.", q: "How do you decide?", opts: ["Let the team vote", "Make an executive decision aligned with company vision", "Work on both with half effort", "Avoid the decision"], correct: 1, explain: "Leaders tie decisions to vision and strategy. A clear rationale helps the team understand and commit, even if they preferred the other option." },
         { context: "Building Culture", situation: "You notice your growing team is losing the collaborative spirit that made early days special.", q: "What's the most effective intervention?", opts: ["Send an email about values", "Model the behavior, recognize examples, and create rituals", "Hire a culture consultant", "Accept it as inevitable"], correct: 1, explain: "Culture is caught, not taught. Leaders shape culture by consistently modeling values, recognizing aligned behaviors, and creating meaningful rituals." }
      ];
      const s = scenarios[scenario];
      const infoTopics: Record<string, {title: string; content: string}> = {
         styles: { title: "Leadership Styles", content: "Effective founders adapt their style: Directive (crisis), Coaching (development), Supportive (skilled teams), Delegative (autonomous experts). Match your style to the situation and team maturity." },
         feedback: { title: "Giving Feedback", content: "Use SBI: Situation (when/where), Behavior (specific actions), Impact (effect on team/outcomes). Focus on behaviors, not personality. Ask for their perspective and agree on next steps." },
         delegation: { title: "Art of Delegation", content: "Delegate outcomes, not tasks. Provide context (why), clarity (what success looks like), resources (support available), and check-ins (not micromanagement). Let them own the how." },
         trust: { title: "Building Trust", content: "Trust = Credibility (expertise) + Reliability (consistency) + Intimacy (safety) - Self-Interest. Build trust through competence, keeping promises, creating psychological safety, and putting team first." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === s.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì ${s.context}: Great leadership!`]); } else { setLog(l => [...l, `‚úó ${s.context}: Better approach was "${s.opts[s.correct]}"`]); } };
      const next = () => { if(scenario >= scenarios.length - 1) { setPhase('result'); } else { setScenario(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-6"><div className="text-6xl mb-4">üëî</div><h2 className="text-2xl font-bold mb-2">Leadership Styles</h2><p className="text-slate-300 text-center mb-6 max-w-md">Master different leadership approaches for startup challenges!</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl font-bold">Lead the Way</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üëë' : grade === 'B' ? 'üëî' : 'üìö'}</div><h2 className="text-2xl font-bold mb-2">Leadership Assessment</h2><div className="text-4xl font-bold text-amber-400 mb-2">{score}/{scenarios.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Born leader!' : grade === 'B' ? 'Strong leadership!' : 'Keep developing!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setScenario(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-amber-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-amber-900 via-orange-900 to-red-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-amber-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-amber-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-amber-500/30 flex justify-between items-center"><span className="font-bold">üëî {s.context}</span><span className="text-amber-400">{scenario + 1}/{scenarios.length}</span><span className="text-orange-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{s.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{s.q}</p></div><div className="grid gap-2">{s.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === s.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-amber-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{s.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-amber-600 rounded-lg">{scenario >= scenarios.length - 1 ? 'See Results' : 'Next'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-amber-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-amber-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- CUSTOMER JOURNEY RENDERER ---
   const CustomerJourneyRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [stage, setStage] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const stages = [
         { name: "Awareness", icon: "üëÄ", situation: "A potential customer is searching for solutions to their problem. They've never heard of your startup.", q: "What's the most effective awareness strategy?", opts: ["Cold email blast to purchased lists", "Content marketing addressing their pain points", "Expensive TV ads", "Wait for word of mouth"], correct: 1, explain: "Content marketing that addresses pain points attracts qualified prospects actively seeking solutions. It builds trust before you ask for anything." },
         { name: "Consideration", icon: "ü§î", situation: "The prospect found your blog and is comparing you to 3 competitors. They're reading your pricing page.", q: "How do you stand out at this stage?", opts: ["Undercut competitor pricing significantly", "Offer clear differentiation and social proof", "Add more features to the comparison", "Send aggressive sales emails"], correct: 1, explain: "Clear differentiation (why you, not what) plus social proof (testimonials, case studies) helps prospects self-select. Price wars erode value." },
         { name: "Decision", icon: "‚úÖ", situation: "The prospect is ready to buy but is hesitating. They've added to cart but haven't completed checkout.", q: "What's the most effective nudge?", opts: ["Pop-up with 50% discount", "Clear value reminder with easy support access", "Countdown timer creating urgency", "More product features"], correct: 1, explain: "Address hesitation with clarity and support, not manipulation. Genuine help at decision time creates loyal customers, not just transactions." },
         { name: "Retention", icon: "üîÑ", situation: "A customer has used your product for 3 months but engagement is dropping. You notice they haven't logged in for 2 weeks.", q: "What's your re-engagement strategy?", opts: ["Send guilt-trip emails about missed features", "Personalized check-in with helpful resources", "Offer discounts to stay", "Wait until they cancel"], correct: 1, explain: "Proactive, helpful outreach shows you care about their success. Understanding why engagement dropped helps improve the product for everyone." },
         { name: "Advocacy", icon: "üì£", situation: "A customer just achieved amazing results with your product and shared it on LinkedIn.", q: "How do you cultivate this into advocacy?", opts: ["Ask immediately for referrals", "Celebrate their success and make sharing easy", "Offer affiliate commissions", "Ignore it‚Äîthey're already sharing"], correct: 1, explain: "Celebrate customer wins genuinely. Make it easy (not pushy) to share. The best advocacy feels like sharing something valuable, not selling." }
      ];
      const st = stages[stage];
      const infoTopics: Record<string, {title: string; content: string}> = {
         touchpoints: { title: "Customer Touchpoints", content: "Every interaction shapes perception: website, emails, support, product, billing. Map all touchpoints and ensure consistency. One bad experience can undo ten good ones." },
         metrics: { title: "Journey Metrics", content: "Track: CAC (cost to acquire), Time to value (activation speed), NPS (loyalty), Churn rate (retention), LTV (lifetime value). Each stage has key metrics to optimize." },
         emotions: { title: "Emotional Journey", content: "Customers make emotional decisions, then rationalize. Map emotional highs and lows in your journey. Reduce friction at low points, amplify delight at high points." },
         personas: { title: "Customer Personas", content: "Different personas take different journeys. A technical buyer researches deeply; an executive wants ROI summaries. Create journey maps for each key persona." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === st.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì ${st.name}: Excellent approach!`]); } else { setLog(l => [...l, `‚úó ${st.name}: Try "${st.opts[st.correct]}" next time`]); } };
      const next = () => { if(stage >= stages.length - 1) { setPhase('result'); } else { setStage(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6"><div className="text-6xl mb-4">üó∫Ô∏è</div><h2 className="text-2xl font-bold mb-2">Customer Journey Mapping</h2><p className="text-slate-300 text-center mb-6 max-w-md">Guide customers from strangers to advocates! Master every stage of the journey.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-violet-500 to-fuchsia-500 rounded-xl font-bold">Start Journey</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üåü' : grade === 'B' ? 'üó∫Ô∏è' : 'üìç'}</div><h2 className="text-2xl font-bold mb-2">Journey Complete!</h2><div className="text-4xl font-bold text-violet-400 mb-2">{score}/{stages.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Customer journey expert!' : grade === 'B' ? 'Great understanding!' : 'Keep mapping!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setStage(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-violet-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-violet-900 via-purple-900 to-fuchsia-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-violet-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-violet-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-violet-500/30 flex justify-between items-center"><span className="font-bold">{st.icon} {st.name}</span><span className="text-violet-400">{stage + 1}/{stages.length}</span><span className="text-fuchsia-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="flex gap-1 mb-4">{stages.map((s, i) => (<div key={i} className="flex-1 text-center"><div className={`text-2xl ${i <= stage ? 'opacity-100' : 'opacity-30'}`}>{s.icon}</div><div className={`h-1 mt-1 rounded ${i < stage ? 'bg-violet-500' : i === stage ? 'bg-fuchsia-400' : 'bg-slate-700'}`} /></div>))}</div><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{st.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{st.q}</p></div><div className="grid gap-2">{st.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === st.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-violet-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{st.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-violet-600 rounded-lg">{stage >= stages.length - 1 ? 'See Results' : 'Next Stage'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-violet-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-violet-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- MVP DEVELOPMENT RENDERER ---
   const MVPRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [decision, setDecision] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const decisions = [
         { topic: "Feature Scope", situation: "Your team has brainstormed 50 features for the product. Engineering estimates 6 months to build everything.", q: "What's the MVP approach?", opts: ["Build all features but faster", "Identify the ONE core value prop and build only that", "Build 50% of features at 50% quality", "Outsource to build faster"], correct: 1, explain: "MVP means ONE thing done well, not many things done poorly. The core value proposition should be undeniably clear to users." },
         { topic: "Build vs Buy", situation: "You need user authentication for your MVP. Your team wants to build a custom solution for future flexibility.", q: "What's the right MVP decision?", opts: ["Build custom auth from scratch", "Use existing auth services (Auth0, Firebase, etc.)", "Skip auth for MVP", "Build simple auth, plan to replace"], correct: 1, explain: "For MVP, buy/use existing solutions for non-core features. Auth isn't your value prop‚Äîfocus engineering time on what differentiates you." },
         { topic: "Tech Stack", situation: "Your technical co-founder wants to use cutting-edge technology (new framework, latest architecture patterns).", q: "How should you choose MVP technology?", opts: ["Use the newest tech for future-proofing", "Choose boring, proven tech your team knows well", "Let engineers decide based on interest", "Build in multiple technologies to compare"], correct: 1, explain: "Boring technology works. Speed matters more than perfection for MVP. Use what your team knows to ship fast and learn faster." },
         { topic: "Quality vs Speed", situation: "Your MVP is 80% done. The last 20% (edge cases, polish) will take as long as the first 80%.", q: "What should you do?", opts: ["Finish the remaining 20% properly", "Ship at 80% and handle edge cases based on real usage", "Hire more people to finish faster", "Start over with a simpler scope"], correct: 1, explain: "The 80/20 rule applies: 80% of value comes from 20% of features. Ship, learn, then decide which edge cases actually matter." },
         { topic: "Launch Timing", situation: "Your MVP is functional but you're embarrassed by the design. A designer could polish it in 2 more weeks.", q: "When should you launch?", opts: ["Wait for the design polish", "Launch now if core functionality works", "Do a soft launch to friends only", "Rebuild with better design first"], correct: 1, explain: "If you're not embarrassed by V1, you launched too late. Early users care about solving their problem, not pixel-perfect design." }
      ];
      const d = decisions[decision];
      const infoTopics: Record<string, {title: string; content: string}> = {
         definition: { title: "What is MVP?", content: "Minimum Viable Product: the smallest thing you can build to learn whether customers want your solution. It's not a cheap product‚Äîit's a learning vehicle. Emphasis on learning, not product." },
         scope: { title: "Scoping MVP", content: "Start with the problem, not features. Ask: 'What's the smallest thing that proves people will pay/use this?' Cut ruthlessly. If removing a feature doesn't kill the learning goal, remove it." },
         metrics: { title: "MVP Success Metrics", content: "Define success BEFORE building: 'If X users do Y in Z time, we've validated the hypothesis.' Vanity metrics (downloads, signups) mislead. Focus on engagement and retention." },
         iteration: { title: "Post-MVP Iteration", content: "MVP is the start, not the goal. Plan: Build ‚Üí Measure ‚Üí Learn ‚Üí Repeat. Each iteration should have a clear hypothesis to test. Pivot or persevere based on data, not ego." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === d.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì ${d.topic}: Lean thinking!`]); } else { setLog(l => [...l, `‚úó ${d.topic}: Better: "${d.opts[d.correct]}"`]); } };
      const next = () => { if(decision >= decisions.length - 1) { setPhase('result'); } else { setDecision(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-6"><div className="text-6xl mb-4">üöÄ</div><h2 className="text-2xl font-bold mb-2">MVP Development</h2><p className="text-slate-300 text-center mb-6 max-w-md">Master the art of building Minimum Viable Products that maximize learning!</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-lime-500 to-green-500 rounded-xl font-bold">Build MVP</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üéØ' : grade === 'B' ? 'üöÄ' : 'üîß'}</div><h2 className="text-2xl font-bold mb-2">MVP Complete!</h2><div className="text-4xl font-bold text-lime-400 mb-2">{score}/{decisions.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Lean startup master!' : grade === 'B' ? 'Good MVP thinking!' : 'Keep learning!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setDecision(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-lime-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-lime-900 via-green-900 to-emerald-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-lime-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-lime-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-lime-500/30 flex justify-between items-center"><span className="font-bold">üöÄ {d.topic}</span><span className="text-lime-400">{decision + 1}/{decisions.length}</span><span className="text-green-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{d.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{d.q}</p></div><div className="grid gap-2">{d.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === d.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-lime-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{d.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-lime-600 rounded-lg">{decision >= decisions.length - 1 ? 'See Results' : 'Next Decision'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-lime-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-lime-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- RISK ASSESSMENT RENDERER ---
   const RiskAssessmentRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [risk, setRisk] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const risks = [
         { category: "Market Risk", icon: "üìâ", situation: "Your startup is entering a market dominated by two well-funded competitors with 95% market share combined.", q: "How do you assess and mitigate this risk?", opts: ["Avoid the market entirely", "Find an underserved niche and differentiate strongly", "Compete directly on price", "Hope competitors ignore you"], correct: 1, explain: "Dominated markets often have underserved segments. Find a niche where your differentiation matters and grow from there." },
         { category: "Technical Risk", icon: "‚öôÔ∏è", situation: "Your product relies on a new AI model that works 80% of the time in testing. Users need 99% reliability.", q: "What's the best risk mitigation?", opts: ["Launch and fix in production", "Add human fallback for the 20% failures", "Wait until 99% works", "Pivot to simpler technology"], correct: 1, explain: "Hybrid approaches (AI + human fallback) manage technical risk while still delivering value. You can improve automation over time." },
         { category: "Financial Risk", icon: "üí∏", situation: "You have 8 months of runway. Sales cycles are taking longer than expected‚Äîaverage 6 months to close.", q: "How do you manage this financial risk?", opts: ["Spend more on marketing to accelerate", "Cut burn rate and extend runway while refining sales", "Raise emergency funding now", "Accept you'll run out of money"], correct: 1, explain: "Extend runway AND fix the problem. Raising while desperate gives bad terms. Cutting burn buys time to learn and adjust." },
         { category: "Team Risk", icon: "üë•", situation: "Your CTO, who holds critical knowledge, hints they might leave for another opportunity.", q: "How do you mitigate this key person risk?", opts: ["Offer immediate raise to retain them", "Start knowledge transfer and document systems now", "Ignore hints‚Äîthey're probably bluffing", "Start looking for replacement secretly"], correct: 1, explain: "Knowledge concentration is a critical risk. Start documentation and cross-training immediately. Address retention, but also reduce single-point-of-failure." },
         { category: "Regulatory Risk", icon: "‚öñÔ∏è", situation: "Your fintech startup operates in a gray area. A new regulation might require expensive compliance or ban your business model.", q: "What's the smart approach?", opts: ["Ignore until regulation passes", "Engage with regulators proactively and build compliance into product", "Move to unregulated jurisdiction", "Pivot to different industry"], correct: 1, explain: "Proactive regulatory engagement often influences outcomes favorably. Building compliance early creates competitive advantage when regulation hits." }
      ];
      const r = risks[risk];
      const infoTopics: Record<string, {title: string; content: string}> = {
         framework: { title: "Risk Assessment Framework", content: "Assess: Probability √ó Impact = Priority. For each risk: Identify ‚Üí Assess ‚Üí Mitigate ‚Üí Monitor. Focus on high-probability, high-impact risks first. Accept some risks consciously." },
         types: { title: "Startup Risk Types", content: "Key risks: Market (will they buy?), Product (can we build it?), Financial (can we afford it?), Team (can we execute?), Regulatory (is it legal?), Competitive (can we win?)." },
         mitigation: { title: "Mitigation Strategies", content: "Options: Avoid (don't take the risk), Transfer (insurance, partners), Mitigate (reduce probability/impact), Accept (acknowledge and monitor). Match strategy to risk type." },
         monitoring: { title: "Risk Monitoring", content: "Set leading indicators for each risk. Market risk: watch for customer churn signals. Financial: monitor burn rate weekly. Create escalation triggers before problems become crises." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === r.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì ${r.category}: Risk managed!`]); } else { setLog(l => [...l, `‚úó ${r.category}: Better: "${r.opts[r.correct]}"`]); } };
      const next = () => { if(risk >= risks.length - 1) { setPhase('result'); } else { setRisk(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-900 via-rose-900 to-orange-900 text-white p-6"><div className="text-6xl mb-4">‚ö†Ô∏è</div><h2 className="text-2xl font-bold mb-2">Risk Assessment Matrix</h2><p className="text-slate-300 text-center mb-6 max-w-md">Identify, assess, and mitigate startup risks before they become crises!</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-red-500 to-orange-500 rounded-xl font-bold">Assess Risks</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-red-900 via-rose-900 to-orange-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üõ°Ô∏è' : grade === 'B' ? '‚ö†Ô∏è' : 'üé≤'}</div><h2 className="text-2xl font-bold mb-2">Assessment Complete!</h2><div className="text-4xl font-bold text-red-400 mb-2">{score}/{risks.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Risk management pro!' : grade === 'B' ? 'Good risk awareness!' : 'High risk tolerance!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setRisk(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-red-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-red-900 via-rose-900 to-orange-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-red-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-red-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-red-500/30 flex justify-between items-center"><span className="font-bold">{r.icon} {r.category}</span><span className="text-red-400">{risk + 1}/{risks.length}</span><span className="text-orange-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="flex gap-1 mb-4">{risks.map((rs, i) => (<div key={i} className="flex-1 text-center"><div className={`text-xl ${i <= risk ? 'opacity-100' : 'opacity-30'}`}>{rs.icon}</div><div className={`h-1 mt-1 rounded ${i < risk ? 'bg-red-500' : i === risk ? 'bg-orange-400' : 'bg-slate-700'}`} /></div>))}</div><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{r.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{r.q}</p></div><div className="grid gap-2">{r.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === r.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-red-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{r.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-red-600 rounded-lg">{risk >= risks.length - 1 ? 'See Results' : 'Next Risk'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-red-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-red-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- SUSTAINABILITY RENDERER ---
   const SustainabilityRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [topic, setTopic] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const topics = [
         { area: "Environmental", icon: "üå±", situation: "Your e-commerce startup ships 10,000 packages monthly. Customers are asking about your environmental practices.", q: "What's the best sustainable business approach?", opts: ["Ignore‚Äîcustomers won't pay more for green", "Implement sustainable packaging with carbon offset options", "Greenwash with vague claims", "Only ship once a week to reduce trips"], correct: 1, explain: "Genuine sustainability creates differentiation and customer loyalty. Transparent practices (recyclable packaging, carbon offsets) attract conscious consumers." },
         { area: "Social Impact", icon: "ü§ù", situation: "Your startup is growing and you want to build a diverse team, but all applicants look similar to your founders.", q: "How do you improve diversity sustainably?", opts: ["Lower hiring standards for diversity", "Expand recruiting sources and remove bias from hiring process", "Set strict quotas regardless of fit", "Ignore‚Äîhire whoever is best"], correct: 1, explain: "Sustainable diversity means fixing the pipeline (where you recruit) and process (how you evaluate). This attracts diverse talent without compromising standards." },
         { area: "Governance", icon: "‚öñÔ∏è", situation: "Investors are offering term sheets. One offers more money but wants control that could force short-term thinking.", q: "How do you balance funding with sustainable governance?", opts: ["Take the money‚Äîfigure out governance later", "Negotiate governance terms that protect long-term mission", "Reject all outside investment", "Accept any terms to survive"], correct: 1, explain: "Governance structure determines long-term sustainability. Protect founder vision with voting rights, board composition, and clear decision authorities." },
         { area: "Economic", icon: "üí∞", situation: "Your startup is profitable but growth is slowing. VCs want you to burn more to grow faster.", q: "What's the economically sustainable path?", opts: ["Burn aggressively to hit growth targets", "Balance growth investment with profitability runway", "Stop all growth spending", "Pivot to a new market entirely"], correct: 1, explain: "Sustainable growth balances ambition with resilience. Profitability gives options; excessive burn creates pressure that compromises decisions." },
         { area: "Long-term Thinking", icon: "üîÆ", situation: "A lucrative enterprise deal requires customizations that would fragment your product and slow down roadmap.", q: "How do you balance short-term revenue with long-term sustainability?", opts: ["Take any revenue available", "Evaluate if deal aligns with product vision long-term", "Reject all enterprise deals", "Build everything they ask"], correct: 1, explain: "Sustainable growth evaluates each opportunity against long-term vision. Some revenue creates technical debt that costs more than it earns." }
      ];
      const t = topics[topic];
      const infoTopics: Record<string, {title: string; content: string}> = {
         esg: { title: "ESG for Startups", content: "ESG (Environmental, Social, Governance) isn't just for big companies. Investors increasingly evaluate startups on sustainability. Build good practices early‚Äîthey're easier to scale than fix." },
         triple: { title: "Triple Bottom Line", content: "Measure success by People (social impact), Planet (environmental impact), and Profit (financial returns). Sustainable businesses optimize all three, not just profit." },
         circular: { title: "Circular Economy", content: "Design products and services for reuse, repair, and recycling. Reduce waste by keeping materials in use longer. This reduces costs and appeals to eco-conscious customers." },
         bcorp: { title: "B Corp Certification", content: "B Corps meet high standards of social and environmental performance. Certification signals commitment to stakeholders beyond shareholders. Consider if it aligns with your mission." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === t.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì ${t.area}: Sustainable choice!`]); } else { setLog(l => [...l, `‚úó ${t.area}: Better: "${t.opts[t.correct]}"`]); } };
      const next = () => { if(topic >= topics.length - 1) { setPhase('result'); } else { setTopic(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-6"><div className="text-6xl mb-4">üåç</div><h2 className="text-2xl font-bold mb-2">Sustainability & Impact</h2><p className="text-slate-300 text-center mb-6 max-w-md">Build a business that's good for people, planet, and profit!</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-emerald-500 to-teal-500 rounded-xl font-bold">Go Sustainable</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üåü' : grade === 'B' ? 'üåç' : 'üå±'}</div><h2 className="text-2xl font-bold mb-2">Impact Assessment!</h2><div className="text-4xl font-bold text-emerald-400 mb-2">{score}/{topics.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Sustainability champion!' : grade === 'B' ? 'Good impact awareness!' : 'Room to grow!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setTopic(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-emerald-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-emerald-900 via-teal-900 to-cyan-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-emerald-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-emerald-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-emerald-500/30 flex justify-between items-center"><span className="font-bold">{t.icon} {t.area}</span><span className="text-emerald-400">{topic + 1}/{topics.length}</span><span className="text-teal-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="flex gap-1 mb-4">{topics.map((tp, i) => (<div key={i} className="flex-1 text-center"><div className={`text-xl ${i <= topic ? 'opacity-100' : 'opacity-30'}`}>{tp.icon}</div><div className={`h-1 mt-1 rounded ${i < topic ? 'bg-emerald-500' : i === topic ? 'bg-teal-400' : 'bg-slate-700'}`} /></div>))}</div><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{t.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{t.q}</p></div><div className="grid gap-2">{t.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === t.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-emerald-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{t.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-emerald-600 rounded-lg">{topic >= topics.length - 1 ? 'See Results' : 'Next Topic'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-emerald-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-emerald-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- EXIT STRATEGY RENDERER ---
   const ExitStrategyRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const scenarios = [
         { type: "Acquisition", icon: "üè¢", situation: "A larger company offers to acquire your startup for 3x your last valuation. The offer requires you to stay for 3 years.", q: "How do you evaluate this acquisition offer?", opts: ["Accept immediately‚Äî3x is great", "Evaluate strategic fit, team treatment, and earnout terms carefully", "Reject‚Äîalways hold out for IPO", "Counter with 10x valuation"], correct: 1, explain: "Exit evaluation goes beyond price: strategic fit, earnout structure, team retention packages, and your personal goals all matter. Don't rush." },
         { type: "IPO Readiness", icon: "üìà", situation: "Your startup has $50M ARR growing 60% YoY. Investment bankers are suggesting you could IPO in 18 months.", q: "What should you assess for IPO readiness?", opts: ["Revenue growth is enough‚Äîproceed", "Evaluate predictability, governance, compliance, and market timing", "Wait for $100M ARR minimum", "IPO immediately to capture the market"], correct: 1, explain: "IPO readiness requires: predictable revenue, strong governance, SOX compliance readiness, experienced CFO, and favorable market conditions. It's a journey, not an event." },
         { type: "Secondary Sale", icon: "üíµ", situation: "You've been grinding for 7 years. An investor offers to buy $5M of your shares in a secondary transaction.", q: "How should you think about secondary sales?", opts: ["Refuse‚Äîit shows lack of confidence", "Consider if it enables focus and reduces personal financial pressure", "Sell all your shares", "Wait for full exit only"], correct: 1, explain: "Secondary sales can provide founders financial security without full exit. This often enables better long-term decisions by reducing personal financial pressure." },
         { type: "Acqui-hire", icon: "üë•", situation: "Your startup is running low on runway. A big tech company wants to acqui-hire your team but shut down the product.", q: "How do you handle an acqui-hire offer?", opts: ["Reject‚Äîwe'll find another way", "Negotiate best terms for team while being transparent with stakeholders", "Accept any terms to save team", "Pivot to new product instead"], correct: 1, explain: "Acqui-hires happen. Negotiate team packages, handle investor communication transparently, and ensure everyone understands the terms. It's not failure‚Äîit's transition." },
         { type: "Strategic Exit", icon: "üéØ", situation: "You're approached by two acquirers: one offers more cash, the other offers better strategic fit and team opportunities.", q: "How do you choose between exit offers?", opts: ["Always take the highest cash offer", "Weight strategic fit, team outcomes, and your long-term goals alongside price", "Let investors decide", "Reject both and stay independent"], correct: 1, explain: "Exit decisions blend financial returns with strategic considerations. Higher offers with poor fit often underperform. Consider earnouts, team retention, and your own goals." }
      ];
      const s = scenarios[scenario];
      const infoTopics: Record<string, {title: string; content: string}> = {
         types: { title: "Exit Types", content: "Common exits: M&A (most common), IPO (rare but lucrative), Acqui-hire (team-focused), Secondary (partial liquidity), Management buyout. Each has different implications for founders, team, and investors." },
         valuation: { title: "Exit Valuation", content: "Exit valuations consider: revenue multiples (industry-specific), strategic premium (buyer synergies), competitive tension (multiple bidders), growth trajectory, and profitability path." },
         negotiation: { title: "Exit Negotiation", content: "Key terms: Purchase price, Earnouts (performance-based), Escrow (holdbacks), Reps & warranties (liability), Non-compete terms, Team retention packages, Founder role post-acquisition." },
         timing: { title: "Exit Timing", content: "Best time to exit: when you have options, not when you need to. Build relationships with potential acquirers early. The best exits often come from long-term strategic partnerships." }
      };
      const answer = (i: number) => { if(answered) return; setSelected(i); setAnswered(true); if(i === s.correct) { setScore(p => p + 1); setLog(l => [...l, `‚úì ${s.type}: Smart exit thinking!`]); } else { setLog(l => [...l, `‚úó ${s.type}: Consider: "${s.opts[s.correct]}"`]); } };
      const next = () => { if(scenario >= scenarios.length - 1) { setPhase('result'); } else { setScenario(p => p + 1); setAnswered(false); setSelected(null); } };
      const grade = score >= 4 ? 'A' : score >= 3 ? 'B' : score >= 2 ? 'C' : 'D';
      if(phase === 'intro') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-6"><div className="text-6xl mb-4">üö™</div><h2 className="text-2xl font-bold mb-2">Exit Strategy Planning</h2><p className="text-slate-300 text-center mb-6 max-w-md">Plan your endgame! Master acquisition, IPO, and exit negotiation scenarios.</p><button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-yellow-500 to-amber-500 rounded-xl font-bold">Plan Exit</button></div>);
      if(phase === 'result') return (<div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white p-6"><div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? 'üö™' : 'üìä'}</div><h2 className="text-2xl font-bold mb-2">Exit Planning Complete!</h2><div className="text-4xl font-bold text-yellow-400 mb-2">{score}/{scenarios.length}</div><div className="text-6xl mb-4">{grade}</div><p className="text-slate-400 mb-4">{grade === 'A' ? 'Exit strategist!' : grade === 'B' ? 'Good exit sense!' : 'Keep learning!'}</p><div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">{log.map((l,i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}</div><button onClick={() => {setPhase('intro');setScenario(0);setScore(0);setAnswered(false);setSelected(null);setLog([]);}} className="px-6 py-2 bg-yellow-600 rounded-lg">Try Again</button></div>);
      return (<div className="w-full h-full flex flex-col bg-gradient-to-br from-yellow-900 via-amber-900 to-orange-900 text-white overflow-hidden">{showInfo && infoTopic && infoTopics[infoTopic] && (<div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}><div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}><h3 className="text-lg font-bold text-yellow-400 mb-2">{infoTopics[infoTopic].title}</h3><p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p><button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-yellow-600 rounded-lg">Got it!</button></div></div>)}<div className="p-3 bg-black/30 border-b border-yellow-500/30 flex justify-between items-center"><span className="font-bold">{s.icon} {s.type}</span><span className="text-yellow-400">{scenario + 1}/{scenarios.length}</span><span className="text-amber-400">Score: {score}</span></div><div className="flex-1 p-4 overflow-auto"><div className="flex gap-1 mb-4">{scenarios.map((sc, i) => (<div key={i} className="flex-1 text-center"><div className={`text-xl ${i <= scenario ? 'opacity-100' : 'opacity-30'}`}>{sc.icon}</div><div className={`h-1 mt-1 rounded ${i < scenario ? 'bg-yellow-500' : i === scenario ? 'bg-amber-400' : 'bg-slate-700'}`} /></div>))}</div><div className="bg-black/30 rounded-xl p-4 mb-4"><p className="text-sm text-slate-300">{s.situation}</p></div><div className="bg-black/30 rounded-xl p-4 mb-3"><p className="font-medium">{s.q}</p></div><div className="grid gap-2">{s.opts.map((opt, i) => (<button key={i} onClick={() => answer(i)} disabled={answered} className={`p-3 rounded-lg text-left text-sm ${answered ? i === s.correct ? 'bg-green-600' : i === selected ? 'bg-red-600' : 'bg-black/30' : 'bg-black/30 hover:bg-yellow-600/50'}`}>{opt}</button>))}</div>{answered && (<div className="mt-3 p-3 bg-black/30 rounded-lg"><p className="text-sm text-slate-300">{s.explain}</p><button onClick={next} className="mt-3 w-full py-2 bg-yellow-600 rounded-lg">{scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario'}</button></div>)}</div><div className="p-3 bg-black/30 border-t border-yellow-500/30 flex gap-2 justify-center flex-wrap">{Object.keys(infoTopics).map(k => <button key={k} onClick={() => {setInfoTopic(k);setShowInfo(true);}} className="text-xs text-yellow-400">‚ÑπÔ∏è {infoTopics[k].title}</button>)}</div></div>);
   };

   // --- BUSINESS STRUCTURES RENDERER ---
   const BusinessStructuresRenderer = () => {
      const [phase, setPhase] = useState<'intro' | 'play' | 'result'>('intro');
      const [scenario, setScenario] = useState(0);
      const [score, setScore] = useState(0);
      const [selected, setSelected] = useState<number | null>(null);
      const [answered, setAnswered] = useState(false);
      const [log, setLog] = useState<string[]>([]);
      const [showInfo, setShowInfo] = useState(false);
      const [infoTopic, setInfoTopic] = useState<string | null>(null);

      const structures = [
         { id: 'sole', name: 'Sole Proprietorship', icon: 'üë§', desc: 'Simplest, you ARE the business' },
         { id: 'llc', name: 'LLC', icon: 'üè¢', desc: 'Limited liability, flexible taxes' },
         { id: 'scorp', name: 'S-Corp', icon: 'üìä', desc: 'Save on self-employment tax' },
         { id: 'ccorp', name: 'C-Corp', icon: 'üèõÔ∏è', desc: 'Best for VC funding & IPO' }
      ];

      const scenarios = [
         {
            situation: "You're a freelance graphic designer working from home. You have a few clients and earn $50K/year. You want the simplest setup with minimal paperwork.",
            icon: 'üé®',
            q: "Which structure is best for this situation?",
            opts: ['Sole Proprietorship', 'LLC', 'S-Corp', 'C-Corp'],
            correct: 0,
            explain: "Sole Proprietorship is perfect for solo freelancers with low liability risk. It's the simplest to set up (often just a business license), has minimal paperwork, and income is reported on your personal tax return. No separate business tax filing needed!"
         },
         {
            situation: "You're launching an e-commerce business selling products online. You're investing $20K of savings and worried that if a customer sues over a defective product, you could lose your house.",
            icon: 'üõí',
            q: "Which structure protects your personal assets?",
            opts: ['Sole Proprietorship', 'LLC', 'S-Corp', 'C-Corp'],
            correct: 1,
            explain: "LLC (Limited Liability Company) separates your personal assets from business liabilities. If your business gets sued, creditors generally can't come after your house, car, or personal savings. It's the most popular choice for small businesses seeking liability protection."
         },
         {
            situation: "Your consulting business earns $150K/year in profit. You're paying a lot in self-employment tax (15.3%). Your accountant says there's a structure that could save you $10K+ in taxes annually.",
            icon: 'üí∞',
            q: "Which structure can reduce self-employment taxes?",
            opts: ['Sole Proprietorship', 'LLC', 'S-Corp', 'C-Corp'],
            correct: 2,
            explain: "S-Corp allows you to split income between 'reasonable salary' (subject to payroll taxes) and 'distributions' (not subject to self-employment tax). If you pay yourself $80K salary and take $70K as distribution, you save 15.3% on that $70K = ~$10,700!"
         },
         {
            situation: "You've built a tech startup with a revolutionary app. VCs want to invest $2M for 20% equity. They mention needing 'preferred stock' and a 'standard Delaware structure' for the deal.",
            icon: 'üöÄ',
            q: "Which structure do VCs require for investment?",
            opts: ['Sole Proprietorship', 'LLC', 'S-Corp', 'C-Corp'],
            correct: 3,
            explain: "C-Corp (specifically Delaware C-Corp) is required by most VCs. It allows issuing different stock classes (preferred shares for investors), has no limit on shareholders, and provides the structure needed for eventual IPO or acquisition. 90%+ of VC-backed startups are C-Corps."
         },
         {
            situation: "You and two friends are starting a lawn care business. You want shared ownership but worry about personal liability if someone gets injured by your equipment.",
            icon: 'üåø',
            q: "Best structure for multiple owners with liability protection?",
            opts: ['Sole Proprietorship', 'LLC', 'S-Corp', 'C-Corp'],
            correct: 1,
            explain: "Multi-member LLC is perfect for partnerships wanting liability protection. Each member's personal assets are protected, profit sharing is flexible (doesn't have to be equal), and it avoids the double taxation of C-Corps. You can also specify management structure in your Operating Agreement."
         }
      ];

      const s = scenarios[scenario];

      const infoTopics: Record<string, {title: string; content: string}> = {
         liability: {
            title: "Personal Liability",
            content: "Liability protection means separating your personal assets (house, savings, car) from business debts and lawsuits. In a Sole Proprietorship, YOU are the business‚Äîif sued, everything is at risk. LLCs and Corps create a legal 'wall' between you and the business."
         },
         taxes: {
            title: "Business Taxes",
            content: "Sole Props & LLCs are 'pass-through'‚Äîprofits flow to your personal return. S-Corps also pass-through but can split income to reduce self-employment tax. C-Corps pay corporate tax, then shareholders pay again on dividends (double taxation)."
         },
         formation: {
            title: "Formation & Costs",
            content: "Sole Prop: Often free, just need a business license. LLC: $50-500 state filing fee. S-Corp: LLC or Corp that files IRS Form 2553. C-Corp: $100-800 state filing, more paperwork, often need Delaware incorporation for investors."
         },
         growth: {
            title: "Growth & Funding",
            content: "Planning to raise VC funding? You'll need a C-Corp. Want to go public someday? C-Corp. Just want a lifestyle business? LLC is usually sufficient. S-Corps have a 100-shareholder limit and only one stock class‚Äîlimiting for investors."
         }
      };

      const answer = (i: number) => {
         if (answered) return;
         setSelected(i);
         setAnswered(true);
         const structureName = s.opts[i];
         if (i === s.correct) {
            setScore(p => p + 1);
            setLog(l => [...l, `‚úì Scenario ${scenario + 1}: Correctly chose ${structureName}`]);
         } else {
            setLog(l => [...l, `‚úó Scenario ${scenario + 1}: Chose ${structureName}, but ${s.opts[s.correct]} was better`]);
         }
      };

      const next = () => {
         if (scenario >= scenarios.length - 1) {
            setPhase('result');
         } else {
            setScenario(p => p + 1);
            setAnswered(false);
            setSelected(null);
         }
      };

      const grade = score >= 5 ? 'A' : score >= 4 ? 'B' : score >= 3 ? 'C' : 'D';

      // INTRO PHASE
      if (phase === 'intro') return (
         <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-amber-900 via-orange-900 to-yellow-900 text-white p-6">
            <div className="text-6xl mb-4">üèõÔ∏è</div>
            <h2 className="text-2xl font-bold mb-2">Business Structure Advisor</h2>
            <p className="text-slate-300 text-center mb-4 max-w-md">
               Learn to choose the right legal entity for any business situation!
            </p>
            <div className="bg-black/30 rounded-xl p-4 mb-6 max-w-md text-left">
               <p className="text-sm text-amber-200 mb-3 font-bold">üìã How This Game Works:</p>
               <ul className="text-xs text-slate-300 space-y-2">
                  <li>‚Ä¢ You'll face <strong>5 real-world scenarios</strong> about choosing business structures</li>
                  <li>‚Ä¢ Consider liability, taxes, funding needs, and complexity</li>
                  <li>‚Ä¢ Tap <strong>‚ÑπÔ∏è info buttons</strong> during play to learn key concepts</li>
                  <li>‚Ä¢ Each correct answer teaches you when to use each structure</li>
               </ul>
            </div>
            <div className="grid grid-cols-2 gap-2 mb-6 max-w-md">
               {structures.map(st => (
                  <div key={st.id} className="bg-black/20 rounded-lg p-2 text-center">
                     <span className="text-2xl">{st.icon}</span>
                     <p className="text-xs font-bold">{st.name}</p>
                  </div>
               ))}
            </div>
            <button onClick={() => setPhase('play')} className="px-8 py-3 bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl font-bold hover:from-amber-400 hover:to-orange-400 transition-all">
               Start Advising
            </button>
         </div>
      );

      // RESULT PHASE
      if (phase === 'result') return (
         <div className="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-amber-900 via-orange-900 to-yellow-900 text-white p-6">
            <div className="text-6xl mb-4">{grade === 'A' ? 'üèÜ' : grade === 'B' ? 'üèõÔ∏è' : grade === 'C' ? 'üìã' : 'üìö'}</div>
            <h2 className="text-2xl font-bold mb-2">Advisory Complete!</h2>
            <div className="text-4xl font-bold text-amber-400 mb-2">{score}/{scenarios.length}</div>
            <div className="text-6xl mb-4">{grade}</div>
            <p className="text-slate-400 mb-4 text-center max-w-md">
               {grade === 'A' ? 'Expert business advisor! You understand when to use each structure.' :
                grade === 'B' ? 'Strong understanding of business entities!' :
                grade === 'C' ? 'Getting there! Review the concepts below.' :
                'Keep learning! Business structures are crucial for any entrepreneur.'}
            </p>
            <div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4">
               <p className="text-xs font-bold text-amber-400 mb-2">üìä Key Takeaways:</p>
               <ul className="text-xs text-slate-300 space-y-1">
                  <li>‚Ä¢ <strong>Sole Prop:</strong> Simplest, but no liability protection</li>
                  <li>‚Ä¢ <strong>LLC:</strong> Best balance of protection & simplicity</li>
                  <li>‚Ä¢ <strong>S-Corp:</strong> Tax savings for high earners ($100K+)</li>
                  <li>‚Ä¢ <strong>C-Corp:</strong> Required for VC funding & IPO</li>
               </ul>
            </div>
            <div className="w-full max-w-md bg-black/30 rounded-lg p-3 mb-4 max-h-32 overflow-y-auto">
               <p className="text-xs font-bold text-amber-400 mb-2">üìù Your Decisions:</p>
               {log.map((l, i) => <p key={i} className="text-xs text-slate-300">{l}</p>)}
            </div>
            <button onClick={() => { setPhase('intro'); setScenario(0); setScore(0); setAnswered(false); setSelected(null); setLog([]); }} className="px-6 py-2 bg-amber-600 rounded-lg hover:bg-amber-500 transition-all">
               Try Again
            </button>
         </div>
      );

      // PLAY PHASE
      return (
         <div className="w-full h-full flex flex-col bg-gradient-to-br from-amber-900 via-orange-900 to-yellow-900 text-white overflow-hidden">
            {/* Info Modal */}
            {showInfo && infoTopic && infoTopics[infoTopic] && (
               <div className="absolute inset-0 bg-black/80 flex items-center justify-center p-4 z-50" onClick={() => { setShowInfo(false); setInfoTopic(null); }}>
                  <div className="bg-slate-800 rounded-xl p-4 max-w-md" onClick={e => e.stopPropagation()}>
                     <h3 className="text-lg font-bold text-amber-400 mb-2">{infoTopics[infoTopic].title}</h3>
                     <p className="text-sm text-slate-300">{infoTopics[infoTopic].content}</p>
                     <button onClick={() => { setShowInfo(false); setInfoTopic(null); }} className="mt-4 w-full py-2 bg-amber-600 rounded-lg">Got it!</button>
                  </div>
               </div>
            )}

            {/* Header */}
            <div className="p-3 bg-black/30 border-b border-amber-500/30 flex justify-between items-center">
               <span className="font-bold">üèõÔ∏è Business Advisor</span>
               <span className="text-amber-400">{scenario + 1}/{scenarios.length}</span>
               <span className="text-orange-400">Score: {score}</span>
            </div>

            {/* Progress Indicator */}
            <div className="px-4 pt-3">
               <div className="flex gap-1 mb-2">
                  {scenarios.map((_, i) => (
                     <div key={i} className={`flex-1 h-2 rounded ${i < scenario ? 'bg-amber-500' : i === scenario ? 'bg-orange-400' : 'bg-slate-700'}`} />
                  ))}
               </div>
            </div>

            {/* Main Content */}
            <div className="flex-1 p-4 overflow-auto">
               {/* Scenario */}
               <div className="bg-black/30 rounded-xl p-4 mb-4">
                  <div className="text-3xl mb-2">{s.icon}</div>
                  <p className="text-sm text-slate-300">{s.situation}</p>
               </div>

               {/* Question */}
               <div className="bg-black/30 rounded-xl p-4 mb-3">
                  <p className="font-medium">{s.q}</p>
               </div>

               {/* Options */}
               <div className="grid gap-2">
                  {s.opts.map((opt, i) => (
                     <button
                        key={i}
                        onClick={() => answer(i)}
                        disabled={answered}
                        className={`p-3 rounded-lg text-left text-sm flex items-center gap-3 ${
                           answered
                              ? i === s.correct
                                 ? 'bg-green-600'
                                 : i === selected
                                    ? 'bg-red-600'
                                    : 'bg-black/30'
                              : 'bg-black/30 hover:bg-amber-600/50'
                        }`}
                     >
                        <span className="text-xl">{structures[i].icon}</span>
                        <div>
                           <p className="font-bold">{opt}</p>
                           <p className="text-xs opacity-75">{structures[i].desc}</p>
                        </div>
                     </button>
                  ))}
               </div>

               {/* Explanation after answer */}
               {answered && (
                  <div className="mt-3 p-3 bg-black/30 rounded-lg">
                     <p className="text-xs font-bold text-amber-400 mb-1">üí° Why {s.opts[s.correct]}?</p>
                     <p className="text-sm text-slate-300">{s.explain}</p>
                     <button onClick={next} className="mt-3 w-full py-2 bg-amber-600 rounded-lg font-bold">
                        {scenario >= scenarios.length - 1 ? 'See Results' : 'Next Scenario ‚Üí'}
                     </button>
                  </div>
               )}
            </div>

            {/* Info Buttons Footer */}
            <div className="p-3 bg-black/30 border-t border-amber-500/30 flex gap-2 justify-center flex-wrap">
               {Object.keys(infoTopics).map(k => (
                  <button key={k} onClick={() => { setInfoTopic(k); setShowInfo(true); }} className="text-xs text-amber-400 hover:text-amber-300">
                     ‚ÑπÔ∏è {infoTopics[k].title}
                  </button>
               ))}
            </div>
         </div>
      );
   };

   // --- GENERIC RENDERER ---
   const GenericRenderer = () => {
      if (type === 'poster' || type === 'infographic') {
         return (
            <div className="w-full h-full flex flex-col items-center justify-center p-8 bg-slate-900/5">
               <div className="relative rounded-2xl overflow-hidden shadow-2xl border-[12px] border-white bg-slate-900 max-w-4xl max-h-full group">
                  <img src={parsedData?.data || parsedData} className="max-w-full max-h-[70vh] object-contain transition-transform duration-700 group-hover:scale-105" alt="Artifact" />
               </div>
            </div>
         );
      }

      // Debug fallback for unrecognized types
      console.warn("GeneratedDiagram: Unrecognized type", type, "with data:", data);
      return (
         <div className="p-8 text-center">
            <p className="text-slate-400 font-serif italic mb-4">Rendering visual artifact...</p>
            <p className="text-xs text-slate-300">Type: <code className="bg-slate-100 px-1 rounded">{type}</code></p>
            {parsedData === null && <p className="text-xs text-red-400 mt-2">Error: Failed to parse diagram data.</p>}
         </div>
      );
   };



   const renderVisual = () => {
      switch (type) {
         case 'dynamic_blueprint': return <DynamicBlueprintRenderer />;
         case 'rocket': return <RocketEngineRenderer />;
         case 'projectile': return <ProjectileRenderer />;
         case 'compound_interest': return <CompoundInterestRenderer />;
         case 'supply_demand': return <SupplyDemandRenderer />;
         case 'pendulum': return <PendulumRenderer />;
         case 'waves': return <WaveInterferenceRenderer />;
         case 'circuits': return <CircuitRenderer />;
         case 'sorting':
            return <SortingRenderer />;
         case 'addition':
            return <AdditionRenderer />;
         case 'subtraction':
            return <SubtractionRenderer />;
         case 'multiplication':
            return <MultiplicationRenderer />;
         case 'division':
            return <DivisionRenderer />;
         case 'fractions':
            return <FractionRenderer />;
         case 'area':
            return <AreaRenderer />;
         case 'triangle':
            return <TriangleRenderer />;
         case 'force_lab':
            return <ForceLabRenderer />;
         case 'energy_coaster':
            return <EnergyCoasterRenderer />;
         case 'atomic_builder':
            return <AtomicBuilderRenderer />;
         case 'equation_balancer':
            return <EquationBalancerRenderer />;
         case 'gas_law':
            return <GasLawRenderer />;
         case 'advanced_force_lab':
            return <AdvancedForceLabRenderer />;
         case 'newton_third_law':
            return <NewtonThirdLawRenderer />;
         case 'net_force':
            return <NetForceRenderer />;
         case 'gravity_acceleration':
            return <GravityAccelerationRenderer />;
         case 'force_classification':
            return <ForceClassificationRenderer />;
         case 'stress_response':
            return <StressResponseRenderer />;
         case 'posture_analyzer':
            return <PostureAnalyzerRenderer />;
         case 'heart_rate_zones':
            return <HeartRateZoneRenderer />;
         case 'plate_method':
            return <PlateMethodRenderer />;
         case 'breathing_guide':
            return <BreathingGuideRenderer />;
         case 'gravitational_pe':
            return <GravitationalPERenderer />;
         case 'chemical_pe':
            return <ChemicalPERenderer />;
         case 'energy_conservation':
            return <EnergyConservationRenderer />;
         case 'machine_efficiency':
            return <MachineEfficiencyRenderer />;
         case 'convection':
            return <ConvectionRenderer />;
         case 'specific_heat':
            return <SpecificHeatRenderer />;
         case 'latent_heat':
            return <LatentHeatRenderer />;
         case 'entropy':
            return <EntropyRenderer />;
         case 'heat_engine':
            return <HeatEngineRenderer />;
         case 'light_transmission':
            return <LightTransmissionRenderer />;
         case 'light_absorption':
            return <LightAbsorptionRenderer />;
         case 'digital_signal':
            return <DigitalSignalRenderer />;
         case 'wave_equation':
            return <WaveEquationRenderer />;
         case 'superposition':
            return <SuperpositionRenderer />;
         case 'wave_interference':
            return <WaveInterference2DRenderer />;
         case 'standing_wave':
            return <StandingWaveRenderer />;
         case 'resonance':
            return <ResonanceRenderer />;
         case 'doppler_effect':
            return <DopplerEffectRenderer />;
         case 'snells_law':
            return <SnellsLawRenderer />;
         case 'tir':
            return <TIRRenderer />;
         case 'lens':
            return <LensRenderer />;
         case 'mirror':
            return <MirrorRenderer />;
         case 'ray_tracing':
            return <RayTracingLabRenderer />;
         case 'polarization':
            return <PolarizationRenderer />;
         case 'diffraction':
            return <DiffractionRenderer />;
         case 'dispersion':
            return <DispersionRenderer />;
         case 'thin_film':
            return <ThinFilmRenderer />;
         case 'wave_particle_duality':
            return <WaveParticleDualityRenderer />;
         case 'photoelectric_effect':
            return <PhotoelectricEffectRenderer />;
         case 'laser':
            return <LaserRenderer />;
         case 'acoustic_levitation':
            return <AcousticLevitationRenderer />;
         case 'fiber_optics':
            return <FiberOpticsRenderer />;
         case 'static_balloon':
            return <StaticBalloonRenderer />;
         case 'circuit_builder_basic':
            return <CircuitBuilderBasicRenderer />;
         case 'magnet_maze':
            return <MagnetMazeRenderer />;
         case 'electromagnet_basic':
            return <ElectromagnetBasicRenderer />;
         case 'conductivity_tester':
            return <ConductivityTesterRenderer />;
         case 'simple_switch':
            return <SimpleSwitchRenderer />;
         case 'magnetic_pole':
            return <MagneticPoleRenderer />;
         case 'attract_repel':
            return <AttractRepelRenderer />;
         case 'compass':
            return <CompassRenderer />;
         case 'magnetic_material':
            return <MagneticMaterialRenderer />;
         case 'series_circuit':
            return <SeriesCircuitRenderer />;
         case 'parallel_circuit':
            return <ParallelCircuitRenderer />;
         case 'voltage_potential':
            return <VoltagePotentialRenderer />;
         case 'current_flow':
            return <CurrentFlowRenderer />;
         case 'ohms_law':
            return <OhmsLawRenderer />;
         case 'electromagnet':
            return <ElectromagnetRenderer />;
         case 'basic_motor':
            return <BasicMotorRenderer />;
         case 'basic_generator':
            return <BasicGeneratorRenderer />;
         case 'earth_field':
            return <EarthFieldRenderer />;
         case 'household_safety':
            return <HouseholdSafetyRenderer />;
         case 'coulombs_law':
            return <CoulombsLawRenderer />;
         case 'electric_field':
            return <ElectricFieldRenderer />;
         case 'capacitor_lab':
            return <CapacitorLabRenderer />;
         case 'rlc_circuit':
            return <RLCCircuitRenderer />;
         case 'faradays_law':
            return <FaradaysLawRenderer />;
         case 'magnetic_flux':
            return <MagneticFluxRenderer />;
         case 'lenzs_law':
            return <LenzsLawRenderer />;
         case 'battery_connections':
            return <BatteryConnectionsRenderer />;
         case 'bulb_power':
            return <BulbPowerRenderer />;
         case 'multi_step_equations':
            return <MultiStepEquationsRenderer />;
         case 'variables_both_sides':
            return <VariablesBothSidesRenderer />;
         case 'linear_inequalities':
            return <LinearInequalitiesRenderer />;
         case 'inequalities_number_line':
            return <InequalitiesNumberLineRenderer />;
         case 'independent_dependent_variables':
            return <IndependentDependentVariablesRenderer />;
         case 'counting_100':
            return <Counting100Renderer />;
         case 'one_to_one_correspondence':
            return <OneToOneCorrespondenceRenderer />;
         case 'subitizing':
            return <SubitizingRenderer />;
         case 'place_value_tens_ones':
            return <PlaceValueTensOnesRenderer />;
         case 'addition_putting_together':
            return <AdditionPuttingTogetherRenderer />;
         case 'subtraction_taking_apart':
            return <SubtractionTakingApartRenderer />;
         case 'fact_families':
            return <FactFamiliesRenderer />;
         case 'positive_negative_intro':
            return <PositiveNegativeIntroRenderer />;
         case 'skip_counting':
            return <SkipCountingRenderer />;
         case 'fraction_intro':
            return <FractionIntroRenderer />;
         case 'multiplication_repeated_addition':
            return <MultiplicationRepeatedAdditionRenderer />;
         case 'division_fair_sharing':
            return <DivisionFairSharingRenderer />;
         case 'multi_digit_addition_regrouping':
            return <MultiDigitAdditionRegroupingRenderer />;
         case 'multi_digit_subtraction_borrowing':
            return <MultiDigitSubtractionBorrowingRenderer />;
         case 'multiplication_tables':
            return <MultiplicationTablesRenderer />;
         case 'z_score':
            return <ZScoreRenderer />;
         case 'correlation_coefficient':
            return <CorrelationCoefficientRenderer />;
         case 'combinations_permutations':
            return <CombinationsPermutationsRenderer />;
         case 'conditional_probability':
            return <ConditionalProbabilityRenderer />;
         case 'margin_of_error':
            return <MarginOfErrorRenderer />;
         // Plural/variant type mappings to existing renderers
         case 'metal_conductors':
            return <ConductivityTesterRenderer />;
         case 'insulators':
            return <ConductivityTesterRenderer />;
         case 'simple_switches':
            return <SimpleSwitchRenderer />;
         case 'magnetic_poles':
            return <MagneticPoleRenderer />;
         case 'compass_use':
            return <CompassRenderer />;
         case 'electromagnets':
            return <ElectromagnetRenderer />;
         case 'basic_motors':
            return <BasicMotorRenderer />;
         case 'basic_generators':
            return <BasicGeneratorRenderer />;
         case 'earth_magnetic_field':
            return <EarthFieldRenderer />;
         case 'lorentz_force':
            return <LorentzForceRenderer />;
         case 'inductance':
            return <InductanceRenderer />;
         case 'transformers':
            return <TransformersRenderer />;
         case 'day_night_cycle':
            return <DayNightCycleRenderer />;
         case 'moon_phases':
            return <MoonPhasesRenderer />;
         case 'time_dilation':
            return <TimeDilationRenderer />;
         case 'atom_structure':
            return <AtomStructureRenderer />;
         case 'solenoid':
            return <InductanceRenderer />;
         case 'seasons':
            return <DayNightCycleRenderer />;
         case 'solar_system':
            return <MoonPhasesRenderer />;
         case 'isotopes':
            return <AtomStructureRenderer />;
         case 'length_contraction':
            return <TimeDilationRenderer />;
         case 'mass_energy':
            return <TimeDilationRenderer />;
         // ============================================
         // ENTREPRENEURSHIP GRAPHICS (50)
         // ============================================
         // Mindset & Foundational Skills (10)
         case 'growth_mindset':
            return <GrowthMindsetRenderer />;
         case 'opportunity_recognition':
            return <OpportunityRecognitionRenderer />;
         case 'calculated_risk':
            return <CalculatedRiskRenderer />;
         case 'resilience_grit':
            return <ResilienceGritRenderer />;
         case 'scamper_creativity':
            return <ScamperCreativityRenderer />;
         case 'critical_thinking':
            return <CriticalThinkingRenderer />;
         case 'self_reliance':
            return <SelfRelianceRenderer />;
         case 'adaptability_pivot':
            return <AdaptabilityPivotRenderer />;
         case 'empathy_mapping':
            return <EmpathyMappingRenderer />;
         case 'ethical_leadership':
            return <EthicalLeadershipRenderer />;
         // Ideation & Design Thinking (10)
         case 'design_thinking':
            return <DesignThinkingRenderer />;
         case 'problem_solution_fit':
            return <ProblemSolutionFitRenderer />;
         case 'customer_discovery':
            return <CustomerDiscoveryRenderer />;
         case 'user_personas':
            return <UserPersonasRenderer />;
         case 'value_proposition':
            return <ValuePropositionRenderer />;
         case 'prototyping':
            return <PrototypingRenderer />;
         case 'iterative_design':
            return <IterativeDesignRenderer />;
         case 'blue_ocean':
            return <BlueOceanRenderer />;
         case 'trend_analysis':
            return <TrendAnalysisRenderer />;
         case 'first_principles':
            return <FirstPrinciplesRenderer />;
         // Business Models & Strategy (10)
         case 'lean_canvas':
            return <LeanCanvasRenderer />;
         case 'business_model_canvas':
            return <BusinessModelCanvasRenderer />;
         case 'b2b_vs_b2c':
            return <B2bVsB2cRenderer />;
         case 'revenue_models':
            return <RevenueModelsRenderer />;
         case 'unit_economics':
            return <UnitEconomicsRenderer />;
         case 'cac_calculator':
            return <CacCalculatorRenderer />;
         case 'ltv_calculator':
            return <LtvCalculatorRenderer />;
         case 'scalability':
            return <ScalabilityRenderer />;
         case 'franchising':
            return <FranchisingRenderer />;
         case 'social_enterprise':
            return <SocialEnterpriseRenderer />;
         // Marketing & Sales (10)
         case 'four_ps_marketing':
            return <FourPsMarketingRenderer />;
         case 'branding_identity':
            return <BrandingIdentityRenderer />;
         case 'digital_marketing':
            return <DigitalMarketingRenderer />;
         case 'content_strategy':
            return <ContentStrategyRenderer />;
         case 'email_marketing':
            return <EmailMarketingRenderer />;
         case 'influencer_marketing':
            return <InfluencerMarketingRenderer />;
         case 'sales_funnel':
            return <SalesFunnelRenderer />;
         case 'public_relations':
            return <PublicRelationsRenderer />;
         case 'guerrilla_marketing':
            return <GuerrillaMarketingRenderer />;
         case 'copywriting':
            return <CopywritingRenderer />;
         // Financial Literacy (10)
         case 'bootstrapping':
            return <BootstrappingRenderer />;
         case 'cash_flow':
            return <CashFlowRenderer />;
         case 'profit_loss':
            return <ProfitLossRenderer />;
         case 'break_even':
            return <BreakEvenRenderer />;
         case 'pricing_strategies':
            return <PricingStrategiesRenderer />;
         case 'equity_ownership':
            return <EquityOwnershipRenderer />;
         case 'angel_investors':
            return <AngelInvestorsRenderer />;
         case 'venture_capital':
            return <VentureCapitalRenderer />;
         case 'crowdfunding':
            return <CrowdfundingRenderer />;
         case 'pitch_deck':
            return <PitchDeckRenderer />;
         // ============================================
         // ENTREPRENEURSHIP GRAPHICS PART 2 (50)
         // Section VI: Operations & Management
         // ============================================
         case 'supply_chain':
            return <SupplyChainRenderer />;
         case 'inventory_management':
            return <InventoryManagementRenderer />;
         case 'outsourcing':
            return <OutsourcingRenderer />;
         case 'hiring':
            return <HiringRenderer />;
         case 'project_management':
            return <ProjectManagementRenderer />;
         case 'quality_control':
            return <QualityControlRenderer />;
         case 'customer_success':
            return <CustomerSuccessRenderer />;
         case 'agile':
            return <AgileRenderer />;
         case 'time_management':
            return <TimeManagementRenderer />;
         case 'business_structures':
            return <BusinessStructuresRenderer />;
         case 'intellectual_property':
            return <IntellectualPropertyRenderer />;
         case 'contracts':
            return <ContractsRenderer />;
         case 'permits':
            return <PermitsRenderer />;
         case 'employment_law':
            return <EmploymentLawRenderer />;
         case 'ecommerce':
            return <EcommerceRenderer />;
         case 'social_media':
            return <SocialMediaRenderer />;
         case 'seo':
            return <SEORenderer />;
         case 'analytics':
            return <AnalyticsRenderer />;
         case 'cybersecurity':
            return <CybersecurityRenderer />;
         case 'elevator_pitch':
            return <ElevatorPitchRenderer />;
         case 'networking':
            return <NetworkingRenderer />;
         case 'branding':
            return <BrandingRenderer />;
         case 'public_relations':
            return <PublicRelationsRenderer />;
         case 'negotiation':
            return <NegotiationRenderer />;
         case 'fundraising':
            return <FundraisingRenderer />;
         case 'financial_statements':
            return <FinancialStatementsRenderer />;
         case 'pricing_strategy':
            return <PricingStrategyRenderer />;
         case 'budgeting':
            return <BudgetingRenderer />;
         case 'unit_economics':
            return <UnitEconomicsRenderer />;
         case 'market_research':
            return <MarketResearchRenderer />;
         case 'competitive_analysis':
            return <CompetitiveAnalysisRenderer />;
         case 'business_model':
            return <BusinessModelRenderer />;
         case 'growth_strategy':
            return <GrowthStrategyRenderer />;
         case 'pivot_decision':
            return <PivotDecisionRenderer />;
         case 'team_building':
            return <TeamBuildingRenderer />;
         case 'leadership':
            return <LeadershipRenderer />;
         case 'customer_journey':
            return <CustomerJourneyRenderer />;
         case 'mvp':
            return <MVPRenderer />;
         case 'risk_assessment':
            return <RiskAssessmentRenderer />;
         case 'sustainability':
            return <SustainabilityRenderer />;
         case 'exit_strategy':
            return <ExitStrategyRenderer />;
         case 'business_structures':
            return <BusinessStructuresRenderer />;
         default:
            return <GenericRenderer />;
      }
   };

   return (
      <div className="h-full flex flex-col bg-[#F8FAFC]">
         <div className="flex-1 overflow-auto custom-scrollbar relative">
            {renderVisual()}
         </div>
         <div className="px-6 py-3 bg-white border-t border-slate-200 text-[10px] text-slate-500 font-medium flex gap-2 items-center justify-center shrink-0">
            <i className="fa-solid fa-brain text-indigo-500"></i>
            <span className="font-serif italic opacity-80">{parsedData?.insight || "Interactive model generated by Atlas Core."}</span>
         </div>
      </div>
   );
};

export default GeneratedDiagram;
